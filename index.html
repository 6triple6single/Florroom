<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>Play Florroom!</title>
	<link rel="icon" href="data:image/svg+xml,
		<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
			<path d='M0 0L100 0L100 100L0 100Z' style='stroke: none; fill: %23ffff7f'/>
			<path d='M18 66A40 40 0 0 0 82 66M30 18L30 50M70 18L70 50' style='stroke: %23000000; stroke-width: 5px; fill: none'/>
		</svg>
	">
	<style>
		body {
			touch-action: manipulation;
			-webkit-user-select: none;
			user-select: none;
			overflow: hidden;
		}
		input {
			width: 30px;
		}
		g,path {
			transform-origin: center;
		}
		#version1 {
			position: absolute;
			top: 0px;
			left: 0px;
			background-color: #bf7fbf;
			height: 100%;
			width: 100%;
			pointer-events: none;
			z-index: 7000;
		}
		#version2 {
			display: flex;
			flex-direction: column;
			position: absolute;
			top: 50%;
			left: 50%;
			background-color: #7fbf7f;
			width: 50%;
			transform: translate(-50%,-50%);
			border: 2px solid;
			padding-bottom: 50px;
			overflow-x: hidden;
			overflow-y: auto;
			align-items: center;
			z-index: 7744;
		}
		#version3 {
			border: 1.5px solid;
			outline: none;
			background-color: #7f9fbf;
			height: 30px;
			width: 200px;
		}
		#version4 {
			border: 1.5px solid;
			outline: none;
			background-color: #bf9f7f;
			height: 30px;
			width: 200px;
		}
		#endgame1 {
			position: absolute;
			top: 0px;
			left: 0px;
			background-color: #7f7fbf;
			height: 100%;
			width: 100%;
			pointer-events: none;
			z-index: 7000;
		}
		#endgame2 {
			display: flex;
			flex-direction: column;
			position: absolute;
			top: 50%;
			left: 50%;
			background-color: #7fbf7f;
			width: 50%;
			transform: translate(-50%,-50%);
			border: 2px solid;
			padding-bottom: 50px;
			overflow-x: hidden;
			overflow-y: auto;
			align-items: center;
			z-index: 7744;
		}
		#endgame3 {
			border: 1.5px solid;
			outline: none;
			background-color: #7fffff;
			height: 30px;
			width: 200px;
		}
		#end1 {
			position: absolute;
			top: 0px;
			left: 0px;
			background-color: #000000;
			height: 100%;
			width: 100%;
			opacity: 1;
			pointer-events: none;
			z-index: 7976;
		}
		#end2 {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%,-50%);
			font-size: 32px;
			color: #ffffff;
			opacity: 0;
			pointer-events: none;
			z-index: 7979;
		}
		.tl {
			position: absolute;
			top: 20px;
			left: 20px;
		}
		.tr {
			position: absolute;
			top: 20px;
			right: 20px;
		}
		.bl {
			position: absolute;
			bottom: 20px;
			left: 20px;
		}
		.br {
			position: absolute;
			bottom: 20px;
			right: 20px;
		}
		.mid {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%,-50%) var(--transform2,translate(0px,0px));
		}
		.cmid {
			position: absolute;
			top: 50%;
			transform: translate(0px,-50%) var(--transform2,translate(0px,0px));
		}
		.rmid {
			position: absolute;
			left: 50%;
			transform: translate(-50%,0px) var(--transform2,translate(0px,0px));
		}
		.smid {
			position: absolute;
			transform: translate(-50%,-50%);
		}
		.bottom {
			position: absolute;
			top: 100%;
			left: 50%;
			transform: translate(-50%,-100px);
		}
		.lcmargin {
			margin-top: 5px;
			margin-bottom: 5px;
		}
		.cmargin {
			margin-top: 20px;
			margin-bottom: 20px;
		}
		.topmargin {
			margin-top: 20px;
		}
		.bottommargin {
			margin-bottom: 20px;
		}
		.hcmargin {
			margin-top: 50px;
			margin-bottom: 50px;
		}
		.llmargin {
			margin-left: 5px;
			margin-right: 5px;
		}
		.lmargin {
			margin-left: 20px;
			margin-right: 20px;
		}
		.hlmargin {
			margin-left: 50px;
			margin-right: 50px;
		}
		.diag {
			transform: rotate(45deg);
		}
		.rot72 {
			transform: rotate(72deg);
		}
		.rot144 {
			transform: rotate(144deg);
		}
		.rot216 {
			transform: rotate(216deg);
		}
		.rot288 {
			transform: rotate(288deg);
		}
		.nowrap {
			white-space: nowrap;
		}
		.sqrbtn {
			background: none;
			border: none;
			outline: none;
			height: 50px;
			width: 50px;
			padding: 0px;
		}
		.sqrbtn:hover {
			background: #dfffdf;
		}
		.recbtn {
			border: 1.5px solid;
			outline: none;
			height: 30px;
			min-width: 50px;
			padding: 5px;
			white-space: nowrap;
		}
		.srecbtn {
			border: 1px solid;
			outline: none;
			height: 20px;
			min-width: 30px;
			padding: 3px;
			font-size: 12px;
			white-space: nowrap;
		}
		.circbtn {
			background: none;
			border: none;
			outline: none;
			height: 50px;
			width: 50px;
			border-radius: 50%;
			padding: 0px;
			overflow: hidden;
		}
		.circbtn:hover {
			background: #dfffdf;
		}
		.dice {
			background: none;
			border: none;
			outline: none;
			height: 60px;
			width: 60px;
			padding: 0px;
		}
		.mingrid {
			background: none;
			position: relative;
			border: none;
			outline: none;
			height: 20px;
			width: 20px;
			padding: 0px;
		}
		.sgrid {
			background: none;
			position: relative;
			border: none;
			outline: none;
			height: 40px;
			width: 40px;
			padding: 0px;
		}
		.grid {
			background: none;
			position: relative;
			border: 2px solid;
			outline: none;
			height: 60px;
			width: 60px;
			padding: 0px;
		}
		.bgrid {
			background: none;
			position: relative;
			border: none;
			border-radius: 8%;
			outline: none;
			height: 80px;
			width: 80px;
			padding: 0px;
		}
		.bar-container {
			background-color: #7f7f7f;
			position: relative;
			height: 30px;
			width: 250px;
			border-radius: 15px;
		}
		.bar {
			background-color: #5fbf5f;
			height: 100%;
			width: 50%;
			border-radius: 15px;
		}
		.bar-text {
			display: flex;
			position: absolute;
			top: 0px;
			left: 0px;
			height: 100%;
			width: 100%;
			justify-content: center;
			align-items: center;
		}
		.side-bar-container {
			background-color: #7f7f7f;
			position: relative;
			height: 500px;
			width: 30px;
			border-radius: 15px;
		}
		.side-bar {
			background-color: #5fbf5f;
			position: absolute;
			bottom: 0px;
			height: 50%;
			width: 100%;
			border-radius: 15px;
		}
		.pointer {
			cursor: pointer;
		}
		.drag {
			cursor: grab;
		}
		.drag:active {
			cursor: grabbing;
		}
		.forbidden {
			cursor: not-allowed;
		}
		.in-svg {
			height: 100%;
			width: 100%;
			stroke: #000000;
			stroke-width: 5px;
			fill: none;
		}
		.small-svg {
			height: 15px;
			min-width: 15px;
			stroke: #000000;
			stroke-width: 2px;
			fill: none;
		}
		.black {
			color: #000000;
		}
		.black-bg {
			background-color: #000000;
		}
		.fblack-path {
			stroke-width: 1px;
			fill: #000000;
		}
		.black-path {
			stroke: #000000;
		}
		.dgrey {
			color: #3f3f3f;
		}
		.dgrey-bg {
			background-color: #3f3f3f;
		}
		.fdgrey-path {
			stroke-width: 1px;
			fill: #3f3f3f;
		}
		.dgrey-path {
			stroke: #3f3f3f;
		}
		.grey {
			color: #7f7f7f;
		}
		.grey-bg {
			background-color: #7f7f7f;
		}
		.fgrey-path {
			stroke-width: 1px;
			fill: #7f7f7f;
		}
		.grey-path {
			stroke: #7f7f7f;
		}
		.lgrey {
			color: #bfbfbf;
		}
		.lgrey-bg {
			background-color: #bfbfbf;
		}
		.flgrey-path {
			stroke-width: 1px;
			fill: #bfbfbf;
		}
		.lgrey-path {
			stroke: #bfbfbf;
		}
		.white {
			color: #ffffff;
		}
		.white-bg {
			background-color: #ffffff;
		}
		.fwhite-path {
			stroke-width: 1px;
			fill: #ffffff;
		}
		.white-path {
			stroke: #ffffff;
		}
		.red {
			color: #ff7f7f;
		}
		.red-bg {
			background-color: #ff7f7f;
		}
		.fred-path {
			stroke-width: 1px;
			fill: #ff7f7f;
		}
		.red-path {
			stroke: #ff7f7f;
		}
		.lred {
			color: #ffbfbf;
		}
		.lred-bg {
			background-color: #ffbfbf;
		}
		.flred-path {
			stroke-width: 1px;
			fill: #ffbfbf;
		}
		.lred-path {
			stroke: #ffbfbf;
		}
		.green {
			color: #7fff7f;
		}
		.green-bg {
			background-color: #7fff7f;
		}
		.fgreen-path {
			stroke-width: 1px;
			fill: #7fff7f;
		}
		.green-path {
			stroke: #7fff7f;
		}
		.lgreen {
			color: #bfffbf;
		}
		.lgreen-bg {
			background-color: #bfffbf;
		}
		.flgreen-path {
			stroke-width: 1px;
			fill: #bfffbf;
		}
		.lgreen-path {
			stroke: #bfffbf;
		}
		.blue {
			color: #7f7fff;
		}
		.blue-bg {
			background-color: #7f7fff;
		}
		.fblue-path {
			stroke-width: 1px;
			fill: #7f7fff;
		}
		.blue-path {
			stroke: #7f7fff;
		}
		.lblue {
			color: #bfbfff;
		}
		.lblue-bg {
			background-color: #bfbfff;
		}
		.flblue-path {
			stroke-width: 1px;
			fill: #bfbfff;
		}
		.lblue-path {
			stroke: #bfbfff;
		}
		.cyan {
			color: #7fffff;
		}
		.cyan-bg {
			background-color: #7fffff;
		}
		.fcyan-path {
			stroke-width: 1px;
			fill: #7fffff;
		}
		.cyan-path {
			stroke: #7fffff;
		}
		.lcyan {
			color: #bfffff;
		}
		.lcyan-bg {
			background-color: #bfffff;
		}
		.llcyan {
			color: #dfffff;
		}
		.llcyan-bg {
			background-color: #dfffff;
		}
		.purple {
			color: #ff7fff;
		}
		.purple-bg {
			background-color: #ff7fff;
		}
		.fpurple-path {
			stroke-width: 1px;
			fill: #ff7fff;
		}
		.purple-path {
			stroke: #ff7fff;
		}
		.lpurple {
			color: #ffbfff;
		}
		.lpurple-bg {
			background-color: #ffbfff;
		}
		.llpurple {
			color: #ffdfff;
		}
		.llpurple-bg {
			background-color: #ffdfff;
		}
		.yellow {
			color: #ffff7f;
		}
		.yellow-bg {
			background-color: #ffff7f;
		}
		.fyellow-path {
			stroke-width: 1px;
			fill: #ffff7f;
		}
		.yellow-path {
			stroke: #ffff7f;
		}
		.lyellow {
			color: #ffffbf;
		}
		.lyellow-bg {
			background-color: #ffffbf;
		}
		.flyellow-path {
			stroke-width: 1px;
			fill: #ffffbf;
		}
		.lyellow-path {
			stroke: #ffffbf;
		}
		.llyellow {
			color: #ffffdf;
		}
		.llyellow-bg {
			background-color: #ffffdf;
		}
		.fllyellow-path {
			stroke-width: 1px;
			fill: #ffffdf;
		}
		.llyellow-path {
			stroke: #ffffdf;
		}
		.dbrown {
			color: #bf3f3f;
		}
		.dbrown-bg {
			background-color: #bf3f3f;
		}
		.fdbrown-path {
			stroke-width: 1px;
			fill: #bf3f3f;
		}
		.dbrown-path {
			stroke: #bf3f3f;
		}
		.dgreen {
			color: #3fbf3f;
		}
		.dgreen-bg {
			background-color: #3fbf3f;
		}
		.fdgreen-path {
			stroke-width: 1px;
			fill: #3fbf3f;
		}
		.dgreen-path {
			stroke: #3fbf3f;
		}
		.dblue {
			color: #3f3fbf;
		}
		.dblue-bg {
			background-color: #3f3fbf;
		}
		.fdblue-path {
			stroke-width: 1px;
			fill: #3f3fbf;
		}
		.dblue-path {
			stroke: #3f3fbf;
		}
		.cpurple {
			color: #bf3fff;
		}
		.cpurple-bg {
			background-color: #bf3fff;
		}
		.fcpurple-path {
			stroke-width: 1px;
			fill: #bf3fff;
		}
		.cpurple-path {
			stroke: #bf3fff;
		}
		.cpink {
			color: #ff7fbf;
		}
		.cpink-bg {
			background-color: #ff7fbf;
		}
		.fcpink-path {
			stroke-width: 1px;
			fill: #ff7fbf;
		}
		.cpink-path {
			stroke: #ff7fbf;
		}
		.cred {
			color: #ff3f3f;
		}
		.cred-bg {
			background-color: #ff3f3f;
		}
		.fcred-path {
			stroke-width: 1px;
			fill: #ff3f3f;
		}
		.cred-path {
			stroke: #ff3f3f;
		}
		.cdred {
			color: #bf0000;
		}
		.cdred-bg {
			background-color: #bf0000;
		}
		.fcdred-path {
			stroke-width: 1px;
			fill: #bf0000;
		}
		.cdred-path {
			stroke: #bf0000;
		}
		.cyellow {
			color: #ffdf7f;
		}
		.cyellow-bg {
			background-color: #ffdf7f;
		}
		.fcyellow-path {
			stroke-width: 1px;
			fill: #ffdf7f;
		}
		.cyellow-path {
			stroke: #ffdf7f;
		}
		.corange-path {
			stroke: #ffbf3f;
		}
		.corange {
			color: #ffbf3f;
		}
		.corange-bg {
			background-color: #ffbf3f;
		}
		.fcorange-path {
			stroke-width: 1px;
			fill: #ffbf3f;
		}
		.cbrown {
			color: #bf7f3f;
		}
		.cbrown-bg {
			background-color: #bf7f3f;
		}
		.fcbrown-path {
			stroke-width: 1px;
			fill: #bf7f3f;
		}
		.cbrown-path {
			stroke: #bf7f3f;
		}
		.sel-path {
			stroke-width: 1px;
			stroke: #ffff7f;
			fill: #ffff7f;
		}
		.square36 {
			display: grid;
			grid-template-columns: repeat(6,1fr);
			grid-template-rows: repeat(6,1fr);
			background: none;
			border: none;
			height: 380px;
			width: 380px;
			align-items: center;
		}
		.square48 {
			display: grid;
			grid-template-columns: repeat(8,1fr);
			grid-template-rows: repeat(3,1fr) 10px repeat(3,1fr);
			background: none;
			border: 2px solid;
			height: 490px;
			width: 640px;
			align-items: center;
		}
		.col5 {
			display: grid;
			grid-template-columns: repeat(auto-fill,minmax(90px,1fr));
			width: 80%;
			margin: 0 auto;
			row-gap: 10px;
			justify-items: center;
		}
		.box {
			display: flex;
			flex-direction: column;
			border: 2px solid;
			padding-inline: 20px;
			overflow-x: hidden;
			overflow-y: auto;
			text-align: center;
		}
		.inner-box {
			display: flex;
			flex-direction: column;
			font-family: Consolas;
			width: max-content;
			border: 1.5px solid;
			padding: 10px;
			align-items: flex-start;
			align-self: center;
		}
		.inner-box * {
			font-family: Consolas;
		}
		.infobox {
			display: flex;
			flex-direction: column;
			border: 1px solid;
			font-size: 12px;
			width: 300px;
			padding: 10px;
			padding-top: 5px;
			text-align: center;
			opacity: 0.95;
		}
		.itembox {
			background-color: rgba(191,191,191,0.8);
			display: flex;
			height: 90px;
			width: 400px;
			padding: 10px;
			gap: 20px;
			overflow-x: scroll;
			overflow-y: hidden;
			scrollbar-width: thin;
		}
		.itembox>* {
			flex-shrink: 0;
		}
		.inner-input {
			background: #5fbf5f;
			border: none;
			outline: none;
			width: 90%;
			justify-items: center;
			align-self: center;
		}
		.side-log {
			position: absolute;
			background-color: rgba(191,191,191,0.8);
			border: 1px solid;
			top: 25%;
			right: 20px;
			height: 50%;
			width: 300px;
			padding: 5px;
			box-sizing: border-box;
			overflow-x: hidden;
			overflow-y: auto;
			scrollbar-width: none;
			font-size: 12px;
			word-wrap: break-word;
		}
		.side-command {
			position: absolute;
			background-color: rgba(159,159,159,0.8);
			border: 1px solid;
			top: 75%;
			right: 20px;
			height: 20px;
			width: 300px;
			padding-inline: 5px;
			box-sizing: border-box;
		}
		.side-input {
			background: none;
			border: none;
			outline: none;
			height: 100%;
			width: 100%;
			padding: 0px;
		}
		.text1 {
			font-size: 32px;
		}
		.text1-c {
			display: flex;
			font-size: 32px;
			justify-content: center;
			align-items: center;
		}
		.text2 {
			font-size: 24px;
		}
		.text2-c {
			display: flex;
			font-size: 24px;
			justify-content: center;
			align-items: center;
		}
		.text3 {
			font-size: 16px;
		}
		.text3-c {
			display: flex;
			font-size: 16px;
			justify-content: center;
			align-items: center;
		}
		.text4 {
			font-size: 12px;
		}
		.text4-c {
			display: flex;
			font-size: 12px;
			justify-content: center;
			align-items: center;
		}
		.text5 {
			font-size: 8px;
		}
		.text5-c {
			display: flex;
			font-size: 8px;
			justify-content: center;
			align-items: center;
		}
		.highz {
			z-index: 6361;
		}
		.higherz {
			z-index: 6666;
		}
		.highestz {
			z-index: 6859;
		}
		.wider {
			stroke-width: 8px;
		}
		.wide {
			stroke-width: 3px;
		}
		.mwidth {
			stroke-width: 1.5px;
		}
		.narrow {
			stroke-width: 0.5px;
		}
		.narrowp {
			stroke-width: 0.1px;
		}
		.shsize {
			height: 30%;
			width: 30%;
		}
		.shwidth {
			width: 30%;
		}
		.hsize {
			height: 50%;
			width: 50%;
		}
		.hwidth {
			width: 50%;
		}
		.lhsize {
			height: 70%;
			width: 70%;
		}
		.lhwidth {
			width: 70%;
		}
		.apos {
			position: absolute;
		}
		.nd {
			display: none;
		}
		.rflex {
			display: flex;
			flex-direction: row;
		}
		.cflex {
			display: flex;
			flex-direction: column;
		}
		.mcont {
			width: max-content;
		}
		.nlh {
			line-height: 0;
		}
		.cself {
			align-self: center;
		}
		.border {
			border: 3px solid;
		}
		.circ {
			border-radius: 50%;
		}
		.ns {
			stroke: none;
		}
		.rcap {
			stroke-linecap: round;
		}
		.bold {
			font-weight: bold;
		}
		.npe {
			pointer-events: none;
		}
	</style>
	<script>
		const PetalNameList=["Basic","Light","Rock","Rose","Stinger","Iris","Wing","Missile","Grapes","Cactus","Faster","Bubble","Pollen","Dandelion","Beetle Egg","Antennae","Heavy","Yin Yang","Web","Honey","Leaf","Salt","Rice","Corn","Sand","Pincer","Yucca","Magnet","Yggdrasil","Starfish","Pearl","Lightning","Jelly","Claw","Shell","Dahlia","Sponge","Soil","Fangs","Third Eye","Peas","Stick","Clover","Powder","Air","Basil","Orange","Ant Egg","Poo","Relic","Lotus","Bulb","Cotton","Carrot","Bone","Plank","Tomato","Mark","Rubber","Blood Stinger","Bur","Root","Dice","Talisman","Battery","Amulet","Compass","Disc","Shovel","Coin","Chip","Card","Moon Rock","Privet","Glass","Corruption","Coral","Wax","Golden Leaf","Monstera","Domino","Triangle"]
		Object.assign(PetalNameList,{222:"2 Turn Kill",401:"Rift"})
		const PetalLowestRarityList=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,4,1,1,1,1,1,1,1,1,1,4,5,1,1,1,1,1,1,1,1,4,1,5,1,4,1,4,1,5,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,5,1,1,5,1,5,5,4,1,1]
		Object.assign(PetalLowestRarityList,{222:2,401:5})
		const PetalHealthList=[5,2,10,5,1,"*",2,"*","*",8,3,"*",12,"*",10,"/",15,2,"*","*",3,5,"*",20,2,"*",5,8,2,5,12,"*",6,2,5,2,"/",5,2,"/","*",12,3,"/","*","/",6,10,5,5,6,3,8,"*",8,10,20,"*","/",1,"*",6,5,"/","/","/","/","/","*",6,1,5,100,"*","*","/",8,50,5,10,5,2]
		Object.assign(PetalHealthList,{222:"*2",401:"*"})
		const PetalDamageList=[5,2,10,"*",20,3,5,6,2,2,6,"*",1,3,3,"/",6,2,"*","*",3,3,1,3,3,3,3,3,2,3,5,8,3,3,"*","*","/",3,6,"/",3,5,3,"/","*","/",3,2,"*",3,2,"*","*",2,5,6,2,"*","/",15,6,2,5,"/","/","/","/","/","*",6,3,5,2,3,1,"/",8,"*",6,2,2,5]
		Object.assign(PetalDamageList,{222:"*2",401:"*"})
		const PetalSizeList=[10,6,12,10,6,6,5,"*","*",12,6,"*",15,"*",15,"/",15,10,"*","*",12,10,8,10,10,6,10,12,12,8,15,"*",10,10,10,6,"/",10,10,"/","*",15,6,"/","*","/",10,10,8,8,8,6,15,"*",10,12,5,"*","/",6,8,10,10,"/","/","/","/","/","*",10,8,10,20,6,"*","/",10,15,12,15,12,6]
		Object.assign(PetalSizeList,{222:"*2",401:"*"})
		const PetalSpeedList=[50,60,20,40,30,30,60,50,60,20,60,"*",20,50,"*","/",20,50,50,200,30,40,500,20,50,40,20,40,30,20,50,30,30,60,40,50,"/",50,30,"/",60,"*",80,"/",150,"/",50,"*",40,50,50,60,40,30,40,40,30,"*","/",30,50,20,40,"/","/","/","/","/","*",50,40,40,"*",50,200,"/",40,"*",20,30,40,50]
		Object.assign(PetalSpeedList,{222:"*226",401:50})
		const PetalReloadList=[300,500,300,500,600,500,300,300,500,400,300,10,500,300,10,"/",400,300,300,100,300,300,100,400,500,500,300,500,200,300,500,300,400,300,500,500,"/",300,300,"/",400,30,300,"/",200,"/",600,30,400,300,300,200,600,300,500,500,300,20,"/",400,300,100,200,"/","/","/","/","/",10,300,300,200,20,300,100,"/",400,20,300,200,200,300]
		Object.assign(PetalReloadList,{222:"*6260",401:100})
		const PetalATKList=["40-80","40-50","70-90","0-0","50-70","40-100","70-100","0-0","0-0","40-80","50-90","0-0","0-0","0-0","0-0","/","20-30","0-0","0-0","0-0","60-80","40-80","50-90","10-60","50-90","40-80","30-60","40-40","30-60","40-80","0-0","0-0","50-80","50-90","0-0","0-0","/","40-60","60-80","/","0-0","0-0","60-80","/","80-100","/","70-90","0-0","0-0","60-80","30-70","0-0","0-0","0-0","70-80","60-70","20-40","0-0","/","50-70","60-70","0-0","40-80","/","/","/","/","/","0-0","40-80","50-80","80-50","0-0","60-90","0-0","/","50-80","0-0","40-60","20-30","80-50","30-70"]
		Object.assign(PetalATKList,{222:"0-100",401:"0-30"})
		const PetalDEFList=["60-80","50-70","70-90","30-30","50-70","30-40","60-90","0-0","0-0","40-80","50-60","0-0","70-80","0-0","0-0","/","30-80","60-60","0-0","100-100","30-60","40-70","20-30","50-90","50-90","50-80","60-80","50-60","60-80","50-60","30-80","0-0","60-90","50-80","30-30","30-30","/","50-60","30-80","/","0-0","0-0","40-60","/","0-0","/","60-90","0-0","0-80","40-80","50-60","50-50","10-50","0-0","60-70","60-90","20-40","0-0","/","50-70","0-30","30-60","40-80","/","/","/","/","/","0-0","60-80","30-80","50-50","90-100","30-70","0-0","/","50-80","80-100","40-70","60-80","0-0","0-30"]
		Object.assign(PetalDEFList,{222:"0-100",401:"0-0"})
		const PetalDescriptionList=["Nice petal, strong but can't craft.","Weaker than most petals, but recharges very quickly and has five parts.","Extremely durable, but takes a bit longer to recharge.","Its healing properties are amazing.","It really hurts, but it's very fragile.","Very poisonous, but takes a while to do its work.","Good at combat, but got nerfed in Florroom Rewritten.","You can actually shoot this one.","It goes poof with poison.","Somehow increases your maximum health.","It makes your other petals action faster.","Physics are for the another petal called magnet.","Asthmatics beware.","Its interesting properties inhibits healing effects on affected units.","Something interesting might pop out of this.","Allows you to sense incoming enemies.","This thing is so heavy that nothing gets in the way.","This mysterious thing rotates your petals in multiple ways.","It's really sticky.","It attracts mobs and let them prioritize this over flowers.","Gathers energy from the sun to heal your flower passively.","Reflects some of the damage you take back to the enemy that dealt it.","Spawns very quickly, but can't hit enemy back.","Takes a long time to spawn, but has a lot of health.","Bunch of sand particles.","Debilitates enemies temporarily, reducing their movement speed.","Heals your flower faster but has condition.","By physics laws, it attracts lightning.","Dried leaf from the Yggdrasil tree that could revive you.","Heals your flower faster but only while low health.","It can be moved even further.","Strikes all nearby enemies.","No one likes touching this.","Deals extra damage to undamaged targets.","Gives you a temporary shield.","Small amount of heal but fairly consistent.","Spreads damage taken by the flower over time.","Increases petal size.","Heals your flower based on damage dealt by it.","Improves your petal control skill.","It goes poof and hits multiple enemies.","Mysterious stick that summons the forces of the wind.","Weak petal. Perhaps it makes you lucky.","Increases movement speed and results in extra turns.","It's literally air but not nothing.","Improves healing petals.","Sweet citrus fruit.","More interesting things might pop out of this.","Makes mobs less likely to move.","Strange relic. Makes mobs become neutral.","Prevents your flower from poisoning.","Shiny lightbulb that attracts mobs.","Absorbs damage taken by the flower when suspended.","Sturdy and reliable. Can be shot and bounces between enemies.","Sturdy petal with high armor.","It's useful for defending projectiles.","Grows over time but don't let it grow too much.","Dark mark that teleports enemies to hell.","Knockbacks flower when damaged so you have more time to react.","It even hurts, but with some costs.","Decrease armor of affected unit.","Provides additional armor for flower.","Not to play PFLF but just roll it.","Pattern that allows you to evade enemy attacks.","Discharges electricity to compensate energy loss.","Converts a percentage of overheal into shields.","It guides your actions.","Reduces all phisical damage taken.","Becomes untargetable for a single turn.","Looks like basic, but gilded.","All in but there is no gamble feature.","Playing card.","This thing is so big its gravity pulls your other petals.","Deals extra poison damage.","Phases through enemies.","Corrupts your soul. Consumes your mind.","Breaks apart on impact with reduced strength.","Just a bigger honey.","Very special leaf lets your petals reload even faster.","Heals itself and petals around it.","Damage depends on the point.","The more it is, the stronger it is."]
		Object.assign(PetalDescriptionList,{222:"<==>, Turn 2, Score 2, Clear 0",401:"Exile mobs into the abyss... But what is the cost?"})
		const PetalAttributeList=["ATTRIBUTE=Can't craft. Can't absorb. No attribute floating.","COUNT=5","DEFEND=Reduces action by 50 down to 0.","SKILL=Destroys. Heals flower for [200%*Health].","ATKDEF=Kills target if its remaining health (After damage dealt) is less than [Damage] when success.","DESTROY=Deals [Damage] [poison] for 10 turns.","DEFEND=Reduces action to 0.","SHOOT=10 range. 100% accuracy decline. 1 bounce. 5 bounce range. 100% bounce accuracy decline. 100% repeated hitting decline.","SHOOT=3 range. 10% accuracy decline. 3 bounce. 2 bounce range. 20% bounce accuracy decline. 30% repeated hitting decline. Deals [25%*Damage] [poison] for 5 turns.","EQUIP=Increases flower max health by [Health].","SKILL=Costs 200 action. Almost all petals (except faster, 1-speed petal and luck related petal) gain [45+3*Rarity] action.","SKILL=Reduces all mobs' action to [100-30*Level]. Neutral mobs turn back to passive. Applies immunity to flower for [2+Rarity] turns. Retires.","DESTROY=If there's a empty grid below and size is over 5, moves to that grid, reduces petal max health to [80%*Health] and sets health to max, reduces size by 1. Resets attribute otherwise.","SHOOT=5 range. 50% accuracy decline. 1 bounce. 3 bounce range. 50% bounce accuracy decline. 100% repeated hitting decline. Disables target's heal ability for 5 turns.","SKILL=Summons a beetle (60% atk/def, 4 action to attack or move) in grid.&DESTROY=Resets attribute.","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=Anticipates [3+Level] upcoming mobs. Has [5*Rarity-10]% probability to gain a refresh chance whenever a creature spawns.","DEFEND=Has [30+5*Rarity]% probability to push the target upwards when success.","TYPE1&NAME=Yin&SKILL=Costs 150 action. You can move the column arbitrarily. Other affected petals gain [5*Rarity-10] action.&TYPE2&NAME=Yang&SKILL=Costs 150 action. You can move the row arbitrarily.","SKILL=Destroys. Restrains nearest enemy and let it gain halved action for 10 times. Effectiveness for Boss is 25%.","DEFEND=Can't defend projectiles. Defended target has [50-5*Rarity]% chance to immune honey and can't be defended by honey anymore.","ENDTURN=Heals flower for [10%*Health].","ATTRIBUTE=Doesn't stack.&EQUIP=Increases flower damage reflection by [60+10*Rarity]%.","ATTACK=Doesn't deal knockback.","DEFEND=Deals 1x extra knockback when success.","COUNT=4&DAMAGE=Reduces size by 1. Reduces atk/def by 10%.&DESTROY=Resets attribute.","DESTROY=Deals [50%*Damage] [poison] and halves target speed for 5 turns.","ENDTURN=Heals flower for [10%*Health] only if there are at least 2 nearby petals.","ATTRIBUTE=Doesn't stack.&EXIST=Absorbs lightning damage taken by flower.","ATTRIBUTE=Doesn't stack.&EXIST=If flower takes fatal damage, applies immunity to flower for 1 turn, heals flower to max and clears all negative effects, then retires.","ENDTURN=Heals flower for [10%*Health] while it is not above 50%.","ATTRIBUTE=Moving costs 50 more action. Can be moved to mob's field. Attacks target grid instead when moving to grid with a mob.","SKILL=Destroys. Deals [200%*Damage] [lightning] to mobs in column and reduces their action by [30+10*Rarity]%. Deals [Damage] [lightning] to mobs in nearby column.","ATKDEF=Deals 2x extra knockback when success.","ATTACK=Deals 5x damage and sets target's action to -50 when hits target with full health.","SKILL=Destroys. Applies [200%*Health] shield to flower.","COUNT=3&SKILL=Costs 100 action. Destroys a part. Heals flower for [150%*Health].","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=Spreads non-poison damage taken over [2*Rarity+Level] turns.","ATTRIBUTE=Doesn't stack.&EQUIP=Increases size of all petals by 2 up to 20.","ATKDEF=Heals flower for half of damage dealt.","DECORATION&ATTRIBUTE=Doesn't stack.&EQUIP=If [Rarity>=6], Has a 50% probability for each petal to gain 10% extra atk/def.&TYPE1&NAME=Concentrated Eye&EXIST=For all petals with positive atk/def, their atk1 won't be less than atk2-10%, and their def1 won't be less than def2-10%.&TYPE2&NAME=Specialized Eye&EXIST=For all petals with positive atk/def, their atk2 won't be less than atk1+30%, and their def2 won't be less than def1+30%.","SHOOT=3 range. 10% accuracy decline. 3 bounce. 2 bounce range. 20% bounce accuracy decline. 30% repeated hitting decline.","COUNT=2&SKILL=Summons a sandstorm (80% atk/def, 8 action to attack or move) in grid.&DESTROY=Resets attribute.","ATTACK=Deals halved knockback when success.&DESTROY=Has 1% probability of giving the following huge bonus: quadruples health and damage and doubles knockback (once in a fight), reloads all petals and sets their action to 250 (except 1-speed petal).","DECORATION&ENDTURN=Has [5*Rarity-5]% probability to get a bonus flower turn before next flower turn starts.","ATTACK=Tries to push the target before attack. Deals [30+10*Level]% knockback when success.","DECORATION&EXIST=Applies healing debuffs immunity to flower. Increases all healing effects by [20*Rarity+10*Level-30]%.","COUNT=3&DAMAGE=Decreases def by 20%.&DESTROY=Resets attribute.","COUNT=4&SKILL=Summons a soldier ant (60% atk/def, 5 action to attack or move) in grid.&DESTROY=Resets attribute.","DEFEND=Decreases target's action by 50 and applies tardy for [5+2*Level] turns (reduces speed exceeds 10) when success.","ATKDEF=Turns target back to passive and prevents damage when hits neutral+ mob.","EXIST=Applies [poison] immunity to flower.","DEFEND=You can choose another petal to defend if it fails.","ATTRIBUTE=Doesn't stack.&SKILL=Can't manipulate this petal anymore until destroyed. Absorbs damage dealt to flower and divides energy loss by 3.","SHOOT=5 range. 20% accuracy decline. 10 bounce. 1 bounce range. 20% bounce accuracy decline. 30% repeated hitting decline.","EQUIP=Applies [20%*Health] armor to itself.","DEFEND=When target is projectile, receives no damage if the defend is successful, otherwise receives doubled damage and count the defend as successful.","EXIST=Calculates [X=total action]. Its health is at most [(130-X/20)%], damage is increased by [(X/2)%] from original value, size is increased by [X/200] from original value, atk/def is increased by [X/40]% from original value.&DESTROY=Resets attribute.","SKILL=Destroys. Marks the nearest non-boss mob, killing it after 3 turns without loot. Decreases flower health by [30-3*Rarity-Level]% flower max health.","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=When flower gets hit, has [20+3*Rarity+Level]% probability to apply evasion to flower for 3 turns, but also triples energy loss.","ATTACK=When hits target that is not connected, doubles resulting damage but decreases flower health by [20+5*Level]% flower max health down to 1, otherwise flower dies. (PSYONIC CONNECTION)","DESTROY=Applies [50%*Damage] armor debuff for 10 turns.","ATTRIBUTE=Doesn't stack.&EQUIP=Applies [10%*Health] armor to flower.","SKILL=Costs 50 action. Calculates [X=Dice]. Gains 250 action for [X=1]. Makes petal damage become 2x original value for [X=2]. Gains +100% (additive) resulting damage for [X=3]. Makes atk1/def1 100% for [X=4]. Make atk2 100% for [X=5]. Makes def2 100% for [X=6].&STATURN=Resets attribute.","DECORATION&ATTRIBUTE=Doesn't stack.&STATURN=Has [20+3*Rarity+Level]% probability to apply evasion to flower for a single turn.","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=Has [20+3*Rarity+Level]% probability to immune energy loss.","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=Converts [10*Rarity+5*Level]% flower overheal to shield.","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=When any petal moves in the specified direction, the restriction on that direction is removed or the required action is reduced by [10*Rarity]%.&STATURN=Randomly modify direction, or manually if [Rarity>=6]","DECORATION&ATTRIBUTE=Doesn't stack.&EXIST=Decreases damage taken by flower by [20+3*Rarity+Level]%.","ATTRIBUTE=Doesn't stack.&SKILL=Costs [30-3*Rarity-Level]% flower max health flower health. Destroys. Ends turn. Skips mob turn and sets their action to 0 if they are about to action (at least 120 action).","ATTRIBUTE=Can't craft. No attribute floating.","ATKDEF=If it has damage immunity, gains 250 action when defend and attack only costs 50 action (but requirement is not changed).&SKILL=Costs 250 action. Calculates [X=Dice]. Destroys for [X=1]. Gains 250 action and damage immunity for 1 turn for [X>1].&STATURN=Resets attribute.","SKILL=Costs 50 action. Calculates [X=Dice]. Sets atk2 to 100% for [X=5]. Sets def2 to 100% for [X=6]. Sets max health to [50*X]% original value and damage to [250-50*X]% original value for [X<5].&DESTROY=Resets attribute.","ATTRIBUTE=Doesn't stack. Can't move.&EQUIP=Reloads.&EXIST=All petals cost no action when moving towards it, otherwise cost 50 extra action.&DESTROY=Kills nearest mob (50% probability to trigger on boss). Retires.","DESTROY=Settles all remaining [poison] damage to target and increases resulting damage by [10*Rarity]%.","SKILL=Costs 150 action. Deals [Damage] damage to mobs in column.","DECORATION&ATTRIBUTE=Can't absorb. Doesn't stack.&EQUIP=Decreases mind by [350-50*Rarity]. All petals get [5*Rarity*(4+Level)]% more damage.","COUNT=7&DAMAGE=If remaining count equals to 4 or 6, halves health and damage, decreases size by 2.&DESTROY=Resets attribute.","ATTRIBUTE=Can't move.&ENDTURN=Reduces def2 to health percentage (down to 40%).&DESTROY=Resets attribute but decreases def1 by 20% permanently in this fight.","EQUIP=Decreases all reload by [3*Rarity]% (additive up to 50%).","SKILL=Costs 200 action. Heals all nearby petals and itself by [50%*Health].","SKILL=Costs 50 action. Calculates [X=Dice*Dice*Dice]. Sets health to 200% original value for [X>79] (once). Damage becomes at least [X/36] original value after decreases by 5%. atk2 becomes at least [X]%.&DESTROY=Resets attribute.","EQUIP=All other triangles with same rarity increases damage by [10+2*Level]% (additive), and increases atk2 by 5%."]
		Object.assign(PetalAttributeList,{222:"LOOT=Mobs killed in second turn has 7/1296 probability to drop it additionally.&ATTRIBUTE=Can't absorb.&ATTACK=Kills mob after 2 turn.",401:"ATTRIBUTE=Doesn't stack.&DESTROY=If target is mob, creates rifts near it and retires."})
		PetalAttributeList["Yin"]="SKILL=Costs 150 action. You can move the column arbitrarily. Other affected petals gain [5*Rarity-10] action."
		PetalAttributeList["Yang"]="SKILL=Costs 150 action. You can move the row arbitrarily."
		PetalAttributeList["Concentrated Eye"]="DECORATION&ATTRIBUTE=Doesn't stack.&EQUIP=If [Rarity>=6], Has a 50% probability for each petal to gain 10% extra atk/def.&EXIST=For all petals with positive atk/def, their atk1 won't be less than atk2-10%, and their def1 won't be less than def2-10%."
		PetalAttributeList["Specialized Eye"]="DECORATION&ATTRIBUTE=Doesn't stack.&EQUIP=If [Rarity>=6], Has a 50% probability for each petal to gain 10% extra atk/def.&EXIST=For all petals with positive atk/def, their atk2 won't be less than atk1+30%, and their def2 won't be less than def1+30%."
		const PetalSVGArray=new Object()
		PetalSVGArray.Basic="<path class='fwhite-path ns' d='M50 25A13 13 0 0 0 50 51A13 13 0 0 0 50 25'/>"
		PetalSVGArray.Light="<path class='fwhite-path ns' d='M50 19.4A7 7 0 0 0 50 33.4A7 7 0 0 0 50 19.4M39 27.4A7 7 0 0 0 39 41.4A7 7 0 0 0 39 27.4M61 27.4A7 7 0 0 0 61 41.4A7 7 0 0 0 61 27.4M43.2 40.4A7 7 0 0 0 43.2 54.4A7 7 0 0 0 43.2 40.4M56.8 40.4A7 7 0 0 0 56.8 54.4A7 7 0 0 0 56.8 40.4'/>"
		PetalSVGArray.Rock="<path class='fgrey-path ns' d='M34 32L50 20L66 36L62 50L42 52Z'/>"
		PetalSVGArray.Rose="<path class='fcpink-path ns' d='M50 25A13 13 0 0 0 50 51A13 13 0 0 0 50 25'/>"
		PetalSVGArray.Stinger="<path class='fdgrey-path ns' d='M47 32.8L56 38L47 43.2Z'/>"
		PetalSVGArray.Iris="<path class='fcpurple-path ns' d='M50 31A7 7 0 0 0 50 45A7 7 0 0 0 50 31'/>"
		PetalSVGArray.Wing="<path class='fwhite-path ns' d='M36 48A40 40 0 0 0 65 26A20 20 0 0 1 36 48'/>"
		PetalSVGArray.Missile="<path class='fblack-path ns' d='M38 33L50 24L60.5 50.5Z'/>"
		PetalSVGArray.Grapes="<path class='fcpurple-path ns' d='M54 22A7 7 0 0 0 54 36A7 7 0 0 0 54 22M59 35A7 7 0 0 0 59 49A7 7 0 0 0 59 35M46 40A7 7 0 0 0 46 54A7 7 0 0 0 46 40M41 27A7 7 0 0 0 41 41A7 7 0 0 0 41 27'/>"
		PetalSVGArray.Cactus="<path class='fgreen-path ns' d='M50 24A12 12 0 0 0 59.9 28.1A12 12 0 0 0 64 38A12 12 0 0 0 59.9 47.9A12 12 0 0 0 50 52A12 12 0 0 0 40.1 47.9A12 12 0 0 0 36 38A12 12 0 0 0 40.1 28.1A12 12 0 0 0 50 24'/><path class='flgreen-path ns ' d='M50 30A8 8 0 0 0 50 46A8 8 0 0 0 50 30'/>"
		PetalSVGArray.Faster="<path class='flyellow-path ns' d='M50 31A7 7 0 0 0 50 45A7 7 0 0 0 50 31'/>"
		PetalSVGArray.Bubble="<path class='white-path wide' d='M50 24A14 14 0 0 0 50 52A14 14 0 0 0 50 24'/><path class='fwhite-path ns ' fill-opacity='0.3' d='M50 24A14 14 0 0 0 50 52A14 14 0 0 0 50 24'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M55 30A5 5 0 0 0 55 40A5 5 0 0 0 55 30'/>"
		PetalSVGArray.Pollen="<path class='fyellow-path ns' d='M44.4 19.3A9 9 0 0 0 44.4 37.3A9 9 0 0 0 44.4 19.3M61.2 29A9 9 0 0 0 61.2 47A9 9 0 0 0 61.2 29M44.4 38.7A9 9 0 0 0 44.4 56.7A9 9 0 0 0 44.4 38.7'/>"
		PetalSVGArray.Dandelion="<path class='fblack-path ns' d='M39.6 32.2L31.6 24.2A2.2 2.2 0 0 1 34.7 21.1L42.7 29.1A15.5 15.5 0 0 0 39.6 32.2'/><path class='fwhite-path ns' d='M52 30A11.5 11.5 0 0 0 52 53A11.5 11.5 0 0 0 52 30'/>"
		PetalSVGArray["Beetle Egg"]="<path class='flyellow-path ns' d='M50 18A20 15 90 0 0 50 58A20 15 90 0 0 50 18'/>"
		PetalSVGArray.Antennae="<path class='fblack-path wide ns' d='M26 22A40 40 0 0 1 42 54ZM74 22A40 40 0 0 0 58 54Z'/>"
		PetalSVGArray.Heavy="<path class='fdgrey-path ns' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20'/><path class='flgrey-path ns ' d='M57 26A7 7 0 0 0 58 40A7 7 0 0 0 57 26'/>"
		PetalSVGArray["Yin Yang"]="<path class='fgrey-path ns ' d='M50 22A16 16 0 0 0 50 54A16 16 0 0 0 50 22'/><path class='fwhite-path ns ' d='M50 24A7 7 0 0 1 50 38A7 7 0 0 0 50 52A14 14 0 0 1 50 24'/><path class='fblack-path ns ' d='M50 24A7 7 0 0 1 50 38A7 7 0 0 0 50 52A14 14 0 0 0 50 24'/><path class='fwhite-path ns ' fill-opacity='0.9' d='M50 41.5A3.5 3.5 0 0 0 50 48.5A3.5 3.5 0 0 0 50 41.5'/><path class='fblack-path ns ' fill-opacity='0.9' d='M50 27.5A3.5 3.5 0 0 0 50 34.5A3.5 3.5 0 0 0 50 27.5'/>"
		PetalSVGArray.Web="<path class='fwhite-path ns' d='M39 34.4A15 15 0 0 0 50 26.4A15 15 0 0 0 61 34.4A15 15 0 0 0 56.8 47.4A15 15 0 0 0 43.2 47.4A15 15 0 0 0 39 34.4'/>"
		PetalSVGArray.Honey="<path class='fcyellow-path ns' d='M44.4 28.3L55.6 28.3L61.2 38L55.6 47.7L44.4 47.7L38.8 38Z'/>"
		PetalSVGArray.Leaf="<path class='fdgreen-path ns' d='M40 56.1A21 10 115 0 0 60.9 19.9A21 10 125 0 0 40 56.1'/><path class='dgreen-path wide' d='M34.4 65.8L40 56.1M42.6 51.6L55.3 29' style='filter: brightness(80%)'/>"
		PetalSVGArray.Salt="<path class='fwhite-path ns' d='M45 25L55 26L62 34L60 45L48 50L40 43L38 34Z'/>"
		PetalSVGArray.Rice="<path class='fwhite-path wide ns' d='M41 28A2 2 0 0 1 43.4 24.8L51.4 30.8A2 2 0 0 1 49 34ZM51 38A2 2 0 0 1 54.6 36.5L59.6 48.5A2 2 0 0 1 56 50Z'/>"
		PetalSVGArray.Corn="<path class='fyellow-path ns' d='M32 44L40 20A25 25 0 0 1 68 48L44 56A10 10 0 0 0 32 44'/>"
		PetalSVGArray.Sand="<path class='fcyellow-path ns' d='M50 21.1A7 7 0 0 0 50 35.1A7 7 0 0 0 50 21.1M59.9 31A7 7 0 0 0 59.9 45A7 7 0 0 0 59.9 31M50 40.9A7 7 0 0 0 50 54.9A7 7 0 0 0 50 40.9M40.1 31A7 7 0 0 0 40.1 45A7 7 0 0 0 40.1 31'/>"
		PetalSVGArray.Pincer="<path class='fblack-path wide ns' d='M38 34A12 12 0 0 1 54 50A30 13 135 0 0 38 34'/>"
		PetalSVGArray.Yucca="<path class='fgreen-path ns' d='M40 56.1A22 10 115 0 0 60.9 19.9A22 10 125 0 0 40 56.1'/><path class='green-path wide' d='M40 56.1L60.9 19.9' style='filter: brightness(80%)'/>"
		PetalSVGArray.Magnet="<path class='fred-path ns ' fill-opacity='0.8' d='M49.9 14.7L34.4 30.4A16.4 16.4 0 0 0 34.4 53.6L46.4 41.6A2.4 2.4 0 0 1 46.4 38.2L59.8 24.8Z'/><path class='fblue-path ns ' fill-opacity='0.8' d='M73.3 38.1L57.6 53.6A16.4 16.4 0 0 1 34.4 53.6L46.4 41.6A2.4 2.4 0 0 0 49.8 41.6L63.2 28.2Z'/><path class='fred-path ns ' d='M49.9 19.5L36.8 32.8A13 13 0 0 0 36.8 51.2L44 44A5.8 5.8 0 0 1 44 35.8L55 24.8Z'/><path class='fblue-path ns ' d='M68.5 38.1L55.2 51.2A13 13 0 0 1 36.8 51.2L44 44A5.8 5.8 0 0 0 52.2 44L63.2 33Z'/>"
		PetalSVGArray.Yggdrasil="<path class='fcbrown-path ns' d='M40 56.1A21 10 115 0 0 60.9 19.9A21 10 125 0 0 40 56.1'/><path class='cbrown-path wide' d='M34.4 65.8L40 56.1M42.6 51.6L55.3 29' style='filter: brightness(80%)'/>"
		PetalSVGArray.Starfish="<path class='fred-path ns' d='M37 44L49 53L65.2 21.4A1.6 1.6 0 0 0 62.8 19.6Z'/><path class='flred-path ns ' d='M47.5 38.5A4 4 0 0 0 47.5 46.5A4 4 0 0 0 47.5 38.5M53.5 32A2.5 2.5 0 0 0 53.5 37A2.5 2.5 0 0 0 53.5 32'/>"
		PetalSVGArray.Pearl="<path class='flyellow-path ns' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20'/><path class='fwhite-path ns ' d='M57 26A7 7 0 0 0 58 40A7 7 0 0 0 57 26'/>"
		PetalSVGArray.Lightning="<path class='fcyan-path wide ns' d='M54 24L42 40L48 40L46 52L58 36L52 36Z'/>"
		PetalSVGArray.Jelly="<path class='purple-path wide' d='M50 23A15 15 0 0 0 50 53A15 15 0 0 0 50 23'/><path class='fpurple-path ns ' fill-opacity='0.3' d='M50 23A15 15 0 0 0 50 53A15 15 0 0 0 50 23'/><path class='fpurple-path ns ' fill-opacity='0.3' d='M47 28A3 3 0 0 0 47 34A3 3 0 0 0 47 28M52 35A3 3 0 0 0 52 41A3 3 0 0 0 52 35M46 43A3 3 0 0 0 46 49A3 3 0 0 0 46 43M57 40A3 3 0 0 0 57 46A3 3 0 0 0 57 40'/>"
		PetalSVGArray.Claw="<path class='fdbrown-path wide ns' d='M46 50L38 30L60 28A8 4 0 0 0 60 36L44 34Z'/>"
		PetalSVGArray.Shell="<path class='fcyellow-path ns' d='M38 38L58 22A20 20 0 0 1 58 54Z'/><path class='cyellow-path wide' d='M42 37L60 29M42 38L63 38M42 39L60 47' style='filter: brightness(80%)'/>"
		PetalSVGArray.Dahlia="<path class='fcpink-path ns' d='M45.9 23.9A7 7 0 0 0 45.9 37.9A7 7 0 0 0 45.9 23.9M58.2 31A7 7 0 0 0 58.2 45A7 7 0 0 0 58.2 31M45.9 38.1A7 7 0 0 0 45.9 52.1A7 7 0 0 0 45.9 38.1'/>"
		PetalSVGArray.Sponge="<path class='flyellow-path ns ' d='M50 23A12 12 0 0 0 35 23A12 12 0 0 0 35 38A12 12 0 0 0 35 53A12 12 0 0 0 50 53L41 50A3 3 0 0 1 41 44L41 41A3 3 0 0 1 41 35L41 32A3 3 0 0 1 41 26ZM50 23A12 12 0 0 1 65 23A12 12 0 0 1 65 38A12 12 0 0 1 65 53A12 12 0 0 1 50 53L59 50A3 3 0 0 0 59 44L59 41A3 3 0 0 0 59 35L59 32A3 3 0 0 0 59 26ZM50 23L50 26A3 3 0 0 0 50 32L50 35A3 3 0 0 0 50 41L50 44A3 3 0 0 0 50 50L50 53L41 50A3 3 0 0 0 41 44L41 41A3 3 0 0 0 41 35L41 32A3 3 0 0 0 41 26ZM50 23L59 26A3 3 0 0 0 59 32L59 35A3 3 0 0 0 59 41L59 44A3 3 0 0 0 59 50L50 53L50 50A3 3 0 0 0 50 44L50 41A3 3 0 0 0 50 35L50 32A3 3 0 0 0 50 26Z'/><path class='lyellow-path wide' d='M35 23A12 12 0 0 1 50 23A12 12 0 0 1 65 23A12 12 0 0 1 65 38A12 12 0 0 1 65 53A12 12 0 0 1 50 53A12 12 0 0 1 35 53A12 12 0 0 1 35 38A12 12 0 0 1 35 23' style='filter: brightness(80%)'/>"
		PetalSVGArray.Soil="<path class='fdbrown-path ns' d='M39 35L50 26L57 30L61 37L58 47L47 49L42 46Z'/>"
		PetalSVGArray.Fangs="<path class='fcdred-path wide ns' d='M45.5 24.5L54.5 36.5L54.5 51.5L45.5 39.5Z'/>"
		PetalSVGArray["Third Eye"]="<path class='fblack-path mwidth ns' d='M50 20A18 7 90 0 0 50 56A18 7 90 0 0 50 20M60 16L64 16M64 16L64 24M64 24L60 24M60 20L64 20'/><path class='fwhite-path ns ' d='M50 32A6 6 0 0 0 50 44A6 6 0 0 0 50 32'/>"
		PetalSVGArray.Peas="<path class='fgreen-path ns' d='M54 22A7 7 0 0 0 54 36A7 7 0 0 0 54 22M59 35A7 7 0 0 0 59 49A7 7 0 0 0 59 35M46 40A7 7 0 0 0 46 54A7 7 0 0 0 46 40M41 27A7 7 0 0 0 41 41A7 7 0 0 0 41 27'/>"
		PetalSVGArray.Stick="<path class='fdbrown-path wide' stroke-linecap='round' d='M50 38L32 48M50 38L60 24M50 38L64 38' style='filter: brightness(50%)'/>"
		PetalSVGArray.Clover="<path class='fgreen-path ns' d='M50 38L44 30A6 6 0 0 1 56 30ZM50 38L58 32A6 6 0 0 1 58 44ZM50 38L56 46A6 6 0 0 1 44 46ZM50 38L42 44A6 6 0 0 1 42 32Z'/>"
		PetalSVGArray.Powder="<path class='fwhite-path ns ' d='M50 27A12 12 0 0 0 50 51A12 12 0 0 0 50 27M41 22A6 6 0 0 0 41 34A6 6 0 0 0 41 22M59 22A6 6 0 0 0 59 34A6 6 0 0 0 59 22'/>"
		PetalSVGArray.Air="<path class='fwhite-path ns ' fill-opacity='0.1' d='M0 0L100 0L100 100L0 100Z'/>"
		PetalSVGArray.Basil="<path class='fdgreen-path ns' d='M41.8 23.8L49.6 28.3A5.2 5.2 0 1 1 41.8 32.8ZM66.4 38L58.6 42.5A5.2 5.2 0 1 1 58.6 33.5ZM41.8 52.2L41.8 43.2A5.2 5.2 0 1 1 49.6 47.7Z'/>"
		PetalSVGArray.Orange="<path class='fcorange-path ns' d='M44.4 19.3A9 9 0 0 0 44.4 37.3A9 9 0 0 0 44.4 19.3M61.2 29A9 9 0 0 0 61.2 47A9 9 0 0 0 61.2 29M44.4 38.7A9 9 0 0 0 44.4 56.7A9 9 0 0 0 44.4 38.7'/><path class='dgreen-path wide' d='M44.4 24.3L44.4 14.3M44.4 20.3L48.4 20.3M61.2 34L61.2 24M61.2 30L65.2 30M44.4 43.7L44.4 33.7M44.4 39.7L48.4 39.7'/>"
		PetalSVGArray["Ant Egg"]="<path class='flyellow-path ns' d='M50 20.1A8 8 0 0 0 50 36.1A8 8 0 0 0 50 20.1M59.9 30A8 8 0 0 0 59.9 46A8 8 0 0 0 59.9 30M50 39.9A8 8 0 0 0 50 55.9A8 8 0 0 0 50 39.9M40.1 30A8 8 0 0 0 40.1 46A8 8 0 0 0 40.1 30'/>"
		PetalSVGArray.Poo="<path class='fblack-path wide' d='M50 26.8L50 49.2M40.3 32.4L59.7 43.6M59.7 32.4L40.3 43.6'/>"
		PetalSVGArray.Relic="<path class='fcyellow-path ns' d='M50 28A12 12 0 0 0 60 38A12 12 0 0 0 50 48A12 12 0 0 0 40 38A12 12 0 0 0 50 28'/>"
		PetalSVGArray.Lotus="<path class='fcpurple-path ns' d='M50 30A8 8 0 0 0 50 46A8 8 0 0 0 50 30M50 24A16 8 90 0 0 50 52A16 8 90 0 0 50 24M59.9 28.1A16 8 135 0 0 40.1 47.9A16 8 135 0 0 59.9 28.1M64 38A16 8 0 0 0 36 38A16 8 0 0 0 64 38M59.9 47.9A16 8 45 0 0 40.1 28.1A16 8 45 0 0 59.9 47.9'/><path class='fcpurple-path ns ' d='M50 34A4 4 0 0 0 50 42A4 4 0 0 0 50 34' style='filter: brightness(80%)'/>"
		PetalSVGArray.Bulb="<path class='fgrey-path ns ' d='M45 48L55 48L55 54L45 54Z'/><path class='fyellow-path ns ' d='M45 48L41 40A11 11 0 1 1 59 40L55 48Z'/><path class='flyellow-path ns ' fill-opacity='0.3' d='M50 12A25 25 0 0 0 50 62A25 25 0 0 0 50 12'/>"
		PetalSVGArray.Cotton="<path class='fwhite-path ns ' d='M50 23A12 12 0 0 0 35 23A12 12 0 0 0 35 38A12 12 0 0 0 35 53A12 12 0 0 0 50 53L41 49A2 2 0 0 1 41 45L41 40A2 2 0 0 1 41 36L41 31A2 2 0 0 1 41 27ZM50 23A12 12 0 0 1 65 23A12 12 0 0 1 65 38A12 12 0 0 1 65 53A12 12 0 0 1 50 53L59 49A2 2 0 0 0 59 45L59 40A2 2 0 0 0 59 36L59 31A2 2 0 0 0 59 27ZM50 23L50 27A2 2 0 0 0 50 31L50 36A2 2 0 0 0 50 40L50 45A2 2 0 0 0 50 49L50 53L41 49A2 2 0 0 0 41 45L41 40A2 2 0 0 0 41 36L41 31A2 2 0 0 0 41 27ZM50 23L59 27A2 2 0 0 0 59 31L59 36A2 2 0 0 0 59 40L59 45A2 2 0 0 0 59 49L50 53L50 49A2 2 0 0 0 50 45L50 40A2 2 0 0 0 50 36L50 31A2 2 0 0 0 50 27Z'/><path class='white-path wide' d='M35 23A12 12 0 0 1 50 23A12 12 0 0 1 65 23A12 12 0 0 1 65 38A12 12 0 0 1 65 53A12 12 0 0 1 50 53A12 12 0 0 1 35 53A12 12 0 0 1 35 38A12 12 0 0 1 35 23' style='filter: brightness(80%)'/>"
		PetalSVGArray.Carrot="<path class='fcorange-path ns' d='M42 30A30 8 60 0 1 65 53A30 8 30 0 1 42 30'/><path class='dgreen-path wide' d='M41 29L32 29M41 29L34 22M41 29L41 20'/>"
		PetalSVGArray.Bone="<path class='fwhite-path ns' d='M40 26L40 20L60 20L60 26L54 26L54 50L60 50L60 56L40 56L40 50L46 50L46 28Z'/>"
		PetalSVGArray.Plank="<path class='fdbrown-path ns' d='M30 28L40 18L70 48L60 58Z'/><path class='dbrown-path wide' d='M40 26A2 2 0 0 0 40 30A2 2 0 0 0 40 26' style='filter: brightness(80%)'/>"
		PetalSVGArray.Tomato="<path class='fcred-path ns' d='M50 27A16 12 0 0 0 50 51A16 12 0 0 0 50 27'/><path class='dgreen-path wide' d='M50 26L42 20M50 26L50 16M50 26L58 20'/>"
		PetalSVGArray.Mark="<path class='fcdred-path ns ' d='M46.1 50L46.1 26L60.2 45.4L37.4 38L60.2 30.6Z'/><path class='cdred-path mwidth' d='M46.1 50L46.1 26L60.2 45.4L37.4 38L60.2 30.6Z' style='filter: brightness(80%)'/>"
		PetalSVGArray.Rubber="<path class='fwhite-path ns' d='M40 33L55 28L60 43L45 48Z'/>"
		PetalSVGArray["Blood Stinger"]="<path class='fcdred-path ns' d='M47 32.8L56 38L47 43.2Z'/>"
		PetalSVGArray.Bur="<path class='fcdred-path wide ns' d='M50 31.5L55 26L54.6 33.4L62 33L56.5 38L62 43L54.6 42.6L55 50L50 44.5L45 50L45.4 42.6L38 43L43.5 38L38 33L45.4 33.4L45 26Z'/>"
		PetalSVGArray.Root="<path class='fwhite-path wide ns' d='M50 29A2 2 0 0 0 50 25A2 2 0 0 0 50 29L50 35M50 35L40 41M50 35L60 41M40 41L35 47M40 41L45 47M60 41L55 47M60 41L65 47'/>"
		PetalSVGArray.Dice="<path class='fwhite-path ns' d='M36 24L64 24L64 52L36 52Z'/><path class='fblue-path ns ' d='M58 27A3 3 0 0 0 58 33A3 3 0 0 0 58 27M50 35A3 3 0 0 0 50 41A3 3 0 0 0 50 35M42 43A3 3 0 0 0 42 49A3 3 0 0 0 42 43'/>"
		PetalSVGArray.Talisman="<path class='black-path mwidth' stroke-linecap='round' stroke-linejoin='round' d='M50 26.8L40.3 43.6L59.7 43.6L50 26.8L50 43.6A5.6 5.6 0 0 0 50 32.4A5.6 5.6 0 0 0 50 43.6'/>"
		PetalSVGArray.Battery="<path class='fgreen-path ns' d='M38 22L62 22L62 56L38 56Z'/><path class='fgrey-path wide ns' d='M44 20L44 15L56 15L56 20Z'/><path class='fcyan-path ns ' d='M54 24L42 40L48 40L46 52L58 36L52 36Z' style='filter: brightness(80%)'/>"
		PetalSVGArray.Amulet="<path class='fcpink-path ns' d='M44.4 28.3L55.6 28.3L61.2 38L55.6 47.7L44.4 47.7L38.8 38Z'/><path class='fcpink-path ns ' d='M50 32A6 6 0 0 0 50 44A6 6 0 0 0 50 32' style='filter: brightness(80%)'/>"
		PetalSVGArray.Compass="<path class='fblue-path ns ' d='M50 18A20 20 0 0 0 50 58A20 20 0 0 0 50 18'/><path class='fred-path ns ' d='M46 38L50 20L54 38Z'/><path class='fwhite-path ns ' d='M46 38L50 56L54 38Z'/>"
		PetalSVGArray.Disc="<path class='black-path wider' d='M50 25A13 13 0 0 0 50 51A13 13 0 0 0 50 25'/>"
		PetalSVGArray.Shovel="<path class='fdbrown-path wide ns' d='M41 51L45 53L53 37L49 35Z'/><path class='fgrey-path wide ns' d='M45 33L48 27A7 7 0 0 1 60 33L57 39Z'/>"
		PetalSVGArray.Coin="<path class='fcyellow-path ns' d='M50 25A13 13 0 0 0 50 51A13 13 0 0 0 50 25'/><path class='cyellow-path wide' d='M50 28L50 32M53 35A3 3 0 1 0 50 38A3 3 0 1 1 47 41M50 44L50 48' style='filter: brightness(80%)'/>"
		PetalSVGArray.Chip="<path class='fcpurple-path ns' d='M50 25A13 13 0 0 0 50 51A13 13 0 0 0 50 25'/><path class='white-path ' d='M45.9 25.7L54.1 25.7M55.8 26.4L61.6 32.2M62.3 33.9L62.3 42.1M61.6 43.8L55.8 49.6M54.1 50.3L45.9 50.3M44.2 49.6L38.4 43.8M37.7 42.1L37.7 33.9M38.4 32.2L44.2 26.4'/>"
		PetalSVGArray.Card="<path class='fgrey-path ns' d='M38 20L62 20L62 56L38 56Z'/><path class='fwhite-path ns ' d='M38 38A18 12 90 0 0 62 38A18 12 90 0 0 38 38'/><path class='black-path mwidth' d='M41 31L48 31L48 45M59 38L52 38L52 31L59 31L59 45L52 45'/>"
		PetalSVGArray["Moon Rock"]="<path class='fgrey-path wide ns' d='M50 13A25 25 0 0 0 50 63A25 25 0 0 0 75 38A35 35 0 0 0 50 13'/>"
		PetalSVGArray.Privet="<path class='fblack-path ns' d='M50 34A4 4 0 0 0 50 42A4 4 0 0 0 50 34'/>"
		PetalSVGArray.Glass="<path class='fwhite-path ns ' fill-opacity='0.3' d='M35 46L50 32L65 36Z'/>"
		PetalSVGArray.Corruption="<path class='fblack-path ns ' fill-opacity='0.2' d='M36 56L36 34L42 34A3 3 0 0 0 48 34L52 34A3 3 0 0 0 58 34L64 34L64 56L57 45L50 51L43 45ZM36 34L42 34A3 3 0 0 1 48 34L52 34A3 3 0 0 1 58 34L64 34A14 14 0 0 0 36 34'/>"
		PetalSVGArray.Coral="<path class='cpurple-path' stroke-linecap='round' d='M50 38L40 48M50 38L46 26M50 38L60 28M50 38L62 42'/>"
		PetalSVGArray.Wax="<path class='fcyellow-path ns' d='M38.8 18.6L61.2 18.6L72.4 38L61.2 57.4L38.8 57.4L27.6 38Z'/>"
		PetalSVGArray["Golden Leaf"]="<path class='fcyellow-path ns' d='M40 56.1A21 10 115 0 0 60.9 19.9A21 10 125 0 0 40 56.1'/><path class='cyellow-path wide' d='M34.4 65.8L40 56.1M42.6 51.6L55.3 29' style='filter: brightness(80%)'/>"
		PetalSVGArray.Monstera="<path class='fdgreen-path ns' d='M46 50L46 54L54 54L54 50L66 46L58 43L65 40L57 37L63 33L55 33L57 27L53 30L50 22L47 30L43 27L45 33L37 33L43 37L35 40L42 43L34 46Z'/><path class='dgreen-path wide' d='M50 30L50 50' style='filter: brightness(80%)'/>"
		PetalSVGArray.Domino="<path class='fwhite-path ns' d='M32 32L44 20L68 44L56 56Z'/><path class='black-path mwidth' d='M38 30L42 26L50 34M58 42L54 46L50 42L54 38L62 46L58 50M46 42L54 34'/>"
		PetalSVGArray.Triangle="<path class='fwhite-path ns' d='M47 32.8L56 38L47 43.2Z'/>"
		PetalSVGArray["2 Turn Kill"]="<path class='black-path mwidth' d='M39 17L32 21L39 25M42 19L48 19M42 23L48 23M52 19L58 19M52 23L58 23M61 17L68 21L61 25'/><path class='red-path mwidth' d='M33 32L39 32L39 37L33 37L33 42L39 42M47 32L53 32L53 37L47 37L47 42L53 42M47 49L53 49L53 54L47 54L47 59L53 59'/><path class='blue-path mwidth' d='M67 32L61 32L61 42L67 42L67 37L61 37M39 49L33 49L33 59L39 59L39 54L33 54M67 49L61 49L61 59L67 59L67 54L61 54'/>"
		PetalSVGArray.Rift="<path class='fdbrown-path ns ' d='M34 22L49 22L49 38L34 53ZM66 22L51 22L51 38L66 53ZM50 39L65 54L35 54Z'/>"
		for(let i in PetalNameList) {
			PetalSVGArray[PetalNameList[i]]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fblack-path ns' fill-opacity='0.2' d='M8 100A8 8 0 0 1 0 92L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 92A8 8 0 0 1 92 100L92 8L8 8ZM8 92L92 92L92 100L8 100Z'/></svg><svg viewBox='0 0 100 76' class='in-svg' style='position: absolute; height: 76%; top: 0px; left: 0px'><g>"+PetalSVGArray[PetalNameList[i]].replaceAll(/<path class='(\w+-path (ns |wider?|mwidth)|\w+-path)'.+?\/>/g,"").replaceAll("class='f","class='").replaceAll("ns'","wider' stroke-linecap='round' stroke-linejoin='round' style='filter: brightness(80%)'")+PetalSVGArray[PetalNameList[i]].replaceAll("ns '","ns'").replaceAll("path '","path'")+"</g></svg><span class='mid nowrap bold' style='--transform2: translate(0px,20px)'>"+PetalNameList[i].replace("Blood Stinger","B. Stinger").replace("Moon Rock","Moon R.").replace("Golden Leaf","G. Leaf")+"</span>"
		}
		PetalSVGArray.Compass=PetalSVGArray.Compass.replace("<g>","<g style='transform: rotate(45deg)'>")
		const MobNameList=["","Rock","Cactus","Ladybug (Garden)","Bee","Baby Ant","Worker Ant","Soldier Ant","Queen Ant","Ant Hole","Beetle","Hornet","Centipede (Garden)","Centipede (Jungle)","Centipede (Desert)","Ladybug (Jungle)","Ladybug (Desert)","Spider","Scorpion","Soldier Fire Ant","Fire Ant Burrow","Sandstorm","Bubble","Bumble Bee","Shell","Starfish","Crab","Jellyfish","Sponge","Leech","Dandelion","Baby Fire Ant","Worker Fire Ant","Queen Fire Ant","Fly","Leafbug","Mantis","Baby Termite","Worker Termite","Soldier Termite","Termite Overmind","Termite Mound","Termite Egg","Bush","Roach","Moth","Firefly","Beetle (Hell)","Wasp","Spider (Hell)","Centipede (Hell)","Wasp (Hell)"]
		MobNameList[66]="Gambler"
		Object.assign(MobNameList,{101:"!Hornet!",102:"!Spider!",103:"!Dandelion!",104:"!Beetle!",105:"!Scorpion!",106:"!Sandstorm!",107:"!Shell!",108:"!Crab!",109:"!Leech!",110:"!Fly!",111:"!Roach!",112:"!Queen Ant!",113:"!Leafbug!",114:"!Mantis!",115:"!Wasp!",121:"!Summoner!"})
		const MobBehaviorList=["","Passive","Hostile","Neutral","Neutral","Passive","Neutral","Hostile","Hostile","Passive","Hostile","Hostile","Neutral","Hostile","Neutral","Neutral","Neutral","Hostile","Hostile","Hostile","Passive","Passive","Passive","Passive","Neutral","Hostile","Hostile","Hostile","Passive","Hostile","Passive","Passive","Neutral","Hostile","Hostile","Neutral","Hostile","Passive","Neutral","Hostile","Neutral","Passive","Passive","Passive","Neutral","Neutral","Neutral","Hostile","Hostile","Hostile","Hostile","Hostile"]
		MobBehaviorList[66]="Gamble"
		Object.assign(MobBehaviorList,{101:"Hostile",102:"Hostile",103:"Hostile",104:"Hostile",105:"Hostile",106:"Hostile",107:"Hostile",108:"Hostile",109:"Hostile",110:"Hostile",111:"Hostile",112:"Hostile",113:"Hostile",114:"Hostile",115:"Hostile",121:"Passive"})
		const MobHealthList=["",30,20,25,15,10,25,40,100,30,40,25,10,10,10,35,35,25,40,40,"*",50,1,10,20,20,30,30,40,40,10,10,25,100,2,20,40,10,25,40,200,"*",60,15,25,7,16,60,25,60,20,25]
		MobHealthList[66]="/"
		Object.assign(MobHealthList,{101:60,102:60,103:20,104:100,105:100,106:120,107:50,108:80,109:100,110:20,111:60,112:200,113:50,114:100,115:60,121:"*"})
		const MobDamageList=["",2,7,2,10,2,2,2,2,3,6,10,2,2,2,2,2,3,3,4,"*",8,1,4,2,4,5,5,2,2,3,4,4,4,2,6,4,2,2,2,2,"*","*",2,4,2,1,6,10,3,6,10]
		MobDamageList[66]="/"
		Object.assign(MobDamageList,{101:15,102:5,103:5,104:10,105:5,106:12,107:5,108:8,109:3,110:5,111:5,112:3,113:10,114:5,115:15,121:"*"})
		const MobSpeedList=["",10,10,20,25,15,20,20,15,15,20,25,15,20,30,20,20,30,15,20,100,25,30,30,15,20,25,15,10,40,10,15,20,15,25,20,15,15,20,20,5,25,15,15,25,25,25,25,30,35,25,25]
		MobSpeedList[66]="/"
		Object.assign(MobSpeedList,{101:25,102:30,103:15,104:25,105:20,106:25,107:30,108:30,109:40,110:30,111:30,112:15,113:25,114:20,115:30,121:1})
		const MobDodgeList=["",0,0,30,60,20,40,40,10,0,20,40,10,10,10,30,30,50,30,40,0,60,0,70,10,40,60,10,0,0,0,20,40,10,90,30,20,20,40,40,10,0,0,0,40,0,60,20,40,50,10,40]
		MobDodgeList[66]="/"
		Object.assign(MobDodgeList,{101:50,102:70,103:0,104:60,105:70,106:60,107:30,108:70,109:30,110:90,111:60,112:30,113:60,114:50,115:50,121:0})
		const MobLootList=[[],["Rock,2","Heavy,2","Moon Rock,1"],["Cactus,2"],["Light,3","Rose,3"],["Stinger,3","Pollen,2","Honey,2"],["Light,3","Leaf,2","Rice,3"],["Leaf,2","Corn,2"],["Clover,3","Glass,4"],["Basil,4","Ant Egg,4"],["Soil,3","Shovel,3"],["Beetle Egg,3","Privet,4"],["Missile,3","Antennae,2","Orange,3"],["Leaf,2","Peas,2"],["Iris,2","Grapes,2"],["Salt,2","Powder,2"],["Yin Yang,2","Dahlia,3"],["Rose,5","Yggdrasil,4","Dahlia,5"],["Faster,3","Web,3","Third Eye,1"],["Iris,3","Pincer,3"],["Yucca,4","Bone,2"],["Magnet,4","Disc,4"],["Sand,2","Stick,2","Glass,2"],["Bubble,3","Air,5"],["Pollen,5","Honey,3","Wax,5"],["Magnet,1","Pearl,3","Shell,2"],["Salt,2","Sand,2","Starfish,3"],["Sand,2","Claw,3"],["Lightning,2","Jelly,3"],["Sponge,3","Coral,2"],["Faster,3","Fangs,3"],["Dandelion,4"],["Light,3","Yucca,2"],["Corn,2","Yucca,2"],["Basil,4","Ant Egg,4"],["Wing,3","Poo,3","Talisman,2"],["Leaf,3","Root,3"],["Peas,3","Bur,3"],["Relic,2","Carrot,3"],["Relic,2","Plank,2"],["Relic,2","Triangle,3"],["Relic,4","Tomato,2","Compass,5"],["Soil,3","Relic,2","Rubber,3"],["Ant Egg,3","Amulet,2"],["Cotton,4","Golden Leaf,1","Monstera,3"],["Antennae,3","Lotus,2"],["Wing,3","Bulb,3"],["Wing,3","Bulb,3","Battery,2"],["Beetle Egg,1","Mark,1","Dice,2"],["Missile,4","Antennae,3","Blood Stinger,2"],["Third Eye,1","Mark,1","Card,2"],["Mark,1","Domino,1"],["Missile,5","Mark,1","Chip,2"]]
		MobLootList[66]=["Dice,3","Chip,3","Card,3","Corruption,5","Domino,3"]
		Object.assign(MobLootList,{101:[],102:[],103:[],104:[],105:[],106:[],107:[],108:[],109:[],110:[],111:[],112:[],113:[],114:[],115:[],121:[]})
		const MobDescriptionList=["","Just a rock. Maybe does something.","Avoid its thorns, that hurts.","Cute and harmless.","Stings. Don't touch it.","Weak and defenseless like you.","Still a weak one.","Got wings and ready to use them.","Really fat.","Ants hiding inside.","Hungry and flowers are its favorite meal.","Not as nice as the little bees.","Just there doing its thing.","Loves flowers.","Gotta go fast.","Cute and harmless too.","Shiny. Cute and harmless.","Spooky.","Stings!","Ant on fire.","Is this ant hole on fire?","Weather experts advise flowers not to go out.","Pop.","Gotta run.","Help. My petal is attacking me.","Retreats for heal.","Agile and hurts.","Makes the most delicious jam.","Absorbs damage taken by nearby mobs.","Slurp slurp.","Flower with many dandelions equipped.","Ant on fire.","Ant on fire.","Queen ant on fire.","Flies.","Leaf-shaped bug.","You better pray you don't become dinner.","Weak and defenseless but appears to be connected.","Still weak but appears to be connected.","Got wings and appears to be connected.","Fat and appears to be connected.","Why is this one not connected?","Not connected too.","Animals hiding inside.","Gotta go fast until gets tired.","Easily scared.","Shiny lightbulb.","Exotic creature.","They are angry.","Exotic creature.","Exotic creature.","Exotic creature."]
		MobDescriptionList[66]="This could happen to you."
		Object.assign(MobDescriptionList,{101:"Well, this one is evil and hungry.",102:"Got webs and good at using them.",103:"Why is the sky becoming white?",104:"A flower a day keeps summoner away~",105:"Be careful, it is quite poisonous.",106:"If you really want to go out in such a natural disaster...",107:"Harder shell. An unfriendly one is inside.",108:"Dr. Crab has won tons of battles. You are going to be a new defeated challenger.",109:"How to get rid of this?",110:"Flies around in unpredictable ways.",111:"Gotta go faster! Never feels tired.",112:"Hands up! You are surrounded!",113:"Why is this leaf so difficult to defeat? Must be a bug.",114:"Machine gun pea shooter enhanced.",115:"Mutated wasp. That's really frightening.",121:"He crafts everything... Including mobs?"})
		const MobAttributeList=["","ACTION=Destroys without loot. Spawns (Worker Ant/Soldier Ant) without loot.","ATTRIBUTE=Doesn't move.&ATTACK=Can't be defended.","HOSTILE=30%","HOSTILE=10%","ACTION=Additionally attacks if moving down outside first two rows.","HOSTILE=50%","","ATTRIBUTE=Immunes knockback.&ACTION=Summons Soldier Ant with rarity reduced by at most 2 and no loot, then attacks.","COUNT=10&ATTRIBUTE=Doesn't move.&ACTION=Destroys a part.&DAMAGE=Spawns following mobs in order: Baby Ant*2, Worker Ant*3, Soldier Ant*4.&DESTROY=No loot if automatically destroyed. Summons Queen Ant.","","ATTACK=Shoots a missile with [20%*Damage] and 20% accuracy instead.","COUNT=6&HOSTILE=10%&DAMAGE=Drops loot.","COUNT=6&DAMAGE=Drops loot.","COUNT=6&HOSTILE=30%&DAMAGE=Drops loot. Immunes all damage for 5 turns.","HOSTILE=30%","ATTRIBUTE=Guaranteed to be shiny.&HOSTILE=30%","CHARAC=Deals [1/3*Damage] [poison] for 8 turns when attack.","ATTACK=Shoots a missile with [1/3*Damage] and 30% accuracy instead. Applies [1/3*Damage] [poison] for 8 turns when hits.","","COUNT=5&ACTION=Destroys a part.&DAMAGE=Spawns following mobs in order: Soldier Fire Ant*4.&DESTROY=No loot if automatically destroyed. Summons Soldier Fire Ant*2.","ACTION=Additionally attacks if moving down outside first row.","ACTION=Destroys without loot. Deals 100 knockback to all petals.","ACTION=Has 30% probability to additionally attack.&CHARAC=Deals [50%*Damage] only when attack being defended.","ATTRIBUTE=Doesn't move.&HOSTILE=10%&CHARAC=When attack being defended, deals 100 knockback and shoots a missile for [100%*Damage] and 10% accuracy.","ACTION=When health is not above [50%*Health], heals for [20%*Health] and cancels action.","ACTION=Has 50% probability to attempt moving in row before attack.","ATTACK=Deals [40%*Damage] [lightning] instead. Can't be defended.","ATTRIBUTE=Absorbs 50% of damage taken by other nearby enemies down to 1 health.&ACTION=Destroys without loot.","ATTRIBUTE=Doesn't move.&ATTACK=Deals [50%*Damage] direct damage instead. Heals equal to damage dealt.","ACTION=Destroys without loot.&DESTROY=Shoots 2 missiles with [100%*Damage] and 10% accuracy. Applies disable passive heal for 10 turns when hits.","ACTION=Additionally attacks if moving down outside first two rows.","HOSTILE=50%","ATTRIBUTE=Immunes knockback.&ACTION=Summons Soldier Fire Ant with rarity reduced by at most 2 and no loot, then attacks.","","ATTRIBUTE=Has [50%*Damage] armor.&HOSTILE=20%","ATTACK=Shoots 3 missiles with 1 damage and 10% accuracy. Applies [25%*Damage] armor debuff for 10 turns when hits.","ATTRIBUTE=Connected.&ACTION=Additionally attacks if moving down outside first two rows.","ATTRIBUTE=Connected.&HOSTILE=50%","ATTRIBUTE=Connected.","ATTRIBUTE=Doesn't move. Immunes knockback. Connected.&HOSTILE=0%&ACTION=If hostile, destroys all termite mound without loot, then moves and attacks. Becomes hostile otherwise.","COUNT=2&ATTRIBUTE=Doesn't move. Destroys itself if remaining count is 1 and no termites are alive.&EXIST=Immunes all damage and prevents non-Termite mobs from spawning if remaining count is 1.&ACTION=Destroys a part if remaining count is 2. Does nothing otherwise.&DAMAGE=All other mobs retires (but will be back later) and clears all effects. Spawns Baby Termite*2, Worker Termite*3, Soldier Termite*4, (Termite Overmind/Termite Egg).","ACTION=Destroys without loot. Spawns Baby Termite without loot.","ATTRIBUTE=Doesn't move.&ACTION=Summons (Leafbug/Mantis/Firefly/Wasp) with rarity reduced by at most 1 and no loot.","HOSTILE=30%&STATURN=Speed becomes (health%+100%)/2 original value.","ATTRIBUTE=Gains 60% dodge while hostile.&HOSTILE=10%&ACTION=Retires if hostile.","HOSTILE=30%&CHARAC=Additionally deals [300%*Damage] [lightning] to flower whether attack is defended or not.","ACTION=Has 30% chance to charge up and cancel action if not charged.&ATTACK=Directly damages if charged up (and releases charging state).","ATTACK=Shoots (1~2) missiles with [20%*Damage] and 20% accuracy instead.","CHARAC=Deals [2/3*Damage] [poison] for 8 turns when attack.","COUNT=6&DAMAGE=Drops loot.","ATTACK=Shoots 5 missiles with [10%*Damage] and 10% accuracy instead."]
		MobAttributeList[66]="ACTION=Plays 62-point."
		Object.assign(MobAttributeList,{101:"BOSS&ATTRIBUTE=Moves up to 2 grids. Calculates [X] starting from 0.&ACTION=Increases [X] by 1. If [X] reaches 3, changes move to deal [20%*Damage] to flower and all petals, then resets [X] to 0.&ATTACK=Shoots 3 missiles with [40%*Damage] and 40% accuracy instead.",102:"BOSS&ATTRIBUTE=Moves up to 3 grids.&ACTION=Each petal has 30% probability to be restrained and gains halved action for 10 times.&CHARAC=Deals [20%*Damage] [poison] for 20 turns when attack.",103:"BOSS&COUNT=2&ATTRIBUTE=Doesn't move.&ATTACK=Shoots 8 missiles with [20%*Damage] and (50%,50%,40%,40%,30%,30%,20%,20%) accuracy instead. Applies 20% heal debuff and disable passive heal for 6 turns when hits. Both effectiveness and duration stacks.&DAMAGE=Performs an action. Then increases all accuracy by 10%&DESTROY=Performs an action.",104:"BOSS&ATTRIBUTE=Moves up to 2 grids.&ACTION=Each petal in the column or nearby column has [200-2*DEF1]% chance to take [50%*Damage] before attack.",105:"BOSS&ATTACK=Shoots a missile with [20%*Damage] and 80% accuracy instead. Applies [40%*Damage] [poison] for 6 turns when hits.",106:"BOSS&ATTRIBUTE=Moves up to 3 grids&ACTION=Each petal has [120-10*Size]% probability to move up 1 grid or receive [Damage] before attack.",107:"BOSS&ATTACK=Shoots all pearls with [Damage] and 40% accuracy instead if has at least 5 pearls. Otherwise gains (1~2) pearls if defended.",108:"BOSS&ATTRIBUTE=Moves up to 3 grids.&ACTION=Moves in row for at most 1 grid to find a gap before attack.",109:"BOSS&ATTACK=Directly damages and heals equal to damage dealt. Increases damage by 20% original value, effectiveness is decreased by 2% down to 0% by remaining suppression turn.",110:"BOSS&ATTRIBUTE=Moves up to 3 grids. Can't be shot. All petal with negative buff has tripled effective buff when targeted. All petal has at most 90% effective accuracy when targeted.",111:"BOSS&ATTRIBUTE=Moves up to 2 grids.&CHARAC=Increases resulting damage by 20% for every 6 speed above 54 up to 100%.",112:"BOSS&ATTRIBUTE=Moves up to 2 grids.&ACTION=Tries to summon Soldier Ant with no loot up to 2 instead. Otherwise tries to summon 2 Soldier Ant with rarity reduced by at most 1 and no loot up to 4 instead. Otherwise attacks.",113:"BOSS&ATTRIBUTE=Moves up to 2 grids. Has [30%*Damage] armor, increased to [60%*Damage] if speed reaches 30, increased to [150%*Damage] if speed reaches 40. Decreases all damage taken by 50% if speed reaches 50. Immunes all damage if speed reaches 60.&ACTION=Doesn't attack if speed is over 60.&CHARAC=Deals 10% less damage for every 5 speed above 40.",114:"BOSS&ATTACK=Shoots 5 missiles with [20%*Damage] and 20% accuracy instead. Applies stackable [40%*Damage] armor debuff for 20 turns when hits.",115:"BOSS&ATTRIBUTE=Moves up to 3 grids. Calculates [X] starting from 0.&ACTION=Increases [X] by 1. If [X] reaches 2, changes move to deal [20%*Damage] to flower and all petals, then resets [X] to 0.&ATTACK=Shoots 3 missiles with [40%*Damage] and 20% accuracy instead.",121:"BOSS&ATTRIBUTE=Immunes all damage while any Beetle is alive.&EXIST=When a Beetle attacks, all Beetles has 20% probability to get increased level and damage. When a Beetle dies, all Beetles get increased rarity and resets level."})
		const MobSVGArray=new Object()
		MobSVGArray.Rock="<path class='fgrey-path ns' d='M38 30L50 26L60 28L63 44L55 52L45 50L36 40Z'/>"
		MobSVGArray.Cactus="<path class='fgreen-path ns' d='M50 22.3A8 8 0 0 0 61.1 26.9A8 8 0 0 0 65.7 38A8 8 0 0 0 61.1 49.1A8 8 0 0 0 50 53.7A8 8 0 0 0 38.9 49.1A8 8 0 0 0 34.3 38A8 8 0 0 0 38.9 26.9A8 8 0 0 0 50 22.3'/><path class='flgreen-path ns ' d='M50 30A8 8 0 0 0 50 46A8 8 0 0 0 50 30'/>"
		MobSVGArray["Ladybug (Garden)"]="<path class='fred-path ns' d='M59.6 25.2A16 16 0 1 1 40.4 25.2Z'/><path class='fblack-path ns ' d='M40 23A10 5 0 0 1 60 23A10 5 0 0 1 40 23M45 34A3 3 0 0 0 45 40A3 3 0 0 0 45 34M48 47A3 3 0 0 0 48 53A3 3 0 0 0 48 47M60 39A3 3 0 0 0 60 45A3 3 0 0 0 60 39'/>"
		MobSVGArray.Bee="<path class='fblack-path wide' stroke-linejoin='round' d='M47 53L50 58L53 53ZM42 16A2 2 0 0 0 42 20A2 2 0 0 0 42 16M58 16A2 2 0 0 0 58 20A2 2 0 0 0 58 16'/><path class='yellow-path' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24' style='filter: brightness(80%)'/><linearGradient id='svgGradient' x1='50%' y1='0%' x2='50%' y2='100%'><stop offset='0%' stop-color='#ffff7f'/><stop offset='20%' stop-color='#ffff7f'/><stop offset='20%' stop-color='#000000'/><stop offset='35%' stop-color='#000000'/><stop offset='35%' stop-color='#ffff7f'/><stop offset='50%' stop-color='#ffff7f'/><stop offset='50%' stop-color='#000000'/><stop offset='65%' stop-color='#000000'/><stop offset='65%' stop-color='#ffff7f'/><stop offset='80%' stop-color='#ffff7f'/><stop offset='80%' stop-color='#000000'/><stop offset='100%' stop-color='#000000'/></linearGradient><path class='ns' fill='url(#svgGradient)' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24'/><path class='black-path wide' stroke-linecap='round' d='M47 26A10 10 0 0 0 42 18M53 26A10 10 0 0 1 58 18'/>"
		MobSVGArray["Baby Ant"]="<path class='black-path' stroke-linecap='round' d='M43 32L46 25M57 32L54 25'/><path class='dgrey-path wider' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31' style='filter: brightness(80%)'/><path class='fdgrey-path ns ' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31'/>"
		MobSVGArray["Worker Ant"]="<path class='fdgrey-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='dgrey-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fdgrey-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Soldier Ant"]="<path class='fdgrey-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M46 38A8.7 5 105 0 0 41.5 54.8A8.7 5 105 0 0 46 38M54 38A8.7 5 75 0 0 58.5 54.8A8.7 5 75 0 0 54 38'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='dgrey-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fdgrey-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Queen Ant"]="<path class='fdgrey-path ns' d='M50 35A10 10 0 0 0 50 55A10 10 0 0 0 50 35'/><path class='dgrey-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fdgrey-path ns' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M46 34A8.7 5 105 0 0 41.5 50.8A8.7 5 105 0 0 46 34M54 34A8.7 5 75 0 0 58.5 50.8A8.7 5 75 0 0 54 34'/><path class='black-path' stroke-linecap='round' d='M44 24L46 17M56 24L54 17'/><path class='dgrey-path wider' d='M50 23A6 6 0 0 0 50 35A6 6 0 0 0 50 23' style='filter: brightness(80%)'/><path class='fdgrey-path ns ' d='M50 23A6 6 0 0 0 50 35A6 6 0 0 0 50 23'/>"
		MobSVGArray["Ant Hole"]="<path class='fcyellow-path ns ' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20' style='filter: brightness(60%)'/><path class='fcyellow-path ns ' d='M50 26A12 12 0 0 0 50 50A12 12 0 0 0 50 26' style='filter: brightness(40%)'/><path class='fcyellow-path ns ' d='M50 32A6 6 0 0 0 50 44A6 6 0 0 0 50 32' style='filter: brightness(20%)'/>"
		MobSVGArray.Beetle="<path class='black-path' stroke-linecap='round' d='M43 27A9 9 0 0 1 45 20M57 27A9 9 0 0 0 55 20'/><path class='cpurple-path wider' d='M42 34A7 7 0 0 1 47 29A12 12 0 0 1 53 29A7 7 0 0 1 58 34A24 24 0 0 1 58 46A7 7 0 0 1 53 51A12 12 0 0 1 47 51A7 7 0 0 1 42 46A24 24 0 0 1 42 34' style='filter: brightness(80%)'/><path class='fcpurple-path ns ' d='M42 34A7 7 0 0 1 47 29A12 12 0 0 1 53 29A7 7 0 0 1 58 34A24 24 0 0 1 58 46A7 7 0 0 1 53 51A12 12 0 0 1 47 51A7 7 0 0 1 42 46A24 24 0 0 1 42 34'/><path class='cpurple-path' stroke-linecap='round' d='M50 34L50 46' style='filter: brightness(80%)'/><path class='fcpurple-path ns ' d='M45 32.8A1.8 1.8 0 0 0 45 36.4A1.8 1.8 0 0 0 45 32.8M45 38.2A1.8 1.8 0 0 0 45 41.8A1.8 1.8 0 0 0 45 38.2M45 43.6A1.8 1.8 0 0 0 45 47.2A1.8 1.8 0 0 0 45 43.6M55 32.8A1.8 1.8 0 0 0 55 36.4A1.8 1.8 0 0 0 55 32.8M55 38.2A1.8 1.8 0 0 0 55 41.8A1.8 1.8 0 0 0 55 38.2M55 43.6A1.8 1.8 0 0 0 55 47.2A1.8 1.8 0 0 0 55 43.6' style='filter: brightness(80%)'/>"
		MobSVGArray.Hornet="<path class='fblack-path wide' stroke-linejoin='round' d='M47 53L50 62L53 53Z'/><linearGradient id='svgGradient' x1='50%' y1='0%' x2='50%' y2='100%'><stop offset='0%' stop-color='#ffdf7f'/><stop offset='20%' stop-color='#ffdf7f'/><stop offset='20%' stop-color='#000000'/><stop offset='35%' stop-color='#000000'/><stop offset='35%' stop-color='#ffdf7f'/><stop offset='50%' stop-color='#ffdf7f'/><stop offset='50%' stop-color='#000000'/><stop offset='65%' stop-color='#000000'/><stop offset='65%' stop-color='#ffdf7f'/><stop offset='80%' stop-color='#ffdf7f'/><stop offset='80%' stop-color='#000000'/><stop offset='100%' stop-color='#000000'/></linearGradient><path class='cyellow-path' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24' style='filter: brightness(80%)'/><path class='ns' fill='url(#svgGradient)' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24'/><path class='black-path wide' stroke-linecap='round' d='M47 26A20 20 0 0 0 43 16M53 26A20 20 0 0 1 57 16'/>"
		MobSVGArray["Centipede (Garden)"]="<path class='black-path wide' stroke-linecap='round' d='M46 30A15 15 0 0 0 40 18M40 17A1 1 0 0 0 40 19A1 1 0 0 0 40 17M54 30A15 15 0 0 1 60 18M60 17A1 1 0 0 0 60 19A1 1 0 0 0 60 17'/><path class='fblack-path' stroke-linecap='round' stroke-linejoin='round' d='M35.6 34A7 7 0 0 0 35.6 46A15.6 15.6 0 0 1 35.6 34M64.4 34A7 7 0 0 1 64.4 46A15.6 15.6 0 0 0 64.4 34'/><path class='fgreen-path ns' d='M50 28.4A11.6 11.6 0 0 0 50 51.6A11.6 11.6 0 0 0 50 28.4'/>"
		MobSVGArray["Centipede (Jungle)"]="<path class='black-path wide' stroke-linecap='round' d='M46 30A15 15 0 0 0 40 18M40 17A1 1 0 0 0 40 19A1 1 0 0 0 40 17M54 30A15 15 0 0 1 60 18M60 17A1 1 0 0 0 60 19A1 1 0 0 0 60 17'/><path class='fblack-path' stroke-linecap='round' stroke-linejoin='round' d='M35.6 34A7 7 0 0 0 35.6 46A15.6 15.6 0 0 1 35.6 34M64.4 34A7 7 0 0 1 64.4 46A15.6 15.6 0 0 0 64.4 34'/><path class='fcpurple-path ns' d='M50 28.4A11.6 11.6 0 0 0 50 51.6A11.6 11.6 0 0 0 50 28.4'/>"
		MobSVGArray["Centipede (Desert)"]="<path class='black-path wide' stroke-linecap='round' d='M46 30A15 15 0 0 0 40 18M40 17A1 1 0 0 0 40 19A1 1 0 0 0 40 17M54 30A15 15 0 0 1 60 18M60 17A1 1 0 0 0 60 19A1 1 0 0 0 60 17'/><path class='fblack-path' stroke-linecap='round' stroke-linejoin='round' d='M35.6 34A7 7 0 0 0 35.6 46A15.6 15.6 0 0 1 35.6 34M64.4 34A7 7 0 0 1 64.4 46A15.6 15.6 0 0 0 64.4 34'/><path class='fyellow-path ns' d='M50 28.4A11.6 11.6 0 0 0 50 51.6A11.6 11.6 0 0 0 50 28.4'/>"
		MobSVGArray["Ladybug (Jungle)"]="<path class='fdbrown-path ns' d='M59.6 25.2A16 16 0 1 1 40.4 25.2Z'/><path class='fblack-path ns ' d='M40 23A10 5 0 0 1 60 23A10 5 0 0 1 40 23'/><path class='fwhite-path ns ' fill-opacity='0.2' d='M45 34A3 3 0 0 0 45 40A3 3 0 0 0 45 34M48 47A3 3 0 0 0 48 53A3 3 0 0 0 48 47M60 39A3 3 0 0 0 60 45A3 3 0 0 0 60 39'/>"
		MobSVGArray["Ladybug (Desert)"]="<path class='fyellow-path ns' d='M59.6 25.2A16 16 0 1 1 40.4 25.2Z'/><path class='fblack-path ns ' d='M40 23A10 5 0 0 1 60 23A10 5 0 0 1 40 23M45 34A3 3 0 0 0 45 40A3 3 0 0 0 45 34M48 47A3 3 0 0 0 48 53A3 3 0 0 0 48 47M60 39A3 3 0 0 0 60 45A3 3 0 0 0 60 39'/>"
		MobSVGArray.Spider="<path class='black-path wide' stroke-linecap='round' d='M42.5 28A18 18 0 0 0 33 21M38 34.5A25 25 0 0 0 28 31M38 41.5A25 25 0 0 1 28 45M42.5 48A15 15 0 0 1 33 53M57.5 28A18 18 0 0 1 67 21M62 34.5A25 25 0 0 1 72 31M62 41.5A25 25 0 0 0 72 45M57.5 48A15 15 0 0 0 67 53'/><path class='fdgrey-path ns' d='M50 29.5A8.5 8.5 0 0 0 50 46.5A8.5 8.5 0 0 0 50 29.5'/>"
		MobSVGArray.Scorpion="<path class='fcyellow-path wide ns' d='M50 25A13 5 90 0 0 50 51A13 5 90 0 0 50 25M47 31L40 29M40 29L42 21M47 37L38 36M47 41L38 42M47 48L42 47M42 47L40 50M53 31L60 29M60 29L58 21M53 37L62 36M53 41L62 42M53 48L58 47M58 47L60 50M50 51L50 57'/>"
		MobSVGArray["Soldier Fire Ant"]="<path class='fcred-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M46 38A8.7 5 105 0 0 41.5 54.8A8.7 5 105 0 0 46 38M54 38A8.7 5 75 0 0 58.5 54.8A8.7 5 75 0 0 54 38'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='cred-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fcred-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Fire Ant Burrow"]="<path class='fcred-path ns ' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20' style='filter: brightness(80%)'/><path class='fcred-path ns ' d='M50 26A12 12 0 0 0 50 50A12 12 0 0 0 50 26' style='filter: brightness(60%)'/><path class='fcred-path ns ' d='M50 32A6 6 0 0 0 50 44A6 6 0 0 0 50 32' style='filter: brightness(40%)'/>"
		MobSVGArray.Sandstorm="<path class='fyellow-path ns ' d='M50 16.4L68.7 27.2L68.7 48.8L50 59.6L31.3 48.8L31.3 27.2Z'/><path class='fyellow-path ns ' d='M50 23.8L62.3 30.9L62.3 45.1L50 52.2L37.7 45.1L37.7 30.9Z' style='filter: brightness(80%)'/><path class='fyellow-path ns ' d='M50 31.2L55.9 34.6L55.9 41.4L50 44.8L44.1 41.4L44.1 34.6Z' style='filter: brightness(60%)'/>"
		MobSVGArray.Bubble="<path class='white-path mwidth' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20'/><path class='fwhite-path ns ' fill-opacity='0.3' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M58 30A5 5 0 0 0 58 40A5 5 0 0 0 58 30'/>"
		MobSVGArray["Bumble Bee"]="<path class='fblack-path wide' stroke-linejoin='round' d='M42 16A2 2 0 0 0 42 20A2 2 0 0 0 42 16M58 16A2 2 0 0 0 58 20A2 2 0 0 0 58 16'/><linearGradient id='svgGradient' x1='50%' y1='0%' x2='50%' y2='100%'><stop offset='0%' stop-color='#ffdf7f'/><stop offset='20%' stop-color='#ffdf7f'/><stop offset='20%' stop-color='#000000'/><stop offset='35%' stop-color='#000000'/><stop offset='35%' stop-color='#ffdf7f'/><stop offset='50%' stop-color='#ffdf7f'/><stop offset='50%' stop-color='#000000'/><stop offset='65%' stop-color='#000000'/><stop offset='65%' stop-color='#ffdf7f'/><stop offset='80%' stop-color='#ffdf7f'/><stop offset='80%' stop-color='#000000'/><stop offset='100%' stop-color='#000000'/></linearGradient><path class='cyellow-path' d='M50 24A15 12 90 0 0 50 54A15 12 90 0 0 50 24' style='filter: brightness(80%)'/><path class='ns' fill='url(#svgGradient)' d='M50 24A15 12 90 0 0 50 54A15 12 90 0 0 50 24'/><path class='black-path wide' stroke-linecap='round' d='M47 26A10 10 0 0 0 42 18M53 26A10 10 0 0 1 58 18'/>"
		MobSVGArray.Shell="<path class='fcyellow-path ns' d='M50 50L34 30A20 20 0 0 1 66 30Z'/><path class='cyellow-path wide' d='M49 46L41 28M50 46L50 25M51 46L59 28M43 54A25 25 0 0 1 57 54' style='filter: brightness(80%)'/>"
		MobSVGArray.Starfish="<path class='fred-path ns' d='M44 38L48 22A6 3 90 0 1 52 22L56 38Z'/><path class='fred-path rot72 ns' d='M45 38L48 22A6 3 90 0 1 52 22L55 38Z'/><path class='fred-path rot144 ns' d='M45 38L48 22A6 3 90 0 1 52 22L55 38Z'/><path class='fred-path rot216 ns' d='M45 38L48 22A6 3 90 0 1 52 22L55 38Z'/><path class='fred-path rot288 ns' d='M45 38L48 22A6 3 90 0 1 52 22L55 38Z'/><path class='fwhite-path ns ' fill-opacity='0.2' d='M50 24A2 2 0 0 0 50 28A2 2 0 0 0 50 24M50 29A2.5 2.5 0 0 0 50 34A2.5 2.5 0 0 0 50 29'/><path class='fwhite-path rot72 ns ' fill-opacity='0.2' d='M50 24A2 2 0 0 0 50 28A2 2 0 0 0 50 24M50 29A2.5 2.5 0 0 0 50 34A2.5 2.5 0 0 0 50 29'/><path class='fwhite-path rot144 ns ' fill-opacity='0.2' d='M50 24A2 2 0 0 0 50 28A2 2 0 0 0 50 24M50 29A2.5 2.5 0 0 0 50 34A2.5 2.5 0 0 0 50 29'/><path class='fwhite-path rot216 ns ' fill-opacity='0.2' d='M50 24A2 2 0 0 0 50 28A2 2 0 0 0 50 24M50 29A2.5 2.5 0 0 0 50 34A2.5 2.5 0 0 0 50 29'/><path class='fwhite-path rot288 ns ' fill-opacity='0.2' d='M50 24A2 2 0 0 0 50 28A2 2 0 0 0 50 24M50 29A2.5 2.5 0 0 0 50 34A2.5 2.5 0 0 0 50 29'/>"
		MobSVGArray.Crab="<path class='dbrown-path wide' stroke-linecap='round' stroke-linejoin='round' d='M39 29L33 23L42 20M35 33L25 30M32 37L22 36M32 41L22 42M35 45L25 48M61 29L67 23L58 20M65 33L75 30M68 37L78 36M68 41L78 42M65 45L75 48' style='filter: brightness(50%)'/><path class='dbrown-path wider' d='M50 29A14 10 0 0 0 50 49A14 10 0 0 0 50 29' style='filter: brightness(80%)'/><path class='fdbrown-path ns ' d='M50 29A14 10 0 0 0 50 49A14 10 0 0 0 50 29'/>"
		MobSVGArray.Jellyfish="<path class='fwhite-path ns ' fill-opacity='0.3' d='M50 23.5A14.5 14.5 0 0 0 50 52.5A14.5 14.5 0 0 0 50 23.5'/><path class='white-path wide' stroke-linecap='round' d='M50 23.5A14.5 14.5 0 0 0 50 52.5A14.5 14.5 0 0 0 50 23.5M45.5 27.2L42 17M39.2 33.5L30 28M39.2 42.5L29 45M45.5 48.8L41 58M54.5 27.2L58 17M60.8 33.5L70 28M60.8 42.5L71 45M54.5 48.8L59 58'/>"
		MobSVGArray.Sponge="<path class='fyellow-path ns' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20'/><path class='fyellow-path ns ' d='M50 22A3.5 3.5 0 0 0 50 29A3.5 3.5 0 0 0 50 22M50 30A2.5 2.5 0 0 0 50 35A2.5 2.5 0 0 0 50 30' style='filter: brightness(80%)'/><path class='fyellow-path rot72 ns ' d='M50 22A3.5 3.5 0 0 0 50 29A3.5 3.5 0 0 0 50 22M50 30A2.5 2.5 0 0 0 50 35A2.5 2.5 0 0 0 50 30' style='filter: brightness(80%)'/><path class='fyellow-path rot144 ns ' d='M50 22A3.5 3.5 0 0 0 50 29A3.5 3.5 0 0 0 50 22M50 30A2.5 2.5 0 0 0 50 35A2.5 2.5 0 0 0 50 30' style='filter: brightness(80%)'/><path class='fyellow-path rot216 ns ' d='M50 22A3.5 3.5 0 0 0 50 29A3.5 3.5 0 0 0 50 22M50 30A2.5 2.5 0 0 0 50 35A2.5 2.5 0 0 0 50 30' style='filter: brightness(80%)'/><path class='fyellow-path rot288 ns ' d='M50 22A3.5 3.5 0 0 0 50 29A3.5 3.5 0 0 0 50 22M50 30A2.5 2.5 0 0 0 50 35A2.5 2.5 0 0 0 50 30' style='filter: brightness(80%)'/>"
		MobSVGArray.Leech="<path class='fblack-path wide ns' d='M46 27A5 5 0 0 1 54 27L54 51A5 5 0 0 1 46 51ZM46 25L47 20M54 25L53 20'/>"
		MobSVGArray.Dandelion="<path class='fwhite-path wide ns' d='M50 28A10 10 0 0 0 50 48A10 10 0 0 0 50 28M50 28L50 23A3.5 3.5 0 0 0 50 16A3.5 3.5 0 0 0 50 23M60 38L65 38A3.5 3.5 0 0 0 72 38A3.5 3.5 0 0 0 65 38M50 48L50 53A3.5 3.5 0 0 0 50 60A3.5 3.5 0 0 0 50 53M40 38L35 38A3.5 3.5 0 0 0 28 38A3.5 3.5 0 0 0 35 38'/><path class='fwhite-path diag wide ns' d='M50 28L50 23A3.5 3.5 0 0 0 50 16A3.5 3.5 0 0 0 50 23M60 38L65 38A3.5 3.5 0 0 0 72 38A3.5 3.5 0 0 0 65 38M50 48L50 53A3.5 3.5 0 0 0 50 60A3.5 3.5 0 0 0 50 53M40 38L35 38A3.5 3.5 0 0 0 28 38A3.5 3.5 0 0 0 35 38'/>"
		MobSVGArray["Baby Fire Ant"]="<path class='black-path' stroke-linecap='round' d='M43 32L46 25M57 32L54 25'/><path class='cred-path wider' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31' style='filter: brightness(80%)'/><path class='fcred-path ns ' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31'/>"
		MobSVGArray["Worker Fire Ant"]="<path class='fcred-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='cred-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fcred-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Queen Fire Ant"]="<path class='fcred-path ns' d='M50 35A10 10 0 0 0 50 55A10 10 0 0 0 50 35'/><path class='cred-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='fcred-path ns' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M46 34A8.7 5 105 0 0 41.5 50.8A8.7 5 105 0 0 46 34M54 34A8.7 5 75 0 0 58.5 50.8A8.7 5 75 0 0 54 34'/><path class='black-path' stroke-linecap='round' d='M44 24L46 17M56 24L54 17'/><path class='cred-path wider' d='M50 23A6 6 0 0 0 50 35A6 6 0 0 0 50 23' style='filter: brightness(80%)'/><path class='fcred-path ns ' d='M50 23A6 6 0 0 0 50 35A6 6 0 0 0 50 23'/>"
		MobSVGArray.Fly="<path class='fdgrey-path ns' d='M50 29A8 8 0 0 0 50 45A8 8 0 0 0 50 29'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M47 34A8.7 5 105 0 0 42.5 50.8A8.7 5 105 0 0 47 34M53 34A8.7 5 75 0 0 57.5 50.8A8.7 5 75 0 0 53 34'/>"
		MobSVGArray.Leafbug="<path class='black-path wide' stroke-linecap='round' d='M44 23L47 15M56 23L53 15M41 27L36 29M40 34L35 36M40 41L35 43M41 48L36 50M59 27L64 29M60 34L65 36M60 41L65 43M59 48L64 50'/><path class='dgreen-path wider' stroke-linecap='round' stroke-linejoin='round' d='M50 21A20 10 80 0 0 50 57A20 10 100 0 0 50 21' style='filter: brightness(80%)'/><path class='fdgreen-path ns ' d='M50 21A20 10 80 0 0 50 57A20 10 100 0 0 50 21'/><path class='dgreen-path wide' d='M50 25L50 50' style='filter: brightness(80%)'/>"
		MobSVGArray.Mantis="<path class='black-path wide' stroke-linecap='round' d='M40 29L35 31M39 35L34 37M39 41L34 43M40 47L35 49M60 29L65 31M61 35L66 37M61 41L66 43M60 47L65 49'/><path class='green-path wider' stroke-linecap='round' stroke-linejoin='round' d='M50 23A16 8 90 0 0 50 55A16 8 90 0 0 50 23' style='filter: brightness(80%)'/><path class='fgreen-path ns ' d='M50 23A16 8 90 0 0 50 55A16 8 90 0 0 50 23'/><path class='black-path wide' stroke-linecap='round' d='M47 25A20 20 0 0 0 43 15M53 25A20 20 0 0 1 57 15'/>"
		MobSVGArray["Baby Termite"]="<path class='black-path' stroke-linecap='round' d='M43 32L46 25M57 32L54 25'/><path class='lyellow-path wider' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31' style='filter: brightness(80%)'/><path class='flyellow-path ns ' d='M50 31A8 8 0 0 0 50 47A8 8 0 0 0 50 31'/>"
		MobSVGArray["Worker Termite"]="<path class='flyellow-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='lyellow-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='flyellow-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Soldier Termite"]="<path class='flyellow-path ns' d='M50 42A5 5 0 0 0 50 52A5 5 0 0 0 50 42'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M46 38A8.7 5 105 0 0 41.5 54.8A8.7 5 105 0 0 46 38M54 38A8.7 5 75 0 0 58.5 54.8A8.7 5 75 0 0 54 38'/><path class='black-path' stroke-linecap='round' d='M43 29L46 22M57 29L54 22'/><path class='lyellow-path wider' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28' style='filter: brightness(80%)'/><path class='flyellow-path ns ' d='M50 28A8 8 0 0 0 50 44A8 8 0 0 0 50 28'/>"
		MobSVGArray["Termite Overmind"]="<path class='black-path' stroke-linecap='round' d='M40 21L45 15M60 21L55 15'/><path class='lyellow-path wider' d='M50 21A18 18 0 0 0 50 57A18 18 0 0 0 50 21' style='filter: brightness(80%)'/><path class='flyellow-path ns ' d='M50 21A18 18 0 0 0 50 57A18 18 0 0 0 50 21'/>"
		MobSVGArray["Termite Mound"]="<path class='flyellow-path ns ' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20' style='filter: brightness(80%)'/><path class='flyellow-path ns ' d='M50 26A12 12 0 0 0 50 50A12 12 0 0 0 50 26' style='filter: brightness(60%)'/><path class='flyellow-path ns ' d='M50 32A6 6 0 0 0 50 44A6 6 0 0 0 50 32' style='filter: brightness(40%)'/>"
		MobSVGArray["Termite Egg"]="<path class='flyellow-path ns' d='M50 26A12 12 0 0 0 50 50A12 12 0 0 0 50 26'/>"
		MobSVGArray.Bush="<path class='fdgreen-path ns' d='M50 21.2A10 10 0 0 1 56.1 29.6A10 10 0 0 1 66 32.8A10 10 0 0 1 59.9 41.2A10 10 0 0 1 59.9 51.6A10 10 0 0 1 50 48.4A10 10 0 0 1 40.1 51.6A10 10 0 0 1 40.1 41.2A10 10 0 0 1 34 32.8A10 10 0 0 1 44.9 29.6A10 10 0 0 1 50 21.2'/><path class='dgreen-path wide' d='M50 38L50 25.4M50 38L62 34.1M50 38L57.4 47.7M50 38L42.6 47.7M50 38L38 34.1' style='filter: brightness(80%)'/>"
		MobSVGArray.Roach="<path class='fdbrown-path ns' d='M50 23A16 8 90 0 0 50 55A16 8 90 0 0 50 23'/><path class='black-path wide' stroke-linecap='round' d='M47 25A20 20 0 0 0 43 15M53 25A20 20 0 0 1 57 15'/>"
		MobSVGArray.Moth="<path class='fblack-path wide' stroke-linejoin='round' d='M42 21A2 2 0 0 0 42 25A2 2 0 0 0 42 21M58 21A2 2 0 0 0 58 25A2 2 0 0 0 58 21'/><path class='fdgrey-path ns' d='M50 29A8 8 0 0 0 50 45A8 8 0 0 0 50 29'/><path class='fwhite-path ns ' fill-opacity='0.6' d='M47 34A8.7 6.5 105 0 0 42.5 50.8A8.7 6.5 105 0 0 47 34M53 34A8.7 6.5 75 0 0 57.5 50.8A8.7 6.5 75 0 0 53 34'/><path class='black-path wide' stroke-linecap='round' d='M47 29A8 8 0 0 0 42 23M53 29A8 8 0 0 1 58 23'/>"
		MobSVGArray.Firefly="<path class='fyellow-path ns' d='M50 27A12 6 90 0 0 50 51A12 6 90 0 0 50 27'/><path class='fblack-path ns ' stroke-linecap='round' d='M50 20A6 6 0 0 0 50 32A6 6 0 0 0 50 20'/><path class='flyellow-path ns ' fill-opacity='0.3' d='M50 14A25 25 0 0 0 50 64A25 25 0 0 0 50 14'/>"
		MobSVGArray["Beetle (Hell)"]="<path class='black-path' stroke-linecap='round' d='M43 27A9 9 0 0 1 45 20M57 27A9 9 0 0 0 55 20'/><path class='cdred-path wider' d='M42 34A7 7 0 0 1 47 29A12 12 0 0 1 53 29A7 7 0 0 1 58 34A24 24 0 0 1 58 46A7 7 0 0 1 53 51A12 12 0 0 1 47 51A7 7 0 0 1 42 46A24 24 0 0 1 42 34' style='filter: brightness(80%)'/><path class='fcdred-path ns ' d='M42 34A7 7 0 0 1 47 29A12 12 0 0 1 53 29A7 7 0 0 1 58 34A24 24 0 0 1 58 46A7 7 0 0 1 53 51A12 12 0 0 1 47 51A7 7 0 0 1 42 46A24 24 0 0 1 42 34'/><path class='cdred-path' stroke-linecap='round' d='M50 34L50 46' style='filter: brightness(80%)'/><path class='fcdred-path ns ' d='M45 32.8A1.8 1.8 0 0 0 45 36.4A1.8 1.8 0 0 0 45 32.8M45 38.2A1.8 1.8 0 0 0 45 41.8A1.8 1.8 0 0 0 45 38.2M45 43.6A1.8 1.8 0 0 0 45 47.2A1.8 1.8 0 0 0 45 43.6M55 32.8A1.8 1.8 0 0 0 55 36.4A1.8 1.8 0 0 0 55 32.8M55 38.2A1.8 1.8 0 0 0 55 41.8A1.8 1.8 0 0 0 55 38.2M55 43.6A1.8 1.8 0 0 0 55 47.2A1.8 1.8 0 0 0 55 43.6' style='filter: brightness(80%)'/>"
		MobSVGArray.Wasp="<path class='fblack-path wide' stroke-linejoin='round' d='M46 53L50 65L54 53Z'/><linearGradient id='svgGradient' x1='50%' y1='0%' x2='50%' y2='100%'><stop offset='0%' stop-color='#ffbf3f'/><stop offset='20%' stop-color='#ffbf3f'/><stop offset='20%' stop-color='#000000'/><stop offset='35%' stop-color='#000000'/><stop offset='35%' stop-color='#ffbf3f'/><stop offset='50%' stop-color='#ffbf3f'/><stop offset='50%' stop-color='#000000'/><stop offset='65%' stop-color='#000000'/><stop offset='65%' stop-color='#ffbf3f'/><stop offset='80%' stop-color='#ffbf3f'/><stop offset='80%' stop-color='#000000'/><stop offset='100%' stop-color='#000000'/></linearGradient><path class='corange-path' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24' style='filter: brightness(80%)'/><path class='ns' fill='url(#svgGradient)' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24'/><path class='black-path wide' stroke-linecap='round' d='M47 26A20 20 0 0 0 43 16M53 26A20 20 0 0 1 57 16'/>"
		MobSVGArray["Spider (Hell)"]="<path class='black-path wide' stroke-linecap='round' d='M42.5 28A18 18 0 0 0 33 21M38 34.5A25 25 0 0 0 28 31M38 41.5A25 25 0 0 1 28 45M42.5 48A15 15 0 0 1 33 53M57.5 28A18 18 0 0 1 67 21M62 34.5A25 25 0 0 1 72 31M62 41.5A25 25 0 0 0 72 45M57.5 48A15 15 0 0 0 67 53'/><path class='fcdred-path ns' d='M50 29.5A8.5 8.5 0 0 0 50 46.5A8.5 8.5 0 0 0 50 29.5'/>"
		MobSVGArray["Centipede (Hell)"]="<path class='black-path wide' stroke-linecap='round' d='M46 30A15 15 0 0 0 40 18M40 17A1 1 0 0 0 40 19A1 1 0 0 0 40 17M54 30A15 15 0 0 1 60 18M60 17A1 1 0 0 0 60 19A1 1 0 0 0 60 17'/><path class='fblack-path' stroke-linecap='round' stroke-linejoin='round' d='M35.6 34A7 7 0 0 0 35.6 46A15.6 15.6 0 0 1 35.6 34M64.4 34A7 7 0 0 1 64.4 46A15.6 15.6 0 0 0 64.4 34'/><path class='fcdred-path ns' d='M50 28.4A11.6 11.6 0 0 0 50 51.6A11.6 11.6 0 0 0 50 28.4'/>"
		MobSVGArray["Wasp (Hell)"]="<path class='fblack-path wide' stroke-linejoin='round' d='M46 53L50 65L54 53Z'/><linearGradient id='svgGradient' x1='50%' y1='0%' x2='50%' y2='100%'><stop offset='0%' stop-color='#bf0000'/><stop offset='20%' stop-color='#bf0000'/><stop offset='20%' stop-color='#000000'/><stop offset='35%' stop-color='#000000'/><stop offset='35%' stop-color='#bf0000'/><stop offset='50%' stop-color='#bf0000'/><stop offset='50%' stop-color='#000000'/><stop offset='65%' stop-color='#000000'/><stop offset='65%' stop-color='#bf0000'/><stop offset='80%' stop-color='#bf0000'/><stop offset='80%' stop-color='#000000'/><stop offset='100%' stop-color='#000000'/></linearGradient><path class='cdred-path' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24' style='filter: brightness(80%)'/><path class='ns' fill='url(#svgGradient)' d='M50 24A15 9 90 0 0 50 54A15 9 90 0 0 50 24'/><path class='black-path wide' stroke-linecap='round' d='M47 26A20 20 0 0 0 43 16M53 26A20 20 0 0 1 57 16'/>"
		MobSVGArray.Gambler="<path class='fcdred-path ns' d='M50 23A15 15 0 0 0 50 53A15 15 0 0 0 50 23'/><path class='black-path wide' d='M42 42A10 10 0 0 0 58 42M45 30L45 38M55 30L55 38'/>"
		for(let i in MobNameList) if(i!=="0" && MobNameList[i].match("!")===null) {
			MobSVGArray[MobNameList[i]]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fblack-path ns' fill-opacity='0.2' d='M8 100A8 8 0 0 1 0 92L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 92A8 8 0 0 1 92 100L92 8L8 8ZM8 92L92 92L92 100L8 100Z'/></svg><svg viewBox='0 0 100 76' class='in-svg' style='position: absolute; height: 76%; top: 0px; left: 0px'><g>"+MobSVGArray[MobNameList[i]].replaceAll(/<linear.+Gradient>/g,"").replaceAll(/<path class='(\w+-path (ns |wider?|mwidth)|\w+-path|ns)'.+?\/>/g,"").replaceAll("class='f","class='").replaceAll("ns'","wider' stroke-linecap='round' stroke-linejoin='round' style='filter: brightness(80%)'")+MobSVGArray[MobNameList[i]].replaceAll("ns '","ns'").replaceAll("path '","path'")+"</g></svg><span class='mid nowrap bold' style='--transform2: translate(0px,20px)'>"+MobNameList[i].replace(/\s\(.+\)/,"").replace("Ant","A.").replace("Fire ","F. ").replace("Termite","T.").replace("Bumble","B.").replace("Soldier F","S. F").replace("Burrow","B.").replace("Worker F","W. F").replace("Queen F","Q. F").replace("Overmind","Over.")+"</span>"
		}
		MobSVGArray.Summoner="<svg viewBox='0 0 100 100' class='in-svg'><path class='fblack-path ns' fill-opacity='0.2' d='M8 100A8 8 0 0 1 0 92L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 92A8 8 0 0 1 92 100L92 8L8 8ZM8 92L92 92L92 100L8 100Z'/></svg><svg viewBox='0 0 100 76' class='in-svg' style='position: absolute; height: 76%; top: 0px; left: 0px'><path class='fyellow-path' d='M50 20A18 18 0 0 0 50 56A18 18 0 0 0 50 20M40 43A12 12 0 0 0 60 43M44 28L44 38M56 28L56 38'/></svg><span class='mid nowrap bold' style='--transform2: translate(0px,20px)'>Summon</span>"
		const MapNameList=["","","","","","","","","","","Centralia Center","Centralia Field 1","Centralia Field 2","Centralia Field 3","Centralia Field 4","Centralia Field 5","Centralia Field 6","Centralia Field 7","","","","South Desert 1","South Desert 2","South Desert 3","South Desert 4","South Desert 5","South Desert 6","","","","","East Water 1","East Water 2","East Water 3","East Water 4","East Water 5","East Water 6","East Water 7","East Water 8","East Water 9","","Sewer 1","Sewer 2","Sewer 3","Sewer 4","","","","","","","Ant Hell 1","Ant Hell 2","Ant Hell 3","Ant Hell 4","Ant Hell 5","Ant Hell 6","","","","","Jungle 1","Jungle 2","Jungle 3","Jungle 4","Jungle 5","Jungle 6","Jungle Gate"]
		const MapSpawnList=["","","","","","","","","","","","Rock=15%&Ladybug (Garden)=20%&Bee=15%&Baby Ant=20%&Worker Ant=12%&Soldier Ant=5%&Ant Hole=2%&Hornet=8%&Centipede (Garden)=3%","Rock=15%&Ladybug (Garden)=20%&Bee=15%&Baby Ant=15%&Worker Ant=12%&Soldier Ant=8%&Ant Hole=2%&Hornet=10%&Centipede (Garden)=3%","Rock=15%&Ladybug (Garden)=20%&Bee=15%&Baby Ant=10%&Worker Ant=10%&Soldier Ant=10%&Ant Hole=2%&Hornet=12%&Centipede (Garden)=6%","Rock=15%&Ladybug (Garden)=20%&Bee=15%&Baby Ant=5%&Worker Ant=8%&Soldier Ant=10%&Ant Hole=1%&Hornet=20%&Centipede (Garden)=6%","Hornet=20%&Dandelion=80%","Rock=12%&Ladybug (Garden)=15%&Bee=15%&Ant Hole=2%&Hornet=25%&Centipede (Garden)=6%&Spider=15%&Dandelion=10%","Rock=15%&Ladybug (Garden)=12%&Bee=12%&Ant Hole=1%&Hornet=40%&Centipede (Garden)=3%&Spider=12%&Dandelion=5%","","","","Beetle=90%&Ladybug (Desert)=10%","Cactus=25%&Beetle=20%&Centipede (Desert)=10%&Ladybug (Desert)=5%&Scorpion=15%&Fire Ant Burrow=5%&Sandstorm=20%","Cactus=20%&Beetle=20%&Centipede (Desert)=8%&Ladybug (Desert)=4%&Scorpion=20%&Fire Ant Burrow=8%&Sandstorm=20%","Cactus=25%&Beetle=20%&Ladybug (Desert)=2%&Scorpion=25%&Fire Ant Burrow=3%&Sandstorm=25%","Cactus=30%&Beetle=20%&Centipede (Desert)=2%&Ladybug (Desert)=6%&Scorpion=20%&Fire Ant Burrow=12%&Sandstorm=20%","Cactus=20%&Beetle=40%&Ladybug (Desert)=2%&Scorpion=20%&Fire Ant Burrow=3%&Sandstorm=15%","","","","","Bubble=20%&Shell=20%&Starfish=15%&Crab=30%&Sponge=15%","Bubble=20%&Shell=20%&Starfish=20%&Crab=20%&Sponge=20%","Bubble=15%&Shell=10%&Starfish=15%&Crab=15%&Jellyfish=15%&Sponge=30%","Crab=30%&Jellyfish=60%&Sponge=10%","Bubble=10%&Shell=50%&Starfish=15%&Crab=15%&Jellyfish=10%","Bubble=25%&Shell=20%&Crab=15%&Jellyfish=40%","Bubble=10%&Shell=10%&Starfish=10%&Crab=10%&Leech=60%","Bubble=30%&Starfish=50%&Jellyfish=20%","Bubble=30%&Shell=10%&Crab=60%","","Spider=20%&Fly=20%&Roach=20%&Moth=40%","Spider=20%&Fly=25%&Roach=30%&Moth=25%","Spider=20%&Fly=30%&Roach=25%&Moth=25%","Spider=40%&Fly=20%&Roach=25%&Moth=15%","","","","","","","Baby Ant=25%&Worker Ant=30%&Soldier Ant=45%","Baby Ant=12%&Worker Ant=25%&Soldier Ant=60%&Queen Ant=3%","Soldier Fire Ant=45%&Baby Fire Ant=25%&Worker Fire Ant=30%","Soldier Fire Ant=60%&Baby Fire Ant=12%&Worker Fire Ant=25%&Queen Fire Ant=3%","Baby Termite=25%&Worker Termite=30%&Soldier Termite=45%","Baby Termite=12%&Worker Termite=25%&Soldier Termite=63%","","","","","Termite Mound=10%&Bush=90%","Centipede (Jungle)=5%&Ladybug (Jungle)=10%&Leafbug=15%&Mantis=10%&Termite Mound=5%&Bush=40%&Firefly=5%&Wasp=10%","Centipede (Jungle)=5%&Ladybug (Jungle)=8%&Leafbug=15%&Mantis=10%&Termite Mound=4%&Bush=40%&Firefly=8%&Wasp=10%","Centipede (Jungle)=5%&Ladybug (Jungle)=8%&Leafbug=15%&Mantis=12%&Termite Mound=3%&Bush=35%&Firefly=10%&Wasp=12%","Centipede (Jungle)=3%&Ladybug (Jungle)=10%&Leafbug=15%&Mantis=15%&Termite Mound=2%&Bush=30%&Firefly=10%&Wasp=15%","Centipede (Jungle)=3%&Ladybug (Jungle)=8%&Leafbug=20%&Mantis=20%&Termite Mound=1%&Bush=20%&Firefly=8%&Wasp=20%",""]
		const MapRarityList=["/","/","/","/","/","/","/","/","/","/","/",0,1,1,2,3,4,5,"/","/","/",0,1,2,2,3,5,"/","/","/","/",1,1,1,2,3,4,4,5,5,"/",1,2,3,5,"/","/","/","/","/","/",2,4,3,4,3,4,"/","/","/","/",0,1,2,3,4,4,"/"]
		const MapDensityList=["/","/","/","/","/","/","/","/","/","/","/","5-8","5-8","8-12","10-15","6-9","8-12","12-18","/","/","/","3-5","10-15","6-9","8-12","8-12","10-15","/","/","/","/","5-8","6-9","8-12","12-18","8-12","10-15","10-15","6-9","8-12","/","5-8","6-9","6-9","8-12","/","/","/","/","/","/","5-8","6-9","5-8","6-9","5-8","6-9","/","/","/","/","2-3","3-5","5-8","8-12","10-15","12-18","/"]
		const ItemSVGArray=new Object()
		ItemSVGArray["Energy Drink"]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fcorange-path' d='M35 25A15 5 0 0 0 65 25L65 75A15 5 0 0 1 35 75Z'/><path class='flgrey-path' d='M35 25A15 5 0 0 1 65 25A15 5 0 0 1 35 25Z'/><path class='fyellow-path yellow-path wide' d='M50 47A5 4.5 90 0 1 50 57A5 4.5 90 0 1 50 47M50 44L50 38M55 46L59 41M57.5 52L62.5 51.5M55 58L59 62M50 60L50 66M45 58L41 62M42.5 52L37.5 51.5M45 46L41 41'/></svg><span class='nd'>Energy Drink</span>"
		ItemSVGArray.Arrow="<svg viewBox='0 0 100 100' class='in-svg'><path class='fcyan-path ns' d='M50 20L75 45A3.5 1.5 135 0 1 70 50L50 30L30 50A3.5 1.5 45 0 1 25 45ZM50 45L75 70A3.5 1.5 135 0 1 70 75L50 55L30 75A3.5 1.5 45 0 1 25 70Z'/></svg><span class='nd'>Arrow</span>"
		ItemSVGArray["Epic Rose Juice"]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fgreen-path' d='M32 25A18 6 0 0 0 68 25L68 75A18 6 0 0 1 32 75Z'/><path class='flgrey-path' d='M32 25A18 6 0 0 0 68 25A18 6 0 0 0 32 25Z'/><path class='cpink-path' d='M50 44A22 22 0 0 1 61 63A22 22 0 0 1 39 63A22 22 0 0 1 50 44Z' style='filter: brightness(90%)'/><path class='fcpink-path ns' d='M50 44A22 22 0 0 1 61 63A22 22 0 0 1 39 63A22 22 0 0 1 50 44Z'/></svg><span class='nd'>Epic Rose Juice</span>"
		ItemSVGArray["Triple Web"]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path ns' d='M39 29.5A15 15 0 0 0 50 21.5A15 15 0 0 0 61 29.5A15 15 0 0 0 56.8 42.5A15 15 0 0 0 43.2 42.5A15 15 0 0 0 39 29.5ZM54.3 56A15 15 0 0 0 65.3 48A15 15 0 0 0 76.3 56A15 15 0 0 0 72.1 69A15 15 0 0 0 58.5 69A15 15 0 0 0 54.3 56ZM23.7 56A15 15 0 0 0 34.7 48A15 15 0 0 0 45.7 56A15 15 0 0 0 41.5 69A15 15 0 0 0 27.9 69A15 15 0 0 0 23.7 56Z'/><path class='white-path wide' d='M39 29.5A15 15 0 0 0 50 21.5A15 15 0 0 0 61 29.5A15 15 0 0 0 56.8 42.5A15 15 0 0 0 43.2 42.5A15 15 0 0 0 39 29.5ZM54.3 56A15 15 0 0 0 65.3 48A15 15 0 0 0 76.3 56A15 15 0 0 0 72.1 69A15 15 0 0 0 58.5 69A15 15 0 0 0 54.3 56ZM23.7 56A15 15 0 0 0 34.7 48A15 15 0 0 0 45.7 56A15 15 0 0 0 41.5 69A15 15 0 0 0 27.9 69A15 15 0 0 0 23.7 56Z' style='filter: brightness(90%)'/></svg><span class='nd'>Triple Web</span>"
		ItemSVGArray["Time Shard"]="<svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path' d='M29 62L58 33A41 41 0 0 1 70 62Z'/><path class='blue-path rcap wide' d='M29 62L49 42'/><path class='red-path rcap' d='M29 62L43 62'/><path class='fblack-path' d='M66 50A2 2 0 0 0 66 54A2 2 0 0 0 66 50M62 40A2 2 0 0 0 62 44A2 2 0 0 0 62 40'/></svg><span class='nd'>Time Shard</span>"
		const CardSVGArray=new Object()
		CardSVGArray.Default="<svg viewBox='0 0 100 100' class='in-svg'><path class='grey-path wider' stroke-linecap='round' stroke-linejoin='round' d='M34 26L66 26L66 74L34 74Z' style='filter: brightness(90%)'/><path class='fgrey-path ns' d='M34 26L66 26L66 74L34 74Z'/><path class='fwhite-path ns' d='M34 50A24 16 90 0 0 66 50A24 16 90 0 0 34 50'/><path class='black-path mwidth' d='M38 41L47 41L47 59M62 50L53 50L53 41L62 41L62 59L53 59'/></svg><span class='nd'>Default</span>"
		CardSVGArray.Basic="<svg viewBox='0 0 100 100' class='in-svg' style='border-radius: 8%; overflow: hidden'><path class='fblack-path ns' fill-opacity='0.2' d='M0 0L100 0L100 0L0 0Z'/><path class='white-path wider' d='M50 32A18 18 0 0 0 50 68A18 18 0 0 0 50 32' style='filter: brightness(90%)'/><path class='fwhite-path ns' d='M50 32A18 18 0 0 0 50 68A18 18 0 0 0 50 32'/></svg><span class='nd'>Basic</span>"
		CardSVGArray.Rock="<svg viewBox='0 0 100 100' class='in-svg'><path class='grey-path wider' d='M28 42L49 26L70 47L65 66L38 69Z' style='filter: brightness(90%)'/><path class='fgrey-path ns' d='M28 42L49 26L70 47L65 66L38 69Z'/></svg><span class='nd'>Rock</span>"
		CardSVGArray["Blood Stinger"]="<svg viewBox='0 0 100 100' class='in-svg'><path class='cdred-path wider' stroke-linecap='round' stroke-linejoin='round' d='M46 43L58 50L46 57Z' style='filter: brightness(90%)'/><path class='fcdred-path ns' d='M46 43L58 50L46 57Z'/></svg><span class='nd'>Blood Stinger</span>"
		CardSVGArray.Dice="<svg viewBox='0 0 100 100' class='in-svg'><path class='white-path wider' stroke-linecap='round' stroke-linejoin='round' d='M32 32L68 32L68 68L32 68Z' style='filter: brightness(90%)'/><path class='fwhite-path ns' d='M32 32L68 32L68 68L32 68Z'/><path class='fred-path ns' d='M50 44A6 6 0 0 0 50 56A6 6 0 0 0 50 44'/></svg><span class='nd'>Dice</span>"
		CardSVGArray.Air="<svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path ns' fill-opacity='0.1' d='M10 10L90 10L90 90L10 90'/></svg><span class='nd'>Air</span>"
		CardSVGArray.Yggdrasil="<svg viewBox='0 0 100 100' class='in-svg'><path class='cbrown-path wider' stroke-linecap='round' stroke-linejoin='round' d='M37 73.4A27.3 13 115 0 0 64.2 26.5A27.3 13 125 0 0 37 73.4' style='filter: brightness(90%)'/><path class='fcbrown-path ns' d='M37 73.4A27.3 13 115 0 0 64.2 26.5A27.3 13 125 0 0 37 73.4'/><path class='cbrown-path wide' d='M40.4 67.7L56.9 38.3' style='filter: brightness(90%)'/></svg><span class='nd'>Yggdrasil</span>"
		CardSVGArray.Criticize="<svg viewBox='0 0 100 100' class='in-svg'><path class='yellow-path' d='M50 18L50 62'/><path class='fyellow-path ns' d='M50 75A4 4 0 0 0 50 83A4 4 0 0 0 50 75'/></svg><span class='nd'>Criticize</span>"
		CardSVGArray.Disregard="<svg viewBox='0 0 100 100' class='in-svg'><path class='cyan-path' d='M35 35A15 15 0 1 1 59 47A22.5 22.5 0 0 0 50 65'/><path class='fcyan-path ns' d='M50 75A4 4 0 0 0 50 83A4 4 0 0 0 50 75'/></svg><span class='nd'>Disregard</span>"
		CardSVGArray.Refresh="<svg viewBox='0 0 100 100' class='in-svg'><path class='white-path wider' d='M67 67A24 24 0 1 1 67 33M71 31L65 37L71 37Z'></path></svg><span class='nd'>Refresh</span>"
		function LevelExp(level) {
			if(level===0) return 1
			let answer=1.06361**level-1
			return approx(1000*answer)
		}
		function FlowerMaxHealthBase(level) {
			let answer=1.01**level-0.4
			return approx(250*answer)
		}
		function FlowerMaxHealth() {
			let answer=FlowerMaxHealthBase(player.level)
			if(fight.flower.effect.hasOwnProperty("bloom")) answer+=fight.flower.effect.bloom.buff
			if(fight.flower.effect.hasOwnProperty("wither")) answer-=fight.flower.effect.wither.debuff
			if(answer<1) return 1
			return answer
		}
		function FlowerSlot() {
			let answer=6+betterFloor(player.level/10)
			return answer
		}
		function PetalAbsorbExp(rarity,level) {
			let base=[0,8,12,20,40,100,300]
			let answer=base[rarity]
			answer*=2**level
			return answer
		}
		function ExpVariance(baseexp) {
			let fluctuation=baseexp/5-0.5,fluctuationint=betterFloor(fluctuation)
			let answer=fluctuationint*(fluctuationint+1)*(2*fluctuationint+1)/6+(fluctuation-fluctuationint)*((fluctuationint+1)**2)
			answer/=(fluctuation+0.5)
			return answer
		}
		function MobHealthMultiplier(rarity) {
			let answer=[0,8,10,15,25,40,60,100]
			return answer[rarity]
		}
		function MobDamageMultiplier(rarity) {
			let answer=[0,5,6,8,10,15,20,30]
			return answer[rarity]
		}
		function MobSpeedMultiplier(rarity) {
			let answer=[0,1,1,1,1,1,1.1,1.3]
			return answer[rarity]
		}
		function PetalDamageMultiplier(rarity,level) {
			let base=[5,5,6,8,11,15,20]
			let answer=0
			for(let i=0;i<=rarity;i++) answer+=base[i]
			answer+=base[rarity]*level
			if(level>5) {
				answer*=1.5
			} else {
				answer*=(1+level/10)
			}
			return answer
		}
		function PetalHealthMultiplier(rarity,level) {
			let base=[4,1,2,3,4,5,6]
			let answer=0
			for(let i=0;i<rarity;i++) answer+=2*base[i]
			answer+=base[rarity]*level
			answer*=(0.9+rarity/10)
			return answer
		}
		function BossRarity(floor,order) {
			let answer=betterFloor((floor+order+6)/2)
			if(answer>7) answer=7
			return answer
		}
		function BossHealthMultiplier(floor) {
			let answer=[0.5,1,1.2,1.2,1.5,1.5,2,2.5]
			return answer[floor]
		}
		function BossDamageMultiplier(floor) {
			let answer=[0.5,0.6,0.8,1,1.2,1.3,1.4,1.5]
			return answer[floor]
		}
		function AttackSuccessBase(patk,mdef) {
			if(patk===0) return 0
			if(mdef===0) return 100
			if(patk===100 && mdef===100) return 37
			if(patk===100) return 100
			if(mdef===100) return 0
			let patkr=patk/100,mdefr=mdef/100,answer=patkr**(mdefr/(1-mdefr**patkr))*100
			return approx(answer)
		}
		function AttackSuccessChance(petal,mob,direction="Front",row="Front") {
			if(direction==="Auto") {
				if(petal.x===mob.x) {
					direction="Front"
				} else {
					direction="Side"
				}
			}
			if(row==="Auto") {
				if(petal.y===4) {
					row="Front"
				} else {
					row="Middle"
				}
			}
			let patk=petal.atk2,mdef=mob.dodge
			if(row!=="Front") patk=petal.atk1
			patk+=petal.atkbuff
			if(mob.name==="!Fly!" && petal.atkbuff<0) patk+=2*petal.atkbuff
			if(direction!=="Front") patk-=(18-petal.size)*(17-petal.size)/2
			if(patk<=10) return 0
			if(patk>100) patk=100
			if(mob.name==="!Fly" && patk>90) patk=90
			if(mob.name==="Moth" && mob.behavior==="Neutral+") mdef+=60
			if(mdef<10) return 100
			if(mdef>100) mdef=100
			let calculatedChance=AttackSuccessBase(patk,mdef)
			if(calculatedChance===0) return 0
			if(direction!=="Front" && petal.atkbuff<5) {
				if(petal.atkbuff>=-5) {
					calculatedChance-=(5-petal.atkbuff)
				} else {
					calculatedChance-=(-2*petal.atkbuff)
				}
			}
			if(calculatedChance<=0) return 0
			return calculatedChance
		}
		function ShootSuccessChance(petal,mob) {
			if(mob.name==="!Fly!") return 0
			let patk=100,mdef=mob.dodge,shootDistance=discalc(petal.shootatt.x,mob.x)+discalc(petal.shootatt.y,mob.y,0)
			if(petal.shootatt.bounce===0) {
				if(shootDistance>petal.shootatt.range) patk-=(shootDistance-petal.shootatt.range)*petal.shootatt.accdec
			} else {
				if(shootDistance>petal.shootatt.bonrange) return 0
				if(petal.shootatt.bounce>petal.shootatt.freebon) patk-=(petal.shootatt.bounce-petal.shootatt.freebon)*petal.shootatt.bondec
				for(let i=0;i<petal.shootatt.hitarray.length;i++) if(mob===petal.shootatt.hitarray[i]) patk-=petal.shootatt.repdec
			}
			if(patk<=10) return 0
			let petalClone=petal.clone()
			petalClone.atk2=patk
			return AttackSuccessChance(petalClone,mob)
		}
		function DefendSuccessBase(pdef,matk) {
			if(pdef===0) return 0
			if(matk===0) return 100
			if(pdef===100 && matk===100) return 37
			if(pdef===100) return 100
			if(matk===100) return 0
			let pdefr=pdef/100,matkr=matk/100,answer=pdefr**(matkr/(1-matkr))*100
			return approx(answer)
		}
		function DefendSuccessChance(petal,mob,direction="Front",row="Back") {
			if(petal.name==="Honey" && (mob.name.match("(Missile)")!==null || mob.effect.hasOwnProperty("honeyimmunity"))) return 0
			if(direction==="Auto") {
				if(petal.x===mob.x) {
					direction="Front"
				} else {
					direction="Side"
				}
			}
			if(row==="Auto") {
				if(petal.y===6) {
					row="Back"
				} else {
					row="Middle"
				}
			}
			let pdef=petal.def2,matk=mob.dodge
			if(row!=="Back") pdef=petal.def1
			pdef+=petal.defbuff
			if(mob.name==="!Fly!" && petal.defbuff<0) pdef+=2*petal.defbuff
			if(direction!=="Front") pdef-=(18-petal.size)*(17-petal.size)/2
			if(pdef<=10) return 0
			if(pdef>100) pdef=100
			if(mob.name==="!Fly" && pdef>90) pdef=90
			if(mob.name==="Moth" && mob.behavior==="Neutral+") matk+=60
			if(matk<10) return 100
			if(matk>100) mdef=100
			let calculatedChance=DefendSuccessBase(pdef,matk)
			if(calculatedChance===0) return 0
			if(direction!=="Front" && petal.defbuff<5) calculatedChance-=(5-petal.defbuff)
			if(calculatedChance<=0) return 0
			return calculatedChance
		}
		function RarityUpBase(rarity,level) {
			if(level===0 || rarity===6) return 0
			if(level>=3) return 100
			let base=[0,2,10]
			let answer=50*level-30
			answer-=(rarity-1)*base[level]
			return answer
		}
		function PetalRarityUpChance(rarity,level) {
			let answer=RarityUpBase(rarity,level)
			return answer
		}
		function LevelUpBase(rarity,level) {
			let base=[0,40,34,28,22,16,10]
			let answer=1-level/4
			if(answer<1/4) answer=1/4
			answer*=base[rarity]
			return approx(answer)
		}
		function PetalLevelUpChance(rarity,level,num) {
			let answer=LevelUpBase(rarity,level)
			answer*=(num-1)
			return answer
		}
		function ShinyMobStatMultiplier(shiny) {
			let answer=new Object()
			if(shiny!==undefined) {
				if(shiny===1) {
					answer.health=0.2
					answer.damage=0.5
				}
				if(shiny===2) {
					answer.health=0.2
					answer.damage=3
				}
				if(shiny===3) {
					answer.health=0.3
					answer.damage=1
				}
				if(shiny===4) {
					answer.health=0.3
					answer.damage=2
				}
				return answer
			}
			let seed=roll(1,100)
			if(seed<=10) {
				answer.shiny=1
				answer.health=0.2
				answer.damage=0.5
			} else if(seed<=40) {
				answer.shiny=2
				answer.health=0.2
				answer.damage=3
			} else if(seed<=70) {
				answer.shiny=3
				answer.health=0.3
				answer.damage=1
			} else {
				answer.shiny=4
				answer.health=0.3
				answer.damage=2
			}
			return answer
		}
		function ShinyMobLootBuff() {
			let base=[[35,15,4,1],[23,6,2,0],[10,3,1,0]]
			let seed=roll(1,100),answer=new Object()
			for(let i=0;i<=2;i++) {
				for(let j=0;j<=3;j++) if(seed>0) {
					seed-=base[i][j]
					if(seed<=0) {
						answer.rarity=i
						answer.level=j
					}
				}
			}
			return answer
		}
		function MobLootBase(mrarity,droprate,prarity) {
			let base=[0,2,6,12,20,30,42,43],basemax=[0,12,24,36,48,60,72,84],basechance=[0,20,25,30,35,40]
			let calc=new Array(60).fill(0)
			calc[0]=1
			for(let i=1;i<=basemax[mrarity];i++) {
				for(let j=base[7];j>=1;j--) {
					calc[j]+=(calc[j-1]-calc[j])*basechance[droprate]/100
				}
				calc[base[6]]+=calc[base[7]]
				calc[base[7]]=0
				calc[0]-=calc[0]*basechance[droprate]/100
			}
			let answer=0
			for(let i=base[prarity];i<base[prarity+1];i++) answer+=calc[i]
			return answer
		}
		function MobLoot(mrarity,droprate,seed) {
			if(!seed) seed=Math.random()
			for(let i=0;i<=5;i++) {
				seed-=MobLootBase(mrarity,droprate,i)
				if(seed<0) return i
			}
			return 6
		}
		function MobRarityBase(wave,rarity) {
			let base=[0,0,5,15,30,50,75,105,106]
			let calc=new Array(120).fill(0)
			calc[0]=1
			for(let i=1;i<=25*wave;i++) {
				for(let j=base[8];j>=1;j--) {
					calc[j]+=(calc[j-1]-calc[j])/10
				}
				calc[base[7]]+=calc[base[8]]
				calc[base[8]]=0
				calc[0]-=calc[0]/10
			}
			let answer=0
			for(let i=base[rarity];i<base[rarity+1];i++) answer+=calc[i]
			return answer
		}
		function MobRarity(wave) {
			let seed=Math.random()
			for(let i=1;i<=6;i++) {
				seed-=MobRarityBase(wave,i)
				if(seed<=0) return i
			}
			return 7
		}
		function MapWave(floor,rarity) {
			let answer=(2.8+0.6*floor)**(1.15+0.15*rarity)-2
			return approx(answer)
		}
		function MobID(map) {
			let seed=roll(1,100)
			let pendingMob=MapSpawnList[map].split("&")
			for(let i in pendingMob) {
				seed-=parseInt(pendingMob[i].match(/\d+/))
				if(seed<=0) return MobNameList.indexOf(pendingMob[i].match(/.+(?==)/)[0])
			}
		}
		function FloorDensityMultiplier(floor) {
			let answer=[1,1,1.1,1.2,1.3,1.4,1.5,1.6]
			return answer[floor]
		}
		function FloorCapacity(floor) {
			let base=[5,6,7,8,8,9,9,10]
			let answer=base[floor]
			if(fight.riftfight) answer+=2
			return answer
		}
		function Petal(id=0,rarity=1,level=0,float=true,nobuff=false) {
			this.id=id,this.rarity=rarity,this.level=level
			if(typeof(this.id)==="string") this.id=PetalNameList.indexOf(this.id)
			this.name=PetalNameList[this.id]
			if(typeof(PetalHealthList[this.id])==="number") {
				this.health=PetalHealthList[this.id]
				this.health*=PetalHealthMultiplier(this.rarity,this.level)
				if(float && PetalAttributeList[this.id].match("No attribute floating")===null) this.health*=0.8+0.4*Math.random()
				this.health=approx(this.health)
			} else if(PetalHealthList[this.id]==="*") {
				this.health=1
			} else if(PetalHealthList[this.id]==="/") {
				this.health="/"
			} else {
				this.health=2
			}
			this.currenthealth=this.health
			if(typeof(PetalDamageList[this.id])==="number") {
				this.damage=PetalDamageList[this.id]
				this.damage*=PetalDamageMultiplier(this.rarity,this.level)
				if(float && PetalAttributeList[this.id].match("No attribute floating")===null) this.damage*=0.8+0.4*Math.random()
				this.damage=approx(this.damage)
			} else if(PetalDamageList[this.id]==="*") {
				this.damage=1
			} else if(PetalDamageList[this.id]==="/") {
				this.damage="/"
			} else {
				this.damage=2
			}
			if(typeof(PetalSpeedList[this.id])==="number") {
				this.speed=PetalSpeedList[this.id]
				if(float && PetalAttributeList[this.id].match("No attribute floating")===null) this.speed*=0.9+0.2*Math.random()
				this.speed=approx(this.speed)
			} else if(PetalSpeedList[this.id]==="*") {
				this.speed=1
			} else if(PetalSpeedList[this.id]==="/") {
				this.speed="/"
			} else {
				this.speed=226
			}
			if(typeof(PetalReloadList[this.id])==="number") {
				this.reload=PetalReloadList[this.id]
				if(float && PetalAttributeList[this.id].match("No attribute floating")===null) this.reload*=0.9+0.2*Math.random()
				this.reload=approx(this.reload)
			} else if(PetalReloadList[this.id]==="/") {
				this.reload="/"
			} else {
				this.reload=6260
			}
			if(typeof(PetalSizeList[this.id])==="number") {
				this.size=PetalSizeList[this.id]
			} else if(PetalSizeList[this.id]==="*") {
				this.size=1
			} else if(PetalSizeList[this.id]==="/") {
				this.size="/"
			} else {
				this.size=2
			}
			if(PetalATKList[this.id]==="/") {
				this.atk1="/"
				this.atk2="/"
			} else {
				this.atk1=parseInt(PetalATKList[this.id].match(/^\d+/))
				this.atk2=parseInt(PetalATKList[this.id].match(/(?<=-)\d+/))
			}
			this.atkbuff=roll(-10,10)
			if(this.atkbuff*this.atkbuff>10) this.atkbuff=roll(-10,10)
			if(this.atkbuff*this.atkbuff>30) this.atkbuff=roll(-10,10)
			if(this.atkbuff*this.atkbuff>60) this.atkbuff=roll(-10,10)
			if(PetalDEFList[this.id]==="/") {
				this.def1="/"
				this.def2="/"
			} else {
				this.def1=parseInt(PetalDEFList[this.id].match(/^\d+/))
				this.def2=parseInt(PetalDEFList[this.id].match(/(?<=-)\d+/))
			}
			this.defbuff=roll(-10,10)
			if(this.defbuff*this.defbuff>10) this.defbuff=roll(-10,10)
			if(this.defbuff*this.defbuff>30) this.defbuff=roll(-10,10)
			if(this.defbuff*this.defbuff>60) this.defbuff=roll(-10,10)
			this.star=0
			this.x=0,this.y=0
			this.actionbar=0,this.count=0,this.calculate=0,this.state="Unequipped"
			if(PetalAttributeList[this.id].match(/(?<=COUNT=)\d+/)) this.count=parseInt(PetalAttributeList[this.id].match(/(?<=COUNT=)\d+/))
			if(PetalAttributeList[this.id].match("SHOOT")!==null) {
				this.shootatt=new Object()
				this.shootatt.range=parseInt(PetalAttributeList[this.id].match(/\d+(?= range.)/))
				this.shootatt.accdec=parseInt(PetalAttributeList[this.id].match(/\d+(?=% accuracy decline.)/))
				this.shootatt.freebon=parseInt(PetalAttributeList[this.id].match(/\d+(?= bounce.)/))
				this.shootatt.bonrange=parseInt(PetalAttributeList[this.id].match(/\d+(?= bounce range.)/))
				this.shootatt.bondec=parseInt(PetalAttributeList[this.id].match(/\d+(?=% bounce accuracy decline.)/))
				this.shootatt.repdec=parseInt(PetalAttributeList[this.id].match(/\d+(?=% repeated hitting decline.)/))
				this.shootatt.bounce=0
				this.shootatt.hitarray=new Array()
			}
			this.effect=new Object()
		}
		function isPetal(potentialPetal) {
			return Petal.prototype.isPrototypeOf(potentialPetal)
		}
		Petal.prototype.clone=function() {
			return Object.assign(new Petal(),structuredClone(this))
		}
		Petal.prototype.print=function() {
			if(this.state==="Retired") return
			if(this.y===0) {
				if(this.name==="Compass") {
					if(this.calculate===0) {
						getGrid(2,this.originorder,0).children[1].children[0].style.transform="rotate(45deg)"
					} else {
						getGrid(2,this.originorder,0).children[1].children[0].style.transform="rotate("+(90*(this.calculate-1))+"deg)"
					}
				}
				return
			}
			if(this.name.match(/\?/)===null) {
				getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Petal_"+PetalNameList[this.id],1,this.rarity))
			} else {
				getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Mob_"+this.name.slice(0,-1),1,this.rarity))
			}
			let editingPath=getGrid(0,this.x,this.y).children[0].children[0]
			if(this.state==="Reloading") {
				let reloadProgress=this.actionbar/this.reload
				if(reloadProgress<0) reloadProgress=0
				if(reloadProgress>1) reloadProgress=1
				editingPath.setAttribute("d","M8 100A8 8 0 0 1 0 92L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 92A8 8 0 0 1 92 100L92 8L8 8ZM8 92L92 92L92 100L8 100L8 97L"+(8+84*reloadProgress)+" 97L"+(8+84*reloadProgress)+" 95L8 95ZM8 8L92 8L92 92L8 92Z")
				return
			}
			let node1=100,node2=200,maxAction=250,healthP=this.currenthealth/this.health
			if(isNaN(healthP)) healthP=1
			if(healthP<0) healthP=0
			if(this.speed===1) node1=1
			if(this.name==="Beetle?") {
				node1=4
				node2=12
			}
			if(this.name==="Sandstorm?") {
				node1=8
				node2=16
			}
			if(this.name==="Soldier Ant?") {
				node1=5
				node2=15
			}
			if(this.actionbar<node1) {
				let nodeProgress=this.actionbar/node1
				if(nodeProgress<0) nodeProgress=0
				editingPath.setAttribute("d","M0 36L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 36L92 36L92 8L8 8L8 36ZM5 36L8 36L8 92L92 92L92 36L95 36L95 92A3 3 0 0 1 92 95L8 95A3 3 0 0 1 5 92ZM0 36L3 36L3 92A5 5 0 0 0 8 97L92 97A5 5 0 0 0 97 92L97 36L100 36L100 92A8 8 0 0 1 92 100L8 100A8 8 0 0 1 0 92ZM8 8L92 8L92 "+(92-84*healthP)+"L8 "+(92-84*healthP)+"ZM5 "+(36+56*nodeProgress)+"L5 92A3 3 0 0 0 8 95L92 95A3 3 0 0 0 95 92L95 36L97 36L97 92A5 5 0 0 1 92 97L8 97A5 5 0 0 1 3 92L3 "+(36+56*nodeProgress)+"Z")
			} else if(this.actionbar<node2) {
				let nodeProgress=(this.actionbar-node1)/(node2-node1)
				editingPath.setAttribute("d","M0 36L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 36L92 36L92 8L8 8L8 36ZM5 36L8 36L8 92L92 92L92 36L95 36L95 92A3 3 0 0 1 92 95L8 95A3 3 0 0 1 5 92ZM0 36L3 36L3 92A5 5 0 0 0 8 97L92 97A5 5 0 0 0 97 92L97 36L100 36L100 92A8 8 0 0 1 92 100L8 100A8 8 0 0 1 0 92ZM8 8L92 8L92 "+(92-84*healthP)+"L8 "+(92-84*healthP)+"ZM"+(8+84*nodeProgress)+" 95L92 95A3 3 0 0 0 95 92L95 36L97 36L97 92A5 5 0 0 1 92 97L"+(8+84*nodeProgress)+" 97Z")
			} else {
				let nodeProgress=(this.actionbar-node2)/(maxAction-node2)
				editingPath.setAttribute("d","M0 36L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 36L92 36L92 8L8 8L8 36ZM5 36L8 36L8 92L92 92L92 36L95 36L95 92A3 3 0 0 1 92 95L8 95A3 3 0 0 1 5 92ZM0 36L3 36L3 92A5 5 0 0 0 8 97L92 97A5 5 0 0 0 97 92L97 36L100 36L100 92A8 8 0 0 1 92 100L8 100A8 8 0 0 1 0 92ZM8 8L92 8L92 "+(92-84*healthP)+"L8 "+(92-84*healthP)+"ZM95 "+(92-56*nodeProgress)+"L95 36L97 36L97 "+(92-56*nodeProgress)+"Z")
			}
		}
		Petal.prototype.load=function() {
			this.actionbar-=this.reload
			this.currenthealth=this.health
			this.state="Existing"
			if(PetalAttributeList[this.id].match(/(?<=COUNT=)\d+/)) this.count=parseInt(PetalAttributeList[this.id].match(/(?<=COUNT=)\d+/))
			this.print()
			if(this.name==="Lotus" && fight.flower.effect.hasOwnProperty("poison")) {
				delete fight.flower.effect.poison
				updateFlowerState()
			}
		}
		Petal.prototype.reset=function() {
			this.health=this.origin.health
			this.damage=this.origin.damage
			this.speed=this.origin.speed
			this.reload=this.origin.reload
			this.size=this.origin.size
			this.atk1=this.origin.atk1
			this.atk2=this.origin.atk2
			this.def1=this.origin.def1
			this.def2=this.origin.def2
		}
		Petal.prototype.destroy=function(mob) {
			if(this.name==="Bubble" && mob==="Skill") {
				addLog("[Petal] Bubble is retired.","#ff5fdf")
				this.currenthealth=0
				this.print()
				this.state="Retired"
				collapseGrid(getGrid(0,this.x,this.y))
				return
			}
			if(this.name==="Yggdrasil" && mob==="Skill") {
				addLog("[Petal] Yggdrasil is retired.","#ff5fdf")
				this.currenthealth=0
				this.print()
				this.state="Retired"
				collapseGrid(getGrid(0,this.x,this.y))
				return
			}
			if(this.name==="Moon Rock") {
				if(fight.mob.length>0) {
					let closestMob=fight.mob[0]
					for(let i=1;i<fight.mob.length;i++) {
						if(compareVectorCloser({x:toCord(fight.mob[i].x-this.x+4)-4,y:fight.mob[i].y-this.y},{x:toCord(closestMob.x-this.x+4)-4,y:closestMob.y-this.y})) {
							closestMob=fight.mob[i]
						}
					}
					if(MobAttributeList[closestMob.id].match("BOSS")===null || determine(50,true," for execute")) {
						closestMob.doom()
					}
				}
				addLog("[Petal] Moon Rock is retired.","#ff5fdf")
				this.currenthealth=0
				this.print()
				this.state="Retired"
				collapseGrid(getGrid(0,this.x,this.y))
				return
			}
			if(this.name==="Pollen") {
				let sproutFlag=true
				if(this.y===6 || getFilledGrid(this.x,this.y+1)) sproutFlag=false
				if(this.size<=5) sproutFlag=false
				if(sproutFlag) {
					addLog("[Petal] Pollen sprouted.","#9f9fdf")
					if(!this.effect.hasOwnProperty("sprout")) this.effect.sprout=0
					this.effect.sprout++
					this.print()
					collapseGrid(getGrid(0,this.x,this.y))
					this.health=Math.max(approx(0.8**this.effect.sprout*this.origin.health),1)
					this.currenthealth=this.health
					this.size--
					this.y++
					this.print()
					return
				}
			}
			if(this.name==="Rift" && isMob(mob) && !fight.riftfight) {
				fight.rift.open=true
				fight.rift.x=mob.x
				fight.rift.y=mob.y
				let riftGrid=createGrid("Rift",0,0,"Border",1,0)
				riftGrid.setAttribute("class","smid bgrid apos")
				riftGrid.style.top=getGrid(0,fight.rift.x,fight.rift.y).getBoundingClientRect().top+40+"px"
				riftGrid.style.left=getGrid(0,fight.rift.x,fight.rift.y).getBoundingClientRect().left+40+"px"
				riftGrid.style["pointer-events"]="none"
				document.body.appendChild(riftGrid)
				addLog("[Petal] Rift is retired.","#ff5fdf")
				this.currenthealth=0
				this.print()
				this.state="Retired"
				collapseGrid(getGrid(0,this.x,this.y))
				return
			}
			if(this.count>1) {
				addLog("[Petal] A part of "+this.name+" is destroyed.","#df9fdf")
				if(this.name==="Sand") {
					this.size--
					this.atk1-=10
					this.atk2-=10
					this.def1-=10
					this.def2-=10
				}
				if(this.name==="Orange") {
					this.def1-=20
					this.def2-=20
				}
				if(this.name==="Coral" && (this.count===7 || this.count===5)) {
					this.size-=2
					this.health=approx(this.health/2)
					this.damage=approx(this.damage/2)
				}
				this.count--
				this.currenthealth=this.health
				this.print()
				return
			}
			addLog("[Petal] "+this.name+" is destroyed.","#ff9fdf")
			if(this.name==="Iris" && isMob(mob)) {
				mob.injure({effectdamage:this.damage,effectturn:10},"Poison")
			}
			if(this.name==="Pollen") {
				delete this.effect.sprout
				this.reset()
			}
			if(this.name==="Beetle?") {
				this.name="Beetle Egg"
				this.reset()
			}
			if(this.name==="Sand") {
				this.reset()
			}
			if(this.name==="Pincer" && isMob(mob)) {
				mob.injure({effectdamage:approx(this.damage/2),effectturn:5},"Poison")
				mob.injure({effectturn:5},"Debilitate")
			}
			if(this.name==="Pearl" && this.y<=3) {
				getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Empty",1,0))
				let closestSpace={x:20,y:0}
				for(let i=1;i<=8;i++) for(let j=4;j<=6;j++) if(!getFilledGrid(i,j)) {
					if(compareVectorCloser({x:toCord(i-this.x+4)-4,y:j-this.y},{x:toCord(closestSpace.x-this.x+4)-4,y:closestSpace.y-this.y})) {
						closestSpace={x:i,y:j}
					}
				}
				this.x=closestSpace.x
				this.y=closestSpace.y
			}
			if(this.name==="Sandstorm?") {
				this.name="Stick"
				this.reset()
			}
			if(this.name==="Orange") {
				this.reset()
			}
			if(this.name==="Soldier Ant?") {
				this.name="Ant Egg"
				this.reset()
			}
			if(this.name==="Tomato") {
				this.calculate=0
				this.reset()
			}
			if(this.name==="Bur" && isMob(mob)) {
				mob.injure({effectstrength:approx(this.damage/2),effectturn:10},"Vulnerability")
			}
			if(this.name==="Card") {
				this.calculate=0
				this.reset()
			}
			if(this.name==="Privet" && isMob(mob) && mob.effect.hasOwnProperty("poison")) {
				let totalPoison=0
				for(let i=0;i<mob.effect.poison.length;i++) totalPoison+=mob.effect.poison[i]
				delete mob.effect.poison
				mob.injure(totalPoison*(1+0.1*this.rarity),"Poison Result")
			}
			if(this.name==="Coral") {
				this.reset()
			}
			if(this.name==="Wax") {
				this.origin.def1-=20
				if(this.origin.def1<0) this.origin.def1=0
				this.reset()
			}
			if(this.name==="Domino") {
				this.calculate=0
				this.reset()
			}
			this.state="Reloading"
			this.count=0
			if(this.actionbar<0) this.actionbar=0
			if(this.effect.hasOwnProperty("restraint")) delete this.effect.restraint
			this.print()
			if(this.actionbar>=this.reload) this.load()
			if(this.name==="Clover" && determine(1,true," for lucky")) {
				player.clover=true
				for(let i=0;i<fight.petal.length;i++) {
					if(fight.petal[i].speed===1 && fight.petal[i].state==="Reloading") {
						fight.petal[i].actionbar=fight.petal[i].reload
						fight.petal[i].load()
					} else if(fight.petal[i].speed>1) {
						fight.petal[i].progress(6361)
					}
				}
				if(!this.effect.hasOwnProperty("lucky")) {
					this.effect.lucky=true
					this.health*=4
					this.currenthealth=this.health
					this.damage*=4
				}
			}
		}
		Petal.prototype.injure=function(damage,mob) {
			if(this.effect.hasOwnProperty("immunity")) return
			let mobName=mob
			if(isMob(mob)) mobName=mob.name
			if(mobName==="Restraint") {
				addLog("[Petal] "+this.name+" is restrained.","#9f9fdf")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("restraint")) this.effect.restraint=0
				if(this.effect.restraint<resultingTurn) this.effect.restraint=resultingTurn
				return
			}
			let resultingDamage=damage
			if(mobName==="!Roach!" && mob.effect.quickness>4) {
				let damageBuff=20*(mob.effect.quickness-4)
				if(damageBuff>100) damageBuff=100
				resultingDamage+=approx(resultingDamage*damageBuff/100)
			}
			if(mobName==="!Leafbug!" && mob.effect.quickness>3) {
				let damageDebuff=10*(mob.effect.quickness-3)
				resultingDamage-=approx(resultingDamage*damageDebuff/100)
				if(resultingDamage<0) resultingDamage=0
			}
			if(explore.floor>=1) resultingDamage=approx(resultingDamage*10000/fight.energy)
			if(isMob(mob) && this.effect.hasOwnProperty("resistance")) {
				resultingDamage-=this.effect.resistance
				if(resultingDamage<0) resultingDamage=0
			}
			if(resultingDamage) {
				addLog("[Petal] "+this.name+" received "+resultingDamage+" damage from "+mobName+".","#9f9fdf")
				this.currenthealth-=resultingDamage
			}
			if(this.currenthealth<=0) {
				this.destroy(mob)
			} else {
				if(this.name==="Wax") {
					if(this.def2>betterFloor(this.currenthealth/this.health*10)*10) this.def2=betterFloor(this.currenthealth/this.health*10)*10
					if(this.def2<40) this.def2=40
				}
				this.print()
			}
		}
		Petal.prototype.knockback=function(knockback) {
			let resultingKnockback=knockback,extraDamage=0
			if(this.speed>1 && resultingKnockback>this.actionbar+50) {
				extraDamage=approx((resultingKnockback-this.actionbar-50)/300*this.health)
				resultingKnockback=this.actionbar+50
			}
			if(this.speed===1 && resultingKnockback>this.actionbar) resultingKnockback=this.actionbar
			if(resultingKnockback) {
				addLog("[Petal] "+this.name+" received "+resultingKnockback+" knockback.","#bfbf00")
				this.actionbar-=resultingKnockback
			}
			if(extraDamage) this.injure(extraDamage,"Knockback")
			this.print()
		}
		Petal.prototype.progress=function(value) {
			if(this.state==="Retired") return
			if(this.state==="Suspended") return
			if(this.y===0) return
			let pendingAction=this.speed,maxAction=250
			if(value) pendingAction=value
			if(this.effect.hasOwnProperty("restraint")) {
				pendingAction=approx(pendingAction/2)
				this.effect.restraint--
				if(!this.effect.restraint) delete this.effect.restraint
			}
			if(explore.floor>=1 && fight.energy<6400) pendingAction=approx(pendingAction*(fight.energy-3500)/3000)
			this.actionbar+=pendingAction
			if(this.state==="Existing" && this.name==="Tomato") {
				this.calculate+=pendingAction
				if(this.calculate>600) this.health=approx(this.origin.health*(1.3-this.calculate/2000))
				if(this.health<=0) {
					this.health=1
					this.actionbar=0
					this.destroy()
					return
				}
				if(this.currenthealth>this.health) this.currenthealth=this.health
				this.damage=approx(this.origin.damage*(1+this.calculate/200))
				this.size=this.origin.size+betterFloor(this.calculate/200)
				this.atk1=this.origin.atk1+betterFloor(this.calculate/400)*10
				this.atk2=this.origin.atk2+betterFloor(this.calculate/400)*10
				this.def1=this.origin.def1+betterFloor(this.calculate/400)*10
				this.def2=this.origin.def2+betterFloor(this.calculate/400)*10
				if(this.atk1>100) this.atk1=100
				if(this.atk2>100) this.atk2=100
				if(this.def1>100) this.def1=100
				if(this.def2>100) this.def2=100
			}
			if(this.state==="Reloading" && this.actionbar>=this.reload) this.load()
			if(this.state==="Existing" && this.actionbar>=maxAction) this.actionbar=maxAction
			this.print()
		}
		Petal.prototype.move=function(targetX,targetY) {
			if(this.state==="Suspended") return
			if(targetX!==undefined) {
				if(getFilledGrid(targetX,targetY)) {
					this.attack(targetX,targetY)
					return
				}
				addLog("[Petal] Movement of "+this.name+": from ("+this.x+","+this.y+") to ("+targetX+","+targetY+").","#9f9fdf")
				getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Empty",1,0))
				this.x=targetX
				this.y=targetY
				this.print()
				fight.manipulate=false
				return
			}
			fight.manipulate=true
			operPrepare(this,"Move")
		}
		Petal.prototype.attack=async function(targetX,targetY) {
			if(this.state==="Suspended") return
			if(targetX!==undefined) {
				let targetMob
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===targetX && fight.mob[i].y===targetY) targetMob=fight.mob[i]
				if(this.name==="Air" && this.calculate>0) {
					targetMob.move(this.calculate)
					this.calculate=0
				}
				addLog("[Petal] Attack of "+this.name+": to "+targetMob.name+" at ("+targetMob.x+","+targetMob.y+")...","#9f9fdf")
				if(this.name==="Pearl" || determine(AttackSuccessChance(this,targetMob,"Auto","Auto"),true," for attack")) {
					let damageDealt=this.damage*2,damageReceived=targetMob.damage,knockbackDealt=50
					if(this.name==="Rice") {
						knockbackDealt=0
					}
					if(this.name==="Jelly") {
						knockbackDealt+=100
					}
					if(this.name==="Claw" && targetMob.currenthealth===targetMob.health) {
						damageDealt*=5
						targetMob.actionbar=-50
					}
					if(this.name==="Clover" && !this.effect.hasOwnProperty("lucky")) {
						knockbackDealt=approx(knockbackDealt/2)
					}
					if(this.name==="Air") {
						knockbackDealt=approx(knockbackDealt*(0.3+0.1*this.level))
					}
					if(this.name==="Blood Stinger") {
						if(MobAttributeList[targetMob.id].match("Connected")!==null) {
							flowerRetreat()
							return
						} else {
							damageDealt*=2
							flowerInjure(approx(fight.flower.health*(0.2+0.05*this.level)),"Blood Stinger")
						}
					}
					if(this.name==="2 Turn Kill") {
						targetMob.injure({effectturn:2},"Doom")
					}
					if(this.effect.hasOwnProperty("surge")) {
						damageDealt+=approx(damageDealt*this.effect.surge/100)
					}
					if(this.name==="Relic" && targetMob.behavior==="Neutral+") {
						addLog("[Mob] "+targetMob.name+" returns to passive.","#bfbf00")
						targetMob.behavior="Neutral"
					} else {
						this.injure(damageReceived,targetMob)
						if(targetMob.currenthealth>0) targetMob.injure(damageDealt,this)
					}
					if(knockbackDealt) targetMob.knockback(knockbackDealt)
					if(this.name==="Fangs") {
						flowerHeal(approx(damageDealt/2),"Lifesteal")
					}
					this.print()
					await waitAnimation()
					missileCheck()
					await waitMissile()
					fight.manipulate=false
				} else {
					this.print()
					fight.manipulate=false
				}
				return
			}
			fight.manipulate=true
			operPrepare(this,"Attack")
		}
		Petal.prototype.shoot=async function(targetX,targetY) {
			if(animation) return
			if(this.state==="Suspended") return
			if(targetX!==undefined) {
				let targetMob
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===targetX && fight.mob[i].y===targetY) targetMob=fight.mob[i]
				if(!targetMob) {
					addLog("[Petal] Shoot of "+this.name+" ended.","#9f9fdf")
					this.actionbar=0
					this.destroy("Shoot")
					this.shootatt.bounce=0
					delete this.shootatt.hitarray
					await waitAnimation()
					missileCheck()
					await waitMissile()
					fight.manipulate=false
					collapseTempGrid()
					return
				}
				addLog("[Petal] Shoot of "+this.name+": to "+targetMob.name+" at ("+targetMob.x+","+targetMob.y+")...","#9f9fdf")
				if(determine(ShootSuccessChance(this,targetMob),true," for shoot")) {
					if(getGrid(79,this.shootatt.x,this.shootatt.y)) getGrid(79,this.shootatt.x,this.shootatt.y).style.opacity=0.2
					this.shootatt.x=targetMob.x
					this.shootatt.y=targetMob.y
					let damageDealt=this.damage
					targetMob.injure(damageDealt,this.clone())
					if(this.name==="Grapes" && targetMob.currenthealth>0) {
						targetMob.injure({effectdamage:approx(this.damage/4),effectturn:5},"Poison")
					}
					if(this.name==="Dandelion" && targetMob.currenthealth>0) {
						targetMob.injure({effectturn:5},"Suppression")
					}
					this.shootatt.hitarray.push(targetMob)
					let tempGrid=createGrid(79,targetX,targetY,"Petal_"+PetalNameList[this.id],1,this.rarity)
					tempGrid.classList.add("apos")
					tempGrid.style.top=getGrid(0,targetX,targetY).getBoundingClientRect().top+"px"
					tempGrid.style.left=getGrid(0,targetX,targetY).getBoundingClientRect().left+"px"
					tempGrid.style.opacity=0.5
					document.body.appendChild(tempGrid)
					this.shootatt.bounce++
					this.shootatt.continue=true
					return
				} else {
					this.actionbar=0
					this.destroy("Shoot")
					this.shootatt.bounce=0
					delete this.shootatt.hitarray
					await waitAnimation()
					missileCheck()
					await waitMissile()
					fight.manipulate=false
					collapseTempGrid()
					return
				}
			}
			this.shootatt.bounce=0
			this.shootatt.hitarray=new Array()
			this.shootatt.x=this.x
			this.shootatt.y=this.y
			fight.manipulate=true
			operPrepare(this,"Shoot")
		}
		Petal.prototype.skill=async function() {
			if(this.name==="Rose") {
				selectedGrid.select=false
				closeGridInfo()
				flowerHeal(2*this.health,this)
				this.actionbar=0
				this.destroy("Skill")
				return
			}
			if(this.name==="Faster") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Petal] Your petals are accelerated.","#9f9fdf")
				this.actionbar-=skillRequirement(this)
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].y>0 && fight.petal[i].speed>1 && fight.petal[i].name!=="Faster" && fight.petal[i].name!=="Clover" && fight.petal[i].name!=="Dice" && fight.petal[i].name!=="Chip" && fight.petal[i].name!=="Card" && fight.petal[i].name!=="Domino") {
					let pendingProgress=45+3*this.rarity
					fight.petal[i].progress(pendingProgress)
				}
				this.print()
				return
			}
			if(this.name==="Bubble") {
				selectedGrid.select=false
				closeGridInfo()
				let actionLimit=100-30*this.level,immuneTurn=2+this.rarity
				if(actionLimit<-50) actionLimit=-50
				for(let i=0;i<fight.mob.length;i++) {
					if(fight.mob[i].actionbar>actionLimit) {
						fight.mob[i].actionbar=actionLimit
						fight.mob[i].print()
					}
					if(fight.mob[i].behavior==="Neutral+") fight.mob[i].behavior="Neutral"
				}
				flowerHeal({effectturn:immuneTurn},"Immunity")
				this.destroy("Skill")
				return
			}
			if(this.name==="Beetle Egg") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Petal] Beetle Egg summons a Beetle?...","#9f9fdf")
				this.actionbar=0
				this.name="Beetle?"
				this.atk1=60
				this.atk2=60
				this.def1=60
				this.def2=60
				this.print()
				return
			}
			if(this.name==="Antennae") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Mob] Incoming mobs refreshed.","#bfbf00")
				for(let i=0;i<fight.spawnmob.length;i++) if(!fight.spawnmob[i].effect.hasOwnProperty("summoned")) {
					fight.spawnmob[i]=new Mob(MobID(explore.flowerspot),MobRarity(MapWave(explore.floor,MapRarityList[explore.flowerspot])))
				}
				delete this.effect.refresh
				this.print()
				return
			}
			if(this.name==="Yin") {
				fight.manipulate=true
				operPrepare(this,"Skill")
				return
			}
			if(this.name==="Yang") {
				fight.manipulate=true
				operPrepare(this,"Skill")
				return
			}
			if(this.name==="Web") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar=0
				this.destroy("Skill")
				if(fight.mob.length>0) {
					let closestMob=fight.mob[0]
					for(let i=1;i<fight.mob.length;i++) {
						if(compareVectorCloser({x:toCord(fight.mob[i].x-this.x+4)-4,y:fight.mob[i].y-this.y},{x:toCord(closestMob.x-this.x+4)-4,y:closestMob.y-this.y})) {
							closestMob=fight.mob[i]
						}
					}
					closestMob.injure({effectturn:10},"Restraint")
				}
				return
			}
			if(this.name==="Lightning") {
				selectedGrid.select=false
				closeGridInfo()
				for(let i=fight.mob.length-1;i>=0;i--) {
					if(fight.mob[i].x===this.x) {
						if(fight.mob[i].actionbar>0) fight.mob[i].actionbar=approx(fight.mob[i].actionbar*(0.7-0.1*this.rarity))
						fight.mob[i].injure(this.damage*2,"Lightning Strike")
					} else if(discalc(fight.mob[i].x,this.x)===1) {
						fight.mob[i].injure(this.damage,"Lightning Strike")
					}
				}
				this.actionbar=0
				this.destroy("Skill")
				await waitAnimation()
				missileCheck()
				return
			}
			if(this.name==="Shell") {
				selectedGrid.select=false
				closeGridInfo()
				flowerHeal(2*this.health,"Shield")
				this.actionbar=0
				this.destroy("Skill")
				return
			}
			if(this.name==="Dahlia") {
				selectedGrid.select=false
				closeGridInfo()
				flowerHeal(approx(1.5*this.health),this)
				if(this.count>1) {
					this.actionbar-=skillRequirement(this)
				} else {
					this.actionbar=0
				}
				this.destroy("Skill")
				return
			}
			if(this.name==="Stick") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Petal] Stick summons 2 Sandstorm?...","#9f9fdf")
				this.actionbar=0
				this.name="Sandstorm?"
				this.atk1=80
				this.atk2=80
				this.def1=80
				this.def2=80
				this.print()
				return
			}
			if(this.name==="Ant Egg") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Petal] Ant Egg summons 4 Soldier Ant?...","#9f9fdf")
				this.actionbar=0
				this.name="Soldier Ant?"
				this.atk1=60
				this.atk2=60
				this.def1=60
				this.def2=60
				this.print()
				return
			}
			if(this.name==="Cotton") {
				selectedGrid.select=false
				closeGridInfo()
				addLog("[Petal] Cotton is suspended.","#9f9fdf")
				this.state="Suspended"
				this.print()
				return
			}
			if(this.name==="Mark") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar=0
				this.destroy("Skill")
				if(fight.mob.length>0) {
					let closestMob=fight.mob[0]
					for(let i=1;i<fight.mob.length;i++) {
						if(compareVectorCloser({x:toCord(fight.mob[i].x-this.x+4)-4,y:fight.mob[i].y-this.y},{x:toCord(closestMob.x-this.x+4)-4,y:closestMob.y-this.y}) || MobAttributeList[closestMob.id].match("BOSS")!==null) {
							closestMob=fight.mob[i]
						}
					}
					if(MobAttributeList[closestMob.id].match("BOSS")===null) {
						closestMob.effect.noloot=true
						closestMob.injure({effectturn:3},"Doom")
					}
				}
				flowerInjure(approx(fight.flower.health*(0.3-0.03*this.rarity-0.01*this.level)),"Mark")
				return
			}
			if(this.name==="Dice") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				this.calculate=dice()
				if(this.calculate===1) this.progress(250)
				if(this.calculate===2) this.damage=2*this.origin.damage
				if(this.calculate===3) {
					if(!this.effect.surge) this.effect.surge=0
					this.effect.surge+=100
				}
				if(this.calculate===4) {
					this.atk1=100
					this.def1=100
				}
				if(this.calculate===5) this.atk2=100
				if(this.calculate===6) this.def2=100
				this.print()
				return
			}
			if(this.name==="Compass") {
				fight.manipulate=true
				operPrepare(this,"Skill")
				return
			}
			if(this.name==="Shovel") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar=0
				this.destroy("Skill")
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].actionbar>=120) {
					fight.mob[i].actionbar=0
					fight.mob[i].print()
				}
				fight.turn="Mob"
				flowerInjure(approx(fight.flower.health*(0.3-0.03*this.rarity-0.01*this.level)),"Shovel")
				endTurn()
				return
			}
			if(this.name==="Chip") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				this.calculate=dice()
				if(this.calculate===1) this.destroy("Skill")
				if(this.calculate>1) {
					this.progress(250)
					if(!this.effect.hasOwnProperty("immunity")) this.effect.immunity=0
					if(this.effect.immunity<1) this.effect.immunity=1
				}
				this.print()
				return
			}
			if(this.name==="Card") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				this.calculate=dice()
				if(this.calculate>=1 && this.calculate<=4) {
					this.health=approx(this.origin.health*0.5*this.calculate)
					if(this.currenthealth>this.health) this.currenthealth=this.health
					this.damage=approx(this.origin.damage*(2.5-0.5*this.calculate))
				}
				if(this.calculate===5) this.atk2=100
				if(this.calculate===6) this.def2=100
				this.print()
				return
			}
			if(this.name==="Glass") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				for(let i=fight.mob.length-1;i>=0;i--) if(fight.mob[i].x===this.x) {
					fight.mob[i].injure(this.damage,this)
				}
				this.print()
				await waitAnimation()
				missileCheck()
				return
			}
			if(this.name==="Monstera") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0 && (discalc(fight.petal[i].x,this.x)+discalc(fight.petal[i].y,this.y,0))<=1) {
					fight.petal[i].currenthealth+=approx(fight.petal[i].health/2)
					if(fight.petal[i].currenthealth>fight.petal[i].health) fight.petal[i].currenthealth=fight.petal[i].health
					fight.petal[i].print()
				}
				return
			}
			if(this.name==="Domino") {
				selectedGrid.select=false
				closeGridInfo()
				this.actionbar-=skillRequirement(this)
				this.calculate=dice()*dice()*dice()
				if(this.calculate>79 && this.health===this.origin.health) {
					this.health=2*this.origin.health
					this.currenthealth=this.health
				}
				this.damage-=approx(this.damage/20)
				if(this.damage<approx(this.calculate/36*this.origin.damage)) this.damage=approx(this.calculate/36*this.origin.damage)
				if(this.atk2<this.calculate) this.atk2=betterFloor(this.calculate/10)*10
				if(this.atk2>100) this.atk2=100
				this.print()
				return
			}
		}
		function Mob(id=1,rarity=1,shiny,float=true) {
			this.id=id,this.rarity=rarity
			if(typeof(this.id)==="string") this.id=MobNameList.indexOf(this.id)
			if(float && this.id===4 && determine(10)) this.id=23
			this.name=MobNameList[this.id]
			let statMult=new Object()
			statMult.health=1
			statMult.damage=1
			if(shiny!==undefined) {
				this.shiny=shiny
				if(this.shiny>0) statMult=ShinyMobStatMultiplier(this.shiny)
			} else if(roll(1,100)<=1 || this.name==="Ladybug (Desert)") {
				statMult=ShinyMobStatMultiplier()
				this.shiny=statMult.shiny
			} else {
				this.shiny=0
			}
			if(MobAttributeList[this.id].match("BOSS")!==null) {
				this.shiny=0
				statMult.health=BossHealthMultiplier(explore.floor)
				statMult.damage=BossDamageMultiplier(explore.floor)
			}
			if(typeof(MobHealthList[this.id])==="number") {
				this.health=MobHealthList[this.id]
				this.health*=MobHealthMultiplier(this.rarity)
				if(float && MobAttributeList[this.id].match("BOSS")===null) this.health*=0.8+0.4*Math.random()
				this.health*=statMult.health
				this.health=approx(this.health)
			} else if(MobHealthList[this.id]==="*") {
				this.health=1
			} else {
				this.health="/"
			}
			this.currenthealth=this.health
			if(typeof(MobDamageList[this.id])==="number") {
				this.damage=MobDamageList[this.id]
				this.damage*=MobDamageMultiplier(this.rarity)
				this.damage*=statMult.damage
				this.damage=approx(this.damage)
			} else if(MobDamageList[this.id]==="*") {
				this.damage=1
			} else {
				this.damage="/"
			}
			if(typeof(MobSpeedList[this.id])==="number") {
				this.speed=MobSpeedList[this.id]
				if(MobAttributeList[this.id].match("BOSS")===null) this.speed*=MobSpeedMultiplier(this.rarity)
				if(float && MobAttributeList[this.id].match("BOSS")===null) this.speed*=0.9+0.2*Math.random()
				this.speed=approx(this.speed)
			} else if(MobSpeedList[this.id]==="*") {
				this.speed=1
			} else {
				this.speed="/"
			}
			if(typeof(MobDodgeList[this.id])==="number") {
				this.dodge=MobDodgeList[this.id]
			} else if(MobDodgeList[this.id]==="*") {
				this.dodge=1
			} else {
				this.dodge="/"
			}
			this.behavior=MobBehaviorList[this.id]
			this.x=0,this.y=0
			this.actionbar=0,this.count=0,this.calculate=0
			if(MobAttributeList[this.id].match(/(?<=COUNT=)\d+/)) this.count=parseInt(MobAttributeList[this.id].match(/(?<=COUNT=)\d+/))
			this.effect=new Object()
		}
		function isMob(potentialMob) {
			return Mob.prototype.isPrototypeOf(potentialMob)
		}
		Mob.prototype.clone=function() {
			return Object.assign(new Mob(),structuredClone(this))
		}
		Mob.prototype.print=function() {
			if(this.name.match("(Missile)")!==null) return
			if(this.effect.removing) return
			if(this.effect.squeezing) return
			getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Mob_"+this.name,1,this.rarity))
			let editingPath=getGrid(0,this.x,this.y).children[0].children[0]
			let actionProgress=this.actionbar/200,healthP=this.currenthealth/this.health
			if(isNaN(healthP)) healthP=1
			if(healthP<0) healthP=0
			if(actionProgress>1) actionProgress=1
			editingPath.setAttribute("d","M8 100A8 8 0 0 1 0 92L0 8A8 8 0 0 1 8 0L92 0A8 8 0 0 1 100 8L100 92A8 8 0 0 1 92 100L92 8L8 8ZM8 92L92 92L92 100L8 100L8 97L"+(8+84*actionProgress)+" 97L"+(8+84*actionProgress)+" 95L8 95ZM8 8L92 8L92 "+(92-84*healthP)+"L8 "+(92-84*healthP)+"Z")
		}
		Mob.prototype.loot=function() {
			if(!player.gallery.hasOwnProperty(this.name)) {
				player.gallery[this.name]=new Object()
				for(let i=1;i<=7;i++) {
					player.gallery[this.name]["rarity"+i+"killed"]=0
					player.gallery[this.name]["rarity"+i+"looted"]=0
				}
			}
			player.gallery[this.name]["rarity"+this.rarity+"looted"]++
			for(let i in MobLootList[this.id]) {
				let pendingID=PetalNameList.indexOf(MobLootList[this.id][i].slice(0,-2)),pendingRarity=MobLoot(this.rarity,parseInt(MobLootList[this.id][i].slice(-1))),pendingLevel=0
				if(pendingRarity<PetalLowestRarityList[pendingID]) continue
				if(this.shiny) {
					let lootBuff=ShinyMobLootBuff()
					pendingRarity+=lootBuff.rarity
					if(pendingRarity>6) pendingRarity=6
					pendingLevel+=lootBuff.level
				}
				loot(pendingID,pendingRarity,pendingLevel,true)
			}
			if(fight.turnnum===2 && 1296*Math.random()<=7) {
				let pendingID=222,pendingRarity=MobLoot(this.rarity,2),pendingLevel=0
				if(pendingRarity>=PetalLowestRarityList[pendingID]) loot(pendingID,pendingRarity,pendingLevel,true)
			}
		}
		Mob.prototype.doom=async function() {
			this.currenthealth=0
			addLog("[Mob] "+this.name+" is destroyed.","#ff9f0f")
			this.effect.removing=true
			if(!player.gallery.hasOwnProperty(this.name)) {
				player.gallery[this.name]=new Object()
				for(let i=1;i<=7;i++) {
					player.gallery[this.name]["rarity"+i+"killed"]=0
					player.gallery[this.name]["rarity"+i+"looted"]=0
				}
			}
			player.gallery[this.name]["rarity"+this.rarity+"killed"]++
			if(!this.effect.noloot) this.loot()
			for(let i=0;i<fight.mob.length;i++) if(fight.mob[i]===this) fight.mob.splice(i,1)
			await collapseGrid(getGrid(0,this.x,this.y))
			let termiteFlag=false,termiteType=["Baby Termite","Worker Termite","Soldier Termite","Termite Overmind","Termite Egg"]
			for(let i=0;i<fight.mob.length;i++) if(termiteType.indexOf(fight.mob[i].name)!==-1) termiteFlag=true
			if(!termiteFlag) for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].name==="Termite Mound" && fight.mob[i].count===1) {
				fight.mob[i].currenthealth=0
				fight.mob[i].remove()
			}
			fillMob()
		}
		Mob.prototype.remove=async function() {
			if(this.currenthealth>0) return
			if(this.count>1) {
				addLog("[Mob] A part of "+this.name+" is destroyed.","#ffbf00")
				this.effect.squeezing=true
				await squeezeGrid(getGrid(0,this.x,this.y))
				delete this.effect.squeezing
				this.count--
				this.currenthealth=this.health
				this.actionbar=0
				this.print()
				if(MobAttributeList[this.id].match("DAMAGE=Drops loot")!==null && !this.effect.noloot) this.loot()
				if(this.name==="Ant Hole") {
					let summonType=["","Soldier Ant","Soldier Ant","Soldier Ant","Soldier Ant","Worker Ant","Worker Ant","Worker Ant","Baby Ant","Baby Ant"]
					let summonSeed=summonType[this.count]
					addLog("[Mob] Ant Hole summons 1 "+summonSeed+".","#bfbf00")
					spawnNear(new Mob(summonSeed,this.rarity,this.shiny),this.x,this.y)
				}
				if(this.name==="Centipede (Desert)") {
					this.effect.immunity=5
				}
				if(this.name==="Fire Ant Burrow") {
					addLog("[Mob] Fire Ant Burrow summons 1 Soldier Fire Ant.","#bfbf00")
					spawnNear(new Mob("Soldier Fire Ant",this.rarity,this.shiny),this.x,this.y)
				}
				if(this.name==="Termite Mound") {
					for(let i=fight.mob.length-1;i>=0;i--) if(fight.mob[i]!==this) {
						fight.mob[i].effect=new Object()
						fight.mob[i].summoned=true
						fight.mob[i].currenthealth=fight.mob[i].health
						fight.mob[i].actionbar=0
						collapseGrid(getGrid(0,fight.mob[i].x,fight.mob[i].y))
						fight.spawnmob.unshift(fight.mob.splice(i,1)[0])
					}
					await waitAnimation()
					addLog("[Mob] Termite Mound summons 2 Baby Termite.","#bfbf00")
					for(let i=1;i<=2;i++) spawnNear(new Mob("Baby Termite",this.rarity,this.shiny),0,0)
					addLog("[Mob] Termite Mound summons 3 Worker Termite.","#bfbf00")
					for(let i=1;i<=3;i++) spawnNear(new Mob("Worker Termite",this.rarity,this.shiny),0,0)
					addLog("[Mob] Termite Mound summons 4 Soldier Termite.","#bfbf00")
					for(let i=1;i<=4;i++) spawnNear(new Mob("Soldier Termite",this.rarity,this.shiny),0,0)
					let summonType=["Termite Overmind","Termite Egg"]
					let summonSeed=summonType[roll(0,1)]
					addLog("[Mob] Termite Mound summons 1 "+summonSeed+".","#bfbf00")
					spawnNear(new Mob(summonSeed,this.rarity,this.shiny),0,0)
				}
				if(this.name==="!Dandelion!") {
					for(let i=1;i<=8;i++) {
						let shootingMissile=this.clone()
						shootingMissile.origin=this
						shootingMissile.name+=" (Missile)"
						shootingMissile.damage=approx(0.2*shootingMissile.damage)
						shootingMissile.dodge=50-10*betterFloor((i-1)/2)
						fight.missile.push(shootingMissile)
					}
				}
				return
			}
			addLog("[Mob] "+this.name+" is destroyed.","#ff9f0f")
			this.effect.removing=true
			if(!player.gallery.hasOwnProperty(this.name)) {
				player.gallery[this.name]=new Object()
				for(let i=1;i<=7;i++) {
					player.gallery[this.name]["rarity"+i+"killed"]=0
					player.gallery[this.name]["rarity"+i+"looted"]=0
				}
			}
			player.gallery[this.name]["rarity"+this.rarity+"killed"]++
			if(!this.effect.noloot) this.loot()
			for(let i=0;i<fight.mob.length;i++) if(fight.mob[i]===this) fight.mob.splice(i,1)
			await collapseGrid(getGrid(0,this.x,this.y))
			if(this.name==="Beetle" && fight.mob.length>0 && fight.mob[0].name==="!Summoner!") {
				for(let i=1;i<fight.mob.length;i++) {
					addLog("[Mob] Beetle gets 1 rarity up.","#bfbf00")
					fight.mob[i].rarity++
					let newBeetle=new Mob("Beetle",fight.mob[i].rarity,0)
					fight.mob[i].health=newBeetle.health
					fight.mob[i].damage=newBeetle.damage
					fight.mob[i].currenthealth=fight.mob[i].health
					delete fight.mob[i].effect.levelup
					fight.mob[i].print()
				}
			}
			if(this.name==="Rock" && this.effect.noloot===true) {
				let summonType=["Worker Ant","Soldier Ant"]
				let summonSeed=summonType[roll(0,1)]
				addLog("[Mob] Rock summons 1 "+summonSeed+".","#bfbf00")
				spawnNear(new Mob(summonSeed,this.rarity,this.shiny),this.x,this.y,true)
			}
			if(this.name==="Ant Hole") {
				addLog("[Mob] Ant Hole summons 1 Queen Ant.","#bfbf00")
				spawnNear(new Mob("Queen Ant",this.rarity,this.shiny),this.x,this.y)
			}
			if(this.name==="Fire Ant Burrow") {
				addLog("[Mob] Fire Ant Burrow summons 2 Soldier Fire Ant.","#bfbf00")
				spawnNear(new Mob("Soldier Fire Ant",this.rarity,this.shiny),this.x,this.y)
				spawnNear(new Mob("Soldier Fire Ant",this.rarity,this.shiny),this.x,this.y)
			}
			if(this.name==="Bubble" && this.effect.noloot) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0) fight.petal[i].knockback(100)
			}
			if(this.name==="Dandelion") {
				for(let i=1;i<=2;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.dodge=10
					fight.missile.push(shootingMissile)
				}
			}
			if(this.name==="Termite Egg" && this.effect.noloot) {
				addLog("[Mob] Termite Egg summons 1 Baby Termite.","#bfbf00")
				spawnNear(new Mob("Baby Termite",this.rarity,this.shiny),this.x,this.y,true)
			}
			if(this.name==="!Dandelion!") {
				this.calculate=8
				for(let i=1;i<=8;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(0.2*shootingMissile.damage)
					shootingMissile.dodge=60-10*betterFloor((i-1)/2)
					fight.missile.push(shootingMissile)
				}
			}
			let termiteFlag=false,termiteType=["Baby Termite","Worker Termite","Soldier Termite","Termite Overmind","Termite Egg"]
			for(let i=0;i<fight.mob.length;i++) if(termiteType.indexOf(fight.mob[i].name)!==-1) termiteFlag=true
			if(!termiteFlag) for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].name==="Termite Mound" && fight.mob[i].count===1) {
				fight.mob[i].currenthealth=0
				fight.mob[i].remove()
			}
			fillMob()
			if(fight.turn==="Mob") {
				missileCheck()
				await waitMissile()
			}
			updateT()
		}
		Mob.prototype.injure=function(damage,petal) {
			if(this.name.match("(Missile)")!==null) return
			if(this.effect.hasOwnProperty("immunity")) return
			if(this.name==="Termite Mound" && this.count===1) return
			if(this.name==="!Summoner!" && fight.mob.length>1) return
			let petalName=petal
			if(isPetal(petal)) {
				petalName=petal.name
				if(this.behavior==="Neutral") this.behavior="Neutral+"
			}
			if(petalName==="Poison") {
				addLog("[Mob] "+this.name+" is poisoned.","#bfbf00")
				let resultingPoison=damage.effectdamage,resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("poison")) this.effect.poison=new Array()
				for(let i=0;i<resultingTurn;i++) {
					if(!this.effect.poison.hasOwnProperty(i)) this.effect.poison[i]=0
					if(this.effect.poison[i]<resultingPoison) this.effect.poison[i]=resultingPoison
				}
				return
			}
			if(petalName==="Suppression") {
				addLog("[Mob] "+this.name+" is suppressed.","#bfbf00")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("suppression")) this.effect.suppression={turn:0}
				this.effect.suppression.turn+=resultingTurn
				return
			}
			if(petalName==="Restraint") {
				addLog("[Mob] "+this.name+" is restrained.","#bfbf00")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("restraint")) this.effect.restraint=0
				if(this.effect.restraint<resultingTurn) this.effect.restraint+=resultingTurn
				return
			}
			if(petalName==="Debilitate") {
				addLog("[Mob] "+this.name+" is debilitated.","#bfbf00")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("debilitation")) this.effect.debilitation=0
				if(this.effect.debilitation<resultingTurn) this.effect.debilitation+=resultingTurn
				return
			}
			if(petalName==="Tardy") {
				addLog("[Mob] "+this.name+" is tardy.","#bfbf00")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("tardiness")) this.effect.tardiness=0
				if(this.effect.tardiness<resultingTurn) this.effect.tardiness+=resultingTurn
				return
			}
			if(petalName==="Doom") {
				addLog("[Mob] "+this.name+" is doomed.","#bfbf00")
				let resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("doom")) this.effect.doom=6361
				if(this.effect.doom>resultingTurn) this.effect.doom=resultingTurn
				return
			}
			if(petalName==="Vulnerability") {
				addLog("[Mob] "+this.name+" is vulnerable.","#bfbf00")
				let resultingStrength=damage.effectstrength,resultingTurn=damage.effectturn
				if(!this.effect.hasOwnProperty("vulnerability")) this.effect.vulnerability=new Array()
				for(let i=0;i<resultingTurn;i++) {
					if(!this.effect.vulnerability.hasOwnProperty(i)) this.effect.vulnerability[i]=0
					this.effect.vulnerability[i]+=resultingStrength
				}
				return
			}
			if(petalName==="Psyonic Connection") {
				addLog("[Mob] "+this.name+" received "+damage+" damage from Psyonic Connection.","#bfbf00")
				this.currenthealth-=damage
				this.print()
				if(this.behavior==="Neutral") this.behavior="Neutral+"
				if(this.currenthealth<=0) this.remove()
				return
			}
			if(petalName==="Absorption") {
				addLog("[Mob] Sponge received "+damage+" damage from Absorption.","#bfbf00")
				this.currenthealth-=damage
				this.print()
				return
			}
			let resultingDamage=damage
			if(explore.floor>=1) resultingDamage=approx(resultingDamage*fight.energy/10000)
			if(this.effect.hasOwnProperty("vulnerability")) {
				resultingDamage+=this.effect.vulnerability[0]
			}
			if(this.name==="Leafbug") {
				let armorBlock=approx(this.damage/2)
				resultingDamage-=armorBlock
				if(resultingDamage<0) resultingDamage=0
			}
			if(this.name==="!Leafbug!") {
				let armorBlock=approx(0.3*this.damage)
				if(this.effect.quickness>=1) armorBlock=approx(0.6*this.damage)
				if(this.effect.quickness>=3) armorBlock=approx(1.5*this.damage)
				resultingDamage-=armorBlock
				if(resultingDamage<0) resultingDamage=0
				if(this.effect.quickness>=5) resultingDamage=approx(resultingDamage/2)
				if(this.effect.quickness>=7) resultingDamage=0
			}
			if(this.name!=="Sponge") {
				for(let i=1;i<=4;i++) if(this.y+dy[i]>=1 && this.y+dy[i]<=3) {
					for(let j=0;j<fight.mob.length;j++) if(fight.mob[j].name==="Sponge" && fight.mob[j].x===this.x+dx[i] && fight.mob[j].y===this.y+dy[i]) {
						let absorption=Math.min(betterFloor(resultingDamage/2),fight.mob[j].currenthealth-1)
						if(absorption) {
							fight.mob[j].injure(absorption,"Absorption")
							resultingDamage-=absorption
						}
						break
					}
				}
			}
			if(MobAttributeList[this.id].match("Connected")!==null) {
				let totalConnect=0
				for(let i=0;i<fight.mob.length;i++) if(MobAttributeList[fight.mob[i].id].match("Connected")!==null) totalConnect++
				resultingDamage=approx(resultingDamage/totalConnect)
				for(let i=fight.mob.length-1;i>=0;i--) if(MobAttributeList[fight.mob[i].id].match("Connected")!==null) {
					fight.mob[i].injure(resultingDamage,"Psyonic Connection")
				}
				resultingDamage=0
			}
			if(isPetal(petal) && fight.turn!=="Mob" && MobAttributeList[this.id].match("BOSS")!==null) {
				if(!this.effect.hasOwnProperty("quickness")) this.effect.quickness=0
				this.effect.quickness++
			}
			if(resultingDamage) {
				addLog("[Mob] "+this.name+" received "+resultingDamage+" damage from "+petalName+".","#bfbf00")
				this.currenthealth-=resultingDamage
			}
			if(petalName==="Stinger" && this.currenthealth<petal.damage) {
				addLog("[Mob] "+this.name+" is executed.","#bfbf00")
				this.currenthealth=0
			}
			this.print()
			if(this.currenthealth<=0) this.remove()
		}
		Mob.prototype.knockback=function(knockback) {
			if(this.currenthealth<=0 && this.count<=1) return
			if(this.name.match("(Missile)")!==null) return
			if(MobAttributeList[this.id].match("Immunes knockback")!==null) return
			let resultingKnockback=knockback
			if(resultingKnockback>this.actionbar+50) resultingKnockback=this.actionbar+50
			if(resultingKnockback) {
				addLog("[Mob] "+this.name+" received "+resultingKnockback+" knockback.","#bfbf00")
				this.actionbar-=resultingKnockback
			}
			this.print()
		}
		Mob.prototype.progress=function(value) {
			if(this.name==="Roach") {
				let pendingSpeed=approx((this.currenthealth/this.health+1)/2*this.speed)
				if(pendingSpeed<this.speed) {
					this.effect.slowness=this.speed-pendingSpeed
				} else {
					delete this.effect.slowness
				}
			}
			let pendingAction=this.speed,maxAction=250
			if(value) {
				pendingAction=value
			} else {
				if(this.effect.hasOwnProperty("tardiness")) {
					if(pendingAction>10) pendingAction=approx((pendingAction*10)**0.5)
					this.effect.tardiness--
					if(!this.effect.tardiness) delete this.effect.tardiness
				}
				if(this.effect.hasOwnProperty("debilitation")) {
					pendingAction=approx(pendingAction/2)
					this.effect.debilitation--
					if(!this.effect.debilitation) delete this.effect.debilitation
				}
			}
			if(this.effect.hasOwnProperty("slowness")) pendingAction-=this.effect.slowness
			if(this.effect.hasOwnProperty("quickness")) pendingAction+=this.speed/5*this.effect.quickness
			if(this.effect.hasOwnProperty("restraint")) {
				if(MobAttributeList[this.id].match("BOSS")===null) {
					pendingAction=approx(pendingAction/2)
				} else {
					pendingAction=approx(pendingAction*0.75)
				}
				this.effect.restraint--
				if(!this.effect.restraint) delete this.effect.restraint
			}
			this.actionbar+=pendingAction
			if(this.actionbar>=maxAction) this.actionbar=maxAction
			this.print()
		}
		Mob.prototype.action=async function() {
			addLog("[Mob] Action of "+this.name+"...","#bfbf00")
			this.actionbar-=200
			animation=true
			this.print()
			for(let i=0;i<=40;i++) {
				getGrid(0,this.x,this.y).style.scale=1.3-0.015*Math.abs(i-20)
				await delay(30)
			}
			animation=false
			getGrid(0,this.x,this.y)
			if(MobAttributeList[this.id].match("Destroys without loot")!==null) {
				this.effect.noloot=true
				this.currenthealth=0
				this.print()
				updateT()
				this.remove()
				return
			}
			if(MobAttributeList[this.id].match("Destroys a part")!==null) {
				if(this.name==="Termite Mound" && this.count!==2) {
					updateT()
					return
				}
				if(this.name==="Ant Hole" && this.count===1) {
					this.effect.noloot=true
				}
				if(this.name==="Fire Ant Burrow" && this.count===1) {
					this.effect.noloot=true
				}
				this.currenthealth=0
				this.print()
				updateT()
				this.remove()
				return
			}
			if(this.behavior==="Neutral") {
				if(determine(parseInt(MobAttributeList[this.id].match(/(?<=HOSTILE=)\d+/)),true," for hostile behavior")) {
					addLog("[Mob] "+this.name+" is becoming hostile!","#bfbf00")
					this.behavior="Neutral+"
				}
			}
			if(this.name==="Moth" && this.behavior==="Neutral+") {
				this.effect.noloot=true
				this.currenthealth=0
				updateT()
				this.remove()
				return
			}
			if(MobAttributeList[this.id].match("ACTION")!==null) {
				if(this.name==="Queen Ant") {
					addLog("[Mob] Queen Ant summons 1 Soldier Ant.","#bfbf00")
					let pendingRarity=this.rarity-2
					if(pendingRarity<1) pendingRarity=1
					spawnNear(new Mob("Soldier Ant",pendingRarity,this.shiny),this.x,this.y,true)
					this.attack()
				}
				if(this.name==="Bumble Bee") {
					if(determine(30,true," for attack")) this.attack()
				}
				if(this.name==="Starfish") {
					if(this.currenthealth<=this.health/2) {
						let pendingHeal=this.health/5
						pendingHeal=approx(pendingHeal)
						addLog("[Mob] Starfish heals for "+pendingHeal+" health.","#bfbf00")
						this.currenthealth+=pendingHeal
					} else {
						this.attack()
					}
				}
				if((this.name==="Crab" && determine(50,true," for move")) || this.name==="!Crab!") {
					let factorLeft=100,factorMiddle=101,factorRight=100
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0 && (fight.petal[i].y>4 || fight.petal[i].name==="Pearl") && fight.petal[i].y>this.y) {
						if(discalc(fight.petal[i].x,toCord(this.x-1))<=1) {
							let imaginePos=this.clone()
							imaginePos.x=toCord(imaginePos.x-1)
							if(DefendSuccessChance(fight.petal[i],imaginePos,"Auto","Auto")>100-factorLeft) factorLeft=100-DefendSuccessChance(fight.petal[i],imaginePos,"Auto","Auto")
						}
						if(discalc(fight.petal[i].x,this.x)<=1 && DefendSuccessChance(fight.petal[i],this,"Auto","Auto")>101-factorMiddle) factorMiddle=101-DefendSuccessChance(fight.petal[i],this,"Auto","Auto")
						if(discalc(fight.petal[i].x,toCord(this.x+1))<=1) {
							let imaginePos=this.clone()
							imaginePos.x=toCord(imaginePos.x+1)
							if(DefendSuccessChance(fight.petal[i],imaginePos,"Auto","Auto")>100-factorRight) factorRight=100-DefendSuccessChance(fight.petal[i],imaginePos,"Auto","Auto")
						}
					}
					if(this.name==="!Crab!") {
						factorLeft=factorLeft**3
						factorMiddle=factorMiddle**3
						factorRight=factorRight**3
					}
					if(getFilledGrid(toCord(this.x-1),this.y)) factorLeft=0
					if(getFilledGrid(toCord(this.x+1),this.y)) factorRight=0
					let factorSeed=roll(1,factorLeft+factorMiddle+factorRight)
					if(factorSeed<=factorLeft) this.move(4)
					if(factorSeed>factorLeft+factorMiddle) this.move(2)
				}
				if(this.name==="Crab" || this.name==="!Crab!") {
					this.attack()
				}
				if(this.name==="Queen Fire Ant") {
					addLog("[Mob] Queen Fire Ant summons 1 Soldier Fire Ant.","#bfbf00")
					let pendingRarity=this.rarity-2
					if(pendingRarity<1) pendingRarity=1
					spawnNear(new Mob("Soldier Fire Ant",pendingRarity,this.shiny),this.x,this.y,true)
					this.attack()
				}
				if(this.name==="Termite Overmind") {
					if(this.behavior==="Neutral") {
						addLog("[Mob] Termite Overmind is becoming hostile!","#bfbf00")
						this.behavior="Neutral+"
					} else {
						for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].name==="Termite Mound") {
							fight.mob[i].effect.noloot=true
							fight.mob[i].currenthealth=0
							fight.mob[i].remove()
						}
						this.attack()
					}
				}
				if(this.name==="Bush") {
					let summonType=["Leafbug","Mantis","Firefly","Wasp"]
					let summonSeed=summonType[roll(0,3)]
					addLog("[Mob] Bush summons 1 "+summonSeed+".","#bfbf00")
					let pendingRarity=this.rarity-1
					if(pendingRarity<1) pendingRarity=1
					spawnNear(new Mob(summonSeed,pendingRarity,this.shiny),this.x,this.y,true)
				}
				if(this.name==="Beetle (Hell)") {
					if(!this.effect.charge && determine(30,true," for charge")) {
						addLog("[Mob] Beetle (Hell) has charged up.","#bfbf00")
						this.effect.charge=true
						updateT()
						return
					} else {
						this.attack()
					}
				}
				if(this.name==="!Hornet!") {
					this.calculate++
					this.attack()
				}
				if(this.name==="!Spider!") {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0 && determine(30,true,"for restrain")) {
						fight.petal[i].injure({effectturn:10},"Restraint")
					}
					this.attack()
				}
				if(this.name==="!Beetle!") {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0 && discalc(fight.petal[i].x,this.x)<=1 && determine(200-2*fight.petal[i].def1,true,"for strike")) {
						fight.petal[i].injure(approx(this.damage/2),"Strike")
					}
					this.attack()
				}
				if(this.name==="!Sandstorm!") {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y===4 && determine(120-10*fight.petal[i].size,true,"for drag")) {
						fight.petal[i].injure(this.damage,"Drag")
					}
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y===5 && determine(120-10*fight.petal[i].size,true,"for drag")) {
						if(getFilledGrid(fight.petal[i].x,fight.petal[i].y-1)) {
							fight.petal[i].injure(this.damage,"Drag")
						} else {
							addLog("[Petal] "+fight.petal[i].name+" is dragged.","#df9fdf")
							getGrid(0,fight.petal[i].x,fight.petal[i].y).replaceWith(createGrid(0,fight.petal[i].x,fight.petal[i].y,"Empty",1,0))
							fight.petal[i].y--
							fight.petal[i].print()
						}
					}
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y===6 && determine(120-10*fight.petal[i].size,true,"for drag")) {
						if(getFilledGrid(fight.petal[i].x,fight.petal[i].y-1)) {
							fight.petal[i].injure(this.damage,"Drag")
						} else {
							addLog("[Petal] "+fight.petal[i].name+" is dragged.","#df9fdf")
							getGrid(0,fight.petal[i].x,fight.petal[i].y).replaceWith(createGrid(0,fight.petal[i].x,fight.petal[i].y,"Empty",1,0))
							fight.petal[i].y--
							fight.petal[i].print()
						}
					}
					this.attack()
				}
				if(this.name==="!Queen Ant!") {
					this.calculate++
					if(this.calculate<=2) {
						addLog("[Mob] Queen Ant summons 1 Soldier Ant.","#bfbf00")
						let pendingRarity=this.rarity-1
						spawnNear(new Mob("Soldier Ant",pendingRarity,0),this.x,this.y,true)
					} else if(this.calculate<=4) {
						addLog("[Mob] Queen Ant summons 2 Soldier Ant.","#bfbf00")
						let pendingRarity=this.rarity-2
						spawnNear(new Mob("Soldier Ant",pendingRarity,0),this.x,this.y,true)
						spawnNear(new Mob("Soldier Ant",pendingRarity,0),this.x,this.y,true)
					} else {
						this.attack()
					}
				}
				if(this.name==="!Leafbug!" && (this.effect.quickness<=7 || !this.effect.hasOwnProperty("quickness"))) {
					this.attack()
				}
				if(this.name==="!Wasp!") {
					this.calculate++
					this.attack()
				}
			} else if(this.behavior==="Neutral+" || this.behavior==="Hostile") {
				this.attack()
			}
			await waitConfirmation()
			if(this.currenthealth<=0 && this.count<=1) return
			await waitAnimation()
			missileCheck()
			await waitMissile()
			if(MobAttributeList[this.id].match("Doesn't move")===null) {
				let moveflag=true
				if(this.name==="!Hornet!" && this.calculate>=3) {
					moveflag=false
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0) {
						fight.petal[i].injure(approx(0.2*this.damage),"Barrage")
					}
					flowerInjure(approx(0.2*this.damage),"Barrage")
					this.calculate=0
				}
				if(this.name==="!Wasp!" && this.calculate>=2) {
					moveflag=false
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].y>0) {
						fight.petal[i].injure(approx(0.2*this.damage),"Barrage")
					}
					flowerInjure(approx(0.2*this.damage),"Barrage")
					this.calculate=0
				}
				if(moveflag) this.move()
			}
			if(MobAttributeList[this.id].match("BOSS")!==null) {
				delete this.effect.quickness
			}
			updateT()
		}
		Mob.prototype.move=function(dir) {
			if(MobAttributeList[this.id].match("Doesn't move")!==null) return
			if(dir!==undefined) {
				if(fight.rift.open && ((this.x===fight.rift.x && this.y===fight.rift.y) || (toCord(this.x+dx[dir])===fight.rift.x && this.y+dy[dir]===fight.rift.y))) {
					fight.riftmob.push(this.clone())
					this.effect.noloot=true
					this.doom()
					return
				}
				if(this.y+dy[dir]>=1 && this.y+dy[dir]<=3 && !getFilledGrid(toCord(this.x+dx[dir]),this.y+dy[dir])) {
					getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Empty",1,0))
					this.x=toCord(this.x+dx[dir])
					this.y=toCord(this.y+dy[dir])
					this.print()
				}
				return
			}
			let pendingCord=new Array(),distanceLimit=1,originX=this.x,originY=this.y
			pendingCord.push({x:originX,y:originY})
			if(MobAttributeList[this.id].match(/(?<=Moves up to )\d/)!==null) distanceLimit=parseInt(MobAttributeList[this.id].match(/(?<=Moves up to )\d/))
			for(let i=1;i<=8;i++) for(let j=1;j<=3;j++) if(discalc(i,this.x)+discalc(j,this.y,0)<=distanceLimit && !getFilledGrid(i,j)) pendingCord.push({x:i,y:j})
			let resultingCord=pendingCord[roll(0,pendingCord.length-1)]
			if(this.x===resultingCord.x && this.y===resultingCord.y) return
			if(fight.rift.open && ((this.x===fight.rift.x && this.y===fight.rift.y) || (resultingCord.x===fight.rift.x && resultingCord.y===fight.rift.y))) {
				fight.riftmob.push(this.clone())
				this.effect.noloot=true
				this.doom()
				return
			}
			getGrid(0,this.x,this.y).replaceWith(createGrid(0,this.x,this.y,"Empty",1,0))
			this.x=resultingCord.x
			this.y=resultingCord.y
			this.print()
			if(this.name==="Baby Ant" && this.y===originY+1 && this.y>=3) {
				this.attack()
			}
			if(this.name==="Sandstorm" && this.y===originY+1 && this.y>=2) {
				this.attack()
			}
			if(this.name==="Baby Fire Ant" && this.y===originY+1 && this.y>=3) {
				this.attack()
			}
			if(this.name==="Baby Termite" && this.y===originY+1 && this.y>=3) {
				this.attack()
			}
		}
		Mob.prototype.attack=async function() {
			if(this.name.match("(Missile)")===null) {
				addLog("[Mob] Attack of "+this.name+"...","#bfbf00")
				fight.mobattack=true
				confirmation=true
			} else {
				addLog("[Mob] "+this.origin.name+" shoots a missile.","#bfbf00")
			}
			let attackFlag=true
			if(this.name==="Beetle" && fight.mob.length>0 && fight.mob[0].name==="!Summoner!") {
				for(let i=1;i<fight.mob.length;i++) if(determine(20,true," for level up")) {
					addLog("[Mob] Beetle gets 1 level up.","#bfbf00")
					if(!fight.mob[i].effect.hasOwnProperty("levelup")) fight.mob[i].effect.levelup=0
					fight.mob[i].effect.levelup++
				}
			}
			if(this.name.match("(Missile)")===null && MobAttributeList[this.id].match("ATTACK")!==null) {
				attackFlag=false
				if(this.name==="Cactus") {
					flowerInjure(this.damage,this)
				}
				if(this.name==="Hornet") {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(shootingMissile.damage/5)
					shootingMissile.dodge=20
					fight.missile.push(shootingMissile)
				}
				if(this.name==="Scorpion") {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(shootingMissile.damage/3)
					shootingMissile.dodge=30
					fight.missile.push(shootingMissile)
				}
				if(this.name==="Jellyfish") {
					flowerInjure(approx(0.4*this.damage),"Lightning")
				}
				if(this.name==="Leech") {
					flowerInjure(approx(0.5*this.damage),this)
				}
				if(this.name==="Mantis") for(let i=1;i<=3;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=1
					shootingMissile.dodge=10
					fight.missile.push(shootingMissile)
				}
				if(this.name==="Beetle (Hell)") {
					if(this.effect.charge) {
						addLog("[Mob] Beetle (Hell) uses charged attack.","#bfbf00")
						delete this.effect.charge
						flowerInjure(this.damage,this)
					} else {
						attackFlag=true
					}
				}
				if(this.name==="Wasp") {
					let shootingRepeat=roll(1,2)
					for(let i=1;i<=shootingRepeat;i++) {
						let shootingMissile=this.clone()
						shootingMissile.origin=this
						shootingMissile.name+=" (Missile)"
						shootingMissile.damage=approx(shootingMissile.damage/5)
						shootingMissile.dodge=20
						fight.missile.push(shootingMissile)
					}
				}
				if(this.name==="Wasp (Hell)") for(let i=1;i<=5;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(shootingMissile.damage/10)
					shootingMissile.dodge=10
					fight.missile.push(shootingMissile)
				}
				if(this.name==="!Hornet!") for(let i=1;i<=3;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(0.4*shootingMissile.damage)
					shootingMissile.dodge=40
					fight.missile.push(shootingMissile)
				}
				if(this.name==="!Dandelion!") for(let i=1;i<=8;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(0.2*shootingMissile.damage)
					shootingMissile.dodge=70-10*this.count-10*betterFloor((i-1)/2)
					fight.missile.push(shootingMissile)
				}
				if(this.name==="!Scorpion!") {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(shootingMissile.damage/5)
					shootingMissile.dodge=80
					fight.missile.push(shootingMissile)
				}
				if(this.name==="!Shell!") {
					if(this.effect.pearl>=5) {
						for(let i=1;i<=this.effect.pearl;i++) {
							let shootingMissile=this.clone()
							shootingMissile.origin=this
							shootingMissile.name+=" (Missile)"
							shootingMissile.dodge=40
							fight.missile.push(shootingMissile)
						}
						delete this.effect.pearl
					} else {
						attackFlag=true
					}
				}
				if(this.name==="!Leech!") {
					flowerInjure(this.damage,this)
					if(!this.effect.origindamage) this.effect.origindamage=this.damage
					let buffEffectiveness=20
					if(this.effect.hasOwnProperty("suppression")) buffEffectiveness-=2*this.effect.suppression.turn
					if(buffEffectiveness>0) this.damage+=approx(this.effect.origindamage*buffEffectiveness/100)
				}
				if(this.name==="!Mantis!") for(let i=1;i<=5;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(shootingMissile.damage/5)
					shootingMissile.dodge=20
					fight.missile.push(shootingMissile)
				}
				if(this.name==="!Wasp!") for(let i=1;i<=3;i++) {
					let shootingMissile=this.clone()
					shootingMissile.origin=this
					shootingMissile.name+=" (Missile)"
					shootingMissile.damage=approx(0.4*shootingMissile.damage)
					shootingMissile.dodge=20
					fight.missile.push(shootingMissile)
				}
			}
			if(attackFlag) {
				if(this.name.match("(Missile)")===null) getGrid(0,this.x,this.y).children[1].style.transform="rotate(180deg)"
				confirmation2=true
				operPrepare(this,"Defend")
				updateT()
				await waitConfirmation2()
			}
			if(this.name.match("(Missile)")===null) {
				fight.mobattack=false
				confirmation=false
				updateT()
			}
			if(this.name.match("(Missile)")!==null) missileCheck()
		}
	</script>
	<script>
		const bookHTML=new Object()
		bookHTML["Flower Artisan Guide"]="<h2>Flower Artisan Guide</h2><span class='nowrap'></span><br><span>Combine or refine common petals into powerful new forms. By combining different petals with similar characteristics, you gain stronger one improved in level, giving stronger damaging attributes. By refining petal with high level, you gain stronger one improved in rarity, guaranting better durability and wear resistance. Be proficient in the two production methods, and you can easily overwhelm your opponents during battles. This book is your guide to mastering the art of petal craft.</span><br><span>For Rarity Up, you only need to select 1 petal with positive Level (and Rarity should not be Mythic). Higher Level increases the success chance and higher Rarity decreases the chance. The chance is always 100% for petal with at least 3 Level. However, you may find it not worth in some cases. Higher rarity grants your petal higher Health but Damage might be significant decreased since <span class='bold'>Rarity Up resets Level</span>.</span><br><span>For Level Up, you need to select at least 2 petals of the same type with identical Rarity and Level. The success chance decreases as Rarity and Level increases, and the decay stops after 3 Level. To increase the success chance, you need to put more petals at once. (X+1) petals grants you X times success chance. However, success chance exceeds 100% does nothing, and you lost all petals when success or lost [1,X] petals when fail, so putting all petals together is not a wise decision.</span><br><span>Before you begin, there's one more thing to remind you: The Base Four Influencing Fators (Speed, Reload, ATKBuff, DEFBuff) is <span class='bold'>kept</span> on Rarity Up. On Level Up, they <span class='bold'>independently inherit</span> from one material. Choose your materials wisely! Here is another multifunctional calculator which is quite convenient to use by simply inputting Rarity and Level. 3 0 or 4 2 for example.</span><input type='text' tabindex='-1' id='craft-detail' onkeydown='craftdetail(event.key)' class='inner-input' list='craftdetaillist' autocomplete='off' title='Craft Detail'><datalist id='craftdetaillist'><option value='3 0'><option value='4 2'></datalist>"
		bookHTML["Flower Combat Guide"]="<h2>Flower Combat Guide</h2><span class='nowrap'></span><br><span>When you enter a map for the first time, mobs will be spawned and fight against you. There is a threshold depends on Floor that prevents too many mobs existing at the same time. Therefore, when you defeat a mob, a new mob may spawn.</span><br><span>The process of a round in battle is divided into the following parts: At the beginning, your petals gain action based on speed. You can move petals, use them for attack or perform special skills. Then mobs gain action. Mob with action exceeding the threshold will attack and you use petal to defend. If you skip defend or the defend fails, you take the damage. By default value, moving a petal costs 100 action, while using a petal to attack costs 200 action. The threshold for mob is 200 action.</span><br><span>Your petals can attack or defend mobs from <span class='bold'>the front or the side column</span>. The success rate of attack is based on petal ATK (atk2 for front row and atk1 for middle row) and mob Dodge. The success rate of defend is based on petal DEF (def2 for back row and def1 for middle row) and mob Dodge. These two formula have significant difference. When the mob is from side column, the formula also uses petal Size. Petal Size is capped at 20, but the best value for side-defending is <span class='bold'>17 to 18 Size</span>.</span><br><span>For shootable petal, before any bounces, the Accuracy (the petal ATK in success rate formula for shootable petals) is always 100% inside range. For each distance exceeds range, the Accuracy is decreased by Accuracy Decline. If it hits the target, it can bounce between enemies. The Accuracy is decreased by Repeated Accuracy Decline each time it hits a enemy that already hit. The Accuracy is decreased by Bounce Accuracy Decline each bounce exceeds Bounce. Any bounce hits can only hit enemy within Bounce Range.</span><br><span>Since you are facing mobs from all directions and not only from the front, <span class='bold'>the first and last columns are connected</span>, which means that both your petals and mobs can move from the first column to the last column or inverted, and the first and last columns are side columns to each other. The distance between two grids is calculated by horizontal distance plus vertical distance <span class='bold'>without using the Pythagorean theorem</span>. The word 'Retire' means a petal disappears and can't be used again in the same fight. If you are defeated, you only have 30% probability to temporary keep loot and they could be lost if you are defeated again in the same map.</span><br><span>You can calculate chance in the following box. For example, Aa-48S12 calculates the success rate of attacking 80% Dodge mob in side column with 12 Size, 100% ATK and -4 ATKbuff petal, A4+a6F calculates the success rate of attacking 60% Dodge mob in the front column with 40% ATK and +10 ATKbuff petal, D3+05F calculates the success rate of defending 50% Dodge mob in the front column with 30% DEF and +0 DEFbuff petal.</span><input type='text' tabindex='-1' id='combat-calc' onkeydown='combatcalc(event.key)' class='inner-input' list='calclist' autocomplete='off' title='Calculator'><datalist id='calclist'><option value='Aa-48S12'><option value='A4+a6F'><option value='D3+05F'></datalist>"
		bookHTML["Flower Control Guide"]="<h2>Flower Control Guide</h2><span class='nowrap'></span><br><h3>Hot Keys</h3><div class='green-bg inner-box'><span style='color: #7f7f7f'>S: Open/Close settings</span><span style='color: #7f7f7f'>H: Open/Close help</span><span style='color: #7f7f7f'>Z: Open/Close inventory</span><span style='color: #7f7f7f'>V: Open/Close gallery</span><br><span style='color: #9f9f00'>W=: Move up</span><span style='color: #9f9f00'>D=: Move right</span><span style='color: #9f9f00'>S=: Move down</span><span style='color: #9f9f00'>A=: Move left</span><br><span style='color: #009f9f'>T: End turn (mostly)</span><span style='color: #009f9f'>M: Move</span><span style='color: #009f9f'>R: Attack</span><span style='color: #009f9f'>X: Special actions</span><br><span style='color: #ffffff'>Enter: Confirm</span><span style='color: #ffffff'>Backspace: Cancel</span></div>"
		bookHTML["Flower Debate Guide"]="<h2 style='color: #7eef6d'>Flower Debate Guide</h2><span class='nowrap'></span><br><span>Floor 1 Game: Debate Strategy. Reward: Some good things, including talent system.</span><br><br><span>At the beginning, you and your opponent have the same Momentum. When one's Momentum drops to zero, the opponent win. You will receive rewards only when winning for the first time. There are no punishment after failure, and attempts is not limited.</span><br><span>There are 4 types of basic cards: Rock(25%), Blood Stinger(25%), Dice(25%), Air(10%). Basic cards have random rarities from Common to Epic, and levels from 0 to 3. They are petals without attribute floating. If you get a high quality card and don't have any petals of that quality, the level will be reduced until you have a petal at same quality. If there is still no same quality petal after level reduced to 0, rarity will also be reduced.</span><br><span>There are 4 types of advanced cards: Yggdrasil(2%), Criticize(6%), Disregard(6%), Refresh(1%). The rarities of high quality cards are fixed at Legendary, and levels are fixed at 0. Each player has 6 cards.</span><br><span>There are 5 topics: Health(25%), Damage(25%), DPT(25%), Special(20%), Scarce(5%). For each topic, both players choose a card and compare. The loser will get Momentum reduced by 1. Then, both players draw a new card and start a new topic. Each topic has different judgments:</span><span>1. Health Petals: If both player use basic cards, the one with higher health wins.</span><span>2. Damage Petals: If both player use basic cards, the one with higher damage wins. Blood stinger's damage is considered twice as much.</span><span>3. DPT Petals: If both player use basic cards, the one with higher DPT wins. Dice's DPT is considered 6 times as much. Rock is considered as it can hit twice.</span><span>4. Special Petals: If both player use basic cards, the one uses Air wins.</span><span>5. Scarce Petals: If both player use basic cards, no one wins.</span><br><span>Yggdrasil: It is considered as basic cards in topic 1~3. In topic 4~5 it wins all previous cards. In topic 5, it will also cause the opponent to lose an additional 2 Momentum when win.</span><span>Criticize: It wins all previous cards in all topics.</span><span>Disregard: It wins all previous cards in all topics. However, the loser will keep the Momentum.</span><span>Refresh: It wins all previous cards in all topics. However, the loser will keep the Momentum. Instead, the winner discards all cards and draws new cards.</span><br><span>You can see the rarity of your opponent's card. And your attention is amazing, with a 20% chance of recognize when your opponent gains or moves Air.</span>"
		bookHTML["Flower Evolutionary Guide"]="<h2>Flower Evolutionary Guide</h2><span class='nowrap'></span><br><span>Consume the petals to absorb their vital essence. This raw energy fuels your growth, allowing you to level up and evolve. With each infusion of experience, you grow stronger, gain access to higher tier abilities, naturally ascending to greater heights. This ancient cycle of growth is detailed within these pages.</span><br><span>You gain petals from defeated mobs, higher rarity mobs have better droprate. You can see the detail in gallery. The base Experience for a petal is <span class='bold'>(RarityFactor)*(Level+1)</span>. For Common, Unusual, Rare, Epic, Legendary, Mythic Petals, the Factors are 8, 12, 20, 40, 100, 300 respectively. Then, the Experience is multiplied by a random value from 0.8 to 1.2, and rounded to nearest integer, so the expected Experience is equivalent to base Experience.</span><br><span>Since this mechanic is not difficult to understand, you need no calculator for this. I provided another calculator here which helps you get the basic stat of petals. Your gained petals have 20% basic stat attribute floating <span class='bold'>except some special kinds</span>. To use this box, you just need to simply input Name, Rarity, Level. For example, Corn 3 0 calculates the stat of Rare Corn, Plank 4 2 calculates the stat of Epic Plank++.</span><input type='text' tabindex='-1' id='petal-stat' onkeydown='petalstat(event.key)' class='inner-input' list='petalstatlist' autocomplete='off' title='Petal Stat'><datalist id='petalstatlist'><option value='Corn 3 0'><option value='Plank 4 2'></datalist>"
		bookHTML["Flower Game Guide"]="<h2>Flower Game Guide <span style='color: #0078d7; font-style: italic; font-size: 12px; font-weight: noremal'>//TODO</span></h2><div class='white-bg inner-box'><span style='color: #008000'>#include&lt;PFLFtools.h&gt; <span style='color: #0078d7; font-style: italic;'>//should be replaced</span></span><span style='color: #008000'>#include&lt;iostream&gt;</span><span style='color: #008000'>#include&lt;time.h&gt;</span><span style='color: #008000'>#include&lt;math.h&gt;</span><span style='color: #008000'>#include&lt;string.h&gt;</span><span style='color: #008000'>#include&lt;fstream.h&gt;</span><span><span style='font-weight: bold'>using namespace</span> std<span style='color: #ff0000; font-weight: bold'>;</span></span><span><span style='font-weight: bold'>void</span> menu<span style='color: #ff0000; font-weight: bold'>()</span></span><span style='color: #ff0000; font-weight: bold'>{</span><span style='margin-left: 2em'>system<span style='color: #ff0000; font-weight: bold'>(</span><span style='color: #0000ff; font-weight: bold'>\"cls\"</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='margin-left: 2em'>slowprint<span style='color: #ff0000; font-weight: bold'>(</span><span style='color: #0000ff; font-weight: bold'>\"MORE GAME (CLICK!)\"</span><span style='color: #ff0000; font-weight: bold'>,</span><span style='color: #800080'>50</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='margin-left: 2em'>slowprint<span style='color: #ff0000; font-weight: bold'>(</span><a href='https://6triple6single.github.io/PFLF' target='_blank' style='color: #0000ff; font-weight: bold; text-decoration: none'>\"PFLF\"</a><span style='color: #ff0000; font-weight: bold'>,</span><span style='color: #800080'>50</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='margin-left: 2em'>slowprint<span style='color: #ff0000; font-weight: bold'>(</span><a href='https://6triple6single.github.io/Virus1' target='_blank' style='color: #0000ff; font-weight: bold; text-decoration: none'>\"VIRUS 1\"</a><span style='color: #ff0000; font-weight: bold'>,</span><span style='color: #800080'>50</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='margin-left: 2em'><span style='font-weight: bold'>return</span><span style='color: #ff0000; font-weight: bold'>;</span></span><span style='color: #ff0000; font-weight: bold'>}</span><span><span style='font-weight: bold'>int</span> main<span style='color: #ff0000; font-weight: bold'>()</span></span><span style='color: #ff0000; font-weight: bold'>{</span><span style='margin-left: 2em'>system<span style='color: #ff0000; font-weight: bold'>(</span><span style='color: #0000ff; font-weight: bold'>\"cls\"</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='margin-left: 2em'>Sleep<span style='color: #ff0000; font-weight: bold'>(</span><span style='color: #800080'>2000</span><span style='color: #ff0000; font-weight: bold'>);</span></span><span style='color: #0078d7; font-style: italic; margin-left: 2em'>// loadtext();</span><span style='color: #0078d7; font-style: italic; margin-left: 2em'>// loadgallery();</span><span style='color: #0078d7; font-style: italic; margin-left: 2em'>// loadmarvel();</span><span style='margin-left: 2em'>menu<span style='color: #ff0000; font-weight: bold'>();</span></span><span style='margin-left: 2em'><span style='font-weight: bold'>return</span> <span style='color: #800080'>0</span><span style='color: #ff0000; font-weight: bold'>;</span></span><span style='color: #ff0000; font-weight: bold'>}</span></div>"
		bookHTML["Flower Subsist Guide"]="<h2 style='color: #7eef6d'>Flower Subsist Guide</h2><span class='nowrap'></span><br><span>In this long journey, it is inevitable to feel bored and tired, Traveler. You need enough time to strengthen yourself and travel towards higher places. But time won't wait for you. If you don't speed up, you will be greeted by the collapse of Florroom.</span><br><span>And you have realized that things are far more than that, your energy has started to drain slowly but steadily. The cyan vertical bar on the left represents your energy, the lower the energy, the weaker you will be. The upper limit of energy is 100%, and the lower limit is 36%. Never try to cross the 64% safe line, it will only accelerate your death.</span><br><span>Let's be more specific about the effects of energy on combat. As energy is lost, your petals lose more Health when hit, increased to 1/Energy of the original value. Your petals cause lower damage to mobs, which is multiplied by Energy. After crossing the safety line, the flower will receive higher damage, multiplied by 0.3/(Energy-35%). Petals also receive fewer action bars, which is (Energy-35%)/0.3 times the speed.</span><br><span>You should strive to maintain sufficient energy to enter the next floor, where you will receive a 6% energy recovery. Do not waste any items that provide energy recovery, as these tools are extremely scarce and crucial for your survival. To avoid losing too much energy, you need to always remember the following two things:</span><span>1. Don't spend too much turns in battle, as each turn will cause you to lose 0.01% Energy.</span><span>2. Defend mob attacks as much as possible, as each injury will cause you to lose 0.03% Energy.</span><br><span>That's all. Good luck.</span>"
		bookHTML["Flower Survival Guide"]="<h2>Flower Survival Guide</h2><span class='nowrap'></span><br><span>Welcome to the Florroom! This is a tower with 8 floors. As something you may not be familiar with, the goal of the game is to climb from Floor 0 (the bottom) to Floor 7. Here, you make powerful petals, travel between different regions and maps, defeat various mobs and continuously upgrade to gain stronger power!</span><br><span>This is your first book. As the story continues, you will learn more knowledge, which appears in the form of books in this section. If you don't have experience fighting in Florroom, it doesn't matter. You will receive the unique <span class='bold'>Flower Combat Guide</span> I wrote. Enter the name of this book below to get it!</span><br><span>If you remembered something, try writing in the following box to retrieve the corresponding item:</span><input type='text' tabindex='-1' id='item-code' onkeydown='itemcode(event.key)' class='inner-input' autocomplete='off' title='Code'><span>(NOt CASe SenSItiVE &amp; ign o r i ngspace s)</span>"
		let somerandomlimit1=1,somerandomlimit3=1,somerandomlimit4=1
		function book(modify) {
			if(modify===-1 && player.bookreading>0) player.bookreading--
			if(modify===1 && player.bookreading<player.book.length-1) player.bookreading++
			document.getElementById("book-content").innerHTML=bookHTML[player.book[player.bookreading]]
			if(player.book[player.bookreading]==="Flower Artisan Guide") {
				let editingStatHTML="<h3>Level Up Statistics</h3>"
				editingStatHTML+="<span style='color: #7f5f9f'>Total Level Up: "+player.bookstat.artisan.totallevelup
				for(let i=1;i<=6;i++) {
					if(i===1) {
						editingStatHTML+="="
					} else {
						editingStatHTML+="+"
					}
					editingStatHTML+="<span style='color: "+rarityColor[i].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+player.bookstat.artisan.totalraritylevelup[i]+"</span>"
				}
				editingStatHTML+="</span><span style='color: #7f5f9f'>Total Petal Used: "+player.bookstat.artisan.totalleveluppetalused+"</span>"
				editingStatHTML+="<span style='color: #5f9f5f'>Total Success: "+player.bookstat.artisan.totallevelupsuccess+"</span>"
				editingStatHTML+="<span style='color: #5f9f5f'>Total Petal Lost on Success: "+player.bookstat.artisan.totalleveluppetallostsuccess+"</span>"
				editingStatHTML+="<span style='color: #9f5f5f'>Total Fail: "+player.bookstat.artisan.totallevelupfail+"</span>"
				editingStatHTML+="<span style='color: #9f5f5f'>Total Petal Lost on Fail: "+player.bookstat.artisan.totalleveluppetallostfail+"</span>"
				editingStatHTML+="<span style='color: #7f5f9f'>Expected Success: "+approx(player.bookstat.artisan.totallevelupexpectedsuccess*100)/100+"</span>"
				editingStatHTML+="<span style='color: #7f5f9f'>Success Variance: "+approx(player.bookstat.artisan.levelupsuccessvariance*1000)/1000+"</span>"
				editingStatHTML+="<h3>Rarity Up Statistics</h3>"
				editingStatHTML+="<span style='color: #5f7f9f'>Total Rarity Up: "+player.bookstat.artisan.totalrarityup
				for(let i=1;i<=5;i++) {
					if(i===1) {
						editingStatHTML+="="
					} else {
						editingStatHTML+="+"
					}
					editingStatHTML+="<span style='color: "+rarityColor[i].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+player.bookstat.artisan.totalrarityrarityup[i]+"</span>"
				}
				editingStatHTML+="</span><span style='color: #5f9f5f'>Total Success: "+player.bookstat.artisan.totalrarityupsuccess+"</span>"
				editingStatHTML+="<span style='color: #9f5f5f'>Total Fail: "+player.bookstat.artisan.totalrarityupfail+"</span>"
				editingStatHTML+="<span style='color: #5f7f9f'>Expected Success: "+approx(player.bookstat.artisan.totalrarityupexpectedsuccess*100)/100+"</span>"
				editingStatHTML+="<span style='color: #5f7f9f'>Success Variance: "+approx(player.bookstat.artisan.rarityupsuccessvariance*1000)/1000+"</span>"
				document.getElementById("book-content").innerHTML+=editingStatHTML
			}
			if(player.book[player.bookreading]==="Flower Debate Guide") {
				let editingStatHTML="<h3>Your opponents</h3><div class='green-bg inner-box'>"
				for(let i=1;i<=9;i++) {
					editingStatHTML+="<span style='color: "
					if(player.floor1gamestat[i]==="Completed") {
						editingStatHTML+="#5fbf5f"
					} else if(player.floor1gamestat[i]==="Incomplete") {
						editingStatHTML+="#9f9f5f"
					} else {
						editingStatHTML+="#7f7f7f"
					}
					editingStatHTML+="'>"
					if(player.floor1gamestat[i]==="Locked" || fight.active===true || fight.hasOwnProperty("spevent")) {
						editingStatHTML+="<button class='lred-bg srecbtn forbidden'>Locked</button>"
					} else {
						editingStatHTML+="<button onclick='startFight("+(100+i)+")' class='lblue-bg srecbtn pointer'>Start!</button>"
					}
					let reward=["","2*Time Shard","3*Time Shard","Talent Activation","Nothing(WIP)","Nothing(WIP)","Nothing(WIP)","Nothing(WIP)","Nothing(WIP)","Nothing(WIP)"]
					editingStatHTML+="<span class='llmargin' style='color: "+rarityColor[i].replace("#ffe65d","#ffe65d; filter: brightness(90%)").replace("#2bffa3","#2bffa3; filter: brightness(90%)")+"'>"+rarityName[i].slice(0,4)+".</span>"+"Flower, Reward: "+reward[i]
					editingStatHTML+="</span>"
				}
				editingStatHTML+="</div>"
				if(player.floor1gamestat[2]!=="Locked")
				editingStatHTML+="<br><span>Opponents after <span style='color: "+rarityColor[2].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+rarityName[2]+"</span> have higher momentum.</span>"
				if(player.floor1gamestat[4]!=="Locked")
				editingStatHTML+="<span>Opponents after <span style='color: "+rarityColor[4]+"'>"+rarityName[4]+"</span> have higher DPT.</span>"
				if(player.floor1gamestat[5]!=="Locked")
				editingStatHTML+="<span>Opponents after <span style='color: "+rarityColor[5]+"'>"+rarityName[5]+"</span> have higher momentum again.</span>"
				if(player.floor1gamestat[7]!=="Locked")
				editingStatHTML+="<span>Opponents after <span style='color: "+rarityColor[7].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+rarityName[7]+"</span> have higher DPT again.</span>"
				if(player.floor1gamestat[9]!=="Locked")
				editingStatHTML+="<span><span style='color: "+rarityColor[9]+"'>"+rarityName[9]+"</span> opponent has higher damage.</span>"
				document.getElementById("book-content").innerHTML+=editingStatHTML
			}
			if(player.book[player.bookreading]==="Flower Evolutionary Guide") {
				if(explore.floor===1) {
					document.getElementById("book-content").innerHTML=document.getElementById("book-content").innerHTML.replace(" This is a tower with 8 floors. As something you may not be familiar with, the goal of the game is to climb from Floor 0 (the bottom) to Floor 7."," This is a tower with 7 floors. As something you should have known, the goal of the game is to climb from Floor 1 to Floor 7.")
				}
				let editingStatHTML="<h3>Absorb Statistics</h3>"
				editingStatHTML+="<span style='color: #9f7f5f'>Total Petal Absorbed: "+player.bookstat.evolutionary.totalabsorb
				for(let i=1;i<=6;i++) {
					if(i===1) {
						editingStatHTML+="="
					} else {
						editingStatHTML+="+"
					}
					editingStatHTML+="<span style='color: "+rarityColor[i].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+player.bookstat.evolutionary.totalrarityabsorb[i]+"</span>"
				}
				editingStatHTML+="</span><span style='color: #5f9f5f'>Total Exp Gained: "+player.bookstat.evolutionary.totalgainedexp+"</span>"
				editingStatHTML+="<span style='color: #5f9f5f'>Expected Exp: "+player.bookstat.evolutionary.totalexpectedexp+"</span>"
				editingStatHTML+="<span style='color: #5f9f5f'>Exp Variance: "+approx(player.bookstat.evolutionary.expvariance*1000)/1000+"</span>"
				if(player.level<50) {
					editingStatHTML+="<h3>Level Rewards</h3><div class='green-bg inner-box'>"
					for(let i=betterFloor(player.level/10)*10+1;i<=betterFloor(player.level/10)*10+10;i++) {
						editingStatHTML+="<span style='color: "
						if(i<=player.level) {
							editingStatHTML+="#5fbf5f"
						} else if(i===player.level+1) {
							editingStatHTML+="#9f9f5f"
						} else {
							editingStatHTML+="#7f7f7f"
						}
						editingStatHTML+="'>Level "+i+(i<10? " ":"")+": Requires "+LevelExp(i-1)+" Exp, Rewards: 3 Talent Point"
						if(i===10 || i===20 || i===30 || i===40) editingStatHTML+=" <span class='bold'>And 1 Slot</span>"
						editingStatHTML+="</span>"
					}
					editingStatHTML+="</div>"
				}
				if(explore.floor<somerandomlimit1) editingStatHTML=editingStatHTML.replaceAll("3 Talent Point","???")
				document.getElementById("book-content").innerHTML+=editingStatHTML
			}
		}
		let logDisplay=true,cleanerDegree=0
		function cleanerRotate(force=false) {
			if(cleanerDegree===0 && force===false) return
			cleanerDegree=(cleanerDegree+3)%270
			document.getElementById("cleaner").style.transform="rotate("+cleanerDegree+"deg)"
		}
		function addLog(text,color="#000000") {
			if(text.startsWith("[Help]") && player.settings.closehelplog===true) return
			if(text.startsWith("[Command]") && player.settings.closecommandlog===true) return
			if(text.startsWith("[Chat]") && player.settings.closechatlog===true) return
			if(text.startsWith("[Warning]") && player.settings.closewarninglog===true) return
			if(text.startsWith("[Code]") && player.settings.closecodelog===true) return
			if(text.startsWith("[Calculator]") && player.settings.closecalculatorlog===true) return
			if(text.startsWith("[bot#7976]") && player.settings.closebotlog===true) return
			if(text.startsWith("[Petal]") && player.settings.closepetallog===true) return
			if(text.startsWith("[Mob]") && player.settings.closemoblog===true) return
			if(text.startsWith("[Flower]") && player.settings.closeflowerlog===true) return
			if(text.startsWith("[Turn]") && player.settings.closeturnlog===true) return
			if(text.startsWith("[Determine]") && player.settings.closedeterminelog===true) return
			if(text.startsWith("[Resource]") && player.settings.closeresourcelog===true) return
			if(text.startsWith("[Loot]") && player.settings.closelootlog===true) return
			if(text.startsWith("[Craft]") && player.settings.closecraftlog===true) return
			let logElement=document.createElement("div")
			logElement.setAttribute("class","lcmargin")
			if(color) logElement.style.color=color
			logElement.innerHTML=text
			document.getElementById("log").appendChild(logElement)
			document.getElementById("log").scrollTop=document.getElementById("log").scrollHeight
		}
		async function cleanLog() {
			if(cleanerDegree>0) return
			document.getElementById("log").innerHTML=""
			cleanerRotate(true)
		}
		function expandLog() {
			if(logDisplay) {
				logDisplay=false
				document.getElementById("log").style.display="none"
				document.getElementById("command-call").style.display="none"
				document.getElementById("cleaner").style.display="none"
				document.getElementById("command").style.width="unset"
				document.getElementById("expander").children[1].style.display="unset"
			} else {
				logDisplay=true
				document.getElementById("log").style.display=""
				document.getElementById("command-call").style.display=""
				document.getElementById("cleaner").style.display=""
				document.getElementById("command").style.width=""
				document.getElementById("expander").children[1].style.display=""
			}
		}
		function command(key) {
			if(key!=="Enter") return
			if(logDisplay===false) return
			let commandInput=document.getElementById("command-call").value
			document.getElementById("command-call").value=""
			if(commandInput.startsWith(".")) {
				commandInput=commandInput.slice(1)
				let validCommand=false
				if(commandInput==="help") {
					validCommand=true
					addLog("[Help] Help: Print list of all available commands. (Format: .help)","#bf7fbf")
					addLog("[Help] PFLFstart: Play PFLF with bot#7976. (Format: .PFLFstart)","#bf7fbf")
					addLog("[Help] PFLFend: End PFLF game. (Format: .PFLFend)","#bf7fbf")
					addLog("[Help] Claim: Claim number in PFLF. (Format: .claim [number])","#bf7fbf")
					addLog("[Help] PFLFget: Print PFLF state. (Format: .PFLFget)","#bf7fbf")
					addLog("[Help] PFLFhighscore: Print PFLF highscore. (Format: .PFLFhighscore)","#bf7fbf")
				}
				if(commandInput==="PFLFstart" && player.PFLF.active===false) {
					validCommand=true
					player.PFLF.active=true
					player.PFLF.turn=0
					player.PFLF.score=-1001
					player.PFLF.clear=-1
					player.PFLF.dice=0
					commandInput="claim 0"
					addLog("[bot#7976] PFLF started!","#7f7fff")
				}
				if(commandInput==="PFLFend" && player.PFLF.active===true) {
					validCommand=true
					player.PFLF.active=false
					addLog("[bot#7976] PFLF ended!","#7f7fff")
				}
				if(commandInput.startsWith("claim ") && player.PFLF.active===true) {
					let testValid=true,claimNum=commandInput.slice(6).match(/^\d+/)
					if(claimNum===null) testValid=false
					if(testValid===true) {
						claimNum=parseInt(claimNum)
						testValid=isPFLF(claimNum)
					}
					if(testValid===true) {
						let testStr1=player.PFLF.dice.toString(),testStr2=claimNum.toString()
						if(testStr1==="0") testStr1=""
						if(testStr2==="0") testStr2=""
						for(let i=0;i<testStr2.length;i++) {
							if(testStr1.indexOf(testStr2[i])===-1) {
								testValid=false
							} else {
								testStr1=testStr1.slice(0,testStr1.indexOf(testStr2[i]))+testStr1.slice(testStr1.indexOf(testStr2[i])+1)
							}
						}
						if(testValid===true) {
							player.PFLF.score+=(testStr2.length+1)**3
							if(testStr1==="") {
								player.PFLF.clear++
								player.PFLF.score+=1000
							}
							player.PFLF.dice=parseInt("0"+testStr1)
						}
					}
					if(testValid===true) {
						if(player.PFLF.dice>100000) {
							if(player.PFLF.score>player.PFLF.highscore) {
								player.PFLF.highscore=player.PFLF.score
								player.PFLF.highscoreturn=player.PFLF.turn
								player.PFLF.highscoreclear=player.PFLF.clear
							}
							addLog("[bot#7976] Final Turn: "+player.PFLF.turn+", Score: "+player.PFLF.score+", Clear: "+player.PFLF.clear,"#7f7fff")
							player.PFLF.active=false
						}  else {
							player.PFLF.turn++
							for(let i=1;i<=3;i++) player.PFLF.dice=player.PFLF.dice*10+dice()
							commandInput="PFLFget"
						}
					}
					validCommand=testValid
				}
				if(commandInput==="PFLFget" && player.PFLF.active===true) {
					validCommand=true
					addLog("[bot#7976] Turn: "+player.PFLF.turn+", Score: "+player.PFLF.score+", Clear: "+player.PFLF.clear+", Dice: "+player.PFLF.dice,"#7f7fff")
				}
				if(commandInput==="PFLFhighscore") {
					validCommand=true
					addLog("[bot#7976] Highest Score: "+player.PFLF.highscore+", Achieved with Turn "+player.PFLF.highscoreturn+" and Clear "+player.PFLF.highscoreclear+".","#7f7fff")
				}
				if(validCommand===false) addLog("[Command] Invalid command. (Command not exist or available)","#bf7f3f")
			} else {
				addLog("[Chat] Traveler: "+commandInput.replaceAll("<","&lt;"))
			}
		}
		function itemcode(key) {
			if(key!=="Enter") return
			let itemcodeInput=document.getElementById("item-code").value
			document.getElementById("item-code").value=""
			itemcodeInput=itemcodeInput.toLowerCase().replace(/\s/g,"")
			if(!/^[a-z]+$/.test(itemcodeInput)) {
				addLog("[Code] Invalid code. The code should only consist of letters and contains at least 1 letter.","#bf7f3f")
				return
			}
			if(itemcodeInput==="flowercombatguide") {
				if(player.book.indexOf("Flower Combat Guide")===-1) {
					addLog("[Resource] You received Flower Combat Guide from item code.","#7fff7f")
					player.book.push("Flower Combat Guide")
				} else {
					addLog("[Code] The code is already used.","#bf7f3f")
				}
				return
			}
			if(itemcodeInput==="pflf") {
				addLog("[bot#7976] Play PFLF here!","#7f7fff")
				return
			}
			if(itemcodeInput.match("perfect")!==null || itemcodeInput.match("bug")!==null) {
				addLog("[79<sup>2</sup>] The game is perfect, there are no bugs","#ffdfff")
				return
			}
			addLog("[Code] Empty code...","#bfbf7f")
		}
		function combatcalc(key) {
			if(key!=="Enter") return
			let combatcalcInput=document.getElementById("combat-calc").value
			document.getElementById("combat-calc").value=""
			if(!/^[AD][0-9a][-+][0-9a][0-9a](F|S\d+)$/.test(combatcalcInput)) {
				addLog("[Calculator] Invalid input. The input should strictly follow the format /^[AD][0-9a][-+][0-9a][0-9a](F|S\\d+)$/.","#bf7f3f")
				return
			}
			if(/-0/.test(combatcalcInput)) {
				addLog("[Calculator] What is '-0'? This is pointless.","#bf7f3f")
				return
			}
			let calcPetal=new Petal(),calcMob=new Mob()
			if(combatcalcInput[1]==="a") {
				calcPetal.atk1=100
			} else {
				calcPetal.atk1=parseInt(combatcalcInput[1])*10
			}
			calcPetal.atk2=calcPetal.atk1
			if(combatcalcInput[3]==="a") {
				calcPetal.atkbuff=10
			} else {
				calcPetal.atkbuff=parseInt(combatcalcInput[3])
			}
			if(combatcalcInput[2]==="-") calcPetal.atkbuff*=-1
			if(combatcalcInput[4]==="a") {
				calcMob.dodge=100
			} else {
				calcMob.dodge=parseInt(combatcalcInput[4])*10
			}
			if(combatcalcInput[0]==="A") {
				if(combatcalcInput[5]==="F") {
					addLog("[Calculator] The success rate of attacking "+calcMob.dodge+"% Dodge mob in the front column with "+calcPetal.atk1+"% ATK and "+combatcalcInput[2]+Math.abs(calcPetal.atkbuff)+" ATKbuff petal is "+AttackSuccessChance(calcPetal,calcMob,"Front","Middle")+"%","#5fbf5f")
				} else {
					calcPetal.size=parseInt(combatcalcInput.slice(6))
					addLog("[Calculator] The success rate of attacking "+calcMob.dodge+"% Dodge mob in side column with "+calcPetal.size+" Size, "+calcPetal.atk1+"% ATK and "+combatcalcInput[2]+Math.abs(calcPetal.atkbuff)+" ATKbuff petal is "+AttackSuccessChance(calcPetal,calcMob,"Side","Middle")+"%","#5fbf5f")
				}
			}
			if(combatcalcInput[0]==="D") {
				calcPetal.def1=calcPetal.atk1
				calcPetal.def2=calcPetal.atk2
				calcPetal.defbuff=calcPetal.atkbuff
				if(combatcalcInput[5]==="F") {
					addLog("[Calculator] The success rate of defending "+calcMob.dodge+"% Dodge mob in the front column with "+calcPetal.def1+"% DEF and "+combatcalcInput[2]+Math.abs(calcPetal.defbuff)+" DEFbuff petal is "+DefendSuccessChance(calcPetal,calcMob,"Front","Middle")+"%","#5fbf5f")
				} else {
					calcPetal.size=parseInt(combatcalcInput.slice(6))
					addLog("[Calculator] The success rate of defending "+calcMob.dodge+"% Dodge mob in side column with "+calcPetal.size+" Size, "+calcPetal.def1+"% DEF and "+combatcalcInput[2]+Math.abs(calcPetal.defbuff)+" DEFbuff petal is "+DefendSuccessChance(calcPetal,calcMob,"Side","Middle")+"%","#5fbf5f")
				}
			}
		}
		function petalstat(key) {
			if(key!=="Enter") return
			let petalstatInput=document.getElementById("petal-stat").value
			document.getElementById("petal-stat").value=""
			if(!/^.+\s\d\s\d$/.test(petalstatInput)) {
				addLog("[Calculator] Invalid input. The input should strictly follow the format /^.+\\s\\d\\s\\d$/.","#bf7f3f")
				return
			}
			let partSplit=petalstatInput.match(/^(.+)\s(\d)\s(\d)$/)
			partSplit[2]=parseInt(partSplit[2])
			partSplit[3]=parseInt(partSplit[3])
			if(PetalNameList.indexOf(partSplit[1])===-1 || partSplit[2]<1 || partSplit[2]>6) {
				addLog("[Calculator] The petal doesn't exist.","#bf7f3f")
				return
			}
			let calcPetal=new Petal(partSplit[1],partSplit[2],partSplit[3],false)
			addLog("[Calculator] The basic stat of "+rarityName[calcPetal.rarity]+" "+calcPetal.name+"+".repeat(calcPetal.level)+" is: Health="+calcPetal.health+", Damage="+calcPetal.damage+", Speed="+calcPetal.speed+", Reload="+calcPetal.reload+".","#5fbf5f")
		}
		function craftdetail(key) {
			if(key!=="Enter") return
			let craftdetailInput=document.getElementById("craft-detail").value
			document.getElementById("craft-detail").value=""
			if(!/^\d \d$/.test(craftdetailInput)) {
				addLog("[Calculator] Invalid input. The input should strictly follow the format /^\\d \\d$/.","#bf7f3f")
				return
			}
			let calcRarity=parseInt(craftdetailInput[0]),calcLevel=parseInt(craftdetailInput[2]),pendingText="[Calculator] For a petal with "
			pendingText+=rarityName[calcRarity]+" Rarity and "+calcLevel+" Level: Base Health="+approx(PetalHealthMultiplier(calcRarity,calcLevel))+", Base Damage="+approx(PetalDamageMultiplier(calcRarity,calcLevel))+"."
			pendingText+="<br>Level Up Chance="+PetalLevelUpChance(calcRarity,calcLevel,2)+"%, Base Health After="+approx(PetalHealthMultiplier(calcRarity,calcLevel+1))+", Base Damage After="+approx(PetalDamageMultiplier(calcRarity,calcLevel+1))+"."
			if(PetalRarityUpChance(calcRarity,calcLevel)) {
				pendingText+="<br>Rarity Up Chance="+PetalRarityUpChance(calcRarity,calcLevel)+"%, Base Health After="+approx(PetalHealthMultiplier(calcRarity+1,0))+", Base Damage After="+approx(PetalDamageMultiplier(calcRarity+1,0))+"."
			}
			addLog(pendingText,"#5fbf5f")
		}
		let dialogRemain="",dialogPrint=false
		async function dialog(title,maintext,speed,bgColor="#ffffff",textColor="#000000") {
			if(title==="Skip") {
				if(explore.event.searchlibrary===2 && dialogRemain.match(/\)/)) return
				if(explore.event.searchlibrary===10 && dialogRemain.match(/\)/)) return
				if(explore.event.searchlibrary===12 && dialogRemain.match(/\)/)) return
				if(explore.event.floor1hotel===2 && dialogRemain.length>0) return
				if(dialogRemain.length) {
					dialogPrint=false
					document.getElementById("dialog-maintext").innerHTML+=dialogRemain
					dialogRemain=""
					return
				}
				if(explore.event.startdialog===0 && player.settings.dialog==="Skip") explore.event.startdialog=15
				if(explore.event.startdialog===0) {
					dialog("Traveler (You)","The 8th Floor isn't a lie! Let's continue...","Unset","#dfdfff")
					explore.event.startdialog=1
					return
				}
				if(explore.event.startdialog===1) {
					dialog("Traveler (You)","Wait, why have I become so weak? Where are my petals???","Unset","#dfdfff")
					explore.event.startdialog=2
					return
				}
				if(explore.event.startdialog===2) {
					dialog("Garden Watcher","A new flower? Wow, you really look like the Traveler in book.","Unset","#dfffdf")
					explore.event.startdialog=3
					return
				}
				if(explore.event.startdialog===3) {
					dialog("Traveler (You)","The Traveler in book?","Unset","#dfdfff")
					explore.event.startdialog=4
					return
				}
				if(explore.event.startdialog===4) {
					dialog("Garden Watcher","Don't you know that book? It seems that you are a new flower here. Well, Traveler is a powerful flower who wants to climb to the top of Florroom. A great author wrote a novel on this, and the book went viral. Within 64 days after the release, 9% of the flowers chose to leave for exploration. For this reason, the Flower Government has ordered that all flowers will not be accepted again once they are left.","Unset","#dfffdf")
					explore.event.startdialog=5
					return
				}
				if(explore.event.startdialog===5) {
					dialog("Traveler (You)","No, I'm the Traveler.","Unset","#dfdfff")
					explore.event.startdialog=6
					return
				}
				if(explore.event.startdialog===6) {
					dialog("(The Florroom)","(...)","Unset","#dfdfdf")
					explore.event.startdialog=7
					return
				}
				if(explore.event.startdialog===7) {
					dialog("Traveler (You)","So this is the Base Floor? I have lost all my petals. And I feel like I've lost my abilities.","Unset","#dfdfff")
					explore.event.startdialog=8
					return
				}
				if(explore.event.startdialog===8) {
					dialog("Garden Watcher","Yes. You are going again, right? Can you take me with you, please?","Unset","#dfffdf")
					explore.event.startdialog=9
					return
				}
				if(explore.event.startdialog===9) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.startdialog=10;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No, I'm lazy.</button><button type='button' onclick='event.stopPropagation();explore.event.startdialog=11;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No, I'm too weak.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.startdialog=12;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No, I choose C.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.startdialog===10) {
					dialog("Traveler (You)","Of course, I will go again. But I'm too lazy to take you.","Unset","#dfdfff")
					explore.event.startdialog=13
					return
				}
				if(explore.event.startdialog===11) {
					dialog("Traveler (You)","Of course, I will go again. But I need to get stronger first.","Unset","#dfdfff")
					explore.event.startdialog=13
					return
				}
				if(explore.event.startdialog===12) {
					dialog("Traveler (You)","I will go again but no.","Unset","#dfdfff")
					explore.event.startdialog=13
					return
				}
				if(explore.event.startdialog===13) {
					dialog("Garden Watcher","I'm sad for that... Perhaps you can still find some useful books in library!","Unset","#dfffdf")
					explore.event.startdialog=14
					return
				}
				if(explore.event.startdialog===14) {
					dialog("Traveler (You)","Thanks. Bye then.","Unset","#dfdfff")
					explore.event.startdialog=15
					return
				}
				if(explore.event.startdialog===15) {
					explore.event.startdialog="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.searchlibrary===0 && player.settings.dialog==="Skip") explore.event.searchlibrary=11
				if(explore.event.searchlibrary===0) {
					displayCentralRoom()
					dialog("Librarian","Hello, may I ask what book you need to borrow?","Unset","#bfffff")
					explore.event.searchlibrary=1
					return
				}
				if(explore.event.searchlibrary===1) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=2;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Survival Guide.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Evolutionary Guide.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=4;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Artisan Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===2) {
					await dialog("Librarian","(Finding book, Finding book, Finding book) Here it is. What else do you need?","Slow","#bfffff")
					explore.event.searchlibrary=5
					if(player.book.indexOf("Flower Survival Guide")===-1) {
						player.book.push("Flower Survival Guide")
						addLog("[Resource] You received Flower Survival Guide from Library.","#7fff7f")
					}
					return
				}
				if(explore.event.searchlibrary===3) {
					dialog("Librarian","Sorry, this book has already been borrowed out.","Unset","#bfffff")
					explore.event.searchlibrary=6
					return
				}
				if(explore.event.searchlibrary===4) {
					dialog("Librarian","Sorry, this book has already been borrowed out.","Unset","#bfffff")
					explore.event.searchlibrary=7
					return
				}
				if(explore.event.searchlibrary===5) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=8;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Evolutionary Guide.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=9;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Artisan Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===6) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=10;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Survival Guide.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=11;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Artisan Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===7) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=12;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Survival Guide.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=11;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Evolutionary Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===8) {
					dialog("Librarian","Sorry, this book has already been borrowed out.","Unset","#bfffff")
					explore.event.searchlibrary=13
					return
				}
				if(explore.event.searchlibrary===9) {
					dialog("Librarian","Sorry, this book has already been borrowed out.","Unset","#bfffff")
					explore.event.searchlibrary=14
					return
				}
				if(explore.event.searchlibrary===10) {
					await dialog("Librarian","(Finding book, Finding book, Finding book) Here it is. What else do you need?","Slow","#bfffff")
					explore.event.searchlibrary=13
					if(player.book.indexOf("Flower Survival Guide")===-1) {
						player.book.push("Flower Survival Guide")
						addLog("[Resource] You received Flower Survival Guide from Library.","#7fff7f")
					}
					return
				}
				if(explore.event.searchlibrary===11) {
					await dialog("Librarian","Sorry, this book has already been borrowed out too. The only thing I can give you is this Survival Guide. Bye.","Unset","#bfffff")
					explore.event.searchlibrary=15
					if(player.book.indexOf("Flower Survival Guide")===-1) {
						player.book.push("Flower Survival Guide")
						addLog("[Resource] You received Flower Survival Guide from Library.","#7fff7f")
					}
					return
				}
				if(explore.event.searchlibrary===12) {
					await dialog("Librarian","(Finding book, Finding book, Finding book) Here it is. What else do you need?","Slow","#bfffff")
					explore.event.searchlibrary=14
					if(player.book.indexOf("Flower Survival Guide")===-1) {
						player.book.push("Flower Survival Guide")
						addLog("[Resource] You received Flower Survival Guide from Library.","#7fff7f")
					}
					return
				}
				if(explore.event.searchlibrary===13) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=16;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Artisan Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===14) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=16;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>The Evolutionary Guide.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===15) {
					explore.event.searchlibrary="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.searchlibrary===16) {
					dialog("Librarian","Sorry, this book has already been borrowed out too.","Unset","#bfffff")
					explore.event.searchlibrary=17
					return
				}
				if(explore.event.searchlibrary===17) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=15;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Bye.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.searchlibrary=18;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>kys nob.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.searchlibrary===18) {
					dialog("Librarian","No noise allowed in the library! (close the door)","Unset","#bfffff")
					explore.event.searchlibrary=15
					return
				}
				if(explore.event.basefloorwarehouse===0 && player.settings.dialog==="Skip") explore.event.basefloorwarehouse=14
				if(explore.event.basefloorwarehouse===0) {
					displayCentralRoom()
					dialog("(The Florroom)","Traveler walked into a warehouse. The goods inside are messy, like they were left behind after looting.","Unset","#dfdfdf")
					explore.event.basefloorwarehouse=1
					return
				}
				if(explore.event.basefloorwarehouse===1) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=2;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around warehouse.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Find some drinks.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=4;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Search for suitable tools.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===2) {
					if(maintext!==6361) addLog("[Resource] You found an unusual leaf. It seems like a good petal.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=5;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Find some drinks.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=6;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Search for suitable tools.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===3) {
					if(maintext!==6361) addLog("[Resource] You found a large box filled with Energy Drink. You can't take away all the drinks, so you decided to take 20 of them.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=7;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around warehouse.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=8;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Search for suitable tools.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===4) {
					if(maintext!==6361) addLog("[Resource] You found a bow with 10 arrows.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=9;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around warehouse.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=10;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Find some drinks.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===5) {
					if(maintext!==6361) addLog("[Resource] You found a large box filled with Energy Drink. You can't take away all the drinks, so you decided to take 20 of them.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=11;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Search for suitable tools.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===6) {
					if(maintext!==6361) addLog("[Resource] You found a bow with 10 arrows.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=12;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Find some drinks.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===7) {
					if(maintext!==6361) addLog("[Resource] You found an unusual leaf. It seems like a good petal.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=11;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Search for suitable tools.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===8) {
					if(maintext!==6361) addLog("[Resource] You found a bow with 10 arrows.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=13;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around warehouse.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===9) {
					if(maintext!==6361) addLog("[Resource] You found an unusual leaf. It seems like a good petal.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=12;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Find some drinks.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===10) {
					if(maintext!==6361) addLog("[Resource] You found a large box filled with Energy Drink. You can't take away all the drinks, so you decided to take 20 of them.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=13;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around warehouse.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===11) {
					if(maintext!==6361) addLog("[Resource] You found a bow with 10 arrows.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=14;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>That's enough, leave warehouse.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===12) {
					if(maintext!==6361) addLog("[Resource] You found a large box filled with Energy Drink. You can't take away all the drinks, so you decided to take 20 of them.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=14;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>That's enough, leave warehouse.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===13) {
					if(maintext!==6361) addLog("[Resource] You found an unusual leaf. It seems like a good petal.","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorwarehouse=14;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>That's enough, leave warehouse.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorwarehouse===14) {
					explore.event.basefloorwarehouse="Completed"
					document.getElementById("dialog").style.display="none"
					loot("Leaf",2,0)
					player.item.add("Energy Drink",20)
					player.item.add("Arrow",10)
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.basefloorexitcentral===0) {
					displayCentralRoom()
					dialog("(The Florroom)","Are you sure to exit central room?","Instant","#dfdfdf")
					explore.event.basefloorexitcentral=1
					return
				}
				if(explore.event.basefloorexitcentral===1) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorexitcentral=2;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No, I forgot something.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorexitcentral=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Yes, I'm sure.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorexitcentral===2) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.basefloorexitcentral=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Yes, I'm sure.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.basefloorexitcentral===3) {
					explore.event.basefloorexitcentral="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					explore.explored[10]=true
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayMapItem()
					displayMap()
					return
				}
				if(explore.event.evolutionaryguide===1 && player.settings.dialog==="Skip") explore.event.evolutionaryguide=2
				if(explore.event.evolutionaryguide===1) {
					await dialog("(The Florroom)","Traveler found a book under boulder. The title \"Flower Survival Guide\" appears on the side of the book. This book is important and it should not be difficult to push away the boulder to get the book...","Unset","#dfdfdf")
					explore.event.evolutionaryguide=2
					return
				}
				if(explore.event.evolutionaryguide===2) {
					explore.event.evolutionaryguide="Incomplete"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					return
				}
				if(explore.event.evolutionaryguide===3 && player.settings.dialog==="Skip") explore.event.evolutionaryguide=4
				if(explore.event.evolutionaryguide===3) {
					await dialog("(The Florroom)","Traveler got the book. On the cover of the book, there is a sentence: \"I have got all the Flower Artisan Guide from Library using my 125 alt accounts. If you want this book, come to Desert, find me and show me your true abilities.\"","Unset","#dfdfdf")
					explore.event.evolutionaryguide=4
					return
				}
				if(explore.event.evolutionaryguide===4) {
					explore.event.evolutionaryguide="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					player.book.push("Flower Evolutionary Guide")
					addLog("[Resource] You received Flower Evolutionary Guide.","#7fff7f")
					return
				}
				if(explore.event.artisanguide===1 && player.settings.dialog==="Skip") explore.event.artisanguide=2
				if(explore.event.artisanguide===1) {
					await dialog("Summoner","A new challenger? Well, let's get started now.","Unset","#ffffbf")
					explore.event.artisanguide=2
					return
				}
				if(explore.event.artisanguide===2) {
					explore.event.artisanguide="Incomplete"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					return
				}
				if(explore.event.artisanguide===3 && player.settings.dialog==="Skip") explore.event.artisanguide=5
				if(explore.event.artisanguide===3) {
					await dialog("Summoner","I recognize your strength, this book is for you. However, only those with exceptional talent can master the essence of crafting, and no one in this world can compare to me.","Unset","#ffffbf")
					explore.event.artisanguide=4
					return
				}
				if(explore.event.artisanguide===4) {
					dialog("(The Florroom)","After Summoner finished speaking, he took out a book emiting bright yellow light with a striking title: Unusual Flower Artisan Guide+ ! (of course, not for you)","Unset","#dfdfdf")
					explore.event.artisanguide=5
					return
				}
				if(explore.event.artisanguide===5) {
					explore.event.artisanguide="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					player.book.push("Flower Artisan Guide")
					addLog("[Resource] You received Flower Artisan Guide.","#7fff7f")
					return
				}
				if(explore.event.basefloorending===0 && player.settings.dialog==="Skip") {
					explore.event.basefloorending="Completed"
					document.getElementById("end1").style["pointer-events"]="unset"
					for(let i=0;i<=30;i++) {
						document.getElementById("end1").style.opacity=i/30
						if(i===15) {
							document.getElementById("dialog").style.display="none"
							animation=false
						}
						await delay(100)
					}
					location.reload()
					return
				}
				if(explore.event.basefloorending===0) {
					dialog("(The Florroom)","Traveler defeated all guardians. The Jungle Gate opens.","Unset","#dfdfdf")
					explore.event.basefloorending=1
					return
				}
				if(explore.event.basefloorending===1) {
					dialog("(The Florroom)","He walked up the steps leading to Floor 1.","Unset","#dfdfdf")
					explore.event.basefloorending=2
					return
				}
				if(explore.event.basefloorending===2) {
					dialog("(The Florroom)","He walks.","Unset","#dfdfdf")
					explore.event.basefloorending=3
					return
				}
				if(explore.event.basefloorending===3) {
					dialog("(The Florroom)","He continue walks.","Unset","#dfdfdf")
					explore.event.basefloorending=4
					return
				}
				if(explore.event.basefloorending===4) {
					dialog("(The Florroom)","He feels that time is freezing.","Unset","#dfdfdf")
					explore.event.basefloorending=5
					clearAllInterval()
					return
				}
				if(explore.event.basefloorending===5) {
					dialog("(The Florroom)","But he doesn't care.","Unset","#dfdfdf")
					explore.event.basefloorending=6
					return
				}
				if(explore.event.basefloorending===6) {
					dialog("(The Florroom)","He walks.","Unset","#dfdfdf")
					explore.event.basefloorending=7
					document.getElementById("calendar-day").setAttribute("class","grey")
					document.getElementById("calendar-day").innerHTML="Day &("
					return
				}
				if(explore.event.basefloorending===7) {
					dialog("(The Florroom)","He walks.He walks.","Instant","#dfdfdf")
					explore.event.basefloorending=8
					document.getElementById("calendar-hour").setAttribute("class","grey")
					document.getElementById("calendar-hour").innerHTML="&("
					return
				}
				if(explore.event.basefloorending===8) {
					dialog("(The Florroom)","He walks.He walks.HE WALKS","Instant","#dfdfdf")
					explore.event.basefloorending="Completed"
					document.getElementById("calendar-minute").setAttribute("class","grey")
					document.getElementById("calendar-minute").innerHTML="&("
					document.getElementById("end1").style["pointer-events"]="unset"
					for(let i=0;i<=30;i++) {
						document.getElementById("end1").style.opacity=i/30
						if(i===15) {
							document.getElementById("dialog").style.display="none"
							animation=false
						}
						await delay(100)
					}
					location.reload()
					return
				}
				if(explore.event.floor1startdialog===0 && player.settings.dialog==="Skip") explore.event.floor1startdialog=19
				if(explore.event.floor1startdialog===0) {
					dialog("Traveler (You)","(Waking up) Where am I now?","Unset","#dfdfff")
					explore.event.floor1startdialog=1
					return
				}
				if(explore.event.floor1startdialog===1) {
					dialog("(The Florroom)","He starts walking around. There are some messy newspapers on the ground. He picked up one and read.","Unset","#dfdfdf")
					explore.event.floor1startdialog=2
					return
				}
				if(explore.event.floor1startdialog===2) {
					dialog("(Newspaper)","BREAKING NEWS: The underground world suddenly collapsed! The reason is unknown and is currently under investigation.","Slow","#ffffff")
					explore.event.floor1startdialog=3
					return
				}
				if(explore.event.floor1startdialog===3) {
					dialog("(Newspaper)","Recently, there have been a large number of flowers claiming to come from underground world, and the police are registering their information.","Slow","#ffffff")
					explore.event.floor1startdialog=4
					return
				}
				if(explore.event.floor1startdialog===4) {
					dialog("(Newspaper)","Some of them have already formed squads, searching or digging for downward passages. They have received support from the construction committee. Good luck to them.","Slow","#ffffff")
					explore.event.floor1startdialog=5
					return
				}
				if(explore.event.floor1startdialog===5) {
					dialog("(Newspaper)","In addition, we also interviewed a flower named Summoner. According to him, he was on a staircase when the collapse occurred and felt the surrounding time and space becoming chaotic, which has some credibility.","Slow","#ffffff")
					explore.event.floor1startdialog=6
					return
				}
				if(explore.event.floor1startdialog===6) {
					dialog("(The Florroom)","Right at this moment, several police arrived.","Unset","#dfdfdf")
					explore.event.floor1startdialog=7
					return
				}
				if(explore.event.floor1startdialog===7) {
					dialog("Police","Here comes a new flower!","Unset","#9f9fff")
					explore.event.floor1startdialog=8
					return
				}
				if(explore.event.floor1startdialog===8) {
					dialog("Police","Name?","Unset","#9f9fff")
					explore.event.floor1startdialog=9
					return
				}
				if(explore.event.floor1startdialog===9) {
					dialog("Traveler (You)","Traveler.","Unset","#dfdfff")
					explore.event.floor1startdialog=10
					return
				}
				if(explore.event.floor1startdialog===10) {
					dialog("Police","Age?","Unset","#9f9fff")
					explore.event.floor1startdialog=11
					return
				}
				if(explore.event.floor1startdialog===11) {
					dialog("Traveler (You)","I don't know.","Unset","#dfdfff")
					explore.event.floor1startdialog=12
					return
				}
				if(explore.event.floor1startdialog===12) {
					dialog("Police","Fine. Turn left ahead and go to the hotel to register. Here is your ID card.","Unset","#9f9fff")
					explore.event.floor1startdialog=13
					return
				}
				if(explore.event.floor1startdialog===13) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1startdialog=14;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Sure.</button><button type='button' onclick='event.stopPropagation();explore.event.floor1startdialog=15;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>I have questions...</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1startdialog===14) {
					dialog("Police","Don't you have any question to ask?","Unset","#9f9fff")
					explore.event.floor1startdialog=16
					return
				}
				if(explore.event.floor1startdialog===15) {
					dialog("Traveler (You)","What is the cause of the collapse?","Unset","#dfdfff")
					explore.event.floor1startdialog=18
					return
				}
				if(explore.event.floor1startdialog===16) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1startdialog=17;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No.</button><button type='button' onclick='event.stopPropagation();explore.event.floor1startdialog=15;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Yes, I have questions.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1startdialog===17) {
					dialog("Police","You are interesting...","Unset","#9f9fff")
					explore.event.floor1startdialog=19
					return
				}
				if(explore.event.floor1startdialog===18) {
					dialog("Police","They have already discovered some connections... Remember, always pay attention to the time.","Unset","#9f9fff")
					explore.event.floor1startdialog=19
					return
				}
				if(explore.event.floor1startdialog===19) {
					explore.event.floor1startdialog="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.floor1hotel===0 && player.settings.dialog==="Skip") explore.event.floor1hotel=4
				if(explore.event.floor1hotel===0) {
					displayCentralRoom()
					dialog("Clerk","Please show me your ID card.","Fast","#ffffdf")
					explore.event.floor1hotel=1
					return
				}
				if(explore.event.floor1hotel===1) {
					dialog("Traveler (You)","Here you are.","Unset","#dfdfff")
					explore.event.floor1hotel=2
					return
				}
				if(explore.event.floor1hotel===2) {
					displayCentralRoom()
					dialog("Clerk","Okay... Wait...","Slow","#ffffdf")
					explore.event.floor1hotel=3
					return
				}
				if(explore.event.floor1hotel===3) {
					displayCentralRoom()
					dialog("Clerk","Someone bought a nearby house for you. That one with yellow roof.","Fast","#ffffdf")
					explore.event.floor1hotel=4
					return
				}
				if(explore.event.floor1hotel===4) {
					explore.event.floor1hotel="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.floor1warehouse===0 && player.settings.dialog==="Skip") explore.event.floor1warehouse=14
				if(explore.event.floor1warehouse===0) {
					displayCentralRoom()
					dialog("(The Florroom)","Traveler walked into his room, wondering who had bought it for him.","Unset","#dfdfdf")
					explore.event.floor1warehouse=1
					return
				}
				if(explore.event.floor1warehouse===1) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1warehouse=2;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Walk around room.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1warehouse===2) {
					if(maintext!==6361) addLog("[Resource] You found two exquisite cans of drinks inside of chaos spider webs. Who left them here?","#7fff7f")
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1warehouse=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Go to bed.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1warehouse===3) {
					dialog("(The Florroom)","Traveler immediately fell asleep after going to bed. He feels energetic after not sleeping well for a long time, but...","Unset","#dfdfdf")
					explore.event.floor1warehouse=4
					if(player.calendar.day<70) player.calendar.day++
					return
				}
				if(explore.event.floor1warehouse===4) {
					dialog("(The Florroom)","<span style='color: #ff3f3f'>He has never considered about <span style='color: #7fffff'>energy</span>, has he?</span>","Instant","#dfdfdf")
					explore.event.floor1warehouse=5
					explore.energy=10000
					document.getElementById("bar-energy-c").style.opacity=0
					updateFlowerState()
					for(let i=0;i<=20;i++) {
						document.getElementById("bar-energy-c").style.opacity=i/20
						await delay(100)
					}
					explore.event.floor1warehouse=6
					return
				}
				if(explore.event.floor1warehouse===6) {
					explore.event.floor1warehouse="Completed"
					document.getElementById("dialog").style.display="none"
					player.item.add("Epic Rose Juice",2)
					player.item.add("Triple Web",3)
					player.book.push("Flower Subsist Guide")
					addLog("[Resource] You received Flower Subsist Guide.","#7fff7f")
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.floor1game===0 && player.settings.dialog==="Skip") explore.event.floor1game=8
				if(explore.event.floor1game===0) {
					displayCentralRoom()
					dialog("(From far distance)","Rock does high damage, it is much better...","Unset","#ffdfff")
					explore.event.floor1game=1
					return
				}
				if(explore.event.floor1game===1) {
					dialog("(From far distance)","But why not use stinger? It deals higher damage, and...","Unset","#ffdfff")
					explore.event.floor1game=2
					return
				}
				if(explore.event.floor1game===2) {
					dialog("(From far distance)","No! Rock can hit enemy multiple times, it has higher damage.","Unset","#ffdfff")
					explore.event.floor1game=3
					return
				}
				if(explore.event.floor1game===3) {
					dialog("(From far distance)","It is too slow. Multiple hits don't mean good average damage.","Unset","#ffdfff")
					explore.event.floor1game=4
					return
				}
				if(explore.event.floor1game===4) {
					dialog("(From far distance)","Then what do you use for better damage per turn?","Unset","#ffdfff")
					explore.event.floor1game=5
					return
				}
				if(explore.event.floor1game===5) {
					dialog("Traveler (You)","Excuse me. Is there a talent activation device here?","Unset","#dfdfff")
					explore.event.floor1game=6
					return
				}
				if(explore.event.floor1game===6) {
					dialog("(From far distance)","Only strong people can use it. If you can defeat me in the debate, I will give you the right to use it. Come find me later.","Unset","#ffdfff")
					explore.event.floor1game=7
					return
				}
				if(explore.event.floor1game===7) {
					displayCentralRoom()
					dialog("(The Florroom)","Traveler walked towards the door. He may need to first understand the content of the debate.","Unset","#dfdfdf")
					explore.event.floor1game=8
					return
				}
				if(explore.event.floor1game===8) {
					explore.event.floor1game="Completed"
					document.getElementById("dialog").style.display="none"
					player.book.push("Flower Debate Guide")
					addLog("[Resource] You received Flower Debate Guide.","#7fff7f")
					player.floor1gamestat=new Array(10).fill("Locked")
					player.floor1gamestat[1]="Incomplete"
					animation=false
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayCentralRoom()
					return
				}
				if(explore.event.floor1exitcentral===0) {
					displayCentralRoom()
					dialog("(The Florroom)","Are you sure to exit central room?","Instant","#dfdfdf")
					explore.event.floor1exitcentral=1
					return
				}
				if(explore.event.floor1exitcentral===1) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1exitcentral=2;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>No, I forgot something.</button><button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1exitcentral=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>Yes, I'm sure.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1exitcentral===2) {
					dialog("Traveler (You)","<button type='button' tabindex='-1' onclick='event.stopPropagation();explore.event.floor1exitcentral=3;dialog(\"Skip\")' class='llmargin white-bg srecbtn pointer'>You can come back whenever you want.</button>","Instant","#dfdfff")
					return
				}
				if(explore.event.floor1exitcentral===3) {
					explore.event.floor1exitcentral="Completed"
					document.getElementById("dialog").style.display="none"
					animation=false
					explore.explored[10]=true
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					displayMapItem()
					displayMap()
					return
				}
				return
			}
			document.getElementById("dialog").style["background-color"]=bgColor
			document.getElementById("dialog-title").innerHTML=title
			document.getElementById("dialog-title").style.color=textColor
			document.getElementById("dialog-maintext").innerHTML=""
			document.getElementById("dialog-maintext").style.color=textColor
			document.getElementById("dialog").style.display="flex"
			dialogRemain=maintext
			if(speed==="Unset") speed=player.settings.dialog
			if(!speed) speed="Middle"
			if(speed==="Instant") {
				document.getElementById("dialog-maintext").innerHTML=maintext
				dialogRemain=""
				return
			}
			animation=true
			dialogPrint=true
			while(dialogPrint) {
				document.getElementById("dialog-maintext").innerHTML+=dialogRemain.slice(0,1)
				dialogRemain=dialogRemain.slice(1)
				if(!dialogRemain.length) dialogPrint=false
				if(speed==="Fast" && document.getElementById("dialog-maintext").innerHTML.match(/[A-Za-z]$/)) await delay(30)
				if(speed==="Middle" && document.getElementById("dialog-maintext").innerHTML.match(/[A-Za-z]$/)) await delay(50)
				if(speed==="Slow" && document.getElementById("dialog-maintext").innerHTML.match(/[A-Za-z]$/)) await delay(80)
			}
		}
		let EndingList=new Object()
//		EndingList.beta="<h2>The Journey Conquered</h2><span>You have completed Base Floor. Congratulations!</span><br><span>This is the entire content of Florroom Rewritten BETA.</span><span>More content will be release soon, stay tuned!</span><br><span>This game is so balanced that I want to play again</span><br><button type='button' tabindex='-1' id='endgame3' onclick='hardReset()'>Here we go again?</button>"
		EndingList.collapse1="<h2>The Journey Halted</h2><span>It is Day 80, and Base Floor has collapsed.</span><br><span>You made much contributions to the exploration of Florroom</span><span>during your lifetime. Flowers will always remember you.</span><br><span>I'm sure I could have finished it faster. Let's try again.</span><br><button type='button' tabindex='-1' id='endgame3' onclick='hardReset()'>Here we go again?</button>"
		EndingList.collapse2="<h2>The Journey Halted</h2><span>It is Day 80, and Floor 1 has collapsed.</span><br><span>You made much contributions to the exploration of Florroom</span><span>during your lifetime. Flowers will always remember you.</span><br><span>I'm sure I could have gone further. Let's try again.</span><br><button type='button' tabindex='-1' id='endgame3' onclick='hardReset()'>Here we go again?</button>"
		EndingList.exhaust1="<h2>The Journey Halted</h2><span>You felt your eyes darken and then faint, in Floor 1.</span><br><span>You made much contributions to the exploration of Florroom</span><span>during your lifetime. Flowers will always remember you.</span><br><span>I'm sure I am fully prepared now. Let's try again.</span><br><button type='button' tabindex='-1' id='endgame3' onclick='hardReset()'>Here we go again?</button>"
		EndingList.rift="<h2>The Journey Halted</h2><span>You fell into a rift and failed to escape.</span><br><span>You are only one step away from the next Floor. As long as we get there...</span><br><span>The rift... Is the cost behind this worth it?</span><br><span>I have firmly established my will. Let's try again.</span><br><button type='button' tabindex='-1' id='endgame3' onclick='hardReset()'>Here we go again?</button>"
		async function endGameDisplay() {
			document.getElementById("endgame1").style.display="unset"
			document.getElementById("endgame2").style.display="flex"
			for(let i=0;i<=10;i++) {
				document.getElementById("end1").style.opacity=1-i/10
				await delay(100)
			}
			document.getElementById("end1").style["pointer-events"]="none"
			return
		}
		function gameEnded() {
//			if(explore.flowerspot===10 && explore.floor===1) {
//				document.getElementById("endgame2").innerHTML=EndingList.beta
//				endGameDisplay()
//				return true
//			}
			if((player.calendar.second>=5 && explore.floor===0 && player.calendar.day===79) || player.calendar.day===80) {
				document.getElementById("endgame2").innerHTML=EndingList.collapse1
				endGameDisplay()
				return true
			}
			if((player.calendar.second>=5 && explore.floor===1 && player.calendar.day===79) || player.calendar.day===80) {
				document.getElementById("endgame2").innerHTML=EndingList.collapse2
				endGameDisplay()
				return true
			}
			if(explore.energy<3600) {
				document.getElementById("endgame2").innerHTML=EndingList.exhaust1
				endGameDisplay()
				return true
			}
			if(fight.hasOwnProperty("riftfight")) {
				document.getElementById("endgame2").innerHTML=EndingList.rift
				endGameDisplay()
				return true
			}
			return false
		}
		function endFloor(previousFloor) {
			if(previousFloor===0) {
				delete player.item["Energy Drink"]
				delete player.item.Arrow
			}
			delete player.memory
			delete player.calendar.reset
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
			if(previousFloor===0) {
				explore.event=new Object()
				explore.event.basefloorending=0
				dialog("Skip")
			}
		}
	</script>
	<script>
		let mouseX,mouseY
		document.addEventListener('mousemove',(mouse) => {
			mouseX=mouse.clientX
			mouseY=mouse.clientY
		} )
		const version=20260205,acceptedVersion=20260122
		const svgNS="http://www.w3.org/2000/svg"
		const dx=[0,0,1,0,-1],dy=[0,-1,0,1,0],dx5=[0,1,2,2,1,-1,-2,-2,-1],dy5=[0,-2,-1,1,2,2,1,-1,-2]
		let rarityColor=["#000000","#7eef6d","#ffe65d","#4d52e3","#861fde","#de1f1f","#1fdbde","#ff2b75","#2bffa3","#555555"]
		let rarityName=["None","Common","Unusual","Rare","Epic","Legendary","Mythic","Ultra","Super","Unique"]
		const mapArray=[10,11,12,13,14,15,16,17,21,22,23,24,25,26,31,32,33,34,35,36,37,38,39,41,42,43,44,51,52,53,54,55,56,61,62,63,64,65,66,67]
		const pathArray=[1011,1013,1112,1121,1131,1213,1214,1241,1314,1315,1416,1451,1516,1517,1617,1724,1739,2122,2224,2225,2226,2324,2325,2353,2461,2526,3132,3133,3233,3236,3239,3334,3335,3436,3438,3537,3538,3639,3738,3761,3943,4142,4243,4244,4344,5152,5153,5253,5354,5355,5455,5556,5664,6162,6263,6265,6364,6365,6466,6566,6667]
		const tutorialOrder=[10,11,12,14,21,22,24,31,41,42,43,51,52,53,23,61,62,63,64,65,66,67]
		let userVersion=JSON.parse(localStorage.getItem("FLORROOMuserVersion"))
		if(!userVersion) userVersion=version
		localStorage.setItem("FLORROOMuserVersion",JSON.stringify(userVersion))
		let player=JSON.parse(localStorage.getItem("FLORROOMplayer"))
		let explore=JSON.parse(localStorage.getItem("FLORROOMexplore"))
		let fight=JSON.parse(localStorage.getItem("FLORROOMfight"))
		if(!player) player=new Object()
		if(!explore) explore=new Object()
		if(!fight) fight=new Object()
		if(!player.book) {
			player.book=new Array()
			player.book[0]="Flower Game Guide"
			player.book[1]="Flower Control Guide"
		}
		if(!player.bookreading) player.bookreading=0
		if(!player.bookstat) player.bookstat=new Object()
		if(!player.bookstat.evolutionary) {
			player.bookstat.evolutionary=new Object()
			player.bookstat.evolutionary.totalabsorb=0
			player.bookstat.evolutionary.totalrarityabsorb=new Array()
			for(let i=1;i<=6;i++) player.bookstat.evolutionary.totalrarityabsorb[i]=0
			player.bookstat.evolutionary.totalgainedexp=0
			player.bookstat.evolutionary.totalexpectedexp=0
			player.bookstat.evolutionary.expvariance=0
		}
		if(!player.bookstat.artisan) {
			player.bookstat.artisan=new Object()
			player.bookstat.artisan.totallevelup=0
			player.bookstat.artisan.totalraritylevelup=new Array()
			for(let i=1;i<=6;i++) player.bookstat.artisan.totalraritylevelup[i]=0
			player.bookstat.artisan.totalleveluppetalused=0
			player.bookstat.artisan.totallevelupsuccess=0
			player.bookstat.artisan.totalleveluppetallostsuccess=0
			player.bookstat.artisan.totallevelupfail=0
			player.bookstat.artisan.totalleveluppetallostfail=0
			player.bookstat.artisan.totallevelupexpectedsuccess=0
			player.bookstat.artisan.levelupsuccessvariance=0
			player.bookstat.artisan.totalrarityup=0
			player.bookstat.artisan.totalrarityrarityup=new Array()
			for(let i=1;i<=5;i++) player.bookstat.artisan.totalrarityrarityup[i]=0
			player.bookstat.artisan.totalrarityupsuccess=0
			player.bookstat.artisan.totalrarityupfail=0
			player.bookstat.artisan.totalrarityupexpectedsuccess=0
			player.bookstat.artisan.rarityupsuccessvariance=0
		}
		if(!player.calendar) player.calendar=new Object()
		if(!player.calendar.day) player.calendar.day=40
		if(!player.calendar.hour) player.calendar.hour=1
		if(!player.calendar.minute) player.calendar.minute=1
		if(!player.calendar.second) player.calendar.second=0
		if(!player.calendar.reset) {
			player.calendar.reset=true
			if(explore.floor===1) {
				player.calendar.day=30
				player.calendar.hour=1
				player.calendar.minute=1
				player.calendar.second=0
			}
			if(explore.floor===2) {
				player.calendar.day=20
				player.calendar.hour=1
				player.calendar.minute=1
				player.calendar.second=0
			}
			if(explore.floor===3) {
				player.calendar.day=10
				player.calendar.hour=1
				player.calendar.minute=1
				player.calendar.second=0
			}
			if(explore.floor===4) {
				player.calendar.day=1
				player.calendar.hour=1
				player.calendar.minute=1
				player.calendar.second=0
			}
			if(explore.floor>=5) {
				player.calendar.day=79
				player.calendar.hour=1
				player.calendar.minute=1
				player.calendar.second=0
			}
		}
		if(!player.PFLF) player.PFLF=new Object()
		if(!player.PFLF.highscore) player.PFLF.highscore=0
		if(!player.PFLF.highscoreturn) player.PFLF.highscoreturn=0
		if(!player.PFLF.highscoreclear) player.PFLF.highscoreclear=0
		if(!player.PFLF.active) player.PFLF.active=false
		if(!player.level) player.level=0
		if(!player.exp) player.exp=0
		if(!player.inventory) {
			player.inventory=new Object()
			for(let i=1;i<=10;i++) player.inventory[i]=new Petal(0,1,0)
		}
		for(let i in player.inventory) player.inventory[i]=Object.assign(new Petal(),player.inventory[i])
		if(!player.settings) player.settings=new Object()
		if(!player.gallery) player.gallery=new Object()
		if(!player.clover) player.clover=false
		if(!player.item) player.item=new Object()
		player.item.add=function(itemname,itemamount) {
			if(!player.item.hasOwnProperty(itemname)) player.item[itemname]=0
			player.item[itemname]+=itemamount
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
		}
		player.item.subtract=function(itemname,itemamount) {
			if(!player.item.hasOwnProperty(itemname) || player.item[itemname]<itemamount) return false
			player.item[itemname]-=itemamount
			if(player.item[itemname]===0) {
				if(itemname==="Energy Drink") collapseGrid(getGrid(2,1,1))
				if(itemname==="Arrow") collapseGrid(getGrid(2,2,1))
				delete player.item[itemname]
			}
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
			return true
		}
		if(!explore.floor) explore.floor=0
		if(!explore.floweroldspot) explore.floweroldspot=10
		if(!explore.flowerspot) explore.flowerspot=10
		if(!explore.event) explore.event=new Object()
		if(!explore.highest) explore.highest=100*explore.floor+explore.flowerspot
		if(!explore.explored) explore.explored=new Object()
		for(let i in mapArray) if(!explore.explored[mapArray[i]]) explore.explored[mapArray[i]]=false
		if(!explore.floorboss) {
			explore.floorboss=new Array()
			for(let i=0;i<3;i++) explore.floorboss[i]=roll(1,15)
			while(explore.floorboss[0]===explore.floorboss[1] || explore.floorboss[0]===explore.floorboss[2] || explore.floorboss[1]===explore.floorboss[2]) {
				for(let i=0;i<3;i++) explore.floorboss[i]=roll(1,15)
			}
		}
		if(!fight.active) fight.active=false
		if(!fight.manipulate) fight.manipulate=false
		if(!fight.ready) fight.ready=false
		if(!fight.turnnum) fight.turnnum=1
		if(!fight.flower) fight.flower=new Object()
		if(!fight.flower.effect) fight.flower.effect=new Object()
		if(!fight.petal) fight.petal=new Array()
		for(let i in fight.petal) fight.petal[i]=Object.assign(new Petal(),fight.petal[i])
		if(!fight.mob) fight.mob=new Array()
		for(let i in fight.mob) fight.mob[i]=Object.assign(new Mob(),fight.mob[i])
		if(!fight.spawnmob) fight.spawnmob=new Array()
		for(let i in fight.spawnmob) fight.spawnmob[i]=Object.assign(new Mob(),fight.spawnmob[i])
		if(!fight.missile) fight.missile=new Array()
		for(let i in fight.missile) fight.missile[i]=Object.assign(new Mob(),fight.missile[i])
		delete fight.spevent
		if(!fight.rift) fight.rift=new Object()
		if(!fight.rift.open) fight.rift.open=false
		if(!fight.riftmob) fight.riftmob=new Array()
		for(let i in fight.riftmob) fight.riftmob[i]=Object.assign(new Mob(),fight.riftmob[i])
		localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
		localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
		localStorage.setItem("FLORROOMfight",JSON.stringify(fight))
		let animation=false,confirmation=false,confirmation2=false,missile=false
		function safeReload() {
			requestAnimationFrame(() => {
				location.reload()
			} )
		}
		function delay(time) {
			return new Promise(resolve => setTimeout(resolve,time))
		}
		function waitAnimation() {
			return new Promise(resolve => {const checkAnimation=() => animation? setTimeout(checkAnimation,20):resolve(); checkAnimation()})
		}
		function waitConfirmation() {
			return new Promise(resolve => {const checkConfirmation=() => confirmation? setTimeout(checkConfirmation,20):resolve(); checkConfirmation()})
		}
		function waitConfirmation2() {
			return new Promise(resolve => {const checkConfirmation2=() => confirmation2? setTimeout(checkConfirmation2,20):resolve(); checkConfirmation2()})
		}
		function waitMissile() {
			return new Promise(resolve => {const checkMissile=() => missile? setTimeout(checkMissile,20):resolve(); checkMissile()})
		}
		async function copyToClipboard(text) {
			await navigator.clipboard.writeText(text)
		}
		function betterFloor(num) {
			return Math.floor(num+1e-10)
		}
		function approx(num) {
			return betterFloor(num+0.5)
		}
		function isPFLF(num) {
			return (betterFloor(num**0.5)**2===num || betterFloor(num**(1/3))**3===num)
		}
		function numLength(num) {
			if(num===0) return 0
			return num.toString().length
		}
		function color(type) {
			switch(type) {
				case 1:
				return "#ff0000"
				case 2:
				return "#0000ff"
				case 3:
				return "#ff00ff"
				default:
				return "#00ff00"
			}
		}
		function isButton(element) {
			return (element.tagName==="BUTTON")
		}
		function createDice(value,point) {
			let newDice=document.createElement("button")
			newDice.type="button"
			newDice.tabIndex=-1
			newDice.setAttribute("class","dice")
			newDice.setAttribute("onclick","clickDice(this)")
			newDice.value=value
			switch(point) {
				case 1:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M50 45A5 5 0 0 0 50 55A5 5 0 0 0 50 45'/></svg>1"
				break
				case 2:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M50 30A5 5 0 0 0 50 40A5 5 0 0 0 50 30M50 60A5 5 0 0 0 50 70A5 5 0 0 0 50 60'/></svg>2"
				break
				case 3:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M33 62A5 5 0 0 0 33 72A5 5 0 0 0 33 62M50 45A5 5 0 0 0 50 55A5 5 0 0 0 50 45M67 28A5 5 0 0 0 67 38A5 5 0 0 0 67 28'/></svg>3"
				break
				case 4:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M35 30A5 5 0 0 0 35 40A5 5 0 0 0 35 30M65 30A5 5 0 0 0 65 40A5 5 0 0 0 65 30M35 60A5 5 0 0 0 35 70A5 5 0 0 0 35 60M65 60A5 5 0 0 0 65 70A5 5 0 0 0 65 60'/></svg>4"
				break
				case 5:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M35 30A5 5 0 0 0 35 40A5 5 0 0 0 35 30M65 30A5 5 0 0 0 65 40A5 5 0 0 0 65 30M35 60A5 5 0 0 0 35 70A5 5 0 0 0 35 60M65 60A5 5 0 0 0 65 70A5 5 0 0 0 65 60M50 45A5 5 0 0 0 50 55A5 5 0 0 0 50 45'/></svg>5"
				break
				case 6:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/><path class='fblack-path' d='M35 28A5 5 0 0 0 35 38A5 5 0 0 0 35 28M65 28A5 5 0 0 0 65 38A5 5 0 0 0 65 28M35 45A5 5 0 0 0 35 55A5 5 0 0 0 35 45M65 45A5 5 0 0 0 65 55A5 5 0 0 0 65 45M35 62A5 5 0 0 0 35 72A5 5 0 0 0 35 62M65 62A5 5 0 0 0 65 72A5 5 0 0 0 65 62'/></svg>6"
				break
				default:
				newDice.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 10L80 10A10 10 0 0 1 90 20L90 80A10 10 0 0 1 80 90L20 90A10 10 0 0 1 10 80L10 20A10 10 0 0 1 20 10'/></svg>?"
			}
			return newDice
		}
		function getDice(value) {
			return document.querySelector("[value='"+value+"']")
		}
		function clickDice(button) {
			if(animation) return
			let buttonValue=parseInt(button.value)
			return
		}
		let svgGradientCount=0
		function createGrid(value,x,y,text,size=0,rarity=0) {
			let newGrid=document.createElement("button")
			newGrid.type="button"
			newGrid.tabIndex=-1
			newGrid.setAttribute("class","grid")
			if(size===-2) newGrid.setAttribute("class","mingrid")
			if(size===-1) newGrid.setAttribute("class","sgrid")
			if(size===1) newGrid.setAttribute("class","bgrid")
			if(rarity>=1 && rarity<=9) newGrid.style["background-color"]=rarityColor[rarity]
			newGrid.setAttribute("onclick","clickGrid(this)")
			newGrid.value=value
			newGrid.dataset.x=x
			newGrid.dataset.y=y
			newGrid.innerHTML=""
			if(text==="Diamond") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M50 10A40 40 0 0 0 50 90A40 40 0 0 0 50 10'/><path class='fgreen-path' d='M26 46L50 75L74 46L66 32L34 32ZL42 46L50 75L58 46L74 46M50 32L42 46L58 46Z'/></svg><span style='display: none'>Diamond</span>"
			if(text==="Cross") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M20 20L80 80M80 20L20 80'/></svg><span style='display: none'>Cross</span>"
			if(text==="Line") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M0 50L100 50'/></svg><span style='display: none'>Line</span>"
			if(text==="Border") {
				newGrid.style["border-radius"]=0
				newGrid.style.border="5px solid"
				newGrid.innerHTML=""
			}
			if(text==="Defend") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M50 10A40 40 0 0 0 50 90A40 40 0 0 0 50 10'/><path class='fdbrown-path wide' d='M30 35L50 25L70 35A50 50 0 0 1 50 75A50 50 0 0 1 30 35Z'/></svg><span style='display: none'>Defend</span>"
			if(text==="Bloom") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='flred-path' d='M50 32A20 17 135 0 1 74 56L50 80L26 56A20 17 45 0 1 50 32'/><path class='green-path' d='M35 50L65 50M50 35L50 65'/><span style='display: none'>Bloom</span>"
			if(text==="Immunity") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='fyellow-path' d='M50 20L80 50L50 80L20 50Z'/><span style='display: none'>Immunity</span>"
			if(text==="Thorn") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='fdbrown-path' d='M20 63L30 30L40 63L50 30L60 63L70 30L80 63L80 68L20 68Z'/><span style='display: none'>Thorn</span>"
			if(text==="Shield") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='fblue-path wide' d='M25 34L50 22L75 34A60 60 0 0 1 50 80A60 60 0 0 1 25 34Z'/></svg><span style='display: none'>Shield</span>"
			if(text==="Purity") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='fyellow-path' d='M50 20A30 30 0 0 0 50 80A30 30 0 0 0 50 20'/><path class='green-path' d='M35 50L65 50M50 35L50 65'/><span style='display: none'>Purity</span>"
			if(text==="Evasion") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='yellow-path rcap' d='M50 20L44 26M50 20L56 26M50 20L50 80M44 74L50 80M56 74L50 80M80 50L74 44M80 50L74 56M80 50L20 50M26 44L20 50M26 56L20 50'/><span style='display: none'>Evasion</span>"
			if(text==="Resistance") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lgreen-bg in-svg'><path class='fblue-path' d='M50 20L80 50L50 80L20 50Z'/><span style='display: none'>Resistance</span>"
			if(text==="Poison") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lred-bg in-svg'><path class='cpurple-path rcap' d='M50 80L50 20M50 80L30 60M50 80L70 60'/><span style='display: none'>Poison</span>"
			if(text==="Suppression") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lred-bg in-svg'><path class='white-path' d='M50 20A30 30 0 0 0 50 80A30 30 0 0 0 50 20M30 50L70 50'/><span style='display: none'>Suppression</span>"
			if(text==="Vulnerability") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lred-bg in-svg'><path class='fdbrown-path wide' d='M25 34L50 22L75 34A60 60 0 0 1 50 80A60 60 0 0 1 25 34Z'/><path class='white-path rcap' d='M50 30L44 50L56 50L50 70'/><span style='display: none'>Vulnerability</span>"
			if(text==="Wither") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='lred-bg in-svg'><path class='fwhite-path' d='M50 32A20 17 135 0 1 74 56L50 80L26 56A20 17 45 0 1 50 32'/><path class='dbrown-path' d='M35 50L65 50'/><span style='display: none'>Wither</span>"
			if(text==="Empty") newGrid.innerHTML="<span class='mid lgrey text3'>Empty</span>"
			if(text==="Space") newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M0 20L0 0L20 0M80 0L100 0L100 20M100 80L100 100L80 100M20 100L0 100L0 80'/></svg><span class='mid lgrey text3'>Space</span>"
			if(typeof(text)==="number" && text!==0) newGrid.innerHTML="<svg viewBox='0 0 100 100' class='in-svg'><path d='M50 10L90 50L50 90L10 50Z'/></svg><span class='mid'>"+text+"</span>"
			if(typeof(text)==="string" && text.startsWith("Text")) newGrid.innerHTML="<span class='mid'>"+text.slice(5)+"</span>"
			if(typeof(text)==="string" && text.startsWith("Petal")) newGrid.innerHTML=PetalSVGArray[text.slice(6)]
			if(typeof(text)==="string" && text.startsWith("Mob")) newGrid.innerHTML=MobSVGArray[text.slice(4).replaceAll("!","")]
			if(typeof(text)==="string" && text.startsWith("Item")) newGrid.innerHTML=ItemSVGArray[text.slice(5)]
			if(typeof(text)==="string" && text.startsWith("Card")) newGrid.innerHTML=CardSVGArray[text.slice(5)]
			if(newGrid.innerHTML.match("svgGradient")) {
				svgGradientCount++
				newGrid.innerHTML=newGrid.innerHTML.replaceAll("svgGradient","uniqueGradient"+svgGradientCount)
			}
			newGrid.addEventListener("mouseenter",() => gridInfo(newGrid))
			newGrid.addEventListener("mouseleave",() => closeGridInfo())
			return newGrid
		}
		function getGrid(value,x,y) {
			return document.querySelector("[value='"+value+"'][data-x='"+x+"'][data-y='"+y+"']")
		}
		function clickGrid(button) {
			if(animation) return
			if(document.getElementById("gridinfo").style.display==="none") return
			if(fight.ready && fight.turn==="Mob") return
			let buttonValue=parseInt(button.value),buttonX=parseInt(button.getAttribute("data-x")),buttonY=parseInt(button.getAttribute("data-y"))
			if(fight.hasOwnProperty("spevent")) {
				if(fight.spevent.event>=101 && fight.spevent.event<=109 && buttonValue===0 && buttonY===6 && buttonX%3!==0) {
					if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
						selectedGrid.select=false
						closeGridInfo()
						gridInfo(button)
					} else {
						if(selectedGrid.select===true) {
							selectedGrid.select=false
							closeGridInfo()
						}
						gridInfo(button)
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						let option=document.createElement("div")
						option.innerHTML+="<button type='button' id='keyx-btn' onclick='playCard("+buttonX+")' class='llmargin lgrey-bg srecbtn pointer'>[X] Play</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
				return
			}
			if(lupoper.active===true) {
				let targetPetal=player.inventory[lupoper.selectedArray[0]].clone()
				if(player.inventory[buttonX].id===targetPetal.id && player.inventory[buttonX].rarity===targetPetal.rarity && player.inventory[buttonX].level===targetPetal.level) {
					lupoper.selectedArray.push(buttonX)
					collapseGrid(button)
					document.getElementById("lup-confirm").innerHTML="[L] Level Up"
				}
				return
			}
			if(fight.active===false && buttonValue===1) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					selectedGrid.select=true
					selectedGrid.value=buttonValue
					selectedGrid.x=buttonX
					selectedGrid.y=buttonY
					document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
					let option=document.createElement("div")
					if(player.inventory[buttonX].star>0) option.innerHTML+="<button type='button' id='star-btn1' onclick='star(-1)' class='llmargin lblue-bg srecbtn pointer'>Star-</button>"
					if(player.inventory[buttonX].star<10) option.innerHTML+="<button type='button' id='star-btn2' onclick='star(1)' class='llmargin lgreen-bg srecbtn pointer'>Star+</button>"
					if(levelUpCheck(player.inventory[buttonX])) option.innerHTML+="<button type='button' id='lup-btn' onclick='levelUp()' class='llmargin lpurple-bg srecbtn pointer'>[L] Level Up</button>"
					if(rarityUpCheck(player.inventory[buttonX])) option.innerHTML+="<button type='button' id='rup-btn' onclick='rarityUp()' class='llmargin lcyan-bg srecbtn pointer'>[U] Rarity Up</button>"
					if(absorbCheck(player.inventory[buttonX])) option.innerHTML+="<button type='button' id='abs-btn' onclick='absorb()' class='llmargin lred-bg srecbtn forbidden'>Absorb</button>"
					if(option.innerHTML!=="") {
						document.getElementById("gridinfo").appendChild(option)
						document.getElementById("gridinfo").innerHTML+="<br>"
					}
				}
			}
			if(document.getElementById("inventory").style.display==="flex" && buttonValue===0) return
			if(document.getElementById("inventory").style.display==="flex" && buttonValue===2) return
			if(fight.active===true && buttonValue===1) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					selectedGrid.select=true
					selectedGrid.value=buttonValue
					selectedGrid.x=buttonX
					selectedGrid.y=buttonY
					document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
					let option=document.createElement("div")
					if(equipCheck(player.inventory[buttonX])) {
						if(PetalAttributeList[player.inventory[buttonX].id].match("TYPE")===null) {
							option.innerHTML+="<button type='button' id='equip-btn' onclick='equip(0)' class='llmargin white-bg srecbtn pointer'>Equip</button>"
						} else {
							option.innerHTML+="<button type='button' id='equip1-btn' onclick='equip(1)' class='llmargin white-bg srecbtn pointer'>Equip as T1</button>"
							option.innerHTML+="<button type='button' id='equip2-btn' onclick='equip(2)' class='llmargin white-bg srecbtn pointer'>Equip as T2</button>"
						}
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
			}
			if(fight.active===true && fight.ready===false && buttonValue===0) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===buttonX && fight.petal[i].y===buttonY && fight.petal[i].state!=="Retired") {
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						let option=document.createElement("div")
						option.innerHTML+="<button type='button' id='equip-btn' onclick='unequip()' class='llmargin lwhite-bg srecbtn pointer'>Unequip</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
			}
			if(fight.active===true && fight.ready===false && buttonValue===2) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===buttonX && fight.petal[i].y===buttonY && fight.petal[i].state!=="Retired") {
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						let option=document.createElement("div")
						option.innerHTML+="<button type='button' id='equip-btn' onclick='unequip()' class='llmargin lwhite-bg srecbtn pointer'>Unequip</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
			}
			if(fight.active===true && fight.ready===true && buttonValue===0) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===buttonX && fight.petal[i].y===buttonY && fight.petal[i].state!=="Retired") {
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						let option=document.createElement("div")
						if(moveCheck(fight.petal[i])) option.innerHTML+="<button type='button' id='keym-btn' onclick='fight.petal["+i+"].move()' class='llmargin lblue-bg srecbtn pointer'>[M] Move</button>"
						if(attackCheck(fight.petal[i])) option.innerHTML+="<button type='button' id='keyr-btn' onclick='fight.petal["+i+"].attack()' class='llmargin lyellow-bg srecbtn pointer'>[R] Attack</button>"
						if(shootCheck(fight.petal[i])) option.innerHTML+="<button type='button' id='keyr-btn' onclick='fight.petal["+i+"].shoot()' class='llmargin lyellow-bg srecbtn pointer'>[R] Shoot</button>"
						if(skillCheck(fight.petal[i])) option.innerHTML+="<button type='button' id='keyx-btn' onclick='fight.petal["+i+"].skill()' class='llmargin lpurple-bg srecbtn pointer'>[X] Special Skill</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
			}
			if(fight.active===true && fight.ready===true && buttonValue===2) {
				if(selectedGrid.select===true && selectedGrid.value===buttonValue && selectedGrid.x===buttonX && selectedGrid.y===buttonY) {
					selectedGrid.select=false
					closeGridInfo()
					gridInfo(button)
				} else {
					if(selectedGrid.select===true) {
						selectedGrid.select=false
						closeGridInfo()
					}
					gridInfo(button)
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===buttonX && fight.petal[i].y===buttonY && fight.petal[i].state!=="Retired") {
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						if(fight.petal[i].name==="Antennae" && fight.spawnmob.length>0) {
							let anticipateAmount=3+fight.petal[i].level
							if(anticipateAmount>fight.spawnmob.length) anticipateAmount=fight.spawnmob.length
							let perceivedMob=document.createElement("div")
							perceivedMob.setAttribute("class","nlh")
							for(let i=0;i<anticipateAmount;i++) {
								let smallMobGrid=createGrid(79,0,0,"Mob_"+fight.spawnmob[i].name,1,fight.spawnmob[i].rarity)
								smallMobGrid.style.scale=0.5
								smallMobGrid.style.margin="-20px -15px"
								perceivedMob.appendChild(smallMobGrid)
							}
							document.getElementById("gridinfo").appendChild(perceivedMob)
						}
						let option=document.createElement("div")
						if(skillCheck(fight.petal[i])) option.innerHTML+="<button type='button' id='keyx-btn' onclick='fight.petal["+i+"].skill()' class='llmargin lpurple-bg srecbtn pointer'>[X] Special Skill</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
					if(buttonY===1) {
						selectedGrid.select=true
						selectedGrid.value=buttonValue
						selectedGrid.x=buttonX
						selectedGrid.y=buttonY
						document.getElementById("gridinfo").children[0].innerHTML="(Selected) "+document.getElementById("gridinfo").children[0].innerHTML
						let option=document.createElement("div")
						if(buttonX===1 && player.item["Energy Drink"]>=1) option.innerHTML+="<button type='button' id='keyx-btn' onclick='useItem(\"Energy Drink\")' class='llmargin lpurple-bg srecbtn pointer'>[X] Use Item</button>"
						if(buttonX===2 && player.item["Arrow"]>=1) option.innerHTML+="<button type='button' id='keyx-btn' onclick='useItem(\"Arrow\")' class='llmargin lpurple-bg srecbtn pointer'>[X] Use Item</button>"
						if(buttonX===3 && player.item["Epic Rose Juice"]>=1 && explore.energy<9000 && fight.flower.currenthealth<FlowerMaxHealth()/2) option.innerHTML+="<button type='button' id='keyx-btn' onclick='useItem(\"Epic Rose Juice\")' class='llmargin lpurple-bg srecbtn pointer'>[X] Use Item</button>"
						if(buttonX===4 && player.item["Triple Web"]>=1 && JSON.stringify(fight.flower.effect)==="{}") option.innerHTML+="<button type='button' id='keyx-btn' onclick='useItem(\"Triple Web\")' class='llmargin lpurple-bg srecbtn pointer'>[X] Use Item</button>"
						if(option.innerHTML!=="") {
							document.getElementById("gridinfo").appendChild(option)
							document.getElementById("gridinfo").innerHTML+="<br>"
						}
					}
				}
			}
		}
		function roll(lowerLimit,upperLimit) {
			return Math.floor(Math.random()*(upperLimit-lowerLimit+1)+lowerLimit)
		}
		function roll2(lowerLimit,upperLimit) {
			return approx(Math.random()*(upperLimit-lowerLimit)+lowerLimit)
		}
		function dice() {
			return roll(1,6)
		}
		function determine(chance,log,logText="") {
			if(chance<0) chance=0
			if(chance>100) chance=100
			let result=false
			if(100*Math.random()<=chance) result=true
			if(log) {
				if(result) {
					addLog("[Determine] True ("+chance+"%)"+logText,"#3f3f3f")
				} else {
					addLog("[Determine] False ("+(100-chance)+"%)"+logText,"#3f3f3f")
				}
			}
			return result
		}
		function toCord(originCord,modulo=8) {
			return (originCord%modulo+modulo-1)%modulo+1
		}
		function discalc(cord1,cord2,modulo=8) {
			let differ=Math.abs(cord1-cord2)
			if(modulo===0) return differ
			differ%=modulo
			if(modulo-differ<differ) differ=modulo-differ
			return differ
		}
		function compareVectorCloser(v1,v2) {
			if(v1.x**2+v1.y**2<v2.x**2+v2.y**2) return true
			if(v1.x**2+v1.y**2>v2.x**2+v2.y**2) return false
			let dir1=0,dir2=0
			if(v1.x===0&&v1.y<0) dir1=1
			if(v1.x>0) dir1=2
			if(v1.x===0&&v1.y>0) dir1=3
			if(v1.x<0) dir1=4
			if(v2.x===0&&v2.y<0) dir2=1
			if(v2.x>0) dir2=2
			if(v2.x===0&&v2.y>0) dir2=3
			if(v2.x<0) dir2=4
			if(dir1<dir2) return true
			if(dir1>dir2) return false
			return (v1.y/v1.x<v2.y/v2.x)
		}
		let vecArray=new Array()
		for(let i=-7;i<=7;i++) {
			for(let j=-7;j<=7;j++) {
				vecArray=vecArray.concat({x:i,y:j})
			}
		}
		for(let i=0;i<vecArray.length;i++) {
			for(let j=i+1;j<vecArray.length;j++) {
				if(compareVectorCloser(vecArray[j],vecArray[i])) {
					let tempVec=vecArray[j]
					vecArray[j]=vecArray[i]
					vecArray[i]=tempVec
				}
			}
		}
		let cogDegree=0
		function cogRotate() {
			if(document.getElementById("settings").style.display==="flex") {
				cogDegree=(cogDegree+1)%360
				document.getElementById("cog").style.transform="rotate("+cogDegree+"deg)"
			}
		}
		let flowerDegree=0,flowerSpin=1
		function flowerRotate() {
			if(document.getElementById("inventory").style.display==="flex") {
				flowerDegree=(flowerDegree+1)%720
				document.getElementById("flower").style.transform="rotate("+540*Math.sin(flowerDegree/360*Math.PI)*flowerSpin+"deg)"
			}
		}
		let ladybugDegree=roll(0,359),ladybugMovement=0,ladybugTurn=1,ladybugX=roll(0,99),ladybugY=roll(0,99)
		function ladybugMove() {
			if(document.getElementById("gallery").style.display==="flex") {
				if(ladybugMovement===0) {
					ladybugTurn=roll(0,10)
					if(ladybugTurn>=1 && ladybugTurn<=9) ladybugTurn=roll(0,10)
					if(ladybugTurn>=1 && ladybugTurn<=5) ladybugTurn=roll(0,10)
					if(ladybugTurn>=1 && ladybugTurn<=3) ladybugTurn=roll(0,10)
					if(ladybugTurn>=1 && ladybugTurn<=2) ladybugTurn=roll(0,10)
					if(dice()<4) ladybugTurn*=-1
				}
				if(ladybugMovement<180 && roll(1,90)*Math.abs(ladybugTurn)>Math.abs(90-ladybugMovement)*10) {
					ladybugDegree=(ladybugDegree+Math.sign(ladybugTurn)+360)%360
					document.getElementById("ladybug").style.transform="rotate("+ladybugDegree+"deg)"
				}
				if(ladybugMovement>=180 && roll(1,90)*Math.abs(ladybugTurn)>Math.abs(270-ladybugMovement)*10) {
					ladybugX=(ladybugX+Math.sin(ladybugDegree/180*Math.PI)+100)%100
					ladybugY=(ladybugY-Math.cos(ladybugDegree/180*Math.PI)+100)%100
					document.getElementById("ladybug-bg").style.transform="translate(-"+ladybugX+"px, -"+ladybugY+"px)"
				}
				ladybugMovement=(ladybugMovement+1)%360
			}
		}
		function closeAll() {
			if(document.getElementById("mapinfo").style.display==="flex") closeMapInfo()
			if(document.getElementById("settings").style.display==="flex") settings(false)
			if(document.getElementById("help").style.display==="flex") howToPlay(false)
			if(document.getElementById("inventory").style.display==="flex") openInventory(false)
			if(document.getElementById("gallery").style.display==="flex") openGallery(false)
		}
		function cornerDisplay() {
			if(document.getElementById("settings").style.display==="flex") return true
			if(document.getElementById("help").style.display==="flex") return true
			if(document.getElementById("inventory").style.display==="flex") return true
			if(document.getElementById("gallery").style.display==="flex") return true
			return false
		}
		function settings(open=true) {
			if(animation) return
			if(open && document.getElementById("settings").style.display==="flex") {
				settings(false)
				return
			}
			if(!open) {
				document.getElementById("settings").style.display="none"
				return
			}
			closeAll()
			selectedGrid.select=false
			closeGridInfo()
			document.getElementById("settings").innerHTML="<h2>Settings</h2><span class='nowrap'></span><br><span>REC means recommended</span><h3>Log Display</h3>"
			let logDisplay=document.createElement("div")
			if(!player.settings.hasOwnProperty("closehelplog")) {
				let addButton=settingButton(1,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(1,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closecommandlog")) {
				let addButton=settingButton(2,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(2,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closechatlog")) {
				let addButton=settingButton(3,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(3,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closewarninglog")) {
				let addButton=settingButton(4,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(4,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closecodelog")) {
				let addButton=settingButton(5,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(5,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closecalculatorlog")) {
				let addButton=settingButton(6,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(6,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closebotlog")) {
				let addButton=settingButton(7,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(7,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closepetallog")) {
				let addButton=settingButton(8,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(8,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closemoblog")) {
				let addButton=settingButton(9,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(9,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closeflowerlog")) {
				let addButton=settingButton(10,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(10,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closeturnlog")) {
				let addButton=settingButton(11,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(11,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closedeterminelog")) {
				let addButton=settingButton(12,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(12,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closeresourcelog")) {
				let addButton=settingButton(13,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(13,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closelootlog")) {
				let addButton=settingButton(14,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(14,1,"Off")
				logDisplay.appendChild(addButton)
			}
			if(!player.settings.hasOwnProperty("closecraftlog")) {
				let addButton=settingButton(15,1,"On")
				logDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(15,1,"Off")
				logDisplay.appendChild(addButton)
			}
			document.getElementById("settings").appendChild(logDisplay)
			let dialogDisplayTitle=document.createElement("h3")
			dialogDisplayTitle.innerHTML="Dialog Display"
			document.getElementById("settings").appendChild(dialogDisplayTitle)
			let dialogDisplay=document.createElement("div")
			if(player.settings.dialog==="Slow") {
				let addButton=settingButton(1,2,"Slow")
				dialogDisplay.appendChild(addButton)
			} else if(player.settings.dialog==="Fast") {
				let addButton=settingButton(1,2,"Fast")
				dialogDisplay.appendChild(addButton)
			} else if(player.settings.dialog==="Skip") {
				let addButton=settingButton(1,2,"Skip")
				dialogDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(1,2,"Middle")
				dialogDisplay.appendChild(addButton)
			}
			document.getElementById("settings").appendChild(dialogDisplay)
			let themeTitle=document.createElement("h3")
			themeTitle.innerHTML="Theme (Requires Refresh)"
			document.getElementById("settings").appendChild(themeTitle)
			let themeDisplay=document.createElement("div")
			if(player.settings.theme==="C++") {
				let addButton=settingButton(1,3,"C++")
				themeDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(1,3,"Classic")
				themeDisplay.appendChild(addButton)
			}
			if(player.settings.rarity==="Prefixed") {
				let addButton=settingButton(2,3,"Prefixed")
				themeDisplay.appendChild(addButton)
			} else if(player.settings.rarity==="Inverted") {
				let addButton=settingButton(2,3,"Inverted")
				themeDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(2,3,"Normal")
				themeDisplay.appendChild(addButton)
			}
			document.getElementById("settings").appendChild(themeDisplay)
			let qolTitle=document.createElement("h3")
			qolTitle.innerHTML="Quality of Life"
			document.getElementById("settings").appendChild(qolTitle)
			let qolDisplay=document.createElement("div")
			if(!player.settings.hasOwnProperty("alwaysscroll")) {
				let addButton=settingButton(1,4,"Off")
				qolDisplay.appendChild(addButton)
			} else {
				let addButton=settingButton(1,4,"On")
				qolDisplay.appendChild(addButton)
			}
			document.getElementById("settings").appendChild(qolDisplay)
			document.getElementById("settings").appendChild(document.createElement("br"))
			document.getElementById("settings").style.display="flex"
			if(player.settings.alwaysscroll===true) document.getElementById("settings").scrollTop=0
			document.getElementById("settings").focus()
		}
		function settingButton(setX,setY,state) {
			if(setX===1 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Help",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Help<br><span class='text5'>REC=On</span>",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===2 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Command",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===2 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Command",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===3 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Chat",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===3 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Chat",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===4 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Warning",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===4 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Warning",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===5 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Code",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===5 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Code",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===6 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Calculator",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===6 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Calculator",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===7 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Bot",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===7 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Bot",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===8 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Petal<br><span class='text5'>REC=Off</span>",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===8 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Petal",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===9 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Mob",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===9 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Mob<br><span class='text5'>REC=On</span>",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===10 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Flower",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===10 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Flower",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===11 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Turn",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===11 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Turn",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===12 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Determine<br><span class='text5'>REC=Off</span>",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===12 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Determine",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===13 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Resource",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===13 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Resource",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===14 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Loot",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===14 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Loot",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===15 && setY===1 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Craft",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===15 && setY===1 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Craft",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===2 && state==="Slow") {
				let addButton=createGrid(5,setX,setY,"Text_Speed<br><br>Slow<br><span class='text5'>REC=Skip</span>",1,0)
				addButton.classList.add("blue-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===2 && state==="Middle") {
				let addButton=createGrid(5,setX,setY,"Text_Speed<br><br>Middle<br><span class='text5'>REC=Skip</span>",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===2 && state==="Fast") {
				let addButton=createGrid(5,setX,setY,"Text_Speed<br><br>Fast<br><span class='text5'>REC=Skip</span>",1,0)
				addButton.classList.add("yellow-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===2 && state==="Skip") {
				let addButton=createGrid(5,setX,setY,"Text_Speed<br><br>Skip",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===3 && state==="Classic") {
				let addButton=createGrid(5,setX,setY,"Text_Theme<br><br>Classic",1,0)
				addButton.classList.add("white-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===3 && state==="C++") {
				let addButton=createGrid(5,setX,setY,"Text_Theme<br><br>C++",1,0)
				addButton.classList.add("dgrey-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===2 && setY===3 && state==="Normal") {
				let addButton=createGrid(5,setX,setY,"Text_Rarity<br><br>Normal",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===2 && setY===3 && state==="Prefixed") {
				let addButton=createGrid(5,setX,setY,"Text_Rarity<br><br>Prefixed",1,0)
				addButton.classList.add("dgrey-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===2 && setY===3 && state==="Inverted") {
				let addButton=createGrid(5,setX,setY,"Text_Rarity<br><br>Inverted",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===4 && state==="On") {
				let addButton=createGrid(5,setX,setY,"Text_Always<br>scroll<br>before<br>display",1,0)
				addButton.classList.add("green-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
			if(setX===1 && setY===4 && state==="Off") {
				let addButton=createGrid(5,setX,setY,"Text_Always<br>scroll<br>before<br>display",1,0)
				addButton.classList.add("red-bg","llmargin")
				addButton.style.border="2px solid"
				addButton.setAttribute("onclick","settingClick("+setX+","+setY+")")
				return addButton
			}
		}
		function settingClick(setX,setY) {
			if(animation) return
			if(setX===1 && setY===1) {
				if(!player.settings.hasOwnProperty("closehelplog")) {
					cleanLog()
					player.settings.closehelplog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closehelplog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===2 && setY===1) {
				if(!player.settings.hasOwnProperty("closecommandlog")) {
					cleanLog()
					player.settings.closecommandlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closecommandlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===3 && setY===1) {
				if(!player.settings.hasOwnProperty("closechatlog")) {
					cleanLog()
					player.settings.closechatlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closechatlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===4 && setY===1) {
				if(!player.settings.hasOwnProperty("closewarninglog")) {
					cleanLog()
					player.settings.closewarninglog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closewarninglog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===5 && setY===1) {
				if(!player.settings.hasOwnProperty("closecodelog")) {
					cleanLog()
					player.settings.closecodelog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closecodelog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===6 && setY===1) {
				if(!player.settings.hasOwnProperty("closecalculatorlog")) {
					cleanLog()
					player.settings.closecalculatorlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closecalculatorlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===7 && setY===1) {
				if(!player.settings.hasOwnProperty("closebotlog")) {
					cleanLog()
					player.settings.closebotlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closebotlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===8 && setY===1) {
				if(!player.settings.hasOwnProperty("closepetallog")) {
					cleanLog()
					player.settings.closepetallog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closepetallog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===9 && setY===1) {
				if(!player.settings.hasOwnProperty("closemoblog")) {
					cleanLog()
					player.settings.closemoblog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closemoblog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===10 && setY===1) {
				if(!player.settings.hasOwnProperty("closeflowerlog")) {
					cleanLog()
					player.settings.closeflowerlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closeflowerlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===11 && setY===1) {
				if(!player.settings.hasOwnProperty("closeturnlog")) {
					cleanLog()
					player.settings.closeturnlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closeturnlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===12 && setY===1) {
				if(!player.settings.hasOwnProperty("closedeterminelog")) {
					cleanLog()
					player.settings.closedeterminelog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closedeterminelog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===13 && setY===1) {
				if(!player.settings.hasOwnProperty("closeresourcelog")) {
					cleanLog()
					player.settings.closeresourcelog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closeresourcelog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===14 && setY===1) {
				if(!player.settings.hasOwnProperty("closelootlog")) {
					cleanLog()
					player.settings.closelootlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closelootlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===15 && setY===1) {
				if(!player.settings.hasOwnProperty("closecraftlog")) {
					cleanLog()
					player.settings.closecraftlog=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				} else {
					cleanLog()
					delete player.settings.closecraftlog
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				}
			}
			if(setX===1 && setY===2) {
				if(!player.settings.hasOwnProperty("dialog")) player.settings.dialog="Middle"
				if(player.settings.dialog==="Slow") {
					player.settings.dialog="Middle"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Middle"))
				} else if(player.settings.dialog==="Middle") {
					player.settings.dialog="Fast"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Fast"))
				} else if(player.settings.dialog==="Fast") {
					player.settings.dialog="Skip"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Skip"))
				} else {
					player.settings.dialog="Slow"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Slow"))
				}
			}
			if(setX===1 && setY===3) {
				if(!player.settings.hasOwnProperty("theme")) player.settings.theme="Classic"
				if(player.settings.theme==="Classic") {
					player.settings.theme="C++"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"C++"))
				} else {
					player.settings.theme="Classic"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Classic"))
				}
			}
			if(setX===2 && setY===3) {
				if(!player.settings.hasOwnProperty("rarity")) player.settings.rarity="Normal"
				if(player.settings.rarity==="Normal") {
					player.settings.rarity="Prefixed"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Prefixed"))
				} else if(player.settings.rarity==="Prefixed") {
					player.settings.rarity="Inverted"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Inverted"))
				} else {
					player.settings.rarity="Normal"
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Normal"))
				}
			}
			if(setX===1 && setY===4) {
				if(!player.settings.hasOwnProperty("alwaysscroll")) {
					player.settings.alwaysscroll=true
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"On"))
				} else {
					delete player.settings.alwaysscroll
					getGrid(5,setX,setY).replaceWith(settingButton(setX,setY,"Off"))
				}
			}
		}
		function howToPlay(open=true) {
			if(animation) return
			if(open && document.getElementById("help").style.display==="flex") {
				howToPlay(false)
				return
			}
			if(!open) {
				document.getElementById("help").style.display="none"
				document.getElementById("helpsvg").setAttribute("d","M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2M35 35A15 15 0 1 1 59 47A22.5 22.5 0 0 0 50 65")
				return
			}
			closeAll()
			selectedGrid.select=false
			closeGridInfo()
			book()
			document.getElementById("help").style.display="flex"
			document.getElementById("helpsvg").setAttribute("d","M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2M50 18L50 62")
			if(player.settings.alwaysscroll===true) document.getElementById("help").scrollTop=0
			document.getElementById("help").focus()
		}
		function openInventory(open=true,force=false) {
			if(animation && !force) return
			if(open && document.getElementById("inventory").style.display==="flex") {
				openInventory(false)
				return
			}
			if(fight.hasOwnProperty("spevent")) {
				return
			}
			if(!open) {
				selectedGrid.select=false
				closeGridInfo()
				document.getElementById("inventory").style.display="none"
				flowerDegree=0
				document.getElementById("flower").style.transform=""
				return
			}
			if(fight.ready===true) return
			closeAll()
			selectedGrid.select=false
			closeGridInfo()
			printInventory()
			flowerSpin=1
			if(dice()===1) flowerSpin=-1
			if(dice()===1) flowerSpin*=3
			if(player.settings.alwaysscroll===true) document.getElementById("inventory").scrollTop=0
		}
		function openGallery(open=true) {
			if(animation) return
			if(open && document.getElementById("gallery").style.display==="flex") {
				openGallery(false)
				return
			}
			if(!open) {
				document.getElementById("gallery").style.display="none"
				document.getElementById("ladybug").style.scale=1.2
				document.getElementById("ladybug-bg").style.display="none"
				ladybugMovement=0
				return
			}
			closeAll()
			selectedGrid.select=false
			closeGridInfo()
			document.getElementById("gallery").innerHTML="<h2>Gallery</h2><span class='nowrap'></span><br>"
			for(let i in MobNameList) if(player.gallery.hasOwnProperty(MobNameList[i])) {
				let galleryLine=document.createElement("div")
				galleryLine.setAttribute("class","cself")
				galleryLine.style.display="flex"
				galleryLine.style.gap="5px"
				for(let j=1;j<=7;j++) {
					if(player.gallery[MobNameList[i]]["rarity"+j+"killed"]>0 || player.gallery[MobNameList[i]]["rarity"+j+"looted"]>0) {
						galleryLine.appendChild(createGrid(4,i,j,"Mob_"+MobNameList[i],1,j))
					} else {
						galleryLine.appendChild(createGrid(4,i,j,"Space",1,0))
					}
				}
				document.getElementById("gallery").appendChild(galleryLine)
				document.getElementById("gallery").appendChild(document.createElement("br"))
			}
			document.getElementById("gallery").style.display="flex"
			document.getElementById("ladybug").style.scale=1
			document.getElementById("ladybug-bg").style.display="flex"
			if(player.settings.alwaysscroll===true) document.getElementById("gallery").scrollTop=0
		}
		function encodeFile(savestr) {
			if(savestr.length%2>0) savestr+="79.76"
			let encodedstr=""
			for(let i=0;i<savestr.length/2;i++) {
				let encodeValue=(savestr[2*i].charCodeAt()-20)*130+(savestr[2*i+1].charCodeAt()-20)
				encodedstr+=String.fromCharCode(65+betterFloor(encodeValue/676))
				encodedstr+=String.fromCharCode(65+betterFloor(encodeValue/26)%26)
				encodedstr+=String.fromCharCode(65+encodeValue%26)
			}
			for(let i=0;i<encodedstr.length;i++) {
				encodedstr[i]=String.fromCharCode(65+(encodedstr[i].charCodeAt()-65+betterFloor((i+1)/(encodedstr.length+1)*354233654))%26)
			}
			return encodedstr
		}
		function decodeFile(encodedstr) {
			let savestr=""
			for(let i=0;i<encodedstr.length;i++) {
				encodedstr[i]=String.fromCharCode(65+(encodedstr[i].charCodeAt()-65-betterFloor((i+1)/(encodedstr.length+1)*354233654))%26)
			}
			for(let i=0;i<encodedstr.length/3;i++) {
				let encodeValue=(encodedstr[3*i].charCodeAt()-65)*676+(encodedstr[3*i+1].charCodeAt()-65)*26+(encodedstr[3*i+2].charCodeAt()-65)
				savestr+=String.fromCharCode(20+betterFloor(encodeValue/130))
				savestr+=String.fromCharCode(20+encodeValue%130)
			}
			if(savestr[savestr.length-1]==="6") savestr=savestr.slice(0,-5)
			return savestr
		}
		function importSave() {
			if(animation) return
			document.querySelectorAll("input[type='file']").forEach(input => input.remove())
			let fileInput=document.createElement("input")
			fileInput.type="file"
			fileInput.accept=".txt"
			fileInput.style.display="none"
			fileInput.addEventListener("change",function(e) {
				let savefile=e.target.files[0]
				if(!savefile) {
					document.body.removeChild(fileInput)
					return
				}
				let reader=new FileReader()
				reader.onload=async function(event) {
					try {
						savefile=JSON.parse(decodeFile(event.target.result))
						if(!(savefile.player&&savefile.explore&&savefile.fight)) throw new Error()
						if(savefile.player.hasOwnProperty("memory")) {
							savefile.player.memory--
						} else {
							savefile.player.memory=3
						}
						if(savefile.player.memory<0) {
							alert("Error: Memory is broken")
							return
						}
						clearAllInterval()
						localStorage.setItem("FLORROOMplayer",JSON.stringify(savefile.player))
						localStorage.setItem("FLORROOMexplore",JSON.stringify(savefile.explore))
						localStorage.setItem("FLORROOMfight",JSON.stringify(savefile.fight))
						document.getElementById("end1").style["pointer-events"]="unset"
						for(let i=0;i<=10;i++) {
							document.getElementById("end1").style.opacity=i/10
							await delay(100)
						}
						location.reload()
					} catch {
						document.body.removeChild(fileInput)
						alert("Error: Memory incomplete")
					}
				}
				reader.readAsText(savefile)
			} )
			document.body.appendChild(fileInput)
			fileInput.click()
		}
		async function exportSave() {
			if(animation) return
			animation=true
			if(player.hasOwnProperty("memory")) player.memory--
			let savefile={player:player,explore:explore,fight:fight}
			if(player.hasOwnProperty("memory")) player.memory++
			let blob=new Blob([encodeFile(JSON.stringify(savefile))],{type:"text/plain"})
			let downloadElement=document.createElement("a")
			downloadElement.href=URL.createObjectURL(blob)
			if(player.memory===0) {
				downloadElement.download="broken memory.txt"
			} else {
				downloadElement.download="memory.txt"
			}
			downloadElement.click()
			document.getElementById("export-btn").innerHTML="Memories Stored!"
			await delay(1000)
			document.getElementById("export-btn").innerHTML="Store Memories"
			if(player.hasOwnProperty("memory")) document.getElementById("export-btn").innerHTML+=" ("+player.memory+")"
			animation=false
		}
		async function hardReset() {
			if(animation) return
			let getResetSentence=prompt("Are you sure to reset the game and lost all process?\nType 'The game is perfect, there are no bugs' to confirm.")
			if(getResetSentence!=="The game is perfect, there are no bugs") return
			clearAllInterval()
			for(let i=0;i<=50;i++) {
				document.getElementById("end1").style.opacity=i/50
				await delay(100)
			}
			document.getElementById("end1").style["pointer-events"]="unset"
			let saveSettings=player.settings
			player=new Object()
			player.settings=saveSettings
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
			localStorage.removeItem("FLORROOMexplore")
			localStorage.removeItem("FLORROOMfight")
			userVersion=version
			localStorage.setItem("FLORROOMuserVersion",JSON.stringify(userVersion))
			document.getElementById("end2").innerText="The story of the Florroom continues..."
			for(let i=0;i<=20;i++) {
				document.getElementById("end2").style.opacity=i/20
				await delay(100)
			}
			await delay(1000)
			for(let i=0;i<=20;i++) {
				document.getElementById("end2").style.opacity=1-i/20
				await delay(100)
			}
			document.getElementById("end2").innerText="Forever."
			for(let i=0;i<=20;i++) {
				document.getElementById("end2").style.opacity=i/20
				await delay(100)
			}
			await delay(2000)
			for(let i=0;i<=20;i++) {
				document.getElementById("end2").style.opacity=1-i/20
				await delay(100)
			}
			await delay(3000)
			location.reload()
		}
		function updateVersion(reset) {
			if(reset===false) {
				if(userVersion<acceptedVersion) {
					document.getElementById("version3").innerHTML="Your version is too outdated..."
					return
				}
				userVersion=version
				localStorage.setItem("FLORROOMuserVersion",JSON.stringify(userVersion))
				location.reload()
			}
			if(reset===true) {
				hardReset()
			}
		}
		function updateGame() {
			console.log("updateGame")
		}
		function getDir(validArray,dir,oldPlaceX,oldPlaceY,placeX=8,placeY=6)
		{
			if(dir===1) {
				for(let i=(oldPlaceY-2)*placeX+oldPlaceX-1;i>=0;i--) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
				for(let i=0;i<placeX*placeY;i++) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
			}
			if(dir===2) {
				for(let i=(oldPlaceY-1)*placeX+oldPlaceX;i<placeX*placeY;i++) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
				for(let i=placeX*placeY-1;i>=0;i--) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
			}
			if(dir===3) {
				for(let i=oldPlaceY*placeX+oldPlaceX-1;i<placeX*placeY;i++) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
				for(let i=placeX*placeY-1;i>=0;i--) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
			}
			if(dir===4) {
				for(let i=(oldPlaceY-1)*placeX+oldPlaceX-2;i>=0;i--) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
				for(let i=0;i<placeX*placeY;i++) {
					for(let j=0;j<validArray.length;j++) if((validArray[j].y-1)*placeX+validArray[j].x-1===i) return validArray[j]
				}
			}
		}
		let letterArray=[" ","1","2","3","4","5","6","7","8","9","0","t","m","r","x","q","h","z","v","u","l","w","d","s","a","-","+"]
		function tryInput(num) {
			if(document.getElementById("end1").style["pointer-events"]==="unset") return
			if(document.getElementById("dialog").style.display==="flex") {
				if(num===0) {
					dialog("Skip",6361)
					return
				}
				if(num===79) {
					dialog("Skip",6361)
					return
				}
			}
			if(animation) return
			if(document.getElementById("map-container").style.display==="unset" && cornerDisplay()===false && flowerMove===false) {
				if(num===0) {
					let connectedArray=new Array()
					connectedArray.push(explore.flowerspot)
					for(let i of mapArray) if(getSpot(i,explore.flowerspot)!==null && getSpot(i,explore.flowerspot).style.display!=="none") connectedArray.push(i)
					let newSpot=connectedArray[(connectedArray.indexOf(selectedSpot)+1)%connectedArray.length]
					closeMapInfo()
					selectedSpot=newSpot
					mapInfo(getSpot(selectedSpot))
					return
				}
				if(num===79) {
					if(selectedSpot>0) chooseMap(getSpot(selectedSpot))
					return
				}
				if(num===81) {
					closeMapInfo()
					return
				}
			}
			if(document.getElementById("help").style.display==="flex" && help.querySelector("input")!==null && num===0) {
				help.querySelector("input").scrollIntoView({block:"nearest"})
				help.querySelector("input").focus()
				return
			}
			if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("equip-btn")!==null && num===79) {
				document.getElementById("equip-btn").onclick()
				return
			}
			if(document.getElementById("gridinfo").style.display==="flex" && selectedGrid.value===0 && cornerDisplay()===false && num===79) {
				clickGrid(getGrid(0,selectedGrid.x,selectedGrid.y))
				return
			}
			if(document.getElementById("inventory").style.display==="flex" && selectedGrid.value===1 && getGrid(1,selectedGrid.x,selectedGrid.y)!==null && num===79) {
				clickGrid(getGrid(1,selectedGrid.x,selectedGrid.y))
				return
			}
			if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("abs-btn")!==null && num===81) {
				document.getElementById("abs-btn").onclick()
				return
			}
			if(document.getElementById("inventory").style.display==="flex" && document.getElementById("absall-btn").style.display==="unset" && selectedGrid.select===false && num===81) {
				document.getElementById("absall-btn").onclick()
				return
			}
			if(trackingGrid && trackingGrid.isConnected && num===79) {
				trackingGrid.onclick()
				return
			}
			if(trackingGrid && trackingGrid.isConnected && num===81) {
				trackingX=0
				trackingY=0
				trackingGrid.onclick()
				return
			}
			if(operingGrid && operingGrid.isConnected && num===79) {
				operingGrid.onclick()
				return
			}
			if(operingGrid && operingGrid.isConnected && num===81) {
				operingX=0
				operingGrid.onclick()
				return
			}
			if(document.getElementById("gridinfo").style.display==="flex" && num===81) {
				selectedGrid.select=false
				closeGridInfo()
				return
			}
			if(document.getElementById("inventory").style.display==="flex" && document.getElementById("lup-cancel").style.display==="unset" && num===81) {
				document.getElementById("lup-cancel").onclick()
				return
			}
			if(num===1) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("equip1-btn")!==null) {
					document.getElementById("equip1-btn").onclick()
					return
				}
				return
			}
			if(num===2) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("equip2-btn")!==null) {
					document.getElementById("equip1-btn").onclick()
					return
				}
				return
			}
			if(num===11) {
				if(cornerDisplay()) return
				if(fight.hasOwnProperty("spevent")) {
					document.getElementById("fight-t-btn").onclick()
					return
				}
				if(!fight.active) return
				document.getElementById("fight-t-btn").onclick()
				return
			}
			if(num===12) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("keym-btn")!==null) {
					document.getElementById("keym-btn").onclick()
					return
				}
				return
			}
			if(num===13) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("keyr-btn")!==null) {
					document.getElementById("keyr-btn").onclick()
					return
				}
				return
			}
			if(num===14) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("keyx-btn")!==null) {
					document.getElementById("keyx-btn").onclick()
					return
				}
				return
			}
			if(num===15) {
				if(trackingGrid && trackingGrid.isConnected) return
				if(operingGrid && operingGrid.isConnected) return
				settings()
				return
			}
			if(num===16) {
				if(trackingGrid && trackingGrid.isConnected) return
				if(operingGrid && operingGrid.isConnected) return
				howToPlay()
				return
			}
			if(num===17) {
				if(trackingGrid && trackingGrid.isConnected) return
				if(operingGrid && operingGrid.isConnected) return
				openInventory()
				return
			}
			if(num===18) {
				if(trackingGrid && trackingGrid.isConnected) return
				if(operingGrid && operingGrid.isConnected) return
				openGallery()
				return
			}
			if(num===19) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("rup-btn")!==null) {
					document.getElementById("rup-btn").onclick()
					return
				}
				return
			}
			if(num===20) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("lup-btn")!==null) {
					document.getElementById("lup-btn").onclick()
					return
				}
				if(document.getElementById("inventory").style.display==="flex" && document.getElementById("lup-confirm").style.display==="unset") {
					document.getElementById("lup-confirm").onclick()
					return
				}
				return
			}
			if(num>=21 && num<=24) {
				if(document.getElementById("help").style.display==="flex") {
					if(num===22) book(1)
					if(num===24) book(-1)
					return
				}
				if(document.getElementById("inventory").style.display==="flex") {
					if(document.getElementById("inv-petal").children.length===0) return
					let selectedIndex=-1,newIndex=-1
					if(selectedGrid.value===1) {
						for(let i=0;i<document.getElementById("inv-petal").children.length;i++) {
							let pendingGrid=document.getElementById("inv-petal").children[i]
							if(pendingGrid===getGrid(1,selectedGrid.x,selectedGrid.y)) selectedIndex=i
						}
					}
					if(selectedIndex===-1) {
						newIndex=0
					} else {
						if(num===21) {
							for(let i=0;i<selectedIndex;i++) if(Math.abs(document.getElementById("inv-petal").children[selectedIndex].getBoundingClientRect().left-document.getElementById("inv-petal").children[i].getBoundingClientRect().left)<1) newIndex=i
							if(newIndex===-1) newIndex=0
						}
						if(num===22) newIndex=Math.min(selectedIndex+1,document.getElementById("inv-petal").children.length-1)
						if(num===23) {
							for(let i=document.getElementById("inv-petal").children.length-1;i>selectedIndex;i--) if(Math.abs(document.getElementById("inv-petal").children[selectedIndex].getBoundingClientRect().left-document.getElementById("inv-petal").children[i].getBoundingClientRect().left)<1) newIndex=i
							if(newIndex===-1) newIndex=document.getElementById("inv-petal").children.length-1
						}
						if(num===24) newIndex=Math.max(selectedIndex-1,0)
					}
					selectedGrid.select=false
					selectedGrid.value=1
					selectedGrid.x=parseInt(document.getElementById("inv-petal").children[newIndex].dataset.x)
					selectedGrid.y=document.getElementById("inv-petal").children[newIndex].dataset.y
					justifyInventory(getGrid(1,selectedGrid.x,selectedGrid.y))
					gridInfo(document.getElementById("inv-petal").children[newIndex])
					return
				}
				if(trackingGrid && trackingGrid.isConnected) {
					if(getGrid(2,0,0)!==null) {
						trackingY=-1
						trackingGrid.style.top=getGrid(2,0,0).getBoundingClientRect().top+40+"px"
						trackingGrid.style.left=getGrid(2,0,0).getBoundingClientRect().left+40+"px"
					}
					let validArray=new Array()
					for(let i=1;i<=8;i++) for(let j=1;j<=6;j++) if(trackCheck(i,j)) validArray.push({x:i,y:j})
					if(validArray.length===0) return
					let newCord=getDir(validArray,num-20,trackingX,trackingY)
					trackingX=newCord.x
					trackingY=newCord.y
					trackingGrid.style.top=getGrid(0,trackingX,trackingY).getBoundingClientRect().top+40+"px"
					trackingGrid.style.left=getGrid(0,trackingX,trackingY).getBoundingClientRect().left+40+"px"
					return
				}
				if(operingGrid && operingGrid.isConnected) {
					let validArray=new Array()
					for(let i=1;i<=8;i++) for(let j=1;j<=6;j++) if(operCheck(i,j)) validArray.push({x:i,y:j})
					if(validArray.length===0) return
					let newCord=getDir(validArray,num-20,operingX,operingY)
					operingX=newCord.x
					operingY=newCord.y
					operingGrid.style.top=getGrid(0,operingX,operingY).getBoundingClientRect().top+40+"px"
					operingGrid.style.left=getGrid(0,operingX,operingY).getBoundingClientRect().left+40+"px"
					updateT()
					return
				}
				if(document.getElementById("fight-container").style.display==="grid") {
					if(selectedGrid.value!==0) {
						selectedGrid.value=0
						selectedGrid.x=0
						selectedGrid.y=0
					}
					let validArray=new Array()
					for(let i=1;i<=8;i++) for(let j=1;j<=6;j++) if(getGrid(0,i,j).children[0].innerHTML!=="Empty") {
						if(fight.hasOwnProperty("spevent") && fight.spevent.event>=101 && fight.spevent.event<=109 && j>1 && j<6) continue
						validArray.push({x:i,y:j})
					}
					if(validArray.length===0) return
					let newCord=getDir(validArray,num-20,selectedGrid.x,selectedGrid.y)
					selectedGrid.x=newCord.x
					selectedGrid.y=newCord.y
					gridInfo(getGrid(0,selectedGrid.x,selectedGrid.y))
					return
				}
				return
			}
			if(num===25) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("star-btn1")!==null) {
					document.getElementById("star-btn1").onclick()
					return
				}
				return
			}
			if(num===26) {
				if(document.getElementById("gridinfo").style.display==="flex" && document.getElementById("star-btn2")!==null) {
					document.getElementById("star-btn2").onclick()
					return
				}
				return
			}
		}
		document.addEventListener("keydown",function(pressed) {
			if(pressed.target.tagName==="INPUT") {
				if(pressed.target.value==="" && pressed.key==="Backspace") {
					if(document.getElementById("help").style.display==="flex") document.getElementById("help").focus()
					pressed.target.blur()
				}
				return
			}
			if(letterArray.indexOf(pressed.key.toLowerCase())>=0) {
				tryInput(letterArray.indexOf(pressed.key.toLowerCase()))
				if(document.getElementById("help").style.display==="flex" && pressed.key===" ") pressed.preventDefault()
				return
			}
			if(pressed.key.startsWith("Arrow")) {
				if(pressed.key==="ArrowUp") tryInput(21)
				if(pressed.key==="ArrowRight") tryInput(22)
				if(pressed.key==="ArrowDown") tryInput(23)
				if(pressed.key==="ArrowLeft") tryInput(24)
				return
			}
			if(pressed.key==="_") {
				tryInput(25)
				return
			}
			if(pressed.key==="=") {
				tryInput(26)
				return
			}
			if(pressed.key==="Enter") {
				tryInput(79)
				return
			}
			if(pressed.key==="Backspace") {
				tryInput(81)
				return
			}
			if(pressed.key==="Escape") {
				safeReload()
				return
			}
		} )
		let intervalFlower,intervalCalendar
		function clearAllInterval() {
			clearInterval(intervalFlower)
			clearInterval(intervalCalendar)
		}
		window.onload=async function() {
			document.getElementById("end1").style["pointer-events"]="unset"
			document.getElementById("version1").style.display="none"
			document.getElementById("version2").style.display="none"
			document.getElementById("endgame1").style.display="none"
			document.getElementById("endgame2").style.display="none"
			if(userVersion!==version) {
				document.getElementById("version1").style.display="unset"
				document.getElementById("version2").style.display="flex"
				for(let i=0;i<=10;i++) {
					document.getElementById("end1").style.opacity=1-i/10
					await delay(100)
				}
				document.getElementById("end1").style["pointer-events"]="none"
				return
			}
			if(gameEnded()) return
			if(player.settings.theme==="C++") {
				document.body.classList.add("dgrey-bg")
				for(let i in PetalSVGArray) PetalSVGArray[i]=PetalSVGArray[i].replace(/<g>.+<\/g>/,"<g></g>").replace("20px)","0px); font-family: Consolas")
				for(let i in MobSVGArray) MobSVGArray[i]=MobSVGArray[i].replace(/<g>.+<\/g>/,"<g></g>").replace("20px)","0px); font-family: Consolas")
				document.getElementById("gridinfo").style["font-family"]="Consolas"
			}
			if(player.settings.rarity==="Prefixed") {
				rarityName=["Une","Ummon","Unusual","Ure","Upic","Ugendary","Uthic","Ultra","Uper","Unique"]
			}
			if(player.settings.rarity==="Inverted") {
				rarityColor=["#000000","#2bffa3","#ff2b75","#1fdbde","#de1f1f","#861fde","#4d52e3","#ffe65d","#7eef6d","#555555"]
				rarityName=["None","Super","Ultra","Mythic","Legendary","Epic","Rare","Unusual","Common","Unique"]
			}
			setInterval(cogRotate,10)
			setInterval(flowerRotate,10)
			setInterval(cleanerRotate,10)
			document.getElementById("ladybug").style.scale=1.2
			document.getElementById("ladybug").style.transform="rotate("+ladybugDegree+"deg)"
			document.getElementById("ladybug-bg").style.transform="translate(-"+ladybugX+"px, -"+ladybugY+"px)"
			setInterval(ladybugMove,10)
			for(let i=1;i<=3;i++) {
				for(let j=1;j<=8;j++) {
					document.getElementById("fight-container").appendChild(createGrid(0,j,i,"Empty",1))
				}
			}
			for(let i=1;i<=8;i++) {
				document.getElementById("fight-container").appendChild(createGrid(0,i,0,"Line",1))
				getGrid(0,i,0).style["pointer-events"]="none"
			}
			for(let i=4;i<=6;i++) {
				for(let j=1;j<=8;j++) {
					document.getElementById("fight-container").appendChild(createGrid(0,j,i,"Empty",1))
				}
			}
			homeElement=document.getElementById("home-btn")
			homeFlowerElement=document.getElementById("flower-btn")
			setContainElement()
			intervalFlower=setInterval(updateFlowerSpot,10)
			createPath()
			book()
			mapElement.querySelectorAll("path[d*='A2']").forEach(path => {
				path.addEventListener("mouseenter",() => mapInfo(path))
				path.addEventListener("mouseleave",closeMapInfo)
			} )
			if(fight.active===true && fight.ready===false) endFight()
			if(fight.manipulate===true) endFight()
			if(fight.active===true && player.calendar.second>0) endFight()
			if(player.calendar.second>0) player.calendar.second=120
			if(player.hasOwnProperty("memory")) document.getElementById("export-btn").innerHTML+=" ("+player.memory+")"
			document.addEventListener("keydown",(e) => {
				if((e.key===" " || e.key==="Enter") && e.target.tagName==="BUTTON") {
					e.preventDefault()
					e.stopPropagation()
				}
			} )
			document.addEventListener("contextmenu",(e) => {
				e.preventDefault()
			} )
			animation=true
			document.getElementById("end2").innerText="Welcome to the Florroom!"
			for(let i=0;i<=10;i++) {
				document.getElementById("end2").style.opacity=i/10
				await delay(100)
			}
			await delay(1000)
			for(let i=0;i<=10;i++) {
				document.getElementById("end2").style.opacity=1-i/10
				await delay(100)
			}
			for(let i=0;i<=10;i++) {
				document.getElementById("end1").style.opacity=1-i/10
				await delay(100)
			}
			document.getElementById("end1").style["pointer-events"]="none"
			animation=false
			if(!explore.explored[10]) {
				displayCentralRoom()
			} else if(fight.active===true) {
				displayFightField()
				displayFight()
				if(explore.floor>=1) explore.energy=fight.energy
			} else {
				displayMapItem()
				displayMap()
			}
			player.calendar.start=Date.now()
			intervalCalendar=setInterval(updateCalendar,10)
			document.getElementById("flower-effect").style.bottom="35px"
			updateFlowerState()
			addLog("Use .help for command information!")
			if(explore.event.evolutionaryguide===1) dialog("Skip")
			if(explore.event.evolutionaryguide===3) dialog("Skip")
			if(explore.event.artisanguide===1) dialog("Skip")
			if(explore.event.artisanguide===3) dialog("Skip")
		}
		let selectedGrid=new Object()
		selectedGrid.select=false
		let updatingCalendar=false
		function updateCalendar() {
			let tickTime=100
			if(player.item.hasOwnProperty("Time Shard")) tickTime*=(1+0.1*player.item["Time Shard"])
			let timePassed=Date.now()-player.calendar.start
			if(timePassed<tickTime) return
			if(updatingCalendar) return
			updatingCalendar=true
			player.calendar.second+=betterFloor(timePassed/tickTime)
			player.calendar.start+=betterFloor(timePassed/tickTime)*tickTime
			let calendarFlag=true
			while(calendarFlag) {
				calendarFlag=false
				if(player.calendar.second>0 && player.calendar.minute<=79) {
					player.calendar.second--
					player.calendar.minute++
					calendarFlag=true
				}
				if(player.calendar.minute>79 && player.calendar.hour<79) {
					player.calendar.minute=1
					player.calendar.hour++
					calendarFlag=true
				}
				if(player.calendar.day<79 && player.calendar.hour===79 && player.calendar.minute===80) {
					player.calendar.second+=120
					calendarFlag=true
				}
				if(player.calendar.second>=120 && player.calendar.hour===79 && player.calendar.minute===80) {
					player.calendar.second=0
					player.calendar.minute=1
					player.calendar.hour=1
					player.calendar.day++
					document.getElementById("end1").style.opacity=0
					document.getElementById("end1").style["pointer-events"]="none"
					calendarFlag=true
				}
				if(player.calendar.second>0 && player.calendar.minute===80) {
					document.getElementById("end1").style["pointer-events"]="unset"
					if(player.calendar.second<=5) document.getElementById("end1").style.opacity=0.2*player.calendar.second
					if(player.calendar.second>=115) document.getElementById("end1").style.opacity=0.2*(120-player.calendar.second)
					if(player.calendar.second===10) document.getElementById("end2").innerText="Sleeping..."
					if(player.calendar.second>10 && player.calendar.second<=20) document.getElementById("end2").style.opacity=0.1*(player.calendar.second-10)
					if(player.calendar.second>=100 && player.calendar.second<110) document.getElementById("end2").style.opacity=0.1*(110-player.calendar.second)
					if(player.calendar.second===110) document.getElementById("end2").innerText=""
					if(player.calendar.second===5 && fight.active) {
						localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
						location.reload()
					}
					if(player.calendar.second===5 && explore.floor===0 && player.calendar.day>=79) {
						localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
						location.reload()
					}
					if(player.calendar.second===5 && explore.floor===1 && player.calendar.day>=79) {
						localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
						location.reload()
					}
				}
			}
			if(player.calendar.day<70) {
				document.getElementById("calendar-day").setAttribute("class","green")
			} else if(player.calendar.day<77) {
				document.getElementById("calendar-day").setAttribute("class","yellow")
			} else if(player.calendar.day<79) {
				document.getElementById("calendar-day").setAttribute("class","red")
			} else {
				document.getElementById("calendar-day").setAttribute("class","grey")
			}
			if(player.calendar.hour<=50) {
				document.getElementById("calendar-hour").setAttribute("class","green")
				document.getElementById("calendar-minute").setAttribute("class","green")
			} else if(player.calendar.hour<=70) {
				document.getElementById("calendar-hour").setAttribute("class","yellow")
				document.getElementById("calendar-minute").setAttribute("class","yellow")
			} else if(player.calendar.minute<=79) {
				document.getElementById("calendar-hour").setAttribute("class","red")
				document.getElementById("calendar-minute").setAttribute("class","red")
			} else {
				document.getElementById("calendar-hour").setAttribute("class","grey")
				document.getElementById("calendar-minute").setAttribute("class","grey")
			}
			document.getElementById("calendar-day").innerHTML="Day "+player.calendar.day
			document.getElementById("calendar-hour").innerHTML=player.calendar.hour
			if(player.calendar.hour<10) document.getElementById("calendar-hour").innerHTML="0"+player.calendar.hour
			document.getElementById("calendar-minute").innerHTML=Math.min(player.calendar.minute,79)
			if(player.calendar.minute<10) document.getElementById("calendar-minute").innerHTML="0"+player.calendar.minute
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
			localStorage.setItem("FLORROOMfight",JSON.stringify(fight))
			document.getElementById("calendar").style.display="flex"
			updatingCalendar=false
		}
		let drag=false,dragX=0,dragY=0,mapcX=0,mapcY=0,containElement,mapElement,homeElement,homeFlowerElement,scaleSize
		function setContainElement() {
			containElement=document.getElementById("map-container")
			mapElement=document.getElementById("map-trans")
			containElement.addEventListener("mousedown",function(mouse) {
				if(mouse.target.id!=="blank") return
				closeMapInfo()
				drag=true
				dragX=mouseX
				dragY=mouseY
			} )
			document.addEventListener("mousemove",function(mouse) {
				if(drag!==true) return
				mapcX+=(mouseX-dragX)*100/scaleSize,dragX=mouseX
				mapcY+=(mouseY-dragY)*100/scaleSize,dragY=mouseY
				mapElement.style.transform="translate("+mapcX+"px, "+mapcY+"px)"
				updateHome()
			} )
			document.addEventListener("mouseup",function() {
				drag=false
			} )
		}
		function updateHome() {
			scaleSize=Math.min(parseFloat(window.getComputedStyle(containElement).height),parseFloat(window.getComputedStyle(containElement).width))
			let scaledX=mapcX/parseFloat(window.getComputedStyle(containElement).width)
			let scaledY=mapcY/parseFloat(window.getComputedStyle(containElement).height)
			let scaledX2=scaledX+(flowerSpotX-50)/parseFloat(window.getComputedStyle(containElement).width)
			let scaledY2=scaledY+(flowerSpotY-50)/parseFloat(window.getComputedStyle(containElement).height)
			let scaleDistance=Math.max(Math.abs(scaledX),Math.abs(scaledY))
			let scaleDistance2=Math.max(Math.abs(scaledX2),Math.abs(scaledY2))
			if(Math.abs(scaledX)*scaleSize<50 && Math.abs(scaledY)*scaleSize<50) {
				homeElement.style.display="none"
			} else {
				homeElement.style.left=50+scaledX/scaleDistance*40+"%"
				homeElement.style.top=50+scaledY/scaleDistance*40+"%"
				homeElement.style.display="unset"
			}
			if((Math.abs(scaledX2)*scaleSize<50 && Math.abs(scaledY2)*scaleSize<50) || (flowerSpotX===50 && flowerSpotY===50)) {
				homeFlowerElement.style.display="none"
			} else {
				homeFlowerElement.style.left=50+scaledX2/scaleDistance2*40+"%"
				homeFlowerElement.style.top=50+scaledY2/scaleDistance2*40+"%"
				homeFlowerElement.style.display="unset"
			}
		}
		function home(target) {
			if(target==="origin") {
				mapcX=0
				mapcY=0
				mapElement.style.transform=""
				updateHome()
			}
			if(target==="flower") {
				mapcX=50-flowerSpotX
				mapcY=50-flowerSpotY
				mapElement.style.transform="translate("+mapcX+"px, "+mapcY+"px)"
				updateHome()
			}
		}
		function getSpotCord(value) {
			let spotD=document.querySelector("path[value='"+value+"']").getAttribute("d")
			let spotCord=new Object()
			spotCord.x=parseInt(/(?<=M)\d+/.exec(spotD))
			if(isNaN(spotCord.x)) spotCord.x=-parseInt(/(?<=M-)\d+/.exec(spotD))
			spotCord.y=parseInt(/(?<=M-?\d+\s)\d+/.exec(spotD))+2
			if(isNaN(spotCord.y)) spotCord.y=-parseInt(/(?<=M-?\d+\s-)\d+/.exec(spotD))+2
			return spotCord
		}
		function distance(cord1,cord2) {
			if(typeof(cord1)==="string") cord1=parseInt(cord1)
			if(typeof(cord2)==="string") cord2=parseInt(cord2)
			if(cord1===cord2) return 0
			if(pathArray.indexOf(cord1*100+cord2)===-1 && pathArray.indexOf(cord2*100+cord1)===-1) return -1
			let disx=getSpotCord(cord2).x-getSpotCord(cord1).x,disy=getSpotCord(cord2).y-getSpotCord(cord1).y,disv=(disx*disx+disy*disy)**0.5+20
			if(cord1-cord1%10!==cord2-cord2%10) disv=disv*1.5+50
			return betterFloor(disv)
		}
		function createPath() {
			for(let i in pathArray) {
				let pathStart=betterFloor(pathArray[i]/100),pathEnd=pathArray[i]%100,newPath=document.createElementNS(svgNS,"path")
				newPath.setAttribute("value",pathArray[i])
				if(pathEnd-pathEnd%10!==pathStart-pathStart%10) {
					newPath.setAttribute("class","grey-path pointer narrow")
				} else if(pathStart<20) {
					newPath.setAttribute("class","lgreen-path pointer narrow")
				} else if(pathStart<30) {
					newPath.setAttribute("class","yellow-path pointer narrow")
				} else if(pathStart<40) {
					newPath.setAttribute("class","blue-path pointer narrow")
				} else if(pathStart<50) {
					newPath.setAttribute("class","dbrown-path pointer narrow")
				} else if(pathStart<60) {
					newPath.setAttribute("class","dbrown-path pointer narrow")
				} else {
					newPath.setAttribute("class","dgreen-path pointer narrow")
				}
				newPath.setAttribute("d","M"+getSpotCord(pathStart).x+" "+getSpotCord(pathStart).y+"L"+getSpotCord(pathEnd).x+" "+getSpotCord(pathEnd).y)
				mapElement.insertBefore(newPath,mapElement.children[i])
			}
			if(explore.highest<100) {
				let highestPlace=tutorialOrder.indexOf(explore.highest)
				mapElement.querySelectorAll("path[value]").forEach(path => {
					let pathValue=parseInt(path.getAttribute("value"))
					if(pathValue<100) {
						let pathOrder=tutorialOrder.indexOf(pathValue)
						if(pathOrder===-1 || pathOrder>highestPlace+1) path.style.display="none"
					} else {
						let pathOrder1=tutorialOrder.indexOf(pathValue%100)
						let pathOrder2=tutorialOrder.indexOf(betterFloor(pathValue/100))
						if(pathOrder1===-1 || pathOrder1>highestPlace+1 || pathOrder2===-1 || pathOrder2>highestPlace+1) path.style.display="none"
					}
				} )
			}
		}
		let flowerMove=false,flowerMoveStartTime=Date.now(),flowerSpotX=0,flowerSpotY=0,selectedSpot=0
		function travel(spot) {
			if(animation) return
			explore.floweroldspot=explore.flowerspot
			explore.flowerspot=spot
			flowerMoveStartTime=Date.now()
			flowerMove=true
		}
		function updateFlowerSpot(force=false) {
			if(document.getElementById("flowerspot").style.transform==="" || force===true) {
				flowerSpotX=getSpotCord(explore.flowerspot).x
				flowerSpotY=getSpotCord(explore.flowerspot).y
				document.getElementById("flowerspot").style.transform="translate("+(flowerSpotX-50)+"px, "+(flowerSpotY-50)+"px)"
				updateHome()
				return
			}
			if(flowerMove===false) return
			let distancePassed=(Date.now()-flowerMoveStartTime)/100/distance(explore.floweroldspot,explore.flowerspot)
			if(distancePassed>=1) {
				flowerSpotX=getSpotCord(explore.flowerspot).x
				flowerSpotY=getSpotCord(explore.flowerspot).y
				document.getElementById("flowerspot").style.transform="translate("+(flowerSpotX-50)+"px, "+(flowerSpotY-50)+"px)"
				updateHome()
				flowerMove=false
				if(explore.explored[explore.flowerspot]===false) {
					startFight()
				}
				localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
				return
			}
			flowerSpotX=(1-distancePassed)*getSpotCord(explore.floweroldspot).x+distancePassed*getSpotCord(explore.flowerspot).x
			flowerSpotY=(1-distancePassed)*getSpotCord(explore.floweroldspot).y+distancePassed*getSpotCord(explore.flowerspot).y
			document.getElementById("flowerspot").style.transform="translate("+(flowerSpotX-50)+"px, "+(flowerSpotY-50)+"px)"
			updateHome()
		}
		function getSpot(spotValue,spotValue2) {
			if(spotValue2!==undefined) spotValue=spotValue+spotValue2+99*Math.min(spotValue,spotValue2)
			return document.getElementById("map-trans").querySelector("[value='"+spotValue+"']")
		}
		function chooseMap(spot) {
			if(animation) return
			if(flowerMove) return
			let spotValue=parseInt(spot.getAttribute("value"))
			closeMapInfo()
			if(distance(explore.flowerspot,spotValue)===-1) return
//todo
			if(explore.floor===1 && explore.flowerspot>60) return
//delete this after update
			if(spotValue===explore.flowerspot) {
				if(explore.floor===0 && explore.flowerspot===11 && explore.event.hasOwnProperty("evolutionaryguide") && explore.event.evolutionaryguide!=="Completed") {
					startFight()
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					return
				}
				if(explore.floor===0 && explore.flowerspot===21 && explore.event.hasOwnProperty("artisanguide") && explore.event.artisanguide!=="Completed") {
					startFight()
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					return
				}
				if(explore.floor===1 && explore.flowerspot===10) {
					explore.explored[10]=false
					delete explore.event.floor1exitcentral
					displayCentralRoom()
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					return
				}
				return
			}
			travel(spotValue)
		}
		function mapInfo(spot) {
			if(flowerMove) return
			let spotValue=parseInt(spot.getAttribute("value"))
			if(distance(explore.flowerspot,spotValue)===-1) return
			document.getElementById("mapinfo").style.setProperty("--transform2","translate(0%,-50%)")
			document.getElementById("mapinfo").style.top=spot.getBoundingClientRect().top-15+"px"
			document.getElementById("mapinfo").style.left=spot.getBoundingClientRect().left+spot.getBoundingClientRect().width/2+"px"
			let mapInfoTitleColor=["#000000","#9fdf9f","#dfdf7f","#7f7fdf","#9f3f3f","#9f3f3f","#3f9f3f"]
			let editingMapHTML="<h3 style='color: "+mapInfoTitleColor[betterFloor(spotValue/10)]+"'>"+MapNameList[spotValue]+"</h3>"
			if(spotValue===67) {
				for(let i=0;i<3;i++) editingMapHTML+="<span>Boss "+(i+1)+": "+MobNameList[100+explore.floorboss[i]]+"</span>"
			} else if(explore.explored[spotValue]) {
				editingMapHTML+="<span>You already cleared this spot.</span>"
			} else {
				editingMapHTML+="<span style='color: "+rarityColor[MapRarityList[spotValue]+1]+"'>Map Rarity: "+MapRarityList[spotValue]+"</span>"
				editingMapHTML+="<span style='color: "+rarityColor[MapRarityList[spotValue]+1]+"'>Map Density: "+MapDensityList[spotValue]+"</span>"
				let pendingMob=MapSpawnList[spotValue].split("&")
				for(let i in pendingMob) {
					editingMapHTML+="<span>"+pendingMob[i].match(/.+(?==)/)+": "+pendingMob[i].match(/\d+/)+"%</span>"
				}
			}
			editingMapHTML+="<br>"
			if(distance(explore.flowerspot,spotValue)>0) {
				editingMapHTML+="<span>Spot Distance: "+distance(explore.flowerspot,spotValue)+"</span><br>"
			}
			if(explore.floor===0 && spotValue===11 && explore.event.hasOwnProperty("evolutionaryguide") && explore.event.evolutionaryguide!=="Completed") {
				editingMapHTML+="<span style='color: #bf7fbf; font-weight: bold'>Special Event: You noticed a book under a boulder...</span><br>"
			}
			if(explore.floor===0 && spotValue===21 && explore.event.hasOwnProperty("artisanguide") && explore.event.artisanguide!=="Completed") {
				editingMapHTML+="<span style='color: #bf7fbf; font-weight: bold'>Special Event: You remembered the words on book...</span><br>"
			}
			if(explore.floor===1 && spotValue===10) {
				editingMapHTML+="<span style='color: #bf7fbf; font-weight: bold'>Special Event: Go back to central room.</span><br>"
			}
			document.getElementById("mapinfo").innerHTML=editingMapHTML
			document.getElementById("mapinfo").style.display="flex"
		}
		function closeMapInfo() {
			selectedSpot=0
			document.getElementById("mapinfo").style.display="none"
		}
		function petalTextReplace(text,petal) {
			text=text.replaceAll("&","</span>").replaceAll("TYPE","<span style='color: #000000'>Type: ").replaceAll("NAME=","<span style='color: #000000'>Name: ").replaceAll("LOOT=","<span style='color: #0000ff'>How to loot: ").replaceAll("DECORATION","<span style='color: #bfbfbf'>This petal is a decoration, which means it has no entity.").replaceAll(/COUNT=(\d+)/g,"<span style='color: #7f7f9f'>This petal has a quantity of "+petal.count+"/$1 parts").replaceAll("ATTRIBUTE=","<span style='color: #bfbf7f'>Petal attribute: ").replaceAll("EQUIP=","<span style='color: #bfbfff'>When equipped: ").replaceAll("EXIST=","<span style='color: #ffffff'>While exist: ").replaceAll("ATTACK=","<span style='color: #ff7f7f'>When attack: ").replaceAll("DEFEND=","<span style='color: #7fdf7f'>When defend: ").replaceAll("ATKDEF=","<span style='color: #df7fdf'>When attack or defend: ").replaceAll("SHOOT=","<span style='color: #7f7fff'>When shoot: ").replaceAll("SKILL=","<span style='color: #7fdfdf'>Special skill: ").replaceAll("STATURN=","<span style='color: #5fdfff'>At start of turn: ").replaceAll("ENDTURN=","<span style='color: #5fdfff'>At end of turn: ").replaceAll("DAMAGE=","<span style='color: #bf5f5f'>When destroyed a part: ").replaceAll("DESTROY=","<span style='color: #df3f3f'>When destroyed: ")+"</span>"
			text=text.replaceAll("[poison]","<span style='font-weight: bold; color: #bf00bf; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>poison</span>").replaceAll("[lightning]","<span style='font-weight: bold; color: #7fffff; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>lightning</span>").replaceAll("Dice","").replaceAll("[","<span style='font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>").replaceAll("]","</span>").replaceAll(/(?<!\.\s)(?<!^)Damage/g,"<span style='color: #ff7f7f'>"+petal.damage+"</span>").replaceAll(/(?<!\.\s)(?<!^)Health/g,"<span style='color: #7fdf7f'>"+petal.health+"</span>").replaceAll(/(?<!\.\s)(?<!^)Rarity/g,"<span style='color: #00dfff'>"+petal.rarity+"</span>").replaceAll(/(?<!\.\s)(?<!^)Level/g,"<span style='color: #9f5fff'>"+petal.level+"</span>").replaceAll("X","<span style='color: #9f5f9f'>"+(petal.calculate>0?petal.calculate:"X")+"</span>")
			if(!player.clover) text=text.replaceAll("quadruples health and damage and doubles knockback (once in a fight), reloads all petals and sets their action to 250 (except 1-speed petal)","???")
			if(petal.name==="Compass") {
				let dirEnglish=["specified","North","East","South","West"]
				text=text.replaceAll("specified",dirEnglish[petal.calculate])
			}
			if(explore.floor<1) {
				text=text.replaceAll("divides energy loss by 3","???")
				text=text.replaceAll("triples energy loss","???")
				text=text.replaceAll("immune energy loss","???")
			}
			if(explore.floor<somerandomlimit3) {
				text=text.replaceAll("the restriction on that direction is removed","???")
			}
			if(explore.floor<somerandomlimit4) {
				text=text.replaceAll(/Decreases mind by <.+>(?=\.)/g,"???")
			}
			return text
		}
		function mobTextReplace(text,mob) {
			text=text.replaceAll("&","</span>").replaceAll("BOSS","<span style='font-weight: bold; color: #bfbfbf'>This mob is a boss.").replaceAll(/COUNT=(\d+)/g,"<span style='color: #7f7f9f'>This mob has "+mob.count+" remaining lives.").replaceAll("ATTRIBUTE=","<span style='color: #bfbf7f'>Mob attribute: ").replaceAll("STATURN=","<span style='color: #5fdfff'>At start of turn: ").replaceAll("EXIST=","<span style='color: #ffffff'>While exist: ").replaceAll("HOSTILE=","<span style='color: #7fbfbf'>Chance becoming hostile: ").replaceAll("ACTION=","<span style='color: #bfbf3f'>Mob action: ").replaceAll("ATTACK=","<span style='color: #ff7f7f'>When attack: ").replaceAll("CHARAC=","<span style='color: #df7fdf'>Characteristic: ").replaceAll("DAMAGE=","<span style='color: #bf5f5f'>When destroyed a part: ").replaceAll("DESTROY=","<span style='color: #df3f3f'>When destroyed: ")+"</span>"
			text=text.replaceAll("[poison]","<span style='font-weight: bold; color: #bf00bf; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>poison</span>").replaceAll("[lightning]","<span style='font-weight: bold; color: #7fffff; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>lightning</span>").replaceAll("[","<span style='font-weight: bold; text-shadow: 1px 1px 3px rgba(0,0,0,0.7)'>").replaceAll("]","</span>").replaceAll(/(?<!\.\s)(?<!^)Damage/g,"<span style='color: #ff7f7f'>"+mob.damage+"</span>").replaceAll(/(?<!\.\s)(?<!^)Health/g,"<span style='color: #7fdf7f'>"+mob.health+"</span>").replaceAll("X","<span style='color: #9f5f9f'>"+mob.calculate+"</span>")
			return text
		}
		function petalEffectText(effectName,effectValue) {
			if(effectName==="immunity") {
				let pendingText="<span style='color: #5fbf5f'>Effect--Immunity: Immunes all damage for "+effectValue+" turn.</span>"
				return pendingText
			}
			if(effectName==="restraint") {
				let pendingText="<span style='color: #ffbf3f'>Effect--Restraint: Action gain is halved for "+effectValue+" time.</span>"
				return pendingText
			}
			if(effectName==="sprout") {
				let pendingText="<span style='color: #7f7fff'>Effect--Sprout: Max health is "+approx(0.8**effectValue*1000)/10+"% of original value and Size is reduced by "+effectValue+".</span>"
				return pendingText
			}
			if(effectName==="refresh") {
				let pendingText="<span style='color: #3fbfff'>Effect--Refresh Chance: Skill for this petal is available.</span>"
				return pendingText
			}
			if(effectName==="stagger") {
				let pendingText="<span style='color: #bf3fff'>Effect--Stagger: Releases "+effectValue[0]+" damage for next turn, "+effectValue.length+" turn remaining.</span>"
				return pendingText
			}
			if(effectName==="lucky") {
				let pendingText="<span style='color: #00ff00'>Effect--Lucky: You are lucky!</span>"
				return pendingText
			}
			if(effectName==="resistance") {
				let pendingText="<span style='color: #7f7fff'>Effect--Restraint: Reduces physical damage received by "+effectValue+".</span>"
				return pendingText
			}
			if(effectName==="surge") {
				let pendingText="<span style='color: #7f7fff'>Effect--Surge: Increases resulting damage by "+effectValue+"%.</span>"
				return pendingText
			}
		}
		function mobEffectText(effectName,effectValue) {
			if(effectName==="poison") {
				let pendingText="<span style='color: #bf3fff'>Effect--Poison: "+effectValue[0]+" damage for next turn, "+effectValue.length+" turn remaining.</span>"
				return pendingText
			}
			if(effectName==="immunity") {
				let pendingText="<span style='color: #5fbf5f'>Effect--Immunity: Immunes all damage for "+effectValue+" turn.</span>"
				return pendingText
			}
			if(effectName==="suppression") {
				let pendingText="<span style='color: #ffffff'>Effect--Suppression: Healing disabled for "+effectValue.turn+" turn.</span>"
				return pendingText
			}
			if(effectName==="vulnerability") {
				let pendingText="<span style='color: #bf3fff'>Effect--Vulnerability: "+effectValue[0]+" armor debuff for next turn, "+effectValue.length+" turn remaining.</span>"
				return pendingText
			}
			if(effectName==="restraint") {
				let pendingText="<span style='color: #ffbf3f'>Effect--Restraint: Action gain is halved (25% for Boss) for "+effectValue+" time.</span>"
				return pendingText
			}
			if(effectName==="debilitation") {
				let pendingText="<span style='color: #ff3fbf'>Effect--Debilitation: Speed is halved for "+effectValue+" turn.</span>"
				return pendingText
			}
			if(effectName==="noloot") {
				let pendingText="<span style='color: #7f7f7f'>Effect--No Loot: This mob drops no loot when killed.</span>"
				return pendingText
			}
			if(effectName==="slowness") {
				let pendingText="<span style='color: #bfbf3f'>Effect--Slowness: Action gain is decreased by "+effectValue+".</span>"
				return pendingText
			}
			if(effectName==="quickness") {
				let pendingText="<span style='color: #bfbf3f'>Effect--Quickness: Action gain is increased by "+effectValue*20+"% of original speed.</span>"
				return pendingText
			}
			if(effectName==="pearl") {
				let pendingText="<span style='color: #7f7fff'>Effect--Pearl amount: "+effectValue+"</span>"
				return pendingText
			}
			if(effectName==="levelup") {
				let pendingText="<span style='color: #dfbfff'>Effect--Level Up: Attacking damage is increased to "+approx(1.2**effectValue*100)+"% of original value.</span>"
				return pendingText
			}
			if(effectName==="honeyimmunity") {
				let pendingText="<span style='color: #5fbf5f'>Effect--Honey Immunity: Can't be defended by honey.</span>"
				return pendingText
			}
			if(effectName==="tardiness") {
				let pendingText="<span style='color: #9f5f3f'>Effect--Tardiness: Speed exceeds 10 is reduced for "+effectValue+" turn.</span>"
				return pendingText
			}
			if(effectName==="doom") {
				let pendingText="<span style='color: #bf0000'>Effect--Doom: Destroys after "+effectValue+" turn.</span>"
				return pendingText
			}
			return ""
		}
		function compareAverage(attribute,average,float) {
			if(float<0) {
				float*=-1
				attribute=2*average-attribute
			}
			if(attribute===average) return " <span style='color: #555555'>--AVG--</span>"
			if(attribute<average-average*float*0.75) return " <span style='color: #555555'>##FAIL##</span>"
			if(attribute<average) return " <span style='color: #555555'>WEAK</span>"
			if(attribute>average+average*float*0.75) return " <span style='color: #555555'>==BEST==</span>"
			return " <span style='color: #555555'>GOOD</span>"
		}
		function gridInfo(grid) {
			if(animation) return
			if(selectedGrid.select===true) return
			if(grid.style.scale>0 && grid.style.scale<1) return
			let gridValue=parseInt(grid.getAttribute("value")),gridX=parseInt(grid.dataset.x),gridY=parseInt(grid.dataset.y)
			if(gridValue>6000) return
			if(fight.hasOwnProperty("spevent")) {
				if(fight.spevent.event>=101 && fight.spevent.event<=109 && gridValue===0) {
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
					if(gridY===1 && gridX%3===0) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().bottom+10+"px"
						let editingGridCardHTML="<h3>Your opponent</h3>"
						editingGridCardHTML+="<span>Momentum: "+fight.spevent.opponentmomentum+"</span><br>"
						document.getElementById("gridinfo").innerHTML=editingGridCardHTML
						document.getElementById("gridinfo").style.display="flex"
					}
					if(gridY===1 && gridX%3!==0) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().bottom+10+"px"
						let editingGridCardHTML="<h3 style='color: "+rarityColor[fight.spevent.opponentcard[gridX].rarity].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>A Card</h3>"
						document.getElementById("gridinfo").innerHTML=editingGridCardHTML
						document.getElementById("gridinfo").style.display="flex"
					}
					if(gridY===6 && gridX%3===0) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
						let editingGridCardHTML="<h3>Traveler (You)</h3>"
						editingGridCardHTML+="<span>Momentum: "+fight.spevent.travelermomentum+"</span><br>"
						document.getElementById("gridinfo").innerHTML=editingGridCardHTML
						document.getElementById("gridinfo").style.display="flex"
					}
					if(gridY===6 && gridX%3!==0) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
						let editingGridCardHTML="<h3 style='color: "+rarityColor[fight.spevent.travelercard[gridX].rarity].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+fight.spevent.travelercard[gridX].name+"<span class='black'>+</span>".repeat(fight.spevent.travelercard[gridX].level)+"</h3>"
						if(fight.spevent.travelercard[gridX].id<=4) {
							editingGridCardHTML+="<span style='color: #7fdf7f'>Health: "+fight.spevent.travelercard[gridX].health+"</span>"
							editingGridCardHTML+="<span style='color: #ff7f7f'>Damage: "+fight.spevent.travelercard[gridX].damage+"</span>"
							editingGridCardHTML+="<span style='color: #dfdf5f'>DPT: "+fight.spevent.travelercard[gridX].dpt+"</span><br>"
						}
						document.getElementById("gridinfo").innerHTML=editingGridCardHTML
						document.getElementById("gridinfo").style.display="flex"
					}
				}
				return
			}
			if(document.getElementById("inventory").style.display==="flex" && gridValue===0) return
			if(document.getElementById("inventory").style.display==="flex" && gridValue===2) return
			if(gridValue===0) {
				if(gridY===0) return
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===gridX && fight.petal[i].y===gridY && fight.petal[i].state!=="Retired") {
					if(gridY>3) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					} else {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().bottom+10+"px"
					}
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
					let editingGridPetalHTML="<h3 style='color: "+rarityColor[fight.petal[i].rarity]+"'>"+fight.petal[i].name+"<span class='black'>+</span>".repeat(fight.petal[i].level)+"</h3>"
					editingGridPetalHTML=editingGridPetalHTML.replace("#ffe65d","#ffe65d; filter: brightness(90%)")
					editingGridPetalHTML+="<span>"+PetalDescriptionList[fight.petal[i].id]+"</span><br>"
					if(fight.petal[i].state==="Reloading") {
						editingGridPetalHTML+="<span style='color: #bf9f7f'>Reloading</span>"
					} else {
						editingGridPetalHTML+="<span style='color: #7fdf7f'>Health: "+fight.petal[i].currenthealth+"/"+fight.petal[i].health+"</span>"
					}
					editingGridPetalHTML+="<span style='color: #ff7f7f'>Damage: "+fight.petal[i].damage+"</span>"
					editingGridPetalHTML+="<span style='color: #dfdf5f'>Size: "+fight.petal[i].size+"</span>"
					editingGridPetalHTML+="<span style='color: #ff7f7f'>ATK: "+fight.petal[i].atk1+"%->"+fight.petal[i].atk2+"% (buff: "+fight.petal[i].atkbuff+")</span>"
					editingGridPetalHTML+="<span style='color: #7fdf7f'>DEF: "+fight.petal[i].def1+"%->"+fight.petal[i].def2+"% (buff: "+fight.petal[i].defbuff+")</span>"
					if(fight.petal[i].state==="Existing") {
						editingGridPetalHTML+="<span style='color: #bf7fff'>Action: "+fight.petal[i].actionbar+"/"+250+" (+"+fight.petal[i].speed+")</span><br>"
					} else if(fight.petal[i].state==="Suspended") {
						editingGridPetalHTML+="<span style='color: #bf7fff'>Action: "+fight.petal[i].actionbar+"/"+250+" (suspended)</span><br>"
					} else {
						editingGridPetalHTML+="<span style='color: #ff7fbf'>Action: "+fight.petal[i].actionbar+"/"+fight.petal[i].reload+" (+"+fight.petal[i].speed+")</span><br>"
					}
					if(PetalAttributeList[fight.petal[i].id].length>0) {
						let pendingText=PetalAttributeList[fight.petal[i].id]
						if(PetalAttributeList[fight.petal[i].name]!==undefined) pendingText=PetalAttributeList[fight.petal[i].name]
						pendingText=petalTextReplace(pendingText,fight.petal[i])
						editingGridPetalHTML+=pendingText+"<br>"
					}
					if(JSON.stringify(fight.petal[i].effect)!=="{}") {
						let pendingText=""
						for(let j in fight.petal[i].effect) pendingText+=petalEffectText(j,fight.petal[i].effect[j])
						editingGridPetalHTML+=pendingText+"<br>"
					}
					document.getElementById("gridinfo").innerHTML=editingGridPetalHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===gridX && fight.mob[i].y===gridY) {
					if(gridY>3) {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					} else {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().bottom+10+"px"
					}
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
					let editingGridMobHTML=""
					if(fight.mob[i].shiny>0) {
						editingGridMobHTML+="<h3 style='color: "+rarityColor[fight.mob[i].rarity]+"'>"+fight.mob[i].name+"</h3>"
					} else {
						editingGridMobHTML+="<h3 style='color: "+rarityColor[fight.mob[i].rarity]+"'>"+fight.mob[i].name+"</h3>"
					}
					editingGridMobHTML=editingGridMobHTML.replace("#ffe65d","#ffe65d; filter: brightness(90%)")
					editingGridMobHTML+="<span>"+MobDescriptionList[fight.mob[i].id]+"</span><br>"
					if(fight.mob[i].behavior==="Passive") {
						editingGridMobHTML+="<span style='color: #7fdf7f'>Behavior: Passive</span>"
					}
					if(fight.mob[i].behavior==="Neutral") {
						editingGridMobHTML+="<span style='color: #dfdf3f'>Behavior: Neutral</span>"
					}
					if(fight.mob[i].behavior==="Hostile") {
						editingGridMobHTML+="<span style='color: #ff7f7f'>Behavior: Hostile</span>"
					}
					if(fight.mob[i].behavior==="Neutral+") {
						editingGridMobHTML+="<span style='color: #df9f7f'>Behavior: ->Hostile</span>"
					}
					editingGridMobHTML+="<span style='color: #7fdf7f'>Health: "+fight.mob[i].currenthealth+"/"+fight.mob[i].health+"</span>"
					editingGridMobHTML+="<span style='color: #ff7f7f'>Damage: "+fight.mob[i].damage+"</span>"
					editingGridMobHTML+="<span style='color: #7fdf7f'>Dodge: "+fight.mob[i].dodge+"%</span>"
					editingGridMobHTML+="<span style='color: #bf7fff'>Action: "+fight.mob[i].actionbar+"/"+200+" (+"+fight.mob[i].speed+")</span><br>"
					if(MobAttributeList[fight.mob[i].id].length>0) {
						let pendingText=MobAttributeList[fight.mob[i].id]
						pendingText=mobTextReplace(pendingText,fight.mob[i])
						editingGridMobHTML+=pendingText+"<br>"
					}
					if(JSON.stringify(fight.mob[i].effect)!=="{}") {
						let pendingText=""
						for(let j in fight.mob[i].effect) pendingText+=mobEffectText(j,fight.mob[i].effect[j])
						if(pendingText!=="") editingGridMobHTML+=pendingText+"<br>"
					}
					document.getElementById("gridinfo").innerHTML=editingGridMobHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
			}
			if(gridValue===1) {
				document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
				document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
				document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
				let editingPetal=player.inventory[gridX],editingPetalBase=new Petal(editingPetal.id,editingPetal.rarity,editingPetal.level,false)
				let editingGridPetalHTML="<h3 style='color: "+rarityColor[editingPetal.rarity]+"'>"+(editingPetal.hasOwnProperty("temploot")? "?":"")+editingPetal.name+"<span class='black'>+</span>".repeat(editingPetal.level)+"".repeat(editingPetal.star)+"</h3>"
				editingGridPetalHTML=editingGridPetalHTML.replace("#ffe65d","#ffe65d; filter: brightness(90%)")
				editingGridPetalHTML+="<span>"+PetalDescriptionList[editingPetal.id]+"</span><br>"
				if(PetalAttributeList[editingPetal.id].match("DECORATION")===null) {
					editingGridPetalHTML+="<span style='color: #7fdf7f'>Health: "+editingPetal.health
					editingGridPetalHTML+=compareAverage(editingPetal.health,editingPetalBase.health,0.2)
					editingGridPetalHTML+="</span>"
					editingGridPetalHTML+="<span style='color: #ff7f7f'>Damage: "+editingPetal.damage
					editingGridPetalHTML+=compareAverage(editingPetal.damage,editingPetalBase.damage,0.2)
					editingGridPetalHTML+="</span>"
					editingGridPetalHTML+="<span style='color: #dfdf5f'>Size: "+editingPetal.size+"</span>"
					editingGridPetalHTML+="<span style='color: #ff7f7f'>ATK: "+editingPetal.atk1+"%->"+editingPetal.atk2+"% (buff: "+editingPetal.atkbuff+")</span>"
					editingGridPetalHTML+="<span style='color: #7fdf7f'>DEF: "+editingPetal.def1+"%->"+editingPetal.def2+"% (buff: "+editingPetal.defbuff+")</span>"
					editingGridPetalHTML+="<span style='color: #bf7fff'>Speed: "+editingPetal.speed
					editingGridPetalHTML+=compareAverage(editingPetal.speed,editingPetalBase.speed,0.1)
					editingGridPetalHTML+="</span>"
					editingGridPetalHTML+="<span style='color: #ff7fbf'>Reload: "+editingPetal.reload
					editingGridPetalHTML+=compareAverage(editingPetal.reload,editingPetalBase.reload,-0.1)
					editingGridPetalHTML+="</span><br>"
				}
				if(PetalAttributeList[editingPetal.id].length>0) {
					let pendingText=PetalAttributeList[editingPetal.id]
					if(PetalAttributeList[editingPetal.name]!==undefined) pendingText=PetalAttributeList[editingPetal.name]
					pendingText=petalTextReplace(pendingText,editingPetal)
					editingGridPetalHTML+=pendingText+"<br>"
				}
				document.getElementById("gridinfo").innerHTML=editingGridPetalHTML
				document.getElementById("gridinfo").style.display="flex"
				return
			}
			if(gridValue===2) {
				if(gridY===0) {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===gridX && fight.petal[i].y===gridY && fight.petal[i].state!=="Retired") {
						document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
						document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
						document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
						let editingGridPetalHTML="<h3 style='color: "+rarityColor[fight.petal[i].rarity]+"'>"+fight.petal[i].name+"<span class='black'>+</span>".repeat(fight.petal[i].level)+"</h3>"
						editingGridPetalHTML=editingGridPetalHTML.replace("#ffe65d","#ffe65d; filter: brightness(90%)")
						editingGridPetalHTML+="<span>"+PetalDescriptionList[fight.petal[i].id]+"</span><br>"
						if(PetalAttributeList[fight.petal[i].id].length>0) {
							let pendingText=PetalAttributeList[fight.petal[i].id]
							if(PetalAttributeList[fight.petal[i].name]!==undefined) pendingText=PetalAttributeList[fight.petal[i].name]
							pendingText=petalTextReplace(pendingText,fight.petal[i])
							editingGridPetalHTML+=pendingText+"<br>"
						}
						if(JSON.stringify(fight.petal[i].effect)!=="{}") {
							let pendingText=""
							for(let j in fight.petal[i].effect) pendingText+=petalEffectText(j,fight.petal[i].effect[j])
							editingGridPetalHTML+=pendingText+"<br>"
						}
						document.getElementById("gridinfo").innerHTML=editingGridPetalHTML
						document.getElementById("gridinfo").style.display="flex"
						return
					}
				}
				if(gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
					let editingGridItemHTML=""
					if(gridX===1) {
						editingGridItemHTML="<h3 style='color: "+rarityColor[1]+"'>Energy Drink (Available Item)</h3>"
						editingGridItemHTML+="<span>Healthy beverage (water). It tastes as good as sunlight (no taste at all).</span><br>"
						editingGridItemHTML+="<span style='color: #7f7f7f'>Heals flower for 20 health. Consumed after every use.</span>"
						editingGridItemHTML+="<span style='color: #3fbf3f'>Amount: "+player.item["Energy Drink"]+"</span>"
					}
					if(gridX===2) {
						editingGridItemHTML="<h3 style='color: "+rarityColor[1]+"'>Arrow (Available Item)</h3>"
						editingGridItemHTML+="<span>A bow and some arrows with signs of wear and tear, but functional.</span><br>"
						editingGridItemHTML+="<span style='color: #7f7f7f'>Deals 50 damage to a mob. Consumed after every use.</span>"
						editingGridItemHTML+="<span style='color: #3fbf3f'>Amount: "+player.item.Arrow+"</span>"
					}
					if(gridX===3) {
						editingGridItemHTML="<h3 style='color: "+rarityColor[4]+"'>Epic Rose Juice (Available Item)</h3>"
						editingGridItemHTML+="<span>Tasty juice. It is said that after drinking it, one will dream of a rose garden.</span><br>"
						editingGridItemHTML+="<span style='color: #7f7f7f'>Can only be used when Energy is below 90% and Health is below half. Heals flower to full health. Restore 5% Energy. Consumed after every use.</span>"
						editingGridItemHTML+="<span style='color: #3fbf3f'>Amount: "+player.item["Epic Rose Juice"]+"</span>"
					}
					if(gridX===4) {
						editingGridItemHTML="<h3 style='color: "+rarityColor[5]+"'>Triple Web (Available Item)</h3>"
						editingGridItemHTML+="<span>Stick large webs. You know, it will also trap yourself.</span><br>"
						editingGridItemHTML+="<span style='color: #7f7f7f'>Can only be used when you have no buffs and debuffs. Sets all petals and mobs to 0 action. Applies 10% Wither to yourself. Consumed after every use.</span>"
						editingGridItemHTML+="<span style='color: #3fbf3f'>Amount: "+player.item["Triple Web"]+"</span>"
					}
					editingGridItemHTML+="<br>"
					document.getElementById("gridinfo").innerHTML=editingGridItemHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridY===2) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+40+"px"
					let editingGridItemHTML=""
					if(gridX===1) {
						editingGridItemHTML="<h3 style='color: "+rarityColor[3]+"'>Time Shard (Permanent Item)</h3>"
						editingGridItemHTML+="<span>A fragment of time. Can you repair that?</span><br>"
						editingGridItemHTML+="<span style='color: #7f7f7f'>Slows down time by +10% length per tick additively.</span>"
						editingGridItemHTML+="<span style='color: #3fbf3f'>Amount: "+player.item["Time Shard"]+"</span>"
					}
					editingGridItemHTML+="<br>"
					document.getElementById("gridinfo").innerHTML=editingGridItemHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
			}
			if(gridValue===3) {
				if(gridX===1 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Bloom</h3>"
					editingGridEffectHTML+="<span>Your maximum health is increased.</span><br>"
					editingGridEffectHTML+="<span style='color: #5fdf5f'>Maximum Health Buff: "+fight.flower.effect.bloom.buff+"</span>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===2 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Immunity</h3>"
					editingGridEffectHTML+="<span>You are immune to all damage and new debuff. Higher tier of this effect also clears debuff.</span><br>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Remaining Turn: "+fight.flower.effect.immunity.turn+"</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===3 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Thorn</h3>"
					editingGridEffectHTML+="<span>Reflects a portion of damage back to your enemies. Higher tier of this effect also reflects missile damage.</span><br>"
					editingGridEffectHTML+="<span style='color: #df7f3f'>Damage Reflect: "+fight.flower.effect.thorn.buff+"%</span>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===4 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Shield</h3>"
					editingGridEffectHTML+="<span>Absorbs all phisical damage received. Decreased by 5% every turn.</span><br>"
					editingGridEffectHTML+="<span style='color: #ffffff'>Remaining Amount: "+approx(fight.flower.effect.shield)+"</span>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===5 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Purity</h3>"
					editingGridEffectHTML+="<span>Immunes all healing debuff. Also improves all healing effects.</span><br>"
					editingGridEffectHTML+="<span style='color: #5fdf5f'>Healing Buff: "+fight.flower.effect.purity.buff+"%</span>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===6 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Evasion</h3>"
					editingGridEffectHTML+="<span>You can evade all damage by skipping defend. If you choose to defend and fails, you will still receive damage.</span><br>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Remaining Turn: "+fight.flower.effect.evasion.turn+"</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===7 && gridY===1) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Buff: Resistance</h3>"
					editingGridEffectHTML+="<span>Your physical damage received is decreased.</span><br>"
					editingGridEffectHTML+="<span style='color: #bf9f7f'>Armor Buff: "+fight.flower.effect.resistance.buff+"</span>"
					editingGridEffectHTML+="<span style='color: #3fbf3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===1 && gridY===2) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Debuff: Poison</h3>"
					editingGridEffectHTML+="<span>You will receive damage at the start of your turn. Bonus turn is not included. This effect doesn't stack which means it only take effect on the higher one.</span><br>"
					editingGridEffectHTML+="<span style='color: #bf3fff'>Poison damage: "+fight.flower.effect.poison[0]+" (for next turn)</span>"
					editingGridEffectHTML+="<span style='color: #bf3f3f'>Remaining turn: "+fight.flower.effect.poison.length+"</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===2 && gridY===2) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Debuff: Suppression</h3>"
					editingGridEffectHTML+="<span>Your passive heal is disabled. Higher tier of this effect also applies debuff to your active healing.</span><br>"
					editingGridEffectHTML+="<span style='color: #ffffff'>Healing Debuff: "+approx(fight.flower.effect.suppression.debuff*1000)/10+"%</span>"
					editingGridEffectHTML+="<span style='color: #bf3f3f'>Remaining turn: "+fight.flower.effect.suppression.turn+"</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===3 && gridY===2) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Debuff: Vulnerability</h3>"
					editingGridEffectHTML+="<span>Your physical damage received is increased. Lower tier of this effect doesn't fully stack. The formula is the 1.5th root of 1.5th power combined (10+1016,10+10+1021).</span><br>"
					editingGridEffectHTML+="<span style='color: #ffffff'>Armor Debuff: "+approx(fight.flower.effect.vulnerability[0])+" (for this turn)</span>"
					editingGridEffectHTML+="<span style='color: #bf3f3f'>Remaining turn: "+fight.flower.effect.vulnerability.length+"</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
				if(gridX===4 && gridY===2) {
					document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
					document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
					document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
					let editingGridEffectHTML="<h3 class='cpurple'>Debuff: Wither</h3>"
					editingGridEffectHTML+="<span>Your maximum health is reduced. This effect is increase by 10% of damage received every time you are hit by boss.</span><br>"
					editingGridEffectHTML+="<span style='color: #ff5f5f'>Maximum Health Debuff: "+fight.flower.effect.wither.debuff+"</span>"
					editingGridEffectHTML+="<span style='color: #bf3f3f'>Resolves Upon Effect Condition</span><br>"
					document.getElementById("gridinfo").innerHTML=editingGridEffectHTML
					document.getElementById("gridinfo").style.display="flex"
					return
				}
			}
			if(gridValue===4) {
				if(player.gallery[MobNameList[gridX]]["rarity"+gridY+"killed"]===0 && player.gallery[MobNameList[gridX]]["rarity"+gridY+"looted"]===0) return
				document.getElementById("gridinfo").style.setProperty("--transform2","translate(0%,-50%)")
				document.getElementById("gridinfo").style.top=grid.getBoundingClientRect().top-10+"px"
				document.getElementById("gridinfo").style.left=grid.getBoundingClientRect().left+20+"px"
				let editingGridGalleryHTML="",testMob=new Mob(gridX,gridY,0,false)
				editingGridGalleryHTML+="<h3 style='color: "+rarityColor[testMob.rarity].replace("#ffe65d","#ffe65d; filter: brightness(90%)")+"'>"+testMob.name+"</h3>"+"<span>"+MobDescriptionList[testMob.id]+"</span><br>"
				if(testMob.behavior==="Passive") {
					editingGridGalleryHTML+="<span style='color: #7fdf7f'>Behavior: Passive</span>"
				}
				if(testMob.behavior==="Neutral") {
					editingGridGalleryHTML+="<span style='color: #dfdf3f'>Behavior: Neutral</span>"
				}
				if(testMob.behavior==="Hostile") {
					editingGridGalleryHTML+="<span style='color: #ff7f7f'>Behavior: Hostile</span>"
				}
				editingGridGalleryHTML+="<span style='color: #7fdf7f'>Health: "+testMob.health+"</span>"
				editingGridGalleryHTML+="<span style='color: #ff7f7f'>Damage: "+testMob.damage+"</span>"
				editingGridGalleryHTML+="<span style='color: #7fdf7f'>Dodge: "+testMob.dodge+"%</span>"
				editingGridGalleryHTML+="<span style='color: #9f9fff'>Speed: "+testMob.speed+"</span>"
				editingGridGalleryHTML+="<span style='color: #7f7f7f'>Killed/Looted: "+player.gallery[MobNameList[gridX]]["rarity"+gridY+"killed"]+"/"+player.gallery[MobNameList[gridX]]["rarity"+gridY+"looted"]+"</span><br>"
				if(player.gallery[MobNameList[gridX]]["rarity"+gridY+"looted"]>0) editingGridGalleryHTML+="<br>"
				document.getElementById("gridinfo").innerHTML=editingGridGalleryHTML
				if(player.gallery[MobNameList[gridX]]["rarity"+gridY+"looted"]>0 && MobLootList[testMob.id].length>0) {
					for(let i=0;i<MobLootList[testMob.id].length;i++) {
						let lootList=document.createElement("div")
						lootList.setAttribute("class","nlh")
						lootList.style.height="60px"
						let pendingID=PetalNameList.indexOf(MobLootList[testMob.id][i].slice(0,-2)),pendingDroprate=parseInt(MobLootList[testMob.id][i].slice(-1))
						for(let j=PetalLowestRarityList[pendingID];j<=6;j++) if(MobLootBase(testMob.rarity,pendingDroprate,j)>0.001) {
							let smallLootGrid=createGrid(79,0,0,"Petal_"+PetalNameList[pendingID],1,j)
							smallLootGrid.style.scale=0.5
							smallLootGrid.style.margin="-30px -15px"
							smallLootGrid.innerHTML+="<sub class='text2'>"+(approx(MobLootBase(testMob.rarity,pendingDroprate,j)*10000)/100)+"%</sub>"
							lootList.appendChild(smallLootGrid)
						}
						if(lootList.children.length) document.getElementById("gridinfo").appendChild(lootList)
					}
				}
				document.getElementById("gridinfo").style.display="flex"
			}
		}
		function closeGridInfo(forced=false) {
			if(selectedGrid.select===true && forced===false) return
			selectedGrid.select=false
			document.getElementById("gridinfo").style.display="none"
		}
		function displayMap() {
			document.getElementById("central-room").style.display="none"
			document.getElementById("fight-btn").style.display="none"
			document.getElementById("fight-container").style.display="none"
			document.getElementById("fight-item").style.display="none"
			document.getElementById("map-container").style.display="unset"
			document.getElementById("map-item").style.top=parseFloat(document.getElementById("map-container").getBoundingClientRect().bottom)-55+"px"
			document.getElementById("map-item").style.display="flex"
		}
		function displayMapItem() {
			document.getElementById("map-item").innerHTML=""
			if(player.item.hasOwnProperty("Time Shard")) document.getElementById("map-item").appendChild(createGrid(2,1,2,"Item_Time Shard",1,3))
		}
		function displayCentralRoom() {
			document.getElementById("map-container").style.display="none"
			document.getElementById("map-item").style.display="none"
			document.getElementById("fight-btn").style.display="none"
			document.getElementById("fight-container").style.display="none"
			document.getElementById("fight-item").style.display="none"
			if(explore.floor===0) {
				document.getElementById("central-room").innerHTML="<h2 class='rmid apos'>Base Floor-Central Room</h2>"
				document.getElementById("central-room").classList.add("lgreen-bg")
				document.getElementById("central-room").style.display="unset"
				if(!explore.event.hasOwnProperty("startdialog")) {
					explore.event.startdialog=0
					dialog("(The Florroom)","Today is an extraordinary day. Traveler, a flower that aspires to climb to the highest floor of Florroom, after defeating thousands of creatures and traversing diverse regions, however, returns to its starting point.","Unset","#dfdfdf")
					return
				}
				if(explore.event.hasOwnProperty("searchlibrary") && explore.event.searchlibrary!=="Completed") return
				if(explore.event.hasOwnProperty("basefloorwarehouse") && explore.event.basefloorwarehouse!=="Completed") return
				if(explore.event.hasOwnProperty("basefloorexitcentral") && explore.event.basefloorexitcentral!=="Completed") return
				if(!explore.event.hasOwnProperty("searchlibrary")) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.searchlibrary=0;dialog(\"Skip\")' class='lblue-bg cmid bgrid apos' style='left: 40px; height: 120px; width: 120px' title='Library'><svg viewBox='0 0 100 100' class='in-svg'><path class='fred-path ns' d='M27 14L27 84L77 84L77 14ZM23 86L24.2 85.4L74.2 85.4L73 86Z'/><path class='fred-path ns' style='filter: brightness(80%)' d='M23 16L27 14L27 84L23 86Z'/><path class='fwhite-path ns' d='M24.2 85.4L27 84L77 84L74.2 85.4Z'/></svg></button>"
				}
				if(!explore.event.hasOwnProperty("basefloorwarehouse")) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.basefloorwarehouse=0;dialog(\"Skip\")' class='yellow-bg bgrid apos' style='top: 40px; right: 40px; height: 120px; width: 120px' title='Warehouse'><svg viewBox='0 0 100 100' class='in-svg'><path class='fcorange-path' d='M20 45L50 20L80 45Z'/><path class='fdbrown-path' d='M30 45L30 75L70 75L70 45Z'/><path class='fdgreen-path' d='M52 75L52 55L64 55L64 75Z'/></svg></button>"
				}
				if(explore.event.searchlibrary==="Completed" && explore.event.basefloorwarehouse==="Completed") {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.basefloorexitcentral=0;dialog(\"Skip\")' class='lgrey-bg rmid bgrid apos' style='bottom: 40px; height: 120px; width: 120px' title='Exit'><svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path ns' d='M35 20L65 20A5 5 0 0 1 70 25L70 32L65 32L65 25L35 25L35 75L65 75L65 68L70 68L70 75A5 5 0 0 1 65 80L35 80A5 5 0 0 1 30 75L30 25A5 5 0 0 1 35 20'/><path class='white-path rcap wide' d='M75 50L55 50M75 50L68 43M75 50L68 57'/></svg></button>"
				}
				return
			}
			if(explore.floor===1) {
				if(!explore.flowergrid) explore.flowergrid=1
				if(explore.flowergrid===1) {
					document.getElementById("central-room").innerHTML="<h2 class='rmid apos'>Floor 1-Central Room</h2>"
				}
				if(explore.flowergrid===2) {
					document.getElementById("central-room").innerHTML="<h2 class='rmid apos'>Floor 1-Central Room-Hotel</h2>"
				}
				document.getElementById("central-room").classList.add("lgreen-bg")
				document.getElementById("central-room").style.display="unset"
				if(!explore.event.hasOwnProperty("floor1startdialog")) {
					explore.event.floor1startdialog=0
					dialog("(The Florroom)","Traveler wakes up on the ground.","Unset","#dfdfdf")
					return
				}
				if(explore.event.hasOwnProperty("floor1game") && explore.event.floor1game!=="Completed") return
				if(explore.event.hasOwnProperty("floor1hotel") && explore.event.floor1hotel!=="Completed") return
				if(explore.event.hasOwnProperty("floor1warehouse") && explore.event.floor1warehouse!=="Completed") return
				if(explore.event.hasOwnProperty("floor1exitcentral") && explore.event.floor1exitcentral!=="Completed") return
				if(explore.flowergrid===1) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.flowergrid=2;displayCentralRoom();localStorage.setItem(\"FLORROOMexplore\",JSON.stringify(explore))' class='lpurple-bg cmid bgrid apos' style='left: 40px; height: 120px; width: 120px' title='Walk'><svg viewBox='0 0 100 100' class='in-svg'><path class='grey-path rcap' d='M20 50L40 30M20 50L40 70M20 50L80 50'/></svg></button>"
				}
				if(explore.flowergrid===2) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.flowergrid=1;displayCentralRoom();localStorage.setItem(\"FLORROOMexplore\",JSON.stringify(explore))' class='lpurple-bg cmid bgrid apos' style='right: 40px; height: 120px; width: 120px' title='Walk'><svg viewBox='0 0 100 100' class='in-svg'><path class='grey-path rcap' d='M80 50L60 30M80 50L60 70M80 50L20 50'/></svg></button>"
				}
				if(explore.flowergrid===1 && !explore.event.hasOwnProperty("floor1game")) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.floor1game=0;dialog(\"Skip\")' class='yellow-bg bgrid apos' style='top: 40px; left: 40px; height: 120px; width: 120px' title='Game'><svg viewBox='0 0 100 100' class='in-svg'><path class='dgrey-path rcap wide' d='M14 14L86 14M14 38L86 38M14 62L86 62M14 86L86 86M14 14L14 86M38 14L38 86M62 14L62 86M86 14L86 86'/><path class='blue-path wide' d='M50 43A7 7 0 0 1 50 57A7 7 0 0 1 50 43ZM74 67A7 7 0 0 1 74 81A7 7 0 0 1 74 67Z'/><path class='red-path rcap wide' d='M68 44L80 56M80 44L68 56M20 20L32 32M32 20L20 32'/></svg></button>"
				}
				if(explore.flowergrid===1 && explore.event.talentactivation==="Incomplete") {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.talentactivation=0;dialog(\"Skip\")' class='red-bg bgrid apos' style='top: 40px; left: 40px; height: 120px; width: 120px' title='Game'><svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path ns' d='M28 34.8A8 8 0 0 0 28 50.8A8 8 0 0 0 28 34.8M50 18.8A8 8 0 0 0 50 34.8A8 8 0 0 0 50 18.8M72 34.8A8 8 0 0 0 72 50.8A8 8 0 0 0 72 34.8M63.6 60.8A8 8 0 0 0 63.6 76.8A8 8 0 0 0 63.6 60.8M36.4 60.8A8 8 0 0 0 36.4 76.8A8 8 0 0 0 36.4 60.8'/><path class='white-path wide' d='M28 34.8A8 8 0 0 0 28 50.8A8 8 0 0 0 28 34.8M50 18.8A8 8 0 0 0 50 34.8A8 8 0 0 0 50 18.8M72 34.8A8 8 0 0 0 72 50.8A8 8 0 0 0 72 34.8M63.6 60.8A8 8 0 0 0 63.6 76.8A8 8 0 0 0 63.6 60.8M36.4 60.8A8 8 0 0 0 36.4 76.8A8 8 0 0 0 36.4 60.8' style='filter: brightness(90%)'/></svg></button>"
				}
				if(explore.flowergrid===2 && !explore.event.hasOwnProperty("floor1hotel")) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.floor1hotel=0;dialog(\"Skip\")' class='green-bg mid bgrid apos' style='height: 120px; width: 120px' title='Hotel'><svg viewBox='0 0 100 100' class='in-svg'><path class='fdbrown-path' d='M10 45L50 12L90 45Z'/><path class='fgrey-path' d='M20 45L80 45L80 80L20 80Z'/><path class='fcyan-path' d='M28 51L38 51L38 61L28 61ZM45 51L55 51L55 61L45 61ZM62 51L72 51L72 61L62 61ZM28 65L38 65L38 75L28 75ZM62 65L72 65L72 75L62 75Z'/><path class='fdblue-path' d='M45 80L45 65L55 65L55 80Z'/></svg></button>"
				}
				if(explore.flowergrid===2 && explore.event.hasOwnProperty("floor1hotel") && !explore.event.hasOwnProperty("floor1warehouse")) {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.floor1warehouse=0;dialog(\"Skip\")' class='yellow-bg bgrid apos' style='top: 40px; right: 40px; height: 120px; width: 120px' title='Warehouse'><svg viewBox='0 0 100 100' class='in-svg'><path class='fcorange-path' d='M20 45L50 20L80 45Z'/><path class='fdbrown-path' d='M30 45L30 75L70 75L70 45Z'/><path class='fdgreen-path' d='M52 75L52 55L64 55L64 75Z'/></svg></button>"
				}
				if(explore.flowergrid===1 && explore.event.floor1warehouse==="Completed") {
					document.getElementById("central-room").innerHTML+="<button type='button' tabindex='-1' onclick='explore.event.floor1exitcentral=0;dialog(\"Skip\")' class='lgrey-bg rmid bgrid apos' style='bottom: 40px; height: 120px; width: 120px' title='Exit'><svg viewBox='0 0 100 100' class='in-svg'><path class='fwhite-path ns' d='M35 20L65 20A5 5 0 0 1 70 25L70 32L65 32L65 25L35 25L35 75L65 75L65 68L70 68L70 75A5 5 0 0 1 65 80L35 80A5 5 0 0 1 30 75L30 25A5 5 0 0 1 35 20'/><path class='white-path rcap wide' d='M75 50L55 50M75 50L68 43M75 50L68 57'/></svg></button>"
				}
				return
			}
		}
		function displayFight() {
			document.getElementById("central-room").style.display="none"
			document.getElementById("mapinfo").style.display="none"
			document.getElementById("map-container").style.display="none"
			document.getElementById("map-item").style.display="none"
			document.getElementById("fight-container").style.display="grid"
			updateT()
			document.getElementById("fight-btn").style.top=parseFloat(window.getComputedStyle(document.getElementById("fight-container")).top)-300+"px"
			document.getElementById("fight-btn").style.display="flex"
			document.getElementById("fight-item").style.top=parseFloat(document.getElementById("fight-container").getBoundingClientRect().bottom)+55+"px"
			document.getElementById("fight-item").style.display="flex"
			if(fight.rift.open && getGrid("Rift",0,0)===null) {
				let riftGrid=createGrid("Rift",0,0,"Border",1,0)
				riftGrid.setAttribute("class","smid bgrid apos")
				riftGrid.style.top=getGrid(0,fight.rift.x,fight.rift.y).getBoundingClientRect().top+40+"px"
				riftGrid.style.left=getGrid(0,fight.rift.x,fight.rift.y).getBoundingClientRect().left+40+"px"
				riftGrid.style["pointer-events"]="none"
				document.body.appendChild(riftGrid)
			}
		}
		function displayFightField() {
			document.getElementById("fight-item").innerHTML=""
			if(player.item.hasOwnProperty("Energy Drink")) document.getElementById("fight-item").appendChild(createGrid(2,1,1,"Item_Energy Drink",1,1))
			if(player.item.hasOwnProperty("Arrow")) document.getElementById("fight-item").appendChild(createGrid(2,2,1,"Item_Arrow",1,1))
			if(player.item.hasOwnProperty("Epic Rose Juice")) document.getElementById("fight-item").appendChild(createGrid(2,3,1,"Item_Epic Rose Juice",1,4))
			if(player.item.hasOwnProperty("Triple Web")) document.getElementById("fight-item").appendChild(createGrid(2,4,1,"Item_Triple Web",1,5))
			for(let i=1;i<=8;i++) {
				for(let j=1;j<=6;j++) getGrid(0,i,j).replaceWith(createGrid(0,i,j,"Empty",1,0))
			}
			for(let i=0;i<fight.petal.length;i++) {
				if(fight.petal[i].y!==0) {
					fight.petal[i].print()
				} else {
					document.getElementById("fight-item").insertBefore(createGrid(2,fight.petal[i].x,0,"Petal_"+PetalNameList[fight.petal[i].id],1,fight.petal[i].rarity),document.getElementById("fight-item").firstChild)
					if(fight.petal[i].name==="Compass") fight.petal[i].print()
				}
			}
			for(let i=0;i<fight.mob.length;i++) fight.mob[i].print()
		}
		function startFight(specialevent) {
			if(lupoper.active===true) cancelLevelUp()
			if(specialevent) {
				if(flowerMove) return
				howToPlay(false)
				fight.spevent=new Object()
				fight.spevent.event=specialevent
				displayFight()
				if(fight.spevent.event>=101 && fight.spevent.event<=109) {
					fight.spevent.turn="Traveler"
					let momentumList=[0,10,20,20,20,30,30,30,30,30]
					fight.spevent.travelermomentum=fight.spevent.opponentmomentum=momentumList[fight.spevent.event-100]
					fight.spevent.travelercard=new Array()
					for(let i of [1,2,4,5,7,8]) {
						fight.spevent.travelercard[i]=new Card("Traveler")
						fight.spevent.travelercard[i].print(i,6)
					}
					getGrid(0,3,6).replaceWith(createGrid(0,3,6,"Card_Basic",1,9))
					getGrid(0,6,6).replaceWith(createGrid(0,6,6,"Card_Basic",1,9))
					fight.spevent.opponentcard=new Array()
					for(let i of [1,2,4,5,7,8]) {
						fight.spevent.opponentcard[i]=new Card(fight.spevent.event-100)
						fight.spevent.opponentcard[i].print(i,1)
					}
					getGrid(0,3,1).replaceWith(createGrid(0,3,1,"Card_Basic",1,9))
					getGrid(0,6,1).replaceWith(createGrid(0,6,1,"Card_Basic",1,9))
					for(let i=1;i<=8;i++) for(let j=2;j<=5;j++) getGrid(0,i,j).replaceWith(createGrid(0,i,j,"Empty",1))
					fight.spevent.topic=roll(1,4)
					if(fight.spevent.topic===4 && determine(20)) fight.spevent.topic=5
					printTopic(fight.spevent.topic)
				}
				return
			}
			openInventory(false,true)
			howToPlay(false)
			fight.active=true
			fight.ready=false
			fight.flower.effect=new Object()
			fight.flower.health=FlowerMaxHealth()
			fight.flower.currenthealth=fight.flower.health
			fight.petal=new Array()
			fight.mob=new Array()
			fight.spawnmob=new Array()
			fight.missile=new Array()
			fight.mobattack=false
			fight.rift.open=false
			if(explore.floor>=1) fight.energy=explore.energy
			if(explore.floor===0 && explore.flowerspot===11 && explore.event.hasOwnProperty("evolutionaryguide") && explore.event.evolutionaryguide!=="Completed") {
				fight.mob[0]=new Mob("Rock",7,0)
				fight.mob[0].x=1
				fight.mob[0].y=1
				fight.mob[0].effect.noloot=1
			}
			if(explore.floor===0 && explore.flowerspot===11 && explore.event.evolutionaryguide===0) {
				explore.event.evolutionaryguide=1
				dialog("Skip")
			}
			if(explore.floor===0 && explore.flowerspot===21 && explore.event.hasOwnProperty("artisanguide") && explore.event.artisanguide!=="Completed") {
				fight.mob[0]=new Mob("!Summoner!",1,0)
				fight.mob[0].x=1
				fight.mob[0].y=1
				fight.mob[0].effect.noloot=true
				for(let i=1;i<=5;i++) {
					fight.mob[i]=new Mob("Beetle",1,0)
					fight.mob[i].x=i+1
					fight.mob[i].y=1
					fight.mob[i].effect.noloot=true
				}
			}
			if(explore.floor===0 && explore.flowerspot===21 && explore.event.artisanguide===0) {
				explore.event.artisanguide=1
				dialog("Skip")
			}
			document.getElementById("flower-effect").innerHTML=""
			displayFightField()
			displayFight()
			updateFlowerState()
			updateT()
		}
		function readyFight() {
			if(fight.petal.length!==FlowerSlot()) return
			addLog("[bot#7976] Good luck with that!","#7f7fff")
			fight.ready=true
			fight.turnnum=1
			openInventory(false)
			spawnMob()
			for(let i=0;i<fight.petal.length;i++) fight.petal[i].origin=fight.petal[i].origin.clone()
			for(let i=0;i<fight.petal.length;i++) {
				if(fight.petal[i].name!=="Moon Rock") {
					fight.petal[i].currenthealth=fight.petal[i].health
					fight.petal[i].state="Existing"
				} else {
					fight.petal[i].state="Reloading"
				}
				fight.petal[i].actionbar=0
				fight.petal[i].progress()
				if(fight.petal[i].name==="Cactus") {
					if(!fight.flower.effect.hasOwnProperty("bloom")) fight.flower.effect.bloom={buff:0}
					fight.flower.effect.bloom.buff+=fight.petal[i].health
				}
				if(fight.petal[i].name==="Salt") {
					if(!fight.flower.effect.hasOwnProperty("thorn")) fight.flower.effect.thorn={buff:0}
					fight.flower.effect.thorn.buff=60+10*fight.petal[i].rarity
				}
				if(fight.petal[i].name==="Soil") {
					for(let j=0;j<fight.petal.length;j++) if(fight.petal[j].size>2) {
						fight.petal[j].size+=2
						if(fight.petal[j].size>20) fight.petal[j].size=20
						fight.petal[j].origin.size=fight.petal[j].size
					}
				}
				if(fight.petal[i].name==="Concentrated Eye") {
					for(let j=0;j<fight.petal.length;j++) {
						if(fight.petal[i].rarity>=6 && determine(50,true," for accuracy")) {
							addLog("[Petal] "+fight.petal[j].name+" is enhanced.","#9f9fdf")
							if(fight.petal[j].atk1>0 && fight.petal[j].atk1<100) fight.petal[j].atk1+=10
							if(fight.petal[j].atk2>0 && fight.petal[j].atk2<100) fight.petal[j].atk2+=10
							if(fight.petal[j].def1>0 && fight.petal[j].def1<100) fight.petal[j].def1+=10
							if(fight.petal[j].def2>0 && fight.petal[j].def2<100) fight.petal[j].def2+=10
						}
						if(fight.petal[j].atk1>0 && fight.petal[j].atk2>0 && fight.petal[j].atk1<fight.petal[j].atk2-10) {
							fight.petal[j].atk1=fight.petal[j].atk2-10
						}
						if(fight.petal[j].def1>0 && fight.petal[j].def2>0 && fight.petal[j].def1<fight.petal[j].def2-10) {
							fight.petal[j].def1=fight.petal[j].def2-10
						}
						fight.petal[j].origin.atk1=fight.petal[j].atk1
						fight.petal[j].origin.atk2=fight.petal[j].atk2
						fight.petal[j].origin.def1=fight.petal[j].def1
						fight.petal[j].origin.def2=fight.petal[j].def2
					}
				}
				if(fight.petal[i].name==="Specialized Eye") {
					for(let j=0;j<fight.petal.length;j++) {
						if(fight.petal[i].rarity>=6 && determine(50,true," for accuracy")) {
							addLog("[Petal] "+fight.petal[j].name+" is enhanced.","#9f9fdf")
							if(fight.petal[j].atk1>0 && fight.petal[j].atk1<100) fight.petal[j].atk1+=10
							if(fight.petal[j].atk2>0 && fight.petal[j].atk2<100) fight.petal[j].atk2+=10
							if(fight.petal[j].def1>0 && fight.petal[j].def1<100) fight.petal[j].def1+=10
							if(fight.petal[j].def2>0 && fight.petal[j].def2<100) fight.petal[j].def2+=10
						}
						if(fight.petal[j].atk1>0 && fight.petal[j].atk2>0 && fight.petal[j].atk2<fight.petal[j].atk1+30) {
							fight.petal[j].atk2=fight.petal[j].atk1+30
							if(fight.petal[j].atk2>100) fight.petal[j].atk2=100
						}
						if(fight.petal[j].def1>0 && fight.petal[j].def2>0 && fight.petal[j].def2<fight.petal[j].def1+30) {
							fight.petal[j].def2=fight.petal[j].def1+30
							if(fight.petal[j].def2>100) fight.petal[j].def2=100
						}
						fight.petal[j].origin.atk1=fight.petal[j].atk1
						fight.petal[j].origin.atk2=fight.petal[j].atk2
						fight.petal[j].origin.def1=fight.petal[j].def1
						fight.petal[j].origin.def2=fight.petal[j].def2
					}
				}
				if(fight.petal[i].name==="Basil") {
					if(!fight.flower.effect.hasOwnProperty("purity")) fight.flower.effect.purity={buff:0}
					fight.flower.effect.purity.buff=20*fight.petal[i].rarity+10*fight.petal[i].level-30
				}
				if(fight.petal[i].name==="Bone") {
					if(!fight.petal[i].effect.hasOwnProperty("resistance")) fight.petal[i].effect.resistance=0
					fight.petal[i].effect.resistance=approx(0.2*fight.petal[i].health)
				}
				if(fight.petal[i].name==="Root") {
					if(!fight.flower.effect.hasOwnProperty("resistance")) fight.flower.effect.resistance={buff:0}
					fight.flower.effect.resistance.buff=approx(fight.petal[i].health/10)
				}
				if(fight.petal[i].name==="Compass" && fight.petal[i].rarity<6) {
					fight.petal[i].calculate=roll(1,4)
					fight.petal[i].print()
				}
				if(fight.petal[i].name==="Triangle") {
					let damageBuff=0
					for(let j=0;j<fight.petal.length;j++) if(fight.petal[j].name==="Triangle" && fight.petal[j].rarity===fight.petal[i].rarity) {
						damageBuff+=10+2*fight.petal[j].level
						fight.petal[i].atk2+=5
					}
					fight.petal[i].damage+=approx(fight.petal[i].damage*damageBuff/100)
					fight.petal[i].atk2=betterFloor(fight.petal[i].atk2/10)*10
					if(fight.petal[i].atk2>100) fight.petal[i].atk2=100
					fight.petal[i].origin.damage=fight.petal[i].damage
					fight.petal[i].origin.atk2=fight.petal[i].atk2
				}
			}
			let reloadReduction=0,damageCorruption=0
			for(let i=0;i<fight.petal.length;i++) {
				if(fight.petal[i].name==="Corruption") {
					damageCorruption+=5*fight.petal[i].rarity*(4+fight.petal[i].level)
				}
				if(fight.petal[i].name==="Golden Leaf") {
					reloadReduction+=3*fight.petal[i].rarity
					if(reloadReduction>50) reloadReduction=50
				}
			}
			for(let i=0;i<fight.petal.length;i++) {
				if(reloadReduction>0 && typeof(fight.petal[i].reload)==="number") {
					fight.petal[i].reload-=approx(fight.petal[i].reload*reloadReduction/100)
					fight.petal[i].origin.reload=fight.petal[i].reload
				}
				if(damageCorruption>0 && fight.petal[i].damage>2) {
					fight.petal[i].damage+=approx(fight.petal[i].damage*damageCorruption/100)
					fight.petal[i].origin.damage=fight.petal[i].damage
				}
			}
			fight.flower.health=FlowerMaxHealth()
			fight.flower.currenthealth=FlowerMaxHealth()
			updateFlowerState()
			fight.turn="Flower"
			updateT()
		}
		function endFight(win) {
			if(animation) return
			if(fight.hasOwnProperty("spevent")) {
				if(fight.spevent.event>=101 && fight.spevent.event<=109 && win===true) {
					if(player.floor1gamestat[fight.spevent.event-100]==="Incomplete") {
						player.floor1gamestat[fight.spevent.event-100]="Completed"
						if(fight.spevent.event===101) {
							addLog("[Resource] You received 2 pieces of Time Shard.","#7fff7f")
							player.item.add("Time Shard",2)
						}
						if(fight.spevent.event===102) {
							addLog("[Resource] You received 3 pieces of Time Shard.","#7fff7f")
							player.item.add("Time Shard",3)
						}
						if(fight.spevent.event===103) {
							addLog("[Resource] You received talent activation ticket. Go back to use it.","#7fff7f")
							explore.event.talentactivation="Incomplete"
							localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
						}
						if(fight.spevent.event>=104) {
							player.floor1gamestat[fight.spevent.event-100]="Incomplete"
							console.log("Completed without reward")
						}
						if(fight.spevent.event!==109) player.floor1gamestat[fight.spevent.event-99]="Incomplete"
					}
				}
				delete fight.spevent
				if(explore.explored[10]) {
					displayMapItem()
					displayMap()
				} else {
					displayCentralRoom()
				}
				return
			}
			if(fight.hasOwnProperty("riftfight")) delete fight.riftfight
			if(win===true && explore.flowerspot===67 && fight.riftmob.length>0) {
				fight.riftfight=true
				fight.rift.open=false
				getGrid("Rift",0,0).remove()
				addLog("Suddenly, you fell into a rift.","#ff0000")
				while(fight.riftmob.length>0) {
					fight.riftmob[0].effect=new Object()
					fight.riftmob[0].summoned=true
					fight.riftmob[0].currenthealth=fight.riftmob[0].health
					fight.riftmob[0].actionbar=0
					fight.spawnmob.push(fight.riftmob.splice(0,1)[0])
				}
				document.getElementById("end1").style["pointer-events"]="unset"
				document.getElementById("end1").style.opacity=1
				if(player.settings.theme!=="C++") {
					document.body.classList.add("dgrey-bg")
					for(let i in PetalSVGArray) PetalSVGArray[i]=PetalSVGArray[i].replace(/<g>.+<\/g>/,"<g></g>").replace("20px)","0px); font-family: Consolas")
					for(let i in MobSVGArray) MobSVGArray[i]=MobSVGArray[i].replace(/<g>.+<\/g>/,"<g></g>").replace("20px)","0px); font-family: Consolas")
					document.getElementById("gridinfo").style["font-family"]="Consolas"
				}
				for(let i=1;i<=8;i++) {
					for(let j=1;j<=6;j++) {
						getGrid(0,i,j).replaceWith(createGrid(0,i,j,"Empty",1))
					}
				}
				document.getElementById("fight-item").innerHTML=""
				displayFightField()
				fillMob()
				addLog("You see all of this again.","#ff0000")
				addLog("Escaping is never a good choice.","#ff0000")
				document.getElementById("end1").style.opacity=0
				document.getElementById("end1").style["pointer-events"]="none"
				return
			}
			if(operingType==="Shoot") {
				document.removeEventListener("mousemove",operGrid)
				document.body.removeChild(operingGrid)
				operingThing.shoot(0,0)
			}
			fight.active=false
			fight.ready=false
			fight.manipulate=false
			openInventory(false)
			if(win!==true) {
				for(let i in player.inventory) {
					if(player.inventory[i].effect.temploot===explore.flowerspot && !determine(30)) {
						delete player.inventory[i]
					} else if(player.inventory[i].effect.hasOwnProperty("temploot") && player.inventory[i].effect.temploot!==explore.flowerspot) {
						delete player.inventory[i]
					}
				}
				localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
				fight.flower.effect=new Object()
				explore.flowerspot=explore.floweroldspot
				localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
				updateFlowerSpot(true)
				displayMapItem()
				displayMap()
				updateFlowerState()
				return
			}
			for(let i in player.inventory) if(player.inventory[i].effect.temploot===explore.flowerspot) delete player.inventory[i].effect.temploot
			localStorage.setItem("FLORROOMplayer",JSON.stringify(player))
			explore.explored[explore.flowerspot]=true
			if(explore.floor>=1) explore.energy=fight.energy
			if(explore.floor===0 && explore.flowerspot===11 && explore.event.evolutionaryguide==="Incomplete") {
				explore.highest=explore.flowerspot
				explore.event.evolutionaryguide=3
				localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
				dialog("Skip")
			}
			if(explore.floor===0 && explore.flowerspot===11 && !explore.event.hasOwnProperty("evolutionaryguide")) {
				explore.event.evolutionaryguide=0
			}
			if(explore.floor===0 && explore.flowerspot===21 && explore.event.artisanguide==="Incomplete") {
				explore.highest=explore.flowerspot
				explore.event.artisanguide=3
				localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
				dialog("Skip")
			}
			if(explore.floor===0 && explore.flowerspot===21 && !explore.event.hasOwnProperty("artisanguide")) {
				explore.event.artisanguide=0
			}
			if(explore.highest<100 && explore.highest!==10 && explore.highest!==14) {
				explore.highest=explore.flowerspot
				let highestPlace=tutorialOrder.indexOf(explore.highest)
				mapElement.querySelectorAll("path[value]").forEach(path => {
					let pathValue=parseInt(path.getAttribute("value"))
					if(pathValue<100) {
						let pathOrder=tutorialOrder.indexOf(pathValue)
						if(pathOrder!==-1 && pathOrder<=highestPlace+1) path.style.display="unset"
					} else {
						let pathOrder1=tutorialOrder.indexOf(pathValue%100)
						let pathOrder2=tutorialOrder.indexOf(betterFloor(pathValue/100))
						if(pathOrder1!==-1 && pathOrder1<=highestPlace+1 && pathOrder2!==-1 && pathOrder2<=highestPlace+1) path.style.display="unset"
					}
				} )
			}
			if(explore.flowerspot===67) {
				let saveFloor=explore.floor,saveEnergy=explore.energy
				explore=new Object()
				explore.floor=saveFloor+1
				if(explore.floor>1) explore.energy=saveEnergy
				localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
				localStorage.setItem("FLORROOMfight",JSON.stringify(fight))
				endFloor(saveFloor)
				return
			}
			fight.flower.effect=new Object()
			localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
			displayMapItem()
			displayMap()
			updateFlowerState()
		}
		function removeTempGrid() {
			document.querySelectorAll("[value='79']").forEach(grid => grid.remove())
		}
		function collapseTempGrid() {
			document.querySelectorAll("[value='79']").forEach(grid => collapseGrid(grid))
		}
		async function collapseGrid(grid) {
			selectedGrid.select=false
			closeGridInfo(true)
			animation=true
			let gridValue=parseInt(grid.getAttribute("value")),gridX=parseInt(grid.dataset.x),gridY=parseInt(grid.dataset.y)
			for(let i=0;i<=20;i++) {
				grid.style.scale=1-i/20
				await delay(50)
			}
			await delay(200)
			if(gridValue===0) {
				grid.style.opacity=0
				grid.style.scale=1
				grid.replaceWith(createGrid(0,gridX,gridY,"Empty",1))
				for(let i=0;i<=5;i++) {
					grid.style.opacity=i/5
					await delay(20)
				}
			}
			if(gridValue===1) {
				grid.remove()
			}
			if(gridValue===2) {
				grid.remove()
			}
			if(gridValue===3) {
				grid.remove()
			}
			if(gridValue===79) {
				grid.remove()
			}
			animation=false
		}
		async function squeezeGrid(grid) {
			selectedGrid.select=false
			closeGridInfo(true)
			animation=true
			for(let i=0;i<=20;i++) {
				grid.style.scale=Math.abs(i-10)/20+0.5
				await delay(50)
			}
			animation=false
		}
		function printSinglePetal(order) {
			if(lupoper.active && player.inventory[order].hasOwnProperty("temploot")) return
			let place=0
			let newPlace=createGrid(1,order,player.inventory[order].star,"Petal_"+player.inventory[order].name,1,player.inventory[order].rarity)
			while(place<document.getElementById("inv-petal").children.length && player.inventory[order].star<=document.getElementById("inv-petal").children[place].dataset.y && (player.inventory[order].star<document.getElementById("inv-petal").children[place].dataset.y || order>parseInt(document.getElementById("inv-petal").children[place].dataset.x))) place++
			if(place===document.getElementById("inv-petal").children.length) {
				document.getElementById("inv-petal").appendChild(newPlace)
			} else {
				document.getElementById("inv-petal").insertBefore(newPlace,document.getElementById("inv-petal").children[place])
			}
			return newPlace
		}
		let lupoper=new Object()
		lupoper.active=false
		lupoper.selectedArray=new Array()
		function printInventory() {
			if(animation) return
			document.getElementById("inv-petal").innerHTML=""
			for(let i in player.inventory) {
				if(lupoper.active===true && (lupoper.selectedArray.indexOf(parseInt(i))!==-1 || player.inventory[i].id!==player.inventory[lupoper.selectedArray[0]].id || player.inventory[i].rarity!==player.inventory[lupoper.selectedArray[0]].rarity || player.inventory[i].level!==player.inventory[lupoper.selectedArray[0]].level)) continue
				if(fight.active===true) {
					let equippedflag=false
					for(let j in fight.petal) if(fight.petal[j].origin===player.inventory[i]) equippedflag=true
					if(equippedflag) continue
				}
				printSinglePetal(i)
			}
			document.getElementById("absall-btn").innerHTML="Absorb All Petals Without Star"
			if(absorbAllCheck() && !lupoper.active) {
				document.getElementById("absall-btn").style.display="unset"
			} else {
				document.getElementById("absall-btn").style.display="none"
			}
			document.getElementById("inventory").style.display="flex"
		}
		function loot(id,rarity,level,temploot) {
			let inventorySpace=11
			while(player.inventory[inventorySpace] && inventorySpace<=500) inventorySpace++
			if(inventorySpace>500) {
				addLog("[Warning] Your inventory is full. A petal is discarded.","#bf7f3f")
				return -1
			}
			if(typeof(id)==="string") id=PetalNameList.indexOf(id)
			player.inventory[inventorySpace]=new Petal(id,rarity,level)
			if(temploot) player.inventory[inventorySpace].effect.temploot=explore.flowerspot
			addLog("[Loot] You received a "+player.inventory[inventorySpace].name+"+".repeat(player.inventory[inventorySpace].level)+"("+rarityName[player.inventory[inventorySpace].rarity]+").","#9f9fdf")
			return inventorySpace
		}
		function justifyInventory(grid) {
			let placeRect=grid.getBoundingClientRect(),containRect=document.getElementById("inventory").getBoundingClientRect()
			if(placeRect.top<containRect.top+120) {
				document.getElementById("inventory").scrollTop-=(containRect.top-placeRect.top+130)
			} else if(placeRect.bottom>containRect.bottom) {
				document.getElementById("inventory").scrollTop+=(placeRect.bottom-containRect.bottom+10)
			}
		}
		function star(modify) {
			if(animation) return
			selectedGrid.select=false
			closeGridInfo()
			getGrid(1,selectedGrid.x,player.inventory[selectedGrid.x].star).remove()
			player.inventory[selectedGrid.x].star+=modify
			selectedGrid.y+=modify
			justifyInventory(printSinglePetal(selectedGrid.x))
			gridInfo(getGrid(1,selectedGrid.x,player.inventory[selectedGrid.x].star))
			clickGrid(getGrid(1,selectedGrid.x,player.inventory[selectedGrid.x].star))
		}
		function levelUpCheck(petal) {
			if(player.book.indexOf("Flower Artisan Guide")===-1) return false
			if(petal.effect.hasOwnProperty("temploot")) return false
			if(PetalAttributeList[petal.id].match("Can't craft")!==null) return false
			let pairCount=0
			for(let i in player.inventory) if(player.inventory[i].id===petal.id && player.inventory[i].rarity===petal.rarity && player.inventory[i].level===petal.level) pairCount++
			return (pairCount>1)
		}
		async function levelUp() {
			if(animation) return
			if(lupoper.active===false) {
				let targetPetal=player.inventory[selectedGrid.x].clone()
				if(document.getElementById("lup-btn").innerHTML==="[L] Level Up") {
					document.getElementById("lup-btn").innerHTML="Confirm? "+PetalLevelUpChance(targetPetal.rarity,targetPetal.level,2)+"%+ Success"
					return
				}
				lupoper.selectedArray=new Array()
				lupoper.selectedArray.push(selectedGrid.x)
				await collapseGrid(getGrid(1,selectedGrid.x,selectedGrid.y))
				lupoper.active=true
				selectedGrid.select=false
				document.getElementById("lup-confirm").innerHTML="[L] Level Up"
				document.getElementById("lup-cancel").style.display="unset"
				document.getElementById("lup-confirm").style.display="unset"
				printInventory()
			}
			if(lupoper.selectedArray.length<2) return
			let targetPetal=player.inventory[lupoper.selectedArray[0]].clone()
			if(document.getElementById("lup-confirm").innerHTML==="[L] Level Up") {
				document.getElementById("lup-confirm").innerHTML="Confirm? "+PetalLevelUpChance(targetPetal.rarity,targetPetal.level,lupoper.selectedArray.length)+"% Success"
				return
			}
			let lupSuccessChance=PetalLevelUpChance(targetPetal.rarity,targetPetal.level,lupoper.selectedArray.length)
			player.bookstat.artisan.totallevelup++
			player.bookstat.artisan.totalraritylevelup[targetPetal.rarity]++
			player.bookstat.artisan.totalleveluppetalused+=lupoper.selectedArray.length
			player.bookstat.artisan.totallevelupexpectedsuccess+=0.01*lupSuccessChance
			player.bookstat.artisan.levelupsuccessvariance+=(0.01*lupSuccessChance)*(1-0.01*lupSuccessChance)
			if(determine(lupSuccessChance)) {
				addLog("[Craft] Success!","#df9f7f")
				player.bookstat.artisan.totallevelupsuccess++
				player.bookstat.artisan.totalleveluppetallostsuccess+=lupoper.selectedArray.length
				targetPetal.speed=player.inventory[lupoper.selectedArray[roll(0,lupoper.selectedArray.length-1)]].speed
				targetPetal.reload=player.inventory[lupoper.selectedArray[roll(0,lupoper.selectedArray.length-1)]].reload
				targetPetal.atkbuff=player.inventory[lupoper.selectedArray[roll(0,lupoper.selectedArray.length-1)]].atkbuff
				targetPetal.defbuff=player.inventory[lupoper.selectedArray[roll(0,lupoper.selectedArray.length-1)]].defbuff
				for(let i in lupoper.selectedArray) delete player.inventory[lupoper.selectedArray[i]]
				let inventorySpace=loot(targetPetal.id,targetPetal.rarity,targetPetal.level+1)
				player.inventory[inventorySpace].speed=targetPetal.speed
				player.inventory[inventorySpace].reload=targetPetal.reload
				player.inventory[inventorySpace].atkbuff=targetPetal.atkbuff
				player.inventory[inventorySpace].defbuff=targetPetal.defbuff
			} else {
				addLog("[Craft] Failed...","#df9f7f")
				player.bookstat.artisan.totallevelupfail++
				let loss=roll(1,lupoper.selectedArray.length-1)
				player.bookstat.artisan.totalleveluppetallostfail+=loss
				for(let i=1;i<=loss;i++) {
					let lostPetal=roll(0,lupoper.selectedArray.length-1)
					delete player.inventory[lupoper.selectedArray[lostPetal]]
					lupoper.selectedArray.splice(lostPetal,1)
				}
				addLog("[Resource] You lost "+loss+" "+targetPetal.name+"+".repeat(targetPetal.level)+"("+rarityName[targetPetal.rarity]+").","#7fff7f")
			}
			lupoper.active=false
			document.getElementById("lup-cancel").style.display=""
			document.getElementById("lup-confirm").style.display=""
			printInventory()
		}
		function cancelLevelUp() {
			if(animation) return
			for(let i in lupoper.selectedArray) printSinglePetal(lupoper.selectedArray[i])
			lupoper.active=false
			document.getElementById("lup-cancel").style.display=""
			document.getElementById("lup-confirm").style.display=""
			document.getElementById("lup-confirm").innerHTML==="[L] Level Up"
			printInventory()
			addLog("[Craft] Level up canceled. All petals returned.","#df9f7f")
		}
		function rarityUpCheck(petal) {
			if(player.book.indexOf("Flower Artisan Guide")===-1) return false
			if(petal.effect.hasOwnProperty("temploot")) return false
			if(PetalAttributeList[petal.id].match("Can't craft")!==null) return false
			if(petal.rarity===6 || petal.level===0) return false
			return true
		}
		async function rarityUp() {
			if(animation) return
			let targetPetal=player.inventory[selectedGrid.x].clone()
			if(document.getElementById("rup-btn").innerHTML==="[U] Rarity Up") {
				document.getElementById("rup-btn").innerHTML="Confirm? "+PetalRarityUpChance(targetPetal.rarity,targetPetal.level)+"% Success"
				return
			}
			addLog("[Craft] Trying to rarity up "+targetPetal.name+"+".repeat(targetPetal.level)+"("+rarityName[targetPetal.rarity]+")...","#df9f7f")
			delete player.inventory[selectedGrid.x]
			await collapseGrid(getGrid(1,selectedGrid.x,selectedGrid.y))
			selectedGrid.select=false
			let rupSuccessChance=PetalRarityUpChance(targetPetal.rarity,targetPetal.level)
			player.bookstat.artisan.totalrarityup++
			player.bookstat.artisan.totalrarityrarityup[targetPetal.rarity]++
			player.bookstat.artisan.totalrarityupexpectedsuccess+=0.01*rupSuccessChance
			player.bookstat.artisan.rarityupsuccessvariance=(0.01*rupSuccessChance)*(1-0.01*rupSuccessChance)
			if(determine(rupSuccessChance)) {
				addLog("[Craft] Success!","#df9f7f")
				player.bookstat.artisan.totalrarityupsuccess++
				let inventorySpace=loot(targetPetal.id,targetPetal.rarity+1,0)
				player.inventory[inventorySpace].speed=targetPetal.speed
				player.inventory[inventorySpace].reload=targetPetal.reload
				player.inventory[inventorySpace].atkbuff=targetPetal.atkbuff
				player.inventory[inventorySpace].defbuff=targetPetal.defbuff
				printSinglePetal(inventorySpace)
			} else {
				addLog("[Craft] Failed...","#df9f7f")
				player.bookstat.artisan.totalrarityupfail++
				let inventorySpace=loot(targetPetal.id,targetPetal.rarity,0)
				player.inventory[inventorySpace].speed=targetPetal.speed
				player.inventory[inventorySpace].reload=targetPetal.reload
				player.inventory[inventorySpace].atkbuff=targetPetal.atkbuff
				player.inventory[inventorySpace].defbuff=targetPetal.defbuff
				printSinglePetal(inventorySpace)
			}
		}
		function absorbCheck(petal) {
			if(player.book.indexOf("Flower Evolutionary Guide")===-1) return false
			if(petal.effect.hasOwnProperty("temploot")) return false
			if(PetalAttributeList[petal.id].match("Can't absorb")!==null) return false
			return true
		}
		async function absorb() {
			if(animation) return
			let targetPetal=player.inventory[selectedGrid.x].clone()
			if(document.getElementById("abs-btn").innerHTML==="Absorb") {
				document.getElementById("abs-btn").innerHTML="Confirm? +~"+PetalAbsorbExp(targetPetal.rarity,targetPetal.level)+" Exp"
				return
			}
			addLog("[Craft] Absorbing "+targetPetal.name+"+".repeat(targetPetal.level)+"("+rarityName[targetPetal.rarity]+")...","#df9f7f")
			let calculatedExp=PetalAbsorbExp(targetPetal.rarity,targetPetal.level)
			calculatedExp*=0.8+0.4*Math.random()
			calculatedExp=approx(calculatedExp)
			player.bookstat.evolutionary.totalgainedexp+=calculatedExp
			let remainExp=calculatedExp
			delete player.inventory[selectedGrid.x]
			await collapseGrid(getGrid(1,selectedGrid.x,selectedGrid.y))
			selectedGrid.select=false
			player.bookstat.evolutionary.totalabsorb++
			player.bookstat.evolutionary.totalexpectedexp+=PetalAbsorbExp(targetPetal.rarity,targetPetal.level)
			player.bookstat.evolutionary.expvariance+=ExpVariance(PetalAbsorbExp(targetPetal.rarity,targetPetal.level))
			player.bookstat.evolutionary.totalrarityabsorb[targetPetal.rarity]++
			animation=true
			while(remainExp>0) {
				let pendingExp=betterFloor(remainExp/5)+1
				if(pendingExp>LevelExp(player.level)/(10*player.level+1)) pendingExp=betterFloor(LevelExp(player.level)/(10*player.level+1))+1
				if(LevelExp(player.level)-player.exp<=pendingExp) {
					remainExp-=(LevelExp(player.level)-player.exp)
					player.level++
					player.exp=0
				} else {
					player.exp+=pendingExp
					remainExp-=pendingExp
				}
				updateFlowerState()
				await delay(100)
			}
			addLog("[Craft] Your flower gained "+calculatedExp+" Experience.","#df9f7f")
			animation=false
		}
		function absorbAllCheck() {
			if(fight.active) return false
			if(player.book.indexOf("Flower Evolutionary Guide")===-1) return false
			let absorbableCount=0
			for(let i in player.inventory) if(absorbCheck(player.inventory[i]) && player.inventory[i].star===0) absorbableCount++
			if(absorbableCount<=2) return false
			return true
		}
		async function absorbAll() {
			if(animation) return
			if(!absorbAllCheck()) {
				document.getElementById("absall-btn").style.display="none"
				return
			}
			let absorbableCount=0,absorbableExp=0,absorbableExpVariance=0
			for(let i in player.inventory) if(absorbCheck(player.inventory[i]) && player.inventory[i].star===0) {
				absorbableCount++
				absorbableExp+=PetalAbsorbExp(player.inventory[i].rarity,player.inventory[i].level)
				absorbableExpVariance+=ExpVariance(PetalAbsorbExp(player.inventory[i].rarity,player.inventory[i].level))
			}
			if(document.getElementById("absall-btn").innerHTML==="Absorb All Petals Without Star") {
				document.getElementById("absall-btn").innerHTML="Confirm? "+absorbableCount+" Petals, +~"+absorbableExp+" Exp"
				return
			}
			addLog("[Craft] Absorbing "+absorbableCount+" petals for "+absorbableExp+" expected experience.","#df9f7f")
			player.bookstat.evolutionary.totalabsorb+=absorbableCount
			player.bookstat.evolutionary.totalexpectedexp+=absorbableExp
			player.bookstat.evolutionary.expvariance+=absorbableExpVariance
			let calculatedTotalExp=0
			for(let i in player.inventory) if(absorbCheck(player.inventory[i]) && player.inventory[i].star===0) {
				player.bookstat.evolutionary.totalrarityabsorb[player.inventory[i].rarity]++
				let calculatedExp=PetalAbsorbExp(player.inventory[i].rarity,player.inventory[i].level)
				calculatedExp*=0.8+0.4*Math.random()
				calculatedExp=approx(calculatedExp)
				calculatedTotalExp+=calculatedExp
				collapseGrid(getGrid(1,i,player.inventory[i].star))
				delete player.inventory[i]
			}
			player.bookstat.evolutionary.totalgainedexp+=calculatedTotalExp
			await waitAnimation()
			selectedGrid.select=false
			animation=true
			let remainExp=calculatedTotalExp
			while(remainExp>0) {
				let pendingExp=betterFloor(remainExp/5)+1
				if(pendingExp>LevelExp(player.level)/(10*player.level+1)) pendingExp=betterFloor(LevelExp(player.level)/(10*player.level+1))+1
				if(LevelExp(player.level)-player.exp<=pendingExp) {
					remainExp-=(LevelExp(player.level)-player.exp)
					player.level++
					player.exp=0
				} else {
					player.exp+=pendingExp
					remainExp-=pendingExp
				}
				updateFlowerState()
				await delay(100)
			}
			addLog("[Craft] Your flower gained "+calculatedTotalExp+" Experience.","#df9f7f")
			document.getElementById("absall-btn").style.display="none"
			animation=false
		}
		function updateFlowerState() {
			if(explore.hasOwnProperty("energy")) {
				document.getElementById("bar-energy").style.height=(explore.energy/100)+"%"
				if(explore.energy<10000 && explore.energy>=3600) {
					document.getElementById("bar-energy").innerHTML=betterFloor(explore.energy/100)+"<span class='text5'>."+(betterFloor(explore.energy/10)%10)+(explore.energy%10)+"%</span>"
				} else {
					document.getElementById("bar-energy").innerHTML=""
				}
				document.getElementById("bar-energy-c").style.display="unset"
			}
			if(fight.active) {
				document.getElementById("flower-maxhealth").innerHTML="&nbsp;"
				document.getElementById("flower-level").innerHTML="&nbsp;"
				document.getElementById("bar-exp-c").style.display="none"
				fight.flower.health=FlowerMaxHealth()
				let barPercentage=fight.flower.currenthealth/fight.flower.health*100
				if(barPercentage>=12) {
					document.getElementById("bar-health").style.width=barPercentage+"%"
					document.getElementById("bar-health").style.opacity=1
				} else {
					document.getElementById("bar-health").style.width="12%"
					document.getElementById("bar-health").style.opacity=barPercentage/12
				}
				document.getElementById("flower-health").innerHTML="Health: "+fight.flower.currenthealth+"/"+fight.flower.health
				document.getElementById("bar-health-c").style.display="unset"
				if(fight.flower.effect.hasOwnProperty("bloom")) {
					if(getGrid(3,1,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,1,1,"Bloom",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,1,1)!==null) collapseGrid(getGrid(3,1,1))
				}
				if(fight.flower.effect.hasOwnProperty("immunity")) {
					if(getGrid(3,2,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,2,1,"Immunity",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,2,1)!==null) collapseGrid(getGrid(3,2,1))
				}
				if(fight.flower.effect.hasOwnProperty("thorn")) {
					if(getGrid(3,3,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,3,1,"Thorn",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,3,1)!==null) collapseGrid(getGrid(3,3,1))
				}
				if(fight.flower.effect.hasOwnProperty("shield")) {
					if(getGrid(3,4,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,4,1,"Shield",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,4,1)!==null) collapseGrid(getGrid(3,4,1))
				}
				if(fight.flower.effect.hasOwnProperty("purity")) {
					if(getGrid(3,5,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,5,1,"Purity",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,5,1)!==null) collapseGrid(getGrid(3,5,1))
				}
				if(fight.flower.effect.hasOwnProperty("evasion")) {
					if(getGrid(3,6,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,6,1,"Evasion",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,6,1)!==null) collapseGrid(getGrid(3,6,1))
				}
				if(fight.flower.effect.hasOwnProperty("resistance")) {
					if(getGrid(3,7,1)===null) document.getElementById("flower-effect").insertBefore(createGrid(3,7,1,"Resistance",-1),document.getElementById("flower-effect").firstChild)
				} else {
					if(getGrid(3,7,1)!==null) collapseGrid(getGrid(3,7,1))
				}
				if(fight.flower.effect.hasOwnProperty("poison")) {
					if(getGrid(3,1,2)===null) document.getElementById("flower-effect").appendChild(createGrid(3,1,2,"Poison",-1))
				} else {
					if(getGrid(3,1,2)!==null) collapseGrid(getGrid(3,1,2))
				}
				if(fight.flower.effect.hasOwnProperty("suppression")) {
					if(getGrid(3,2,2)===null) document.getElementById("flower-effect").appendChild(createGrid(3,2,2,"Suppression",-1))
				} else {
					if(getGrid(3,2,2)!==null) collapseGrid(getGrid(3,2,2))
				}
				if(fight.flower.effect.hasOwnProperty("vulnerability")) {
					if(getGrid(3,3,2)===null) document.getElementById("flower-effect").appendChild(createGrid(3,3,2,"Vulnerability",-1))
				} else {
					if(getGrid(3,3,2)!==null) collapseGrid(getGrid(3,3,2))
				}
				if(fight.flower.effect.hasOwnProperty("wither")) {
					if(getGrid(3,4,2)===null) document.getElementById("flower-effect").appendChild(createGrid(3,4,2,"Wither",-1))
				} else {
					if(getGrid(3,4,2)!==null) collapseGrid(getGrid(3,4,2))
				}
			} else {
				document.getElementById("flower-effect").innerHTML=""
				document.getElementById("bar-health-c").style.display="none"
				document.getElementById("flower-maxhealth").innerHTML="Max Health: "+FlowerMaxHealth()
				document.getElementById("flower-level").innerHTML="Level: "+player.level
				if(player.book.indexOf("Flower Evolutionary Guide")>-1) {
					let barPercentage=player.exp/LevelExp(player.level)*100
					if(barPercentage>=12) {
						document.getElementById("bar-exp").style.width=barPercentage+"%"
						document.getElementById("bar-exp").style.opacity=1
					} else {
						document.getElementById("bar-exp").style.width="12%"
						document.getElementById("bar-exp").style.opacity=barPercentage/12
					}
					document.getElementById("flower-exp").innerHTML="Exp: "+player.exp+"/"+LevelExp(player.level)
				} else {
					document.getElementById("bar-exp").style.width="0%"
					document.getElementById("flower-exp").innerHTML="Exp: -/-"
				}
				document.getElementById("flower-maxhealth").style.display="unset"
				document.getElementById("bar-exp-c").style.display="unset"
			}
			document.getElementById("flower-state").style.display="flex"
		}
		function updateT() {
			if(fight.hasOwnProperty("spevent")) {
				if(fight.spevent.event>=101 && fight.spevent.event<=109) {
					document.getElementById("fight-t-btn").innerHTML="[T] Exit Early"
					document.getElementById("fight-t-btn").setAttribute("onclick","endFight()")
					document.getElementById("fight-t-btn").style.cursor="default"
				}
				return
			}
			if(fight.active===false) return
			if(operingX!==0 && operingType==="Attack") {
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===operingX && fight.mob[i].y===operingY) {
					document.getElementById("fight-t-btn").innerHTML=AttackSuccessChance(operingThing,fight.mob[i],"Auto","Auto")+"% Success"
					document.getElementById("fight-t-btn").setAttribute("onclick","operResult()")
					document.getElementById("fight-t-btn").style.cursor="default"
				}
				return
			}
			if(operingX!==0 && operingType==="Shoot") {
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===operingX && fight.mob[i].y===operingY) {
					document.getElementById("fight-t-btn").innerHTML=ShootSuccessChance(operingThing,fight.mob[i])+"% Success"
					document.getElementById("fight-t-btn").setAttribute("onclick","operResult()")
					document.getElementById("fight-t-btn").style.cursor="default"
				}
				return
			}
			if(operingX!==0 && operingType==="Defend") {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].x===operingX && fight.petal[i].y===operingY) {
					document.getElementById("fight-t-btn").innerHTML=DefendSuccessChance(fight.petal[i],operingThing,"Auto","Auto")+"% Success"
					document.getElementById("fight-t-btn").setAttribute("onclick","operResult()")
					document.getElementById("fight-t-btn").style.cursor="default"
				}
				return
			}
			if(operingType!=="Inactive") {
				document.getElementById("fight-t-btn").innerHTML="Manipulating..."
				document.getElementById("fight-t-btn").setAttribute("onclick","operResult()")
				document.getElementById("fight-t-btn").style.cursor="default"
				return
			}
			if(fight.ready===false) {
				document.getElementById("fight-t-btn").innerHTML="[T] Ready to Fight. Requires "+fight.petal.length+"/"+FlowerSlot()+" equipped petals."
				if(fight.petal.length===FlowerSlot()) {
					document.getElementById("fight-t-btn").setAttribute("onclick","readyFight()")
					document.getElementById("fight-t-btn").style.cursor="pointer"
				} else {
					document.getElementById("fight-t-btn").setAttribute("onclick","")
					document.getElementById("fight-t-btn").style.cursor="not-allowed"
				}
				return
			}
			if(fight.turn==="Bonus") {
				document.getElementById("fight-t-btn").innerHTML="[T] End Turn (Bonus Turn)"
				document.getElementById("fight-t-btn").setAttribute("onclick","endTurn()")
				document.getElementById("fight-t-btn").style.cursor="pointer"
			}
			if(fight.turn==="Flower") {
				document.getElementById("fight-t-btn").innerHTML="[T] End Turn"
				document.getElementById("fight-t-btn").setAttribute("onclick","endTurn()")
				document.getElementById("fight-t-btn").style.cursor="pointer"
			}
			if(fight.turn==="Mob") {
				document.getElementById("fight-t-btn").innerHTML="[T] Confirm"
				document.getElementById("fight-t-btn").setAttribute("onclick","actionConfirm()")
				document.getElementById("fight-t-btn").style.cursor="pointer"
			}
		}
		let trackingGrid,trackingX=0,trackingY=0,trackingType=0
		function trackCheck(newX,newY) {
			if(newY<=3) return false
			for(let k in fight.petal) if(fight.petal[k].x===newX && fight.petal[k].y===newY) return false
			return true
		}
		function trackGrid() {
			if(PetalAttributeList[player.inventory[selectedGrid.x].id].match("DECORATION")!==null) {
				if(Math.abs(mouseY-getGrid(2,0,0).getBoundingClientRect().top-40)<=25 && Math.abs(mouseX-getGrid(2,0,0).getBoundingClientRect().left-40)<=25) {
					trackingGrid.style.top=getGrid(2,0,0).getBoundingClientRect().top+40+"px"
					trackingGrid.style.left=getGrid(2,0,0).getBoundingClientRect().left+40+"px"
					trackingY=-1
					return
				}
			} else {
				for(let i=1;i<=8;i++) {
					for(let j=1;j<=6;j++) {
						if(Math.abs(mouseY-getGrid(0,i,j).getBoundingClientRect().top-40)<=25 && Math.abs(mouseX-getGrid(0,i,j).getBoundingClientRect().left-40)<=25 && trackCheck(i,j)) {
							trackingGrid.style.top=getGrid(0,i,j).getBoundingClientRect().top+40+"px"
							trackingGrid.style.left=getGrid(0,i,j).getBoundingClientRect().left+40+"px"
							trackingX=i
							trackingY=j
							return
						}
					}
				}
			}
			trackingGrid.style.top=mouseY+"px"
			trackingGrid.style.left=mouseX+"px"
			trackingX=0
			trackingY=0
		}
		let operingGrid,operingThing,operingX=0,operingY=0,operingType="Inactive"
		function operCheck(newX,newY) {
			if(operingType==="Move") {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].x===newX && fight.petal[i].y===newY) return false
				if(discalc(operingThing.x,newX)+discalc(operingThing.y,newY,0)!==1) return false
				if(operingThing.name!=="Pearl" && newY<=3) return false
				if(operingThing.actionbar<moveRequirement(operingThing,newX,newY)) return false
				return true
			}
			if(operingType==="Attack") {
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===newX && fight.mob[i].y===newY) {
					if(discalc(operingThing.x,newX)>1) return false
					if(AttackSuccessChance(operingThing,fight.mob[i],"Auto","Auto")>0) {
						updateT()
						return true
					}
					return false
				}
				return false
			}
			if(operingType==="Shoot") {
				for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===newX && fight.mob[i].y===newY) {
					if(ShootSuccessChance(operingThing,fight.mob[i])>0) {
						updateT()
						return true
					}
					return false
				}
				return false
			}
			if(operingType==="Skill") {
				if(operingThing.name==="Yin") return (newX===operingThing.x)
				if(operingThing.name==="Yang") return (newY===operingThing.y)
				if(operingThing.name==="Compass") return (discalc(newX,3)+discalc(newY,5,0)===1)
			}
			if(operingType==="Defend") {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].x===newX && fight.petal[i].y===newY) {
					if(fight.petal[i].name==="Bulb" && fight.petal[i].calculate>0) return false
					if(discalc(operingThing.x,newX)>1) return false
					if(newY<=4 && fight.petal[i].name!=="Pearl") return false
					if(newY<=operingThing.y) return false
					if(DefendSuccessChance(fight.petal[i],operingThing,"Auto","Auto")>0) {
						updateT()
						return true
					}
					return false
				}
				return false
			}
			if(operingType==="Item") {
				if(operingThing==="Arrow") {
					for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===newX && fight.mob[i].y===newY) {
						return true
					}
					return false
				}
				return false
			}
		}
		function operGrid() {
			for(let i=1;i<=8;i++) {
				for(let j=1;j<=6;j++) {
					if(Math.abs(mouseY-getGrid(0,i,j).getBoundingClientRect().top-40)<=25 && Math.abs(mouseX-getGrid(0,i,j).getBoundingClientRect().left-40)<=25) {
						if(!operCheck(i,j)) continue
						operingGrid.style.top=getGrid(0,i,j).getBoundingClientRect().top+40+"px"
						operingGrid.style.left=getGrid(0,i,j).getBoundingClientRect().left+40+"px"
						operingX=i
						operingY=j
						if(operingType==="Skill" && operingThing.name==="Yin" && getGrid(79,0,0)===null) {
							let operingShift=new Array()
							for(let k=0;k<fight.petal.length;k++) if(fight.petal[k].state!=="Retired" && fight.petal[k].x===operingThing.x) {
								operingShift.push(fight.petal[k].clone())
							}
							for(let k=0;k<fight.mob.length;k++) if(fight.mob[k].x===operingThing.x) {
								operingShift.push(fight.mob[k].clone())
							}
							let shiftY=toCord(operingY-operingThing.y,6)
							for(let k=0;k<operingShift.length;k++) {
								operingShift[k].y=toCord(operingShift[k].y+shiftY,6)
								if(isMob(operingShift[k])) {
									operingShift[k].y=toCord(operingShift[k].y,3)
								} else if(operingShift[k].name!=="Pearl") {
									 operingShift[k].y=toCord(operingShift[k].y,3)+3
								}
							}
							for(let k=0;k<operingShift.length;k++) {
								let operingShiftGrid
								if(isMob(operingShift[k])) {
									operingShiftGrid=createGrid(79,0,0,"Mob_"+operingShift[k].name,1,operingShift[k].rarity)
								} else if(operingShift[k].name.match(/\?/)===null) {
									operingShiftGrid=createGrid(79,0,0,"Petal_"+PetalNameList[operingShift[k].id],1,operingShift[k].rarity)
								} else {
									operingShiftGrid=createGrid(79,0,0,"Mob_"+operingShift[k].name.slice(0,-1),1,operingShift[k].rarity)
								}
								if(operingShift[k].name==="Pearl") {
									for(let l=0;l<operingShift.length;l++) if(l!==k && operingShift[l].x===operingShift[k].x && operingShift[l].y===operingShift[k].y) operingShift[k].y=toCord(operingShift[l].y+3,6)
								}
								operingShiftGrid.setAttribute("class","smid bgrid apos")
								operingShiftGrid.style.top=getGrid(0,operingShift[k].x,operingShift[k].y).getBoundingClientRect().top+40+"px"
								operingShiftGrid.style.left=getGrid(0,operingShift[k].x,operingShift[k].y).getBoundingClientRect().left+40+"px"
								operingShiftGrid.setAttribute("onclick","operResult()")
								operingShiftGrid.style.opacity=0.3
								document.body.appendChild(operingShiftGrid)
							}
							return
						}
						if(operingType==="Skill" && operingThing.name==="Yang" && getGrid(79,0,0)===null) {
							let operingShift=new Array()
							for(let k=0;k<fight.petal.length;k++) if(fight.petal[k].state!=="Retired" && fight.petal[k].y===operingThing.y) {
								operingShift.push(fight.petal[k].clone())
							}
							let shiftX=toCord(operingX-operingThing.x)
							for(let k=0;k<operingShift.length;k++) {
								operingShift[k].x=toCord(operingShift[k].x+shiftX)
							}
							for(let k=0;k<operingShift.length;k++) {
								let operingShiftGrid
								if(operingShift[k].name.match(/\?/)===null) {
									operingShiftGrid=createGrid(79,0,0,"Petal_"+PetalNameList[operingShift[k].id],1,operingShift[k].rarity)
								} else {
									operingShiftGrid=createGrid(79,0,0,"Mob_"+operingShift[k].name.slice(0,-1),1,operingShift[k].rarity)
								}
								operingShiftGrid.setAttribute("class","smid bgrid apos")
								operingShiftGrid.style.top=getGrid(0,operingShift[k].x,operingShift[k].y).getBoundingClientRect().top+40+"px"
								operingShiftGrid.style.left=getGrid(0,operingShift[k].x,operingShift[k].y).getBoundingClientRect().left+40+"px"
								operingShiftGrid.setAttribute("onclick","operResult()")
								operingShiftGrid.style.opacity=0.3
								document.body.appendChild(operingShiftGrid)
							}
							return
						}
						if(operingType==="Attack" && operingThing.name==="Air") {
							if(mouseY-getGrid(0,i,j).getBoundingClientRect().top-40>15) {
								if(operingThing.calculate===1) return
								operingThing.calculate=1
								getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='grey-path rcap' d='M50 18L37 31M50 18L63 31M50 18L50 62'></path>"
							} else if(mouseX-getGrid(0,i,j).getBoundingClientRect().left-40<-15) {
								if(operingThing.calculate===2) return
								operingThing.calculate=2
								getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='grey-path rcap' d='M72 40L59 27M72 40L59 53M72 40L28 40'></path>"
							} else if(mouseY-getGrid(0,i,j).getBoundingClientRect().top-40<-15) {
								if(operingThing.calculate===3) return
								operingThing.calculate=3
								getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='grey-path rcap' d='M50 62L63 49M50 62L37 49M50 62L50 18'></path>"
							} else if(mouseX-getGrid(0,i,j).getBoundingClientRect().left-40>15) {
								if(operingThing.calculate===4) return
								operingThing.calculate=4
								getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='grey-path rcap' d='M28 40L41 53M28 40L41 27M28 40L72 40'></path>"
							} else {
								if(operingThing.calculate===0) return
								operingThing.calculate=0
								getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='fwhite-path ns' fill-opacity='0.1' d='M0 0L100 0L100 100L0 100'></path>"
							}
						}
						return
					}
				}
			}
			operingGrid.style.top=mouseY+"px"
			operingGrid.style.left=mouseX+"px"
			operingY=0
			if(operingX!==0) {
				operingX=0
				if(operingThing.name==="Yin" || operingThing.name==="Yang") removeTempGrid()
				if(operingType==="Attack" && operingThing.name==="Air" && operingThing.calculate>0) {
					operingThing.calculate=0
					getGrid(6361,0,0).children[1].children[0].innerHTML="<path class='fwhite-path ns' fill-opacity='0.1' d='M0 0L100 0L100 100L0 100'></path>"
				}
				updateT()
			}
		}
		function operPrepare(operitem,type) {
			operingType=type
			operingThing=operitem
			if(isPetal(operingThing)) {
				if(operingThing.name.match(/\?/)===null) {
					operingGrid=createGrid(6361,0,0,"Petal_"+PetalNameList[operingThing.id],1,operingThing.rarity)
				} else {
					operingGrid=createGrid(6361,0,0,"Mob_"+operingThing.name.slice(0,-1),1,operingThing.rarity)
				}
			}
			if(operingType==="Defend") operingGrid=createGrid(6361,0,0,"Defend",1,explore.floor+1)
			if(operingType==="Item" && operingThing==="Arrow") operingGrid=createGrid(6361,0,0,"Item_Arrow",1,1)
			operingGrid.setAttribute("class","smid bgrid apos")
			operingGrid.setAttribute("onclick","operResult()")
			operingGrid.style.opacity=0.6
			operingX=0
			operingY=0
			operGrid()
			if(isPetal(operingThing) && operingThing.y>0) getGrid(0,selectedGrid.x,selectedGrid.y).style.opacity=0.4
			selectedGrid.select=false
			closeGridInfo()
			document.body.appendChild(operingGrid)
			document.addEventListener("mousemove",operGrid)
			if(operingType==="Skill" && isPetal(operingThing) && operingThing.name==="Compass") {
				let operCentralGrid=createGrid(79,0,0,"Diamond",1,operingThing.rarity+1)
				operCentralGrid.setAttribute("class","smid bgrid apos")
				operCentralGrid.style.top=getGrid(0,3,5).getBoundingClientRect().top+40+"px"
				operCentralGrid.style.left=getGrid(0,3,5).getBoundingClientRect().left+40+"px"
				operCentralGrid.setAttribute("onclick","operResult()")
				operCentralGrid.style.opacity=0.3
				document.body.appendChild(operCentralGrid)
			}
			updateT()
		}
		function operResult() {
			if(animation) return
			if(operingX!==0) {
				if(operingType==="Move") {
					operingThing.actionbar-=moveRequirement(operingThing,operingX,operingY)
					operingThing.move(operingX,operingY)
				}
				if(operingType==="Attack") {
					if(operingThing.name==="Chip" && operingThing.effect.hasOwnProperty("immunity")) {
						operingThing.actionbar-=50
					} else {
						operingThing.actionbar-=attackRequirement(operingThing)
					}
					operingThing.attack(operingX,operingY)
				}
				if(operingType==="Shoot") {
					operingThing.shoot(operingX,operingY)
				}
				if(operingType==="Skill") {
					if(operingThing.name==="Yin") {
						addLog("[Petal] Petals shifted.","#9f9fdf")
						operingThing.actionbar-=skillRequirement(operingThing)
						let shiftY=toCord(operingY-operingThing.y,6)
						for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].x===operingThing.x) {
							getGrid(0,fight.petal[i].x,fight.petal[i].y).replaceWith(createGrid(0,fight.petal[i].x,fight.petal[i].y,"Empty",1,0))
							fight.petal[i].y=toCord(fight.petal[i].y+shiftY,6)
							if(fight.petal[i].name!=="Pearl") fight.petal[i].y=toCord(fight.petal[i].y,3)+3
						}
						for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===operingThing.x) {
							getGrid(0,fight.mob[i].x,fight.mob[i].y).replaceWith(createGrid(0,fight.mob[i].x,fight.mob[i].y,"Empty",1,0))
							fight.mob[i].y=toCord(fight.mob[i].y+shiftY,3)
						}
						for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].x===operingThing.x) {
							if(fight.petal[i].name==="Pearl") {
								fight.petal[i].y+=6
								if(getFilledGrid(fight.petal[i].x,fight.petal[i].y-6)) fight.petal[i].y-=3
								fight.petal[i].y=toCord(fight.petal[i].y,6)
							}
							fight.petal[i].print()
							if(fight.petal[i]!==operingThing && fight.petal[i].speed>1) fight.petal[i].progress(5*operingThing.rarity-10)
						}
						for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].state!=="Retired" && fight.mob[i].x===operingThing.x) {
							fight.mob[i].print()
						}
						fight.manipulate=false
					}
					if(operingThing.name==="Yang") {
						addLog("[Petal] Petals shifted.","#9f9fdf")
						operingThing.actionbar-=skillRequirement(operingThing)
						let shiftX=toCord(operingX-operingThing.x)
						for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].y===operingThing.y) {
							getGrid(0,fight.petal[i].x,fight.petal[i].y).replaceWith(createGrid(0,fight.petal[i].x,fight.petal[i].y,"Empty",1,0))
							fight.petal[i].x=toCord(fight.petal[i].x+shiftX)
						}
						for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].y===operingThing.y) {
							fight.petal[i].print()
						}
						fight.manipulate=false
					}
					if(operingThing.name==="Compass") {
						for(let i=1;i<=4;i++) if(3+dx[i]===operingX && 5+dy[i]===operingY) {
							operingThing.calculate=i
							operingThing.print()
						}
						fight.manipulate=false
					}
				}
				if(operingType==="Defend") {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired" && fight.petal[i].x===operingX && fight.petal[i].y===operingY) {
						mobDefend(fight.petal[i])
						if(fight.petal[i].name==="Bulb" && fight.petal[i].calculate>0) return
					}
				}
				if(operingType==="Item") {
					for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].x===operingX && fight.mob[i].y===operingY) fight.mob[i].injure(50,"Arrow")
				}
			} else {
				if(operingType==="Attack" && operingThing.name==="Air") operingThing.calculate=0
				if(operingType==="Move" || operingType==="Attack" || operingType==="Skill") {
					if(operingThing.y>0) {
						getGrid(0,selectedGrid.x,selectedGrid.y).style.opacity=1
					}
					fight.manipulate=false
				}
				if(operingType==="Shoot") {
					if(operingThing.shootatt.bounce===0) {
						getGrid(0,selectedGrid.x,selectedGrid.y).style.opacity=1
						fight.manipulate=false
					} else {
						operingThing.shoot(0,0)
					}
				}
				if(operingType==="Defend") mobDefend("Skip")
			}
			document.removeEventListener("mousemove",operGrid)
			document.body.removeChild(operingGrid)
			if(operingType==="Skill" && (operingThing.name==="Yin" || operingThing.name==="Yang" || operingThing.name==="Compass")) {
				removeTempGrid()
			}
			let operingTypeSave=operingType
			operingType="Inactive"
			updateT()
			if(operingTypeSave==="Shoot" && operingThing.shootatt.continue) {
				delete operingThing.shootatt.continue
				operPrepare(operingThing,"Shoot")
			}
			if(operingTypeSave==="Defend" && operingThing.name==="Shell" && operingThing.calculate===1) {
				operingThing.calculate=0
				let shootingMissile=operingThing.clone()
				shootingMissile.origin=operingThing
				shootingMissile.name+=" (Missile)"
				shootingMissile.dodge=10
				fight.missile.push(shootingMissile)
			}
			return
		}
		function equipCheck(petal) {
			if(fight.petal.length>=FlowerSlot()) return false
			if(PetalAttributeList[petal.id].match("Can't equip")!==null) return false
			if(PetalAttributeList[petal.id].match("Doesn't stack")!==null) {
				for(let i in fight.petal) if(fight.petal[i].id===petal.id) return false
			}
			return true
		}
		function equip(type) {
			if(type===-1) {
				if(trackingX!==0) {
					fight.petal.push(player.inventory[selectedGrid.x].clone())
					fight.petal[fight.petal.length-1].x=trackingX
					fight.petal[fight.petal.length-1].y=trackingY
					fight.petal[fight.petal.length-1].origin=player.inventory[selectedGrid.x]
					fight.petal[fight.petal.length-1].originorder=selectedGrid.x
					getGrid(0,trackingX,trackingY).replaceWith(createGrid(0,trackingX,trackingY,"Petal_"+fight.petal[fight.petal.length-1].name,1,fight.petal[fight.petal.length-1].rarity))
					if(trackingType===1) fight.petal[fight.petal.length-1].name="Yin"
					if(trackingType===2) fight.petal[fight.petal.length-1].name="Yang"
				}
				if(trackingY===-1) {
					fight.petal.push(player.inventory[selectedGrid.x].clone())
					fight.petal[fight.petal.length-1].x=selectedGrid.x
					fight.petal[fight.petal.length-1].y=0
					fight.petal[fight.petal.length-1].origin=player.inventory[selectedGrid.x]
					fight.petal[fight.petal.length-1].originorder=selectedGrid.x
					getGrid(2,0,0).replaceWith(createGrid(2,selectedGrid.x,0,"Petal_"+fight.petal[fight.petal.length-1].name,1,fight.petal[fight.petal.length-1].rarity))
					if(trackingType===1) fight.petal[fight.petal.length-1].name="Concentrated Eye"
					if(trackingType===2) fight.petal[fight.petal.length-1].name="Specialized Eye"
				}
				document.removeEventListener("mousemove",trackGrid)
				document.body.removeChild(trackingGrid)
				if(PetalAttributeList[player.inventory[selectedGrid.x].id].match("DECORATION")!==null && trackingY===0) {
					getGrid(2,0,0).remove()
				}
				updateT()
				return
			}
			trackingGrid=createGrid(6361,0,0,"Petal_"+player.inventory[selectedGrid.x].name,1,player.inventory[selectedGrid.x].rarity)
			trackingGrid.setAttribute("class","smid bgrid apos")
			trackingGrid.setAttribute("onclick","equip(-1)")
			trackingGrid.style.opacity=0.6
			trackingType=type
			if(PetalAttributeList[player.inventory[selectedGrid.x].id].match("DECORATION")!==null) {
				document.getElementById("fight-item").prepend(createGrid(2,0,0,"Space",1,0))
			}
			trackGrid()
			openInventory(false)
			document.body.appendChild(trackingGrid)
			document.addEventListener("mousemove",trackGrid)
		}
		function unequip() {
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].x===selectedGrid.x && fight.petal[i].y===selectedGrid.y) fight.petal.splice(i,1)
			collapseGrid(getGrid(selectedGrid.value,selectedGrid.x,selectedGrid.y))
			selectedGrid.select=false
			updateT()
		}
		function getFilledGrid(targetX,targetY) {
			let filledGrid=new Array()
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired") filledGrid.push(fight.petal[i].x*10+fight.petal[i].y)
			for(let i=0;i<fight.mob.length;i++) filledGrid.push(fight.mob[i].x*10+fight.mob[i].y)
			if(targetX!==undefined) {
				if(filledGrid.indexOf(targetX*10+targetY)===-1) return false
				return true
			}
			return filledGrid
		}
		function fullGrid() {
			let filledGrid=getFilledGrid()
			for(let i=1;i<=8;i++) {
				for(let j=1;j<=3;j++) if(filledGrid.indexOf(10*i+j)===-1) return false
			}
			return true
		}
		function fillMob() {
			for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].name==="Termite Mound" && fight.mob[i].count===1) return
			while(fight.mob.length<FloorCapacity(explore.floor) && fight.spawnmob.length) {
				if(fullGrid()) return
				addLog("[Mob] "+fight.spawnmob[0].name+" with "+fight.spawnmob[0].health+" health spawned.","#bfbf00")
				if(fight.spawnmob[0].effect.hasOwnProperty("summoned")) {
					delete fight.spawnmob[0].effect.summoned
				} else {
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Antennae" && (!fight.petal[i].effect.hasOwnProperty("refresh")) && determine(5*fight.petal[i].rarity-10,true," for refresh chance")) {
						fight.petal[i].effect.refresh=true
					}
				}
				let filledGrid=getFilledGrid()
				filledGrid.push(0)
				fight.mob.push(fight.spawnmob.splice(0,1)[0])
				while(filledGrid.indexOf(fight.mob[fight.mob.length-1].x*10+fight.mob[fight.mob.length-1].y)>=0) {
					fight.mob[fight.mob.length-1].x=roll(1,8)
					fight.mob[fight.mob.length-1].y=roll(1,3)
				}
				fight.mob[fight.mob.length-1].print()
			}
			if(fight.mob.length===0) endFight(true)
		}
		function spawnMob() {
			for(let i=0;i<fight.mob.length;i++) {
				getGrid(0,fight.mob[i].x,fight.mob[i].y).replaceWith(createGrid(0,fight.mob[i].x,fight.mob[i].y,"Empty",1,0))
			}
			fight.mob=new Array()
			fight.spawnmob=new Array()
			if(explore.floor===0 && explore.flowerspot===11 && explore.event.hasOwnProperty("evolutionaryguide") && explore.event.evolutionaryguide!=="Completed") {
				fight.spawnmob[0]=new Mob("Rock",7,0)
				fight.spawnmob[0].effect.noloot=1
				fillMob()
				return
			}
			if(explore.floor===0 && explore.flowerspot===21 && explore.event.hasOwnProperty("artisanguide") && explore.event.artisanguide!=="Completed") {
				fight.spawnmob[0]=new Mob("!Summoner!",1,0)
				for(let i=1;i<=5;i++) {
					fight.spawnmob[i]=new Mob("Beetle",1,0)
					fight.spawnmob[i].effect.noloot=true
				}
				fillMob()
				return
			}
			if(explore.flowerspot===67) {
				for(let i=0;i<3;i++) fight.spawnmob[i]=new Mob(explore.floorboss[i]+100,BossRarity(explore.floor,i+1))
				fillMob()
				return
			}
			let minSpawn=parseInt(MapDensityList[explore.flowerspot].match(/^\d+/))*FloorDensityMultiplier(explore.floor),maxSpawn=parseInt(MapDensityList[explore.flowerspot].match(/(?<=-)\d+/))*FloorDensityMultiplier(explore.floor)
			let totalSpawn=roll2(minSpawn,maxSpawn)
			for(let i=0;i<totalSpawn;i++) {
				fight.spawnmob[i]=new Mob(MobID(explore.flowerspot),MobRarity(MapWave(explore.floor,MapRarityList[explore.flowerspot])))
			}
			fillMob()
		}
		async function endTurn() {
			if(animation) return
			if(selectedGrid.select===true) return
			if(cornerDisplay()) return
			closeGridInfo()
			if(fight.turn==="Mob" && bonusTurnCheck()) {
				addLog("[Turn] Mob turn ended. Bonus flower turn starts.","#df9f9f")
				fight.turn="Bonus"
				fight.manipulate=false
				for(let i=0;i<fight.petal.length;i++) fight.petal[i].progress()
				updateT()
				return
			}
			if(fight.turn==="Bonus" || fight.turn==="Mob") {
				fight.turnnum++
				if(fight.turn==="Bonus") {
					addLog("[Turn] Bonus flower turn ended. Flower turn starts.","#df9f9f")
				} else {
					addLog("[Turn] Mob turn ended. Flower turn starts.","#df9f9f")
				}
				if(fight.flower.effect.hasOwnProperty("immunity")) {
					fight.flower.effect.immunity.turn--
					if(!fight.flower.effect.immunity.turn) delete fight.flower.effect.immunity
					updateFlowerState()
				}
				if(fight.flower.effect.hasOwnProperty("shield")) {
					fight.flower.effect.shield*=0.95
					if(fight.flower.effect.shield<1) delete fight.flower.effect.shield
					updateFlowerState()
				}
				if(fight.flower.effect.hasOwnProperty("evasion")) {
					fight.flower.effect.evasion.turn--
					if(!fight.flower.effect.evasion.turn) delete fight.flower.effect.evasion
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Talisman" && determine(20+3*fight.petal[i].rarity+fight.petal[i].level,true," for evasion")) {
					flowerHeal({effectturn:1},"Evasion")
				}
				updateFlowerState()
				if(fight.flower.effect.hasOwnProperty("poison")) {
					addLog("[Flower] Flower received "+fight.flower.effect.poison[0]+" damage from poison.","#00bfbf")
					fight.flower.currenthealth-=fight.flower.effect.poison[0]
					if(fight.flower.currenthealth<=0) yggpls()
					if(fight.flower.currenthealth<=0) {
						flowerRetreat()
						return
					}
					if(fight.flower.effect.hasOwnProperty("poison")) {
						fight.flower.effect.poison.splice(0,1)
						if(!fight.flower.effect.poison.length) delete fight.flower.effect.poison
					}
					updateFlowerState()
				}
				if(fight.flower.effect.hasOwnProperty("suppression")) {
					fight.flower.effect.suppression.turn--
					if(!fight.flower.effect.suppression.turn) delete fight.flower.effect.suppression
					updateFlowerState()
				}
				if(fight.flower.effect.hasOwnProperty("vulnerability")) {
					fight.flower.effect.vulnerability.splice(0,1)
					if(!fight.flower.effect.vulnerability.length) delete fight.flower.effect.vulnerability
					updateFlowerState()
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Sponge" && fight.petal[i].effect.hasOwnProperty("stagger")) {
					addLog("[Flower] Flower received "+ fight.petal[i].effect.stagger[0]+" damage from stagger.","#00bfbf")
					fight.flower.currenthealth-=fight.petal[i].effect.stagger[0]
					if(fight.flower.currenthealth<=0) yggpls()
					if(fight.flower.currenthealth<=0) {
						flowerRetreat()
						return
					}
					if(fight.petal[i].effect.hasOwnProperty("stagger")) {
						fight.petal[i].effect.stagger.splice(0,1)
						if(!fight.petal[i].effect.stagger.length) delete fight.petal[i].effect.stagger
					}
					updateFlowerState()
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Dice") {
					fight.petal[i].reset()
					fight.petal[i].calculate=0
					delete fight.petal[i].effect.surge
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Compass") {
					if(fight.petal[i].rarity>=6) {
						fight.petal[i].calculate=0
					} else {
						fight.petal[i].calculate=roll(1,4)
					}
					fight.petal[i].print()
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Chip") {
					fight.petal[i].calculate=0
					delete fight.petal[i].effect.immunity
				}
				fight.turn="Flower"
				fight.manipulate=false
				for(let i=0;i<fight.petal.length;i++) fight.petal[i].progress()
				updateT()
				return
			}
			if(fight.turn==="Flower") {
				if(!fight.flower.effect.hasOwnProperty("suppression")) {
					let pendingHeal=0
					for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state!=="Retired") {
						if(fight.petal[i].name==="Leaf") {
							pendingHeal+=fight.petal[i].health/10
						}
						if(fight.petal[i].name==="Yucca") {
							let nearbyCount=0
							for(let j=0;j<fight.petal.length;j++) if(fight.petal[j].state!=="Retired" && fight.petal[j].y>0 && discalc(fight.petal[j].x,fight.petal[i].x)+discalc(fight.petal[j].y,fight.petal[i].y,0)===1) nearbyCount++
							if(nearbyCount>=2) pendingHeal+=fight.petal[i].health/10
						}
						if(fight.petal[i].name==="Starfish") {
							if(fight.flower.currenthealth<=fight.flower.health/2) pendingHeal+=fight.petal[i].health/10
						}
					}
					if(pendingHeal>0) flowerHeal(approx(pendingHeal),"Passive Healings")
				}
				if(explore.floor>=1) {
					fight.energy--
					explore.energy=fight.energy
					updateFlowerState()
					if(explore.energy<3600) {
						localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
						flowerRetreat()
					}
				}
				addLog("[Turn] Flower turn ended. Mob turn starts.","#df9f9f")
				fight.turn="Mob"
				fight.manipulate=true
				for(let i=fight.mob.length-1;i>=0;i--) {
					fight.mob[i].progress()
					if(fight.mob[i].effect.hasOwnProperty("poison")) {
						if(fight.mob[i].effect.hasOwnProperty("immunity")) fight.mob[i].effect.poison[0]=0
						addLog("[Mob] "+fight.mob[i].name+" received "+fight.mob[i].effect.poison[0]+" damage from poison.","#bfbf00")
						fight.mob[i].currenthealth-=fight.mob[i].effect.poison[0]
						fight.mob[i].effect.poison.splice(0,1)
						if(!fight.mob[i].effect.poison.length) delete fight.mob[i].effect.poison
						fight.mob[i].print()
						if(fight.mob[i].currenthealth<=0) {
							await fight.mob[i].remove()
							continue
						}
					}
					if(fight.mob[i].effect.hasOwnProperty("suppression")) {
						fight.mob[i].effect.suppression.turn--
						if(!fight.mob[i].effect.suppression.turn) delete fight.mob[i].effect.suppression
					}
					if(fight.mob[i].effect.hasOwnProperty("immunity")) {
						fight.mob[i].effect.immunity--
						if(!fight.mob[i].effect.immunity) delete fight.mob[i].effect.immunity
					}
					if(fight.mob[i].effect.hasOwnProperty("doom")) {
						fight.mob[i].effect.doom--
						if(!fight.mob[i].effect.doom) {
							await fight.mob[i].doom()
							continue
						}
					}
					if(fight.mob[i].effect.hasOwnProperty("vulnerability")) {
						fight.mob[i].effect.vulnerability.splice(0,1)
						if(!fight.mob[i].effect.vulnerability.length) delete fight.mob[i].effect.vulnerability
					}
				}
				fillMob()
				if(fight.mob.length===0) return
				mobActionCheck()
				return
			}
		}
		function bonusTurnCheck() {
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Powder") {
				return determine(5*fight.petal[i].rarity-5,true," for bonus turn")
			}
			return false
		}
		async function flowerRetreat() {
			fight.flower.currenthealth=0
			fight.manipulate=true
			localStorage.setItem("FLORROOMfight",JSON.stringify(fight))
			updateFlowerState()
			clearAllInterval()
			document.getElementById("end1").style["pointer-events"]="unset"
			for(let i=0;i<=30;i++) {
				document.getElementById("end1").style.opacity=i/30
				await delay(100)
			}
			location.reload()
		}
		function yggpls() {
			addLog("[Chat] Traveler: ygg pls","#5f5f5f")
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Yggdrasil") {
				delete fight.flower.effect.poison
				delete fight.flower.effect.suppression
				delete fight.flower.effect.vulnerability
				delete fight.flower.effect.wither
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Sponge") delete fight.petal[i].effect.stagger
				flowerHeal({effectturn:1},"Immunity")
				fight.flower.currenthealth=fight.flower.health
				fight.petal[i].destroy("Skill")
				addLog("[Chat] Traveler: ty","#5f5f5f")
				return
			}
			addLog("[Chat] Traveler: nooooo","#5f5f5f")
		}
		function flowerInjure(damage,mob) {
			if(fight.flower.effect.hasOwnProperty("immunity")) return
			let mobName=mob
			if(isMob(mob)) mobName=mob.name
			if(mobName==="Poison") {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Lotus") return
				addLog("[Flower] Flower is poisoned.","#00bfbf")
				let resultingPoison=damage.effectdamage,resultingTurn=damage.effectturn
				if(!fight.flower.effect.hasOwnProperty("poison")) fight.flower.effect.poison=new Array()
				for(let i=0;i<resultingTurn;i++) {
					if(!fight.flower.effect.poison.hasOwnProperty(i)) fight.flower.effect.poison[i]=0
					if(fight.flower.effect.poison[i]<resultingPoison) fight.flower.effect.poison[i]=resultingPoison
				}
				updateFlowerState()
				return
			}
			if(mobName==="Suppression") {
				if(fight.flower.effect.hasOwnProperty("purity")) return
				addLog("[Flower] Flower is suppressed.","#00bfbf")
				let resultingStrength=0,resultingTurn=damage.effectturn
				if(damage.effectstrength) resultingStrength=damage.effectstrength/100
				if(!fight.flower.effect.hasOwnProperty("suppression")) fight.flower.effect.suppression={turn:0,debuff:0}
				if(damage.stackable) {
					fight.flower.effect.suppression.turn+=resultingTurn
				} else if(fight.flower.effect.suppression.turn<resultingTurn) {
					fight.flower.effect.suppression.turn=resultingTurn
				}
				if(resultingStrength) fight.flower.effect.suppression.debuff=1-(1-fight.flower.effect.suppression.debuff)*(1-resultingStrength)
				updateFlowerState()
				return
			}
			if(mobName==="Vulnerability") {
				addLog("[Flower] Flower is vulnerable.","#00bfbf")
				let resultingStrength=damage.effectstrength,resultingTurn=damage.effectturn
				if(!fight.flower.effect.hasOwnProperty("vulnerability")) fight.flower.effect.vulnerability=new Array()
				for(let i=0;i<resultingTurn;i++) {
					if(!fight.flower.effect.vulnerability.hasOwnProperty(i)) fight.flower.effect.vulnerability[i]=0
					if(damage.fullystackable) {
						fight.flower.effect.vulnerability[i]+=resultingStrength
					} else {
						fight.flower.effect.vulnerability[i]=(fight.flower.effect.vulnerability[i]**1.5+resultingStrength**1.5)**(1/1.5)
					}
				}
				updateFlowerState()
				return
			}
			if(mobName==="Wither") {
				addLog("[Flower] Flower is withered.","#00bfbf")
				let resultingStrength=damage.effectstrength
				if(damage.effectstrength) resultingStrength=damage.effectstrength
				if(!fight.flower.effect.hasOwnProperty("wither")) fight.flower.effect.wither={debuff:0}
				fight.flower.effect.wither.debuff+=resultingStrength
				if(fight.flower.effect.wither.debuff===0) delete fight.flower.effect.wither
				fight.flower.health=FlowerMaxHealth()
				updateFlowerState()
				return
			}
			let resultingDamage=damage,energyLoss=0
			if(isMob(mob)) energyLoss=3
			if(mobName==="!Roach!" && mob.effect.quickness>4) {
				let damageBuff=20*(mob.effect.quickness-4)
				if(damageBuff>100) damageBuff=100
				resultingDamage+=approx(resultingDamage*damageBuff/100)
			}
			if(mobName==="!Leafbug!" && mob.effect.quickness>3) {
				let damageDebuff=10*(mob.effect.quickness-3)
				resultingDamage-=approx(resultingDamage*damageDebuff/100)
				if(resultingDamage<0) resultingDamage=0
			}
			if(explore.floor>=1 && fight.energy<6400) resultingDamage=approx(resultingDamage*3000/(fight.energy-3500))
			if(fight.flower.effect.hasOwnProperty("vulnerability") && isMob(mob)) resultingDamage+=approx(fight.flower.effect.vulnerability[0])
			if(fight.flower.effect.hasOwnProperty("resistance") && isMob(mob)) {
				resultingDamage-=approx(fight.flower.effect.resistance.buff)
				if(resultingDamage<0) resultingDamage=0
			}
			if(mobName==="Lightning") {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Magnet" && resultingDamage>0) {
					let absorption=Math.min(resultingDamage,fight.petal[i].currenthealth)
					fight.petal[i].injure(absorption,"Absorption")
					resultingDamage-=absorption
				}
			}
			if(isMob(mob) && resultingDamage>0) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Disc") {
					resultingDamage-=approx(resultingDamage*(0.2+0.03*fight.petal[i].rarity+0.01*fight.petal[i].level))
				}
			}
			addLog("[Flower] Flower received "+resultingDamage+" damage from "+mobName+".","#00bfbf")
			let resultingInjure=resultingDamage
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Suspended" && fight.petal[i].name==="Cotton") {
				if(energyLoss>1) energyLoss/=3
				if(fight.petal[i].currenthealth>resultingInjure) {
					fight.petal[i].injure(resultingInjure,"Absorption")
					resultingInjure=0
				} else {
					resultingInjure-=fight.petal[i].currenthealth
					fight.petal[i].injure(fight.petal[i].currenthealth,"Absorption")
				}
			}
			if(fight.flower.effect.hasOwnProperty("shield") && mobName!=="Lightning") {
				if(fight.flower.effect.shield>resultingInjure) {
					fight.flower.effect.shield-=resultingInjure
					resultingInjure=0
				} else {
					resultingInjure-=approx(fight.flower.effect.shield)
					fight.flower.effect.shield=0
				}
				if(fight.flower.effect.shield<1) delete fight.flower.effect.shield
			}
			for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Sponge" && resultingInjure>0) {
				if(!fight.petal[i].effect.hasOwnProperty("stagger")) fight.petal[i].effect.stagger=new Array()
				let spreadTurn=2*fight.petal[i].rarity+fight.petal[i].level
				for(let j=0;j<spreadTurn;j++) {
					if(!fight.petal[i].effect.stagger.hasOwnProperty(j)) fight.petal[i].effect.stagger[j]=0
					fight.petal[i].effect.stagger[j]+=betterFloor((resultingInjure+spreadTurn-j-1)/spreadTurn)
					if(fight.petal[i].effect.stagger[j]===0) delete fight.petal[i].effect.stagger[j]
				}
				resultingInjure=0
			}
			if(resultingInjure) {
				fight.flower.currenthealth-=resultingInjure
			}
			if(isMob(mob)) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Rubber" && determine(20+3*fight.petal[i].rarity+fight.petal[i].level,true," for evasion")) {
					energyLoss*=3
					flowerHeal({effectturn:3},"Evasion")
				}
			}
			if(explore.floor>=1 && energyLoss>0) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Battery" && determine(20+3*fight.petal[i].rarity+fight.petal[i].level,true," for recharge")) {
					energyLoss=0
				}
			}
			if(explore.floor>=1 && energyLoss>0) {
				fight.energy-=energyLoss
				explore.energy=fight.energy
				updateFlowerState()
				if(explore.energy<3600) {
					localStorage.setItem("FLORROOMexplore",JSON.stringify(explore))
					flowerRetreat()
				}
			}
			if(fight.flower.currenthealth<=0 && mobName==="Blood Stinger") fight.flower.currenthealth=1
			if(fight.flower.currenthealth<=0) yggpls()
			if(fight.flower.currenthealth<=0) {
				flowerRetreat()
				return
			}
			if(isMob(mob) && fight.flower.effect.hasOwnProperty("thorn") && mob.currenthealth>0) {
				let reflectedDamage=approx(resultingDamage*fight.flower.effect.thorn.buff/100)
				mob.injure(reflectedDamage,"Thorn")
			}
			if(isMob(mob) && MobAttributeList[mob.id].match("BOSS")!==null) {
				flowerInjure({effectstrength:approx(resultingDamage/10)},"Wither")
			}
			if(mobName==="Spider") {
				flowerInjure({effectdamage:approx(mob.damage/3),effectturn:8},"Poison")
			}
			if(mobName==="Leech" && mob.currenthealth>0) {
				let pendingHeal=resultingDamage
				addLog("[Mob] Leech heals for "+pendingHeal+" health.","#bfbf00")
				mob.currenthealth+=pendingHeal
				if(mob.currenthealth>mob.health) mob.currenthealth=mob.health
				mob.print()
			}
			if(mobName==="Spider (Hell)") {
				flowerInjure({effectdamage:approx(mob.damage*2/3),effectturn:8},"Poison")
			}
			if(mobName==="!Spider!") {
				flowerInjure({effectdamage:approx(mob.damage/5),effectturn:20},"Poison")
			}
			if(mobName==="!Leech!" && mob.currenthealth>0) {
				let pendingHeal=resultingDamage
				addLog("[Mob] !Leech! heals for "+pendingHeal+" health.","#bfbf00")
				mob.currenthealth+=pendingHeal
				if(mob.currenthealth>mob.health) mob.currenthealth=mob.health
				mob.print()
			}
			updateFlowerState()
		}
		function flowerHeal(healing,petal) {
			let petalName=petal
			if(isPetal(petal)) petalName=petal.name
			if(petalName==="Immunity") {
				addLog("[Flower] Flower is invincible.","#00bfbf")
				let resultingTurn=healing.effectturn
				if(!fight.flower.effect.hasOwnProperty("immunity")) fight.flower.effect.immunity={turn:0}
				if(fight.flower.effect.immunity.turn<resultingTurn) fight.flower.effect.immunity.turn=resultingTurn
				updateFlowerState()
				return
			}
			if(petalName==="Shield") {
				addLog("[Flower] Flower is shielded.","#00bfbf")
				let resultingShield=healing
				if(!fight.flower.effect.hasOwnProperty("shield")) fight.flower.effect.shield=0
				fight.flower.effect.shield+=resultingShield
				if(fight.flower.effect.shield===0) delete fight.flower.effect.shield
				updateFlowerState()
				return
			}
			if(petalName==="Evasion") {
				addLog("[Flower] Flower is evasive.","#00bfbf")
				let resultingTurn=healing.effectturn
				if(!fight.flower.effect.hasOwnProperty("evasion")) fight.flower.effect.evasion={turn:0}
				if(fight.flower.effect.evasion.turn<resultingTurn) fight.flower.effect.evasion.turn=resultingTurn
				updateFlowerState()
				return
			}
			let resultingHealing=healing
			if(fight.flower.effect.hasOwnProperty("purity")) resultingHealing+=approx(resultingHealing*fight.flower.effect.purity.buff/100)
			if(fight.flower.effect.hasOwnProperty("suppression") && petalName!=="Epic Rose Juice") resultingHealing-=approx(resultingHealing*fight.flower.effect.suppression.debuff)
			addLog("[Flower] Flower received "+resultingHealing+" healing from "+petalName+".","#00bfbf")
			fight.flower.currenthealth+=resultingHealing
			if(fight.flower.currenthealth>fight.flower.health) {
				let overheal=fight.flower.currenthealth-fight.flower.health
				fight.flower.currenthealth=fight.flower.health
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Amulet") {
					flowerHeal(approx(overheal*(0.1*fight.petal[i].rarity+0.05*fight.petal[i].level)),"Shield")
				}
			}
			updateFlowerState()
		}
		function spawnNear(mob,targetX,targetY,noloot) {
			if(targetX===0 && targetY===0) {
				addLog("[Mob] "+mob.name+" with "+mob.health+" health spawned.","#bfbf00")
				let pendingPlace=new Array()
				for(let i=1;i<=8;i++) {
					for(let j=1;j<=3;j++) if(!getFilledGrid(i,j)) pendingPlace.push({x:i,y:j})
				}
				let resultingPlace=pendingPlace[roll(0,pendingPlace.length-1)]
				fight.mob.push(mob)
				fight.mob[fight.mob.length-1].x=resultingPlace.x
				fight.mob[fight.mob.length-1].y=resultingPlace.y
				if(noloot) fight.mob[fight.mob.length-1].effect.noloot=true
				fight.mob[fight.mob.length-1].print()
				return
			}
			let pendingPlace=new Array()
			if(!getFilledGrid(targetX,targetY)) pendingPlace.push(0)
			if(targetY>1 && !getFilledGrid(targetX,targetY-1)) pendingPlace.push(1)
			if(!getFilledGrid(toCord(targetX+1),targetY)) pendingPlace.push(2)
			if(targetY<3 && !getFilledGrid(targetX,targetY+1)) pendingPlace.push(3)
			if(!getFilledGrid(toCord(targetX-1),targetY)) pendingPlace.push(4)
			if(pendingPlace.length>0) {
				addLog("[Mob] "+mob.name+" with "+mob.health+" health spawned.","#bfbf00")
				let resultingPlace=pendingPlace[roll(0,pendingPlace.length-1)]
				fight.mob.push(mob)
				fight.mob[fight.mob.length-1].x=toCord(targetX+dx[resultingPlace])
				fight.mob[fight.mob.length-1].y=targetY+dy[resultingPlace]
				if(noloot) fight.mob[fight.mob.length-1].effect.noloot=true
				fight.mob[fight.mob.length-1].print()
			} else {
				fight.spawnmob.unshift(mob)
				fight.spawnmob[0].effect.summoned=true
				if(noloot) fight.spawnmob[0].effect.noloot=true
			}
		}
		function moveRequirement(petal,movex,movey) {
			let answer=100
			if(petal.name==="Beetle?") answer=4
			if(petal.name==="Pearl") answer+=50
			if(petal.name==="Sandstorm?") answer=8
			if(petal.name==="Soldier Ant?") answer=5
			if(movex===undefined) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Compass") {
					answer-=approx(answer*0.1*fight.petal[i].rarity)
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Moon Rock") {
					answer=0
				}
			} else {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Compass" && toCord(petal.x+dx[fight.petal[i].calculate])===movex && petal.y+dy[fight.petal[i].calculate]===movey) {
					answer-=approx(answer*0.1*fight.petal[i].rarity)
				}
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].state==="Existing" && fight.petal[i].name==="Moon Rock") {
					if(discalc(movex,fight.petal[i].x)+discalc(movey,fight.petal[i].y,0)<discalc(petal.x,fight.petal[i].x)+discalc(petal.y,fight.petal[i].y,0)) {
						answer=0
					} else {
						answer+=50
					}
				}
			}
			return answer
		}
		function moveCheck(petal) {
			if(petal.state!=="Existing") return false
			if(PetalAttributeList[petal.id].match("Can't move")!==null) return false
			if(petal.actionbar<moveRequirement(petal)) return false
			return true
		}
		function attackRequirement(petal) {
			let answer=200
			if(petal.name==="Beetle?") answer=4
			if(petal.name==="Sandstorm?") answer=8
			if(petal.name==="Soldier Ant?") answer=5
			return answer
		}
		function attackCheck(petal) {
			if(petal.state!=="Existing") return false
			if(petal.y===6) return false
			if(petal.y===5 && petal.atk1===0) return false
			if(petal.y===4 && petal.atk2===0) return false
			if(petal.actionbar<attackRequirement(petal)) return false
			return true
		}
		function shootRequirement(petal) {
			let answer=200
			return answer
		}
		function shootCheck(petal) {
			if(petal.state!=="Existing") return false
			if(PetalAttributeList[petal.id].match("SHOOT")===null) return false
			if(petal.actionbar<shootRequirement(petal)) return false
			return true
		}
		function skillRequirement(petal) {
			let answer=0
			if(PetalAttributeList[petal.id].match(/(?<=SKILL=Costs )\d+(?= action)/)!==null) {
				answer=parseInt(PetalAttributeList[petal.id].match(/(?<=SKILL=Costs )\d+(?= action)/))
			}
			return answer
		}
		function skillCheck(petal) {
			if(petal.state!=="Existing") return false
			if(petal.name==="Antennae" && petal.effect.hasOwnProperty("refresh")) return true
			if(petal.name==="Compass" && petal.rarity>=6 && petal.calculate===0) return true
			if(PetalAttributeList[petal.id].match("SKILL")===null) return false
			if(petal.name.match(/\?/)!==null) return false
			if(petal.actionbar<skillRequirement(petal)) return false
			if(petal.name==="Shovel" && fight.flower.currenthealth<=approx(fight.flower.health*(0.3-0.03*petal.rarity-0.01*petal.level))) return false
			return true
		}
		function mobDefend(petal) {
			if(animation) return
			if(petal==="Skip") addLog("[Flower] Defend Skipped","#00bfbf")
			if(isPetal(petal) && determine(DefendSuccessChance(petal,operingThing,"Auto","Auto"),true," for defend")) {
				for(let i=0;i<fight.petal.length;i++) if(fight.petal[i].name==="Bulb" && fight.petal[i].calculate>0) fight.petal[i].calculate=0
				if(petal.name==="Heavy" && operingThing.y>1 && (!getFilledGrid(operingThing.x,operingThing.y-1)) && determine(30+5*petal.rarity,true," for push")) {
					addLog("[Mob] "+operingThing.name+" is pushed upwards.","#bfbf00")
					getGrid(0,operingThing.x,operingThing.y).replaceWith(createGrid(0,operingThing.x,operingThing.y,"Empty",1,0))
					operingThing.y--
					operingThing.print()
				}
				let damageDealt=petal.damage,damageReceived=operingThing.damage,knockbackDealt=0
				if(petal.name==="Corn") {
					knockbackDealt+=50
				}
				if(petal.name==="Jelly") {
					knockbackDealt+=100
				}
				if(operingThing.effect.hasOwnProperty("levelup")) {
					damageReceived*=1.2**operingThing.effect.levelup
					damageReceived=approx(damageReceived)
				}
				if(operingThing.name==="Bumble Bee") {
					damageReceived=approx(damageReceived/2)
				}
				if(petal.name==="Plank" && operingThing.name.match("(Missile)")!==null) {
					damageReceived=0
				}
				if(petal.effect.hasOwnProperty("surge")) {
					damageDealt+=approx(damageDealt*petal.effect.surge/100)
				}
				if(petal.name==="Relic" && operingThing.behavior==="Neutral+") {
					addLog("[Mob] "+operingThing.name+" returns to passive.","#bfbf00")
					operingThing.behavior="Neutral"
				} else {
					petal.injure(damageReceived,operingThing)
					if(operingThing.currenthealth>0) operingThing.injure(damageDealt,petal)
				}
				if(knockbackDealt) operingThing.knockback(knockbackDealt)
				if(petal.name==="Rock" && petal.actionbar>0) {
					petal.actionbar-=50
					if(petal.actionbar<0) petal.actionbar=0
					petal.print()
				}
				if(petal.name==="Wing" && petal.actionbar>0) {
					petal.actionbar=0
					petal.print()
				}
				if(petal.name==="Honey" && determine(50-5*petal.rarity," for immune")) {
					addLog("[Mob] "+operingThing.name+" has developed immunity to honey.","#bfbf00")
					operingThing.effect.honeyimmunity=true
				}
				if(petal.name==="Fangs") {
					flowerHeal(approx(damageDealt/2),"Lifesteal")
				}
				if(petal.name==="Poo") {
					operingThing.injure({effectturn:5+2*petal.level},"Tardy")
				}
				if(operingThing.name==="Shell") {
					operingThing.calculate=1
				}
				if(operingThing.name==="!Shell!") {
					if(!operingThing.effect.hasOwnProperty("pearl")) operingThing.effect.pearl=0
					operingThing.effect.pearl+=roll(1,2)
				}
				operingThing.print()
			} else {
				if(petal.name==="Bulb") {
					petal.calculate=1
					return
				}
				let damageReceived=operingThing.damage,undefended=true
				if(operingThing.effect.hasOwnProperty("levelup")) {
					damageReceived*=1.2**operingThing.effect.levelup
					damageReceived=approx(damageReceived)
				}
				if(petal.name==="Plank" && operingThing.name.match("(Missile)")!==null) {
					petal.injure(2*damageReceived,operingThing)
					damageReceived=0
					undefended=false
				}
				if(petal==="Skip" && fight.flower.effect.hasOwnProperty("evasion")) {
					undefended=false
				}
				if(undefended) {
					flowerInjure(damageReceived,operingThing)
				}
				if(operingThing.name==="Scorpion (Missile)" && undefended) {
					flowerInjure({effectdamage:approx(operingThing.origin.damage/3),effectturn:8},"Poison")
				}
				if(operingThing.name==="Dandelion (Missile)" && undefended) {
					flowerInjure({stackable:false,effectturn:10},"Suppression")
				}
				if(operingThing.name==="Mantis (Missile)" && undefended) {
					flowerInjure({fullystackable:false,effectstrength:operingThing.origin.damage/4,effectturn:10},"Vulnerability")
				}
				if(operingThing.name==="!Dandelion! (Missile)" && undefended) {
					flowerInjure({stackable:true,effectstrength:20,effectturn:6},"Suppression")
				}
				if(operingThing.name==="!Scorpion! (Missile)" && undefended) {
					flowerInjure({effectdamage:approx(0.4*operingThing.origin.damage),effectturn:6},"Poison")
				}
				if(operingThing.name==="!Mantis! (Missile)" && undefended) {
					flowerInjure({fullystackable:true,effectstrength:0.4*operingThing.origin.damage,effectturn:20},"Vulnerability")
				}
				operingThing.print()
			}
			if(isPetal(petal) && petal.name==="Chip" && petal.effect.hasOwnProperty("immunity")) {
				petal.progress(250)
			}
			if(operingThing.name==="Dandelion (Missile)" && operingThing.origin.calculate>1) {
				operingThing.origin.calculate--
			}
			if(operingThing.name==="Dandelion (Missile)" && operingThing.origin.calculate===1) {
				operingThing.origin.calculate=0
			}
			if(operingThing.name==="Firefly") {
				flowerInjure(3*operingThing.damage,"Lightning")
			}
			if(operingThing.name==="!Dandelion! (Missile)" && operingThing.origin.calculate>1) {
				operingThing.origin.calculate--
			}
			if(operingThing.name==="!Dandelion! (Missile)" && operingThing.origin.calculate===1) {
				operingThing.origin.calculate=0
			}
			confirmation2=false
		}
		function useItem(itemname) {
			if(animation) return
			if(itemname==="Energy Drink") {
				if(!player.item.subtract("Energy Drink",1)) return
				selectedGrid.select=false
				closeGridInfo()
				flowerHeal(20,"Energy Drink")
			}
			if(itemname==="Arrow") {
				if(!player.item.subtract("Arrow",1)) return
				operPrepare("Arrow","Item")
			}
			if(itemname==="Epic Rose Juice") {
				if(!player.item.subtract("Epic Rose Juice",1)) return
				selectedGrid.select=false
				closeGridInfo()
				flowerHeal(FlowerMaxHealth(),"Epic Rose Juice")
				fight.energy+=500
				if(fight.energy>10000) fight.energy=10000
				explore.energy=fight.energy
				updateFlowerState()
			}
			if(itemname==="Triple Web") {
				if(!player.item.subtract("Triple Web",1)) return
				selectedGrid.select=false
				closeGridInfo()
				for(let i=0;i<fight.petal.length;i++) {
					fight.petal[i].actionbar=0
					fight.petal[i].print()
				}
				for(let i=0;i<fight.mob.length;i++) {
					fight.mob[i].actionbar=0
					fight.mob[i].print()
				}
				flowerInjure({effectstrength:approx(fight.flower.health/10)},"Wither")
				if(fight.flower.currenthealth>fight.flower.health) fight.flower.currenthealth=fight.flower.health
			}
		}
		function mobActionCheck() {
			let actionMobArray=new Array()
			for(let i=0;i<fight.mob.length;i++) if(fight.mob[i].actionbar>=200) actionMobArray.push(i)
			if(actionMobArray.length===0) {
				endTurn()
				return
			}
			let actionMob=actionMobArray[roll(0,actionMobArray.length-1)]
			fight.mob[actionMob].action()
		}
		function actionConfirm() {
			if(animation) return
			mobActionCheck()
		}
		function missileCheck() {
			if(fight.missile.length===0) {
				missile=false
				updateT()
				return
			}
			missile=true
			fight.missile[0].attack()
			fight.missile.splice(0,1)
		}
	</script>
	<script>
		function Card(drawPlayer) {
			this.rarity=5,this.level=0,this.health=1,this.damage=1,this.dpt=0
			let seed=roll(1,100)
			if(seed<=85) {
				if(seed<=25) {
					this.id=1,this.name="Rock"
				} else if(seed<=50) {
					this.id=2,this.name="Blood Stinger"
				} else if(seed<=75) {
					this.id=3,this.name="Dice"
				} else {
					this.id=4,this.name="Air"
				}
				this.rarity=roll(1,4),this.level=roll(0,3)
				let ownArray={1:new Array(),2:new Array(),3:new Array(),4:new Array()}
				if(drawPlayer==="Traveler") {
					for(let i in player.inventory) if(player.inventory[i].rarity<=4 && player.inventory[i].level<=3) {
						ownArray[player.inventory[i].rarity][player.inventory[i].level]=true
					}
				} else {
					if(drawPlayer>=1) ownArray[1][0]=ownArray[2][0]=true
					if(drawPlayer>=2) ownArray[1][1]=ownArray[3][0]=true
					if(drawPlayer>=3) ownArray[2][1]=ownArray[3][1]=true
					if(drawPlayer>=4) ownArray[1][2]=ownArray[4][0]=true
					if(drawPlayer>=5) ownArray[2][2]=ownArray[4][1]=true
					if(drawPlayer>=6) ownArray[1][3]=ownArray[3][2]=true
					if(drawPlayer>=7) ownArray[2][3]=ownArray[4][2]=true
					if(drawPlayer>=8) ownArray[3][3]=ownArray[4][3]=true
				}
				while(this.level>0 && !ownArray[this.rarity][this.level]) this.level--
				while(!ownArray[this.rarity][this.level]) this.rarity--
				if(this.id<=3) {
					if(drawPlayer==="Traveler") {
						let cardPetal=new Petal(this.name,this.rarity,this.level,false)
						this.health=cardPetal.health
						this.damage=cardPetal.damage
						if(this.id===2) this.damage*=2
						if(this.id===1) this.dpt=2*this.damage*2*cardPetal.speed/(cardPetal.reload+2*attackRequirement(new Object()))
						if(this.id===2) this.dpt=this.damage*2*cardPetal.speed/(cardPetal.reload+attackRequirement(new Object()))
						if(this.id===3) this.dpt=6*this.damage*2*cardPetal.speed/(cardPetal.reload+attackRequirement(new Object()))
						this.dpt=approx(this.dpt)
					} else {
						let cardPetal=new Petal(this.name,this.rarity,this.level,false,true)
						if(drawPlayer===9) {
							cardPetal.health=approx(1.5*cardPetal.health)
							cardPetal.damage=approx(1.5*cardPetal.damage)
						}
						if(drawPlayer>6) {
							cardPetal.speed=approx(1.2*cardPetal.speed)
							cardPetal.reload=approx(0.8*cardPetal.reload)
						} else if(drawPlayer>3) {
							cardPetal.speed=approx(1.1*cardPetal.speed)
							cardPetal.reload=approx(0.9*cardPetal.reload)
						}
						this.health=cardPetal.health
						this.damage=cardPetal.damage
						if(this.id===2) this.damage*=2
						if(this.id===1) this.dpt=2*this.damage*2*cardPetal.speed/(cardPetal.reload+400)
						if(this.id===2) this.dpt=this.damage*2*cardPetal.speed/(cardPetal.reload+200)
						if(this.id===3) this.dpt=6*this.damage*2*cardPetal.speed/(cardPetal.reload+200)
						this.dpt=approx(this.dpt)
					}
				}
				return
			}
			if(seed<=87) {
				this.id=5,this.name="Yggdrasil"
				return
			}
			if(seed<=93) {
				this.id=6,this.name="Criticize"
				return
			}
			if(seed<=99) {
				this.id=7,this.name="Disregard"
				return
			}
			this.id=8,this.name="Refresh"
		}
		Card.prototype.print=function(x,y,force=false) {
			if(this.name==="Air" && determine(20)) force=true
			if(y<=3 && !force) {
				getGrid(0,x,y).replaceWith(createGrid(0,x,y,"Card_Default",1,this.rarity))
			} else {
				getGrid(0,x,y).replaceWith(createGrid(0,x,y,"Card_"+this.name,1,this.rarity))
			}
		}
		function printTopic(topicNumber) {
			let topicText=["None","Health","Damage","DPT","Specialty","Scarcity"]
			getGrid(0,8,3).replaceWith(createGrid(0,8,3,"Text_Topic<br><sub>"+topicText[topicNumber]+"</sub>",1,7))
		}
		function momentumDecrease(player,decrease=1) {
			if(player==="Traveler") {
				fight.spevent.travelermomentum-=decrease
				if(fight.spevent.travelermomentum<0) fight.spevent.travelermomentum=0
				let momentumList=[0,10,20,20,20,30,30,30,30,30]
				let remainPercentage=fight.spevent.travelermomentum/momentumList[fight.spevent.event-100]*100
				let newPath="M0 0L100 0L100 "+(100-remainPercentage)+"L0 "+(100-remainPercentage)+"Z"
				getGrid(0,3,6).children[0].children[0].setAttribute("d",newPath)
				getGrid(0,6,6).children[0].children[0].setAttribute("d",newPath)
			} else {
				fight.spevent.opponentmomentum-=decrease
				if(fight.spevent.opponentmomentum<0) fight.spevent.opponentmomentum=0
				let momentumList=[0,10,20,20,20,30,30,30,30,30]
				let remainPercentage=fight.spevent.opponentmomentum/momentumList[fight.spevent.event-100]*100
				let newPath="M0 0L100 0L100 "+(100-remainPercentage)+"L0 "+(100-remainPercentage)+"Z"
				getGrid(0,3,1).children[0].children[0].setAttribute("d",newPath)
				getGrid(0,6,1).children[0].children[0].setAttribute("d",newPath)
			}
		}
		async function compareCard(topic,travelerCard,opponentCard) {
			let talkElement=document.createElement("span")
			talkElement.setAttribute("class","blue rmid text3")
			if(travelerCard.name==="Refresh" && opponentCard.name==="Refresh") {
				await delay(1000)
				return
			}
			if(travelerCard.name==="Refresh" && opponentCard.id<=5) {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				for(let i of [1,2,4,5,7,8]) if(i!==fight.spevent.travelerselect) {
					fight.spevent.travelercard[i]=new Card("Traveler")
					fight.spevent.travelercard[i].print(i,6)
				}
				talkElement.innerHTML="I have something else to show you."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Refresh") {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				for(let i of [1,2,4,5,7,8]) if(i!==fight.spevent.travelerselect) {
					fight.spevent.travelercard[i]=new Card("Traveler")
					fight.spevent.travelercard[i].print(i,6)
				}
				talkElement.innerHTML="Wait... How about these?"
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Refresh" && travelerCard.id<=5) {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				for(let i of [1,2,4,5,7,8]) if(i!==fight.spevent.opponentselect) {
					fight.spevent.opponentcard[i]=new Card(fight.spevent.event-100)
					fight.spevent.opponentcard[i].print(i,1)
				}
				talkElement.innerHTML="I have something else to show you."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Refresh") {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				for(let i of [1,2,4,5,7,8]) if(i!==fight.spevent.opponentselect) {
					fight.spevent.opponentcard[i]=new Card(fight.spevent.event-100)
					fight.spevent.opponentcard[i].print(i,1)
				}
				talkElement.innerHTML="Wait... How about these?"
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Disregard" && opponentCard.name==="Disregard") {
				await delay(1000)
				return
			}
			if(travelerCard.name==="Disregard" && opponentCard.id<=5) {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				talkElement.innerHTML="I didn't hear that."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Disregard") {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				talkElement.innerHTML="We need to talk about something else."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Disregard" && travelerCard.id<=5) {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				talkElement.innerHTML="I didn't hear that."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Disregard") {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				talkElement.innerHTML="We need to talk about something else."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Criticize" && opponentCard.name==="Criticize") {
				await delay(1000)
				return
			}
			if(travelerCard.name==="Criticize") {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				momentumDecrease("Opponent")
				let winWords=["","That is slow.","You will die faster.","It needs good luck.","Literally useless.","Not possible to get."]
				talkElement.innerHTML=winWords[opponentCard.id]
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Criticize") {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				momentumDecrease("Traveler")
				let winWords=["","That is slow.","You will die faster.","It needs good luck.","Literally useless.","Not possible to get."]
				talkElement.innerHTML=winWords[travelerCard.id]
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Yggdrasil" && opponentCard.name==="Yggdrasil") {
				await delay(1000)
				return
			}
			if(travelerCard.name==="Air" && opponentCard.name==="Air") {
				await delay(1000)
				return
			}
			if(travelerCard.name==="Yggdrasil" && topic===4) {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				momentumDecrease("Opponent")
				talkElement.innerHTML="You need second chance for safe farm."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Yggdrasil" && topic===4) {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				momentumDecrease("Traveler")
				talkElement.innerHTML="You need second chance for safe farm."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Yggdrasil" && topic===5) {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				momentumDecrease("Opponent",3)
				talkElement.innerHTML="It is quite rare."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Yggdrasil" && topic===5) {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				momentumDecrease("Traveler",3)
				talkElement.innerHTML="It is quite rare."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(travelerCard.name==="Air" && topic===4) {
				talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Traveler"
				momentumDecrease("Opponent")
				talkElement.innerHTML="It is useful in some builds."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(opponentCard.name==="Air" && topic===4) {
				talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
				fight.spevent.turn="Opponent"
				momentumDecrease("Traveler")
				talkElement.innerHTML="It is useful in some builds."
				document.body.appendChild(talkElement)
				await delay(2000)
				talkElement.remove()
				return
			}
			if(topic===1) {
				if(travelerCard.health===1) {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,"Cross",1,0))
				} else {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,travelerCard.health,1,0))
				}
				if(opponentCard.health===1) {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,"Cross",1,0))
				} else {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,opponentCard.health,1,0))
				}
				let winWords=["It is more durable.","It defends multiple mobs at the same time.","High damage saves time.","Good DPT is required for boss fight."]
				if(travelerCard.health>opponentCard.health) {
					talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Traveler"
					momentumDecrease("Opponent")
					talkElement.innerHTML=winWords[travelerCard.id]
					if(travelerCard.name==="Rock" && opponentCard.name==="Rock") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				if(opponentCard.health>travelerCard.health) {
					talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Opponent"
					momentumDecrease("Traveler")
					talkElement.innerHTML=winWords[opponentCard.id]
					if(travelerCard.name==="Rock" && opponentCard.name==="Rock") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				await delay(1000)
				return
			}
			if(topic===2) {
				if(travelerCard.damage===1) {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,"Cross",1,0))
				} else {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,travelerCard.damage,1,0))
				}
				if(opponentCard.damage===1) {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,"Cross",1,0))
				} else {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,opponentCard.damage,1,0))
				}
				let winWords=["It has higher damage.","Defend is important anyways.","It instant kills neutral mobs.","Good DPT is required for boss fight."]
				if(travelerCard.damage>opponentCard.damage) {
					talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Traveler"
					momentumDecrease("Opponent")
					talkElement.innerHTML=winWords[travelerCard.id]
					if(travelerCard.name==="Blood Stinger" && opponentCard.name==="Blood Stinger") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				if(opponentCard.damage>travelerCard.damage) {
					talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Opponent"
					momentumDecrease("Traveler")
					talkElement.innerHTML=winWords[opponentCard.id]
					if(travelerCard.name==="Blood Stinger" && opponentCard.name==="Blood Stinger") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				await delay(1000)
				return
			}
			if(topic===3) {
				if(travelerCard.dpt===0) {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,"Cross",1,0))
				} else {
					getGrid(0,4,4).replaceWith(createGrid(0,4,4,travelerCard.dpt,1,0))
				}
				if(opponentCard.dpt===0) {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,"Cross",1,0))
				} else {
					getGrid(0,5,3).replaceWith(createGrid(0,5,3,opponentCard.dpt,1,0))
				}
				let winWords=["It deals higher DPT.","Defend is important anyways.","High damage saves time.","It is the best for mobs with high health."]
				if(travelerCard.dpt>opponentCard.dpt) {
					talkElement.style.top=getGrid(0,1,5).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Traveler"
					momentumDecrease("Opponent")
					talkElement.innerHTML=winWords[travelerCard.id]
					if(travelerCard.name==="Dice" && opponentCard.name==="Dice") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				if(opponentCard.dpt>travelerCard.dpt) {
					talkElement.style.top=getGrid(0,1,2).getBoundingClientRect().top+30+"px"
					fight.spevent.turn="Opponent"
					momentumDecrease("Traveler")
					talkElement.innerHTML=winWords[opponentCard.id]
					if(travelerCard.name==="Dice" && opponentCard.name==="Dice") talkElement.innerHTML=winWords[0]
					document.body.appendChild(talkElement)
					await delay(2000)
					talkElement.remove()
					return
				}
				await delay(1000)
				return
			}
			await delay(1000)
			return
		}
		function opponentChoice(cardRarity) {
			let cardSlot=[0,1,2,4,5,7,8]
			for(let i=1;i<=5;i++) {
				let swapPlace=roll(i,6)
				if(swapPlace>i) {
					cardSlot[swapPlace]+=cardSlot[i]
					cardSlot[i]=cardSlot[swapPlace]-cardSlot[i]
					cardSlot[swapPlace]=cardSlot[swapPlace]-cardSlot[i]
				}
			}
			if(determine(15)) {
				fight.spevent.opponentselect=cardSlot[1]
				return
			}
			if(cardRarity===5) {
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id>=6) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===5 && fight.spevent.topic===5) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				let typeCount=new Array(9).fill(0)
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id<=4) typeCount[fight.spevent.opponentcard[cardSlot[i]].id]++
				for(let i=1;i<=7;i++) for(let j=1;j<=6;j++) if(typeCount[fight.spevent.opponentcard[cardSlot[j]].id]>=2 && fight.spevent.opponentcard[cardSlot[j]].rarity+fight.spevent.opponentcard[cardSlot[j]].level===i) {
					fight.spevent.opponentselect=cardSlot[j]
					return
				}
				fight.spevent.opponentselect=cardSlot[1]
				return
			}
			if(cardRarity>0) {
				if(fight.spevent.topic>=4) {
					for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===5 && fight.spevent.topic===5) {
						fight.spevent.opponentselect=cardSlot[i]
						return
					}
					for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===4) {
						fight.spevent.opponentselect=cardSlot[i]
						return
					}
					for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===5) {
						fight.spevent.opponentselect=cardSlot[i]
						return
					}
					for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id>=6) {
						fight.spevent.opponentselect=cardSlot[i]
						return
					}
					let typeCount=new Array(9).fill(0)
					for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id<=4) typeCount[fight.spevent.opponentcard[cardSlot[i]].id]++
					for(let i=1;i<=7;i++) for(let j=1;j<=6;j++) if(typeCount[fight.spevent.opponentcard[cardSlot[j]].id]>=2 && fight.spevent.opponentcard[cardSlot[j]].rarity+fight.spevent.opponentcard[cardSlot[j]].level===i) {
						fight.spevent.opponentselect=cardSlot[j]
						return
					}
					fight.spevent.opponentselect=cardSlot[1]
					return
				}
				let functionalCount=0
				for(let i=1;i<=6;i++) {
					if(fight.spevent.opponentcard[cardSlot[i]].id>=6) functionalCount++
					if(fight.spevent.opponentcard[cardSlot[i]].id===8) functionalCount+=9
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===8 && functionalCount%10===0) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===6) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===7 && functionalCount>=2) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				let maxStat=1,maxSlot=0
				for(let i=1;i<=6;i++) {
					let newStat
					if(fight.spevent.topic===1) newStat=fight.spevent.opponentcard[cardSlot[i]].health
					if(fight.spevent.topic===2) newStat=fight.spevent.opponentcard[cardSlot[i]].damage
					if(fight.spevent.topic===3) newStat=fight.spevent.opponentcard[cardSlot[i]].dpt
					if(newStat>maxStat) {
						maxStat=newStat
						maxSlot=cardSlot[i]
					}
				}
				if(maxSlot!==0) {
					fight.spevent.opponentselect=maxSlot
					return
				}
				fight.spevent.opponentselect=cardSlot[1]
				return
			}
			if(fight.spevent.topic>=4) {
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===5 && fight.spevent.topic===5) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				let functionalCount=0
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id>=6) functionalCount++
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===4 && functionalCount<=2) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id>=6) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===5) {
					fight.spevent.opponentselect=cardSlot[i]
					return
				}
				let typeCount=new Array(9).fill(0)
				for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id<=4) typeCount[fight.spevent.opponentcard[cardSlot[i]].id]++
				for(let i=1;i<=7;i++) for(let j=1;j<=6;j++) if(typeCount[fight.spevent.opponentcard[cardSlot[j]].id]>=2 && fight.spevent.opponentcard[cardSlot[j]].rarity+fight.spevent.opponentcard[cardSlot[j]].level===i) {
					fight.spevent.opponentselect=cardSlot[j]
					return
				}
				fight.spevent.opponentselect=cardSlot[1]
				return
			}
			let functionalCount=0
			for(let i=1;i<=6;i++) {
				if(fight.spevent.opponentcard[cardSlot[i]].id>=6) functionalCount++
				if(fight.spevent.opponentcard[cardSlot[i]].id===8) functionalCount+=9
			}
			for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===8 && functionalCount%10===0) {
				fight.spevent.opponentselect=cardSlot[i]
				return
			}
			for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===7 && functionalCount>=3) {
				fight.spevent.opponentselect=cardSlot[i]
				return
			}
			for(let i=1;i<=6;i++) if(fight.spevent.opponentcard[cardSlot[i]].id===6 && functionalCount>=3) {
				fight.spevent.opponentselect=cardSlot[i]
				return
			}
			let maxStat=1,maxSlot=0
			for(let i=1;i<=6;i++) {
				let newStat
				if(fight.spevent.topic===1) newStat=fight.spevent.opponentcard[cardSlot[i]].health
				if(fight.spevent.topic===2) newStat=fight.spevent.opponentcard[cardSlot[i]].damage
				if(fight.spevent.topic===3) newStat=fight.spevent.opponentcard[cardSlot[i]].dpt
				if(newStat>maxStat) {
					maxStat=newStat
					maxSlot=cardSlot[i]
				}
			}
			if(maxSlot!==0) {
				fight.spevent.opponentselect=maxSlot
				return
			}
			fight.spevent.opponentselect=cardSlot[1]
			return
		}
		async function playCard(playerchoice) {
			if(animation) return
			animation=true
			fight.spevent.travelerselect=playerchoice
			getGrid(0,fight.spevent.travelerselect,6).replaceWith(createGrid(0,fight.spevent.travelerselect,6,"Empty",1,0))
			fight.spevent.travelercard[fight.spevent.travelerselect].print(5,4)
			selectedGrid.select=false
			closeGridInfo(true)
			if(fight.spevent.turn==="Traveler") {
				opponentChoice(fight.spevent.travelercard[fight.spevent.travelerselect].rarity)
				getGrid(0,fight.spevent.opponentselect,1).replaceWith(createGrid(0,fight.spevent.opponentselect,1,"Empty",1,0))
			}
			fight.spevent.opponentcard[fight.spevent.opponentselect].print(4,3,true)
			await compareCard(fight.spevent.topic,fight.spevent.travelercard[fight.spevent.travelerselect],fight.spevent.opponentcard[fight.spevent.opponentselect])
			getGrid(0,4,3).replaceWith(createGrid(0,4,3,"Empty",1,0))
			getGrid(0,5,3).replaceWith(createGrid(0,5,3,"Empty",1,0))
			getGrid(0,4,4).replaceWith(createGrid(0,4,4,"Empty",1,0))
			getGrid(0,5,4).replaceWith(createGrid(0,5,4,"Empty",1,0))
			if(fight.spevent.travelermomentum<=0) {
				await delay(1000)
				animation=false
				endFight()
				return
			}
			if(fight.spevent.opponentmomentum<=0) {
				await delay(1000)
				animation=false
				endFight(true)
				return
			}
			fight.spevent.travelercard[fight.spevent.travelerselect]=new Card("Traveler")
			fight.spevent.travelercard[fight.spevent.travelerselect].print(fight.spevent.travelerselect,6)
			fight.spevent.opponentcard[fight.spevent.opponentselect]=new Card(fight.spevent.event-100)
			fight.spevent.opponentcard[fight.spevent.opponentselect].print(fight.spevent.opponentselect,1)
			fight.spevent.topic=roll(1,4)
			if(fight.spevent.topic===4 && determine(20)) fight.spevent.topic=5
			printTopic(fight.spevent.topic)
			if(fight.spevent.turn==="Opponent") {
				opponentChoice(0)
				getGrid(0,fight.spevent.opponentselect,1).replaceWith(createGrid(0,fight.spevent.opponentselect,1,"Empty",1,0))
				fight.spevent.opponentcard[fight.spevent.opponentselect].print(4,3)
			}
			animation=false
		}
	</script>
	<script>
		const perfectGame="The game is perfect, there are no bugs"
		console.log(perfectGame)
	</script>
</head>
<body>
	<div class="tl">
		<button type="button" tabindex='-1' onclick="settings()" class="circbtn" title="Settings">
			<svg id="cog" viewBox="0 0 100 100" class="in-svg">
				<path d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2"/>
				<path class="fblack-path" d="M50 30A20 20 0 0 0 50 70L50 60A10 10 0 0 1 50 40L50 30A20 20 0 0 1 50 70L50 60A10 10 0 0 0 50 40Z"/>
				<path class="fblack-path" d="M45 22L55 22L55 35L45 35ZM78 45L78 55L65 55L65 45ZM55 78L45 78L45 65L55 65ZM22 55L22 45L35 45L35 55Z"/>
				<path class="diag fblack-path" d="M45 22L55 22L55 35L45 35ZM78 45L78 55L65 55L65 45ZM55 78L45 78L45 65L55 65ZM22 55L22 45L35 45L35 55Z"/>
			</svg>
		</button>
	</div>
	<div class="tr">
		<button type="button" tabindex='-1' onclick="howToPlay()" class="circbtn" title="How to play">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path id="helpsvg" d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2M35 35A15 15 0 1 1 59 47A22.5 22.5 0 0 0 50 65"/>
				<path class="fblack-path" d="M50 75A4 4 0 0 0 50 83A4 4 0 0 0 50 75"/>
			</svg>
		</button>
	</div>
	<div class="bl">
		<button type="button" tabindex='-1' onclick="openInventory()" class="circbtn" title="Inventory">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2"/>
				<path class="fyellow-path wide" d="M50 35A15 15 0 0 0 50 65A15 15 0 0 0 50 35"/>
				<g id="flower">
					<path class="fgreen-path" d="M41.5 36.8A10 13 0 1 1 58.5 36.8A15.7 15.7 0 0 0 41.5 36.8"/>
					<path class="rot72 fblue-path" d="M41.5 36.8A10 13 0 1 1 58.5 36.8A15.7 15.7 0 0 0 41.5 36.8"/>
					<path class="rot144 fred-path" d="M41.5 36.8A10 13 0 1 1 58.5 36.8A15.7 15.7 0 0 0 41.5 36.8"/>
					<path class="rot216 fcyan-path" d="M41.5 36.8A10 13 0 1 1 58.5 36.8A15.7 15.7 0 0 0 41.5 36.8"/>
					<path class="rot288 fpurple-path" d="M41.5 36.8A10 13 0 1 1 58.5 36.8A15.7 15.7 0 0 0 41.5 36.8"/>
				</g>
			</svg>
		</button>
	</div>
	<div class="br">
		<button type="button" tabindex='-1' onclick="openGallery()" class="circbtn" title="Gallery">
			<svg viewBox="0 0 100 100" class="in-svg">
				<g id="ladybug-bg" class="nd">
					<path class="flgreen-path ns" d="M0 0L50 0L50 50L0 50ZM100 0L150 0L150 50L100 50ZM0 100L50 100L50 150L0 150ZM100 100L150 100L150 150L100 150Z"/>
					<path class="flred-path ns" d="M50 0L100 0L100 50L50 50ZM150 0L200 0L200 50L150 50ZM50 100L100 100L100 150L50 150ZM150 100L200 100L200 150L150 150Z"/>
					<path class="flblue-path ns" d="M0 50L50 50L50 100L0 100ZM100 50L150 50L150 100L100 100ZM0 150L50 150L50 200L0 200ZM100 150L150 150L150 200L100 200Z"/>
					<path class="fpurple-path ns" d="M50 50L100 50L100 100L50 100ZM150 50L200 50L200 100L150 100ZM50 150L100 150L100 200L50 200ZM150 150L200 150L200 200L150 200Z"/>
				</g>
				<path d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2"/>
				<g id="ladybug">
					<path class="fred-path wide" d="M62 34A20 20 0 1 1 38 34Z"/>
					<path class="fblack-path" d="M38 34A12 5 0 0 1 62 34A12 5 0 0 1 38 34"/>
					<path class="fblack-path" d="M45 47A3 3 0 0 0 45 53A3 3 0 0 0 45 47"/>
					<path class="fblack-path" d="M48 62A3 3 0 0 0 48 68A3 3 0 0 0 48 62"/>
					<path class="fblack-path" d="M62 51A3 3 0 0 0 62 57A3 3 0 0 0 62 51"/>
				</g>
			</svg>
		</button>
	</div>
	<div id="settings" class="mid grey-bg box highz hsize nd"></div>
	<div id="help" class="mid llpurple-bg box highz hsize nd">
		<button type="button" tabindex='-1' onclick="book(-1)" class="circbtn tl" title="Previous book">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path class="rcap" d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2M20 50L40 30M20 50L40 70M20 50L80 50"/>
			</svg>
		</button>
		<button type="button" tabindex='-1' onclick="book(1)" class="circbtn tr" title="Next book">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path class="rcap" d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2M80 50L60 30M80 50L60 70M80 50L20 50"/>
			</svg>
		</button>
		<div id="book-content" class="cflex"></div>
		<br>
		<span class="nowrap"></span>
		<br>
		<span></span>
		<br>
		<span>QQ: 807581283</span>
		<br>
	</div>
	<div id="inventory" class="mid lblue-bg box highz hsize nd">
		<div class="text3-c">
			<button type="button" tabindex='-1' id="lup-cancel" onclick="cancelLevelUp()" class="lmargin lred-bg recbtn pointer nd">Cancel</button>
			<h2>Inventory</h2>
			<button type="button" tabindex='-1' id="lup-confirm" onclick="levelUp()" class="lmargin corange-bg recbtn pointer nd">[L] Level Up</button>
		</div>
		<span class="nowrap"></span>
		<br>
		<div id="inv-petal" class="col5"></div>
		<br>
		<button type="button" tabindex='-1' id="absall-btn" onclick="absorbAll()" class="bottommargin red-bg recbtn pointer mcont cself nd">Absorb All Petals Without Star</button>
	</div>
	<div id="gallery" class="mid lyellow-bg box highz hsize nd"></div>
	<div class="cmargin text3-c">
		<button type="button" tabindex='-1' onclick="importSave()" class="lmargin lblue-bg recbtn pointer" title="Import Save">Retrieve Memories</button>
		<button type="button" tabindex='-1' onclick="hardReset()" class="lmargin lred-bg recbtn forbidden" title="HARD RESET">Restart the Universe</button>
		<button type="button" tabindex='-1' id="export-btn" onclick="exportSave()" class="lmargin lyellow-bg recbtn pointer" title="Export Save">Store Memories</button>
	</div>
	<div id="calendar" class="cmargin text2-c nd">
		<span id="calendar-day"></span>
		<span class="lmargin">,</span>
		<span id="calendar-hour"></span>
		<span class="llmargin">:</span>
		<span id="calendar-minute"></span>
	</div>
	<div id="fight-btn" class="mid text3-c nd">
		<button type="button" tabindex='-1' id="fight-t-btn" class="lmargin grey-bg recbtn forbidden">[T]</button>
	</div>
	<div id="fight-container" class="mid square48 nd">
	</div>
	<div id="fight-item" class="mid itembox nd">
	</div>
	<div id="map-container" class="mid lhsize border nd">
		<svg id="blank" viewBox="0 0 100 100" class="in-svg drag">
			<g id="map-trans">
				<path onclick="chooseMap(this)" value="10" class="fgrey-path pointer ns" d="M50 48A2 2 0 0 0 50 52A2 2 0 0 0 50 48"/>
				<path onclick="chooseMap(this)" value="11" class="flgreen-path pointer ns" d="M57 71A2 2 0 0 0 57 75A2 2 0 0 0 57 71"/>
				<path onclick="chooseMap(this)" value="12" class="flgreen-path pointer ns" d="M12 68A2 2 0 0 0 12 72A2 2 0 0 0 12 68"/>
				<path onclick="chooseMap(this)" value="13" class="flgreen-path pointer ns" d="M10 31A2 2 0 0 0 10 35A2 2 0 0 0 10 31"/>
				<path onclick="chooseMap(this)" value="14" class="flgreen-path pointer ns" d="M-34 37A2 2 0 0 0 -34 41A2 2 0 0 0 -34 37"/>
				<path onclick="chooseMap(this)" value="15" class="flgreen-path pointer ns" d="M16 -13A2 2 0 0 0 16 -9A2 2 0 0 0 16 -13"/>
				<path onclick="chooseMap(this)" value="16" class="flgreen-path pointer ns" d="M-36 -22A2 2 0 0 0 -36 -18A2 2 0 0 0 -36 -22"/>
				<path onclick="chooseMap(this)" value="17" class="flgreen-path pointer ns" d="M0 -67A2 2 0 0 0 0 -63A2 2 0 0 0 0 -67"/>
				<path onclick="chooseMap(this)" value="21" class="fyellow-path pointer ns" d="M52 104A2 2 0 0 0 52 108A2 2 0 0 0 52 104"/>
				<path onclick="chooseMap(this)" value="22" class="fyellow-path pointer ns" d="M10 117A2 2 0 0 0 10 121A2 2 0 0 0 10 117"/>
				<path onclick="chooseMap(this)" value="23" class="fyellow-path pointer ns" d="M-33 154A2 2 0 0 0 -33 158A2 2 0 0 0 -33 154"/>
				<path onclick="chooseMap(this)" value="24" class="fyellow-path pointer ns" d="M0 149A2 2 0 0 0 0 153A2 2 0 0 0 0 149"/>
				<path onclick="chooseMap(this)" value="25" class="fyellow-path pointer ns" d="M-32 128A2 2 0 0 0 -32 132A2 2 0 0 0 -32 128"/>
				<path onclick="chooseMap(this)" value="26" class="fyellow-path pointer ns" d="M-26 96A2 2 0 0 0 -26 100A2 2 0 0 0 -26 96"/>
				<path onclick="chooseMap(this)" value="31" class="fblue-path pointer ns" d="M100 4A2 2 0 0 0 100 8A2 2 0 0 0 100 4"/>
				<path onclick="chooseMap(this)" value="32" class="fblue-path pointer ns" d="M115 -28A2 2 0 0 0 115 -24A2 2 0 0 0 115 -28"/>
				<path onclick="chooseMap(this)" value="33" class="fblue-path pointer ns" d="M135 12A2 2 0 0 0 135 16A2 2 0 0 0 135 12"/>
				<path onclick="chooseMap(this)" value="34" class="fblue-path pointer ns" d="M182 9A2 2 0 0 0 182 13A2 2 0 0 0 182 9"/>
				<path onclick="chooseMap(this)" value="35" class="fblue-path pointer ns" d="M138 44A2 2 0 0 0 138 48A2 2 0 0 0 138 44"/>
				<path onclick="chooseMap(this)" value="36" class="fblue-path pointer ns" d="M160 -34A2 2 0 0 0 160 -30A2 2 0 0 0 160 -34"/>
				<path onclick="chooseMap(this)" value="37" class="fblue-path pointer ns" d="M151 71A2 2 0 0 0 151 75A2 2 0 0 0 151 71"/>
				<path onclick="chooseMap(this)" value="38" class="fblue-path pointer ns" d="M178 42A2 2 0 0 0 178 46A2 2 0 0 0 178 42"/>
				<path onclick="chooseMap(this)" value="39" class="fblue-path pointer ns" d="M108 -74A2 2 0 0 0 108 -70A2 2 0 0 0 108 -74"/>
				<path onclick="chooseMap(this)" value="41" class="fdbrown-path pointer ns" d="M31 5A2 2 0 0 0 31 9A2 2 0 0 0 31 5"/>
				<path onclick="chooseMap(this)" value="42" class="fdbrown-path pointer ns" d="M40 -17A2 2 0 0 0 40 -13A2 2 0 0 0 40 -17"/>
				<path onclick="chooseMap(this)" value="43" class="fdbrown-path pointer ns" d="M82 -18A2 2 0 0 0 82 -14A2 2 0 0 0 82 -18"/>
				<path onclick="chooseMap(this)" value="44" class="fdbrown-path pointer ns" d="M63 -50A2 2 0 0 0 63 -46A2 2 0 0 0 63 -50"/>
				<path onclick="chooseMap(this)" value="51" class="fdbrown-path pointer ns" d="M-56 51A2 2 0 0 0 -56 55A2 2 0 0 0 -56 51"/>
				<path onclick="chooseMap(this)" value="52" class="fdbrown-path pointer ns" d="M-32 69A2 2 0 0 0 -32 73A2 2 0 0 0 -32 69"/>
				<path onclick="chooseMap(this)" value="53" class="fdbrown-path pointer ns" d="M-59 169A2 2 0 0 0 -59 173A2 2 0 0 0 -59 169"/>
				<path onclick="chooseMap(this)" value="54" class="fdbrown-path pointer ns" d="M-19 184A2 2 0 0 0 -19 188A2 2 0 0 0 -19 184"/>
				<path onclick="chooseMap(this)" value="55" class="fdbrown-path pointer ns" d="M90 156A2 2 0 0 0 90 160A2 2 0 0 0 90 156"/>
				<path onclick="chooseMap(this)" value="56" class="fdbrown-path pointer ns" d="M144 141A2 2 0 0 0 144 145A2 2 0 0 0 144 141"/>
				<path onclick="chooseMap(this)" value="61" class="fdgreen-path pointer ns" d="M103 91A2 2 0 0 0 103 95A2 2 0 0 0 103 91"/>
				<path onclick="chooseMap(this)" value="62" class="fdgreen-path pointer ns" d="M106 128A2 2 0 0 0 106 132A2 2 0 0 0 106 128"/>
				<path onclick="chooseMap(this)" value="63" class="fdgreen-path pointer ns" d="M141 121A2 2 0 0 0 141 125A2 2 0 0 0 141 121"/>
				<path onclick="chooseMap(this)" value="64" class="fdgreen-path pointer ns" d="M166 122A2 2 0 0 0 166 126A2 2 0 0 0 166 122"/>
				<path onclick="chooseMap(this)" value="65" class="fdgreen-path pointer ns" d="M121 154A2 2 0 0 0 121 158A2 2 0 0 0 121 154"/>
				<path onclick="chooseMap(this)" value="66" class="fdgreen-path pointer ns" d="M157 156A2 2 0 0 0 157 160A2 2 0 0 0 157 156"/>
				<path onclick="chooseMap(this)" value="67" class="fdgreen-path pointer ns" d="M159 179A2 2 0 0 0 159 183A2 2 0 0 0 159 179"/>
				<path id="flowerspot" class="fyellow-path pointer narrowp npe" d="M50 48.5A1.5 1.5 0 0 0 50 51.5A1.5 1.5 0 0 0 50 48.5M49.2 50.4A1 1 0 0 0 50.8 50.4M49.5 49.2L49.5 50M50.5 49.2L50.5 50"/>
			</g>
		</svg>
		<button type="button" tabindex='-1' id="home-btn" onclick="home('origin')" class="mid circbtn nd" title="Home">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2"/>
				<path class="fyellow-path" d="M20 45L50 20L80 45Z"/>
				<path class="fdbrown-path" d="M30 45L30 75L70 75L70 45Z"/>
				<path class="fdgreen-path" d="M52 75L52 55L64 55L64 75Z"/>
			</svg>
		</button>
		<button type="button" tabindex='-1' id="flower-btn" onclick="home('flower')" class="mid circbtn nd" title="Flower">
			<svg viewBox="0 0 100 100" class="in-svg">
				<path d="M50 2A48 48 0 0 0 50 98A48 48 0 0 0 50 2"/>
				<path class="fyellow-path" d="M50 20A30 30 0 0 0 50 80A30 30 0 0 0 50 20M34 58A20 20 0 0 0 66 58M40 34L40 50M60 34L60 50"/>
			</svg>
		</button>
	</div>
	<div id="map-item" class="mid itembox nd">
	</div>
	<div id="mapinfo" class="llcyan-bg mid infobox nd"></div>
	<div id="gridinfo" class="llpurple-bg mid infobox highestz nd"></div>
	<div id="central-room" class="mid lhsize border nd"></div>
	<div id="dialog" class="mid infobox text3-c shwidth nd" onclick="dialog('Skip',6361)">
		<h3 id="dialog-title">Title</h3>
		<span id="dialog-maintext"></span>
		<br>
	</div>
	<div id="log" class="side-log"></div>
	<div id="command" class="side-command text3-c">
		<input type="text" tabindex='-1' id="command-call" onkeydown="command(event.key)" class="side-input" autocomplete="off" title="Command">
		<svg viewBox="0 0 10 10" id="cleaner" onclick="cleanLog()" class="llmargin small-svg circ">
			<path class="fred-path black-path mwidth" d="M5 0A5 5 0 0 0 5 10A5 5 0 0 0 5 0"/>
			<path class="cyan-path mwidth" d="M3 3L7 7"/>
			<path class="cyan-path mwidth" d="M7 3L3 7"/>
		</svg>
		<svg viewBox="0 0 10 10" id="expander" onclick="expandLog()" class="small-svg circ">
			<path class="fgreen-path black-path mwidth" d="M5 0A5 5 0 0 0 5 10A5 5 0 0 0 5 0"/>
			<path class="purple-path mwidth nd" d="M5 2L5 8"/>
			<path class="purple-path mwidth" d="M2 5L8 5"/>
		</svg>
	</div>
	<div id="side-state" class="tl cmid rflex">
		<div id="bar-energy-c" class="side-bar-container nd">
			<div id="bar-energy" class="cyan-bg side-bar text2-c cflex"></div>
		</div>
	</div>
	<div id="flower-state" class="bottom text3-c cflex">
		<span id="flower-maxhealth">&nbsp;</span>
		<span id="flower-level">&nbsp;</span>
		<div id="bar-exp-c" class="bar-container nd">
			<div id="bar-exp" class="bar"></div>
			<div id="flower-exp" class="bar-text"></div>
		</div>
		<div id="bar-health-c" class="bar-container nd">
			<div id="bar-health" class="bar"></div>
			<div id="flower-health" class="bar-text"></div>
		</div>
		<div id="flower-effect" class="apos nlh"></div>
	</div>
	<div id="version1"></div>
	<div id="version2">
		<h2>Announcement</h2>
		<span>This game was updated again when you left!</span>
		<span>Do you want to perform a <span class="bold">hard reset</span> before starting the game?</span>
		<br>
		<span>The last update was on 2026/2/5,</span>
		<span>which updated keyboard control.</span>
		<span>More QoL will be complemented later.</span>
		<br>
		<span>The last update before was on 2026/2/3,</span>
		<span>which updated Time Shard (minigame reward).</span>
		<span>"T" key is available now, more keyboard control soon.</span>
		<br>
		<span>The last important update before was on 2026/1/22,</span>
		<span>which updated Floor 1.</span>
		<span>Fixed some bugs. Small rebalancing (shootable petals mostly).</span>
		<span>Some special event, floor ending, talent is still not available.</span>
		<br>
		<button type="button" tabindex='-1' id="version3" onclick="updateVersion(false)">No, just update the version.</button>
		<br>
		<button type="button" tabindex='-1' id="version4" onclick="updateVersion(true)">Yes, hard reset before starting.</button>
	</div>
	<div id="endgame1"></div>
	<div id="endgame2"></div>
	<div id="end1"></div>
	<div id="end2"></div>
</body>
</html>
